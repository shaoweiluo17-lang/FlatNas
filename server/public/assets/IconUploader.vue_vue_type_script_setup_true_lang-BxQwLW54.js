import{d as oe,a as y,e as w,b as S,g as l,l as T,I as he,q as P,p as E,t as L,u as de,r as X,c as _,y as ke,F as te,E as se,f as ie,j as N,m as z,i as C,z as Oe,A as Me,h as ce,T as pe,k as ue}from"./index-CEb9R0bB.js";const ge={};ge.getData=e=>new Promise((s,i)=>{let t={};We(e).then(o=>{t.arrayBuffer=o;try{t.orientation=Se(o)}catch{t.orientation=-1}s(t)}).catch(o=>{i(o)})});function We(e){let s=null;return new Promise((i,t)=>{if(e.src)if(/^data\:/i.test(e.src))s=He(e.src),i(s);else if(/^blob\:/i.test(e.src)){var o=new FileReader;o.onload=function(a){s=a.target.result,i(s)},Ie(e.src,function(a){o.readAsArrayBuffer(a)})}else{var r=new XMLHttpRequest;r.onload=function(){if(this.status==200||this.status===0)s=r.response,i(s);else throw"Could not load image";r=null},r.open("GET",e.src,!0),r.responseType="arraybuffer",r.send(null)}else t("img error")})}function Ie(e,s){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=function(t){(this.status==200||this.status===0)&&s(this.response)},i.send()}function He(e,s){s=s||e.match(/^data\:([^\;]+)\;base64,/mi)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gmi,"");for(var i=atob(e),t=i.length%2==0?i.length:i.length+1,o=new ArrayBuffer(t),r=new Uint16Array(o),a=0;a<t;a++)r[a]=i.charCodeAt(a);return o}function Xe(e,s,i){var t="",o;for(o=s,i+=s;o<i;o++)t+=String.fromCharCode(e.getUint8(o));return t}function Se(e){var s=new DataView(e),i=s.byteLength,t,o,r,a,c,p,u,f,b,m;if(s.getUint8(0)===255&&s.getUint8(1)===216)for(b=2;b<i;){if(s.getUint8(b)===255&&s.getUint8(b+1)===225){u=b;break}b++}if(u&&(o=u+4,r=u+10,Xe(s,o,4)==="Exif"&&(p=s.getUint16(r),c=p===18761,(c||p===19789)&&s.getUint16(r+2,c)===42&&(a=s.getUint32(r+4,c),a>=8&&(f=r+a)))),f){for(i=s.getUint16(f,c),m=0;m<i;m++)if(b=f+m*12+2,s.getUint16(b,c)===274){b+=8,t=s.getUint16(b,c);break}}return t}const Ye=(e,s)=>{const i=e.__vccOpts||e;for(const[t,o]of s)i[t]=o;return i},Le=oe({data:function(){return{w:0,h:0,scale:1,x:0,y:0,loading:!0,trueWidth:0,trueHeight:0,move:!0,moveX:0,moveY:0,crop:!1,cropping:!1,cropW:0,cropH:0,cropOldW:0,cropOldH:0,canChangeX:!1,canChangeY:!1,changeCropTypeX:1,changeCropTypeY:1,cropX:0,cropY:0,cropChangeX:0,cropChangeY:0,cropOffsertX:0,cropOffsertY:0,support:"",touches:[],touchNow:!1,rotate:0,isIos:!1,orientation:0,imgs:"",coe:.2,scaling:!1,scalingSet:"",coeStatus:"",isCanShow:!0,imgIsQqualCrop:!1}},props:{img:{type:[String,Blob,null,File],default:""},outputSize:{type:Number,default:1},outputType:{type:String,default:"jpeg"},info:{type:Boolean,default:!0},canScale:{type:Boolean,default:!0},autoCrop:{type:Boolean,default:!1},autoCropWidth:{type:[Number,String],default:0},autoCropHeight:{type:[Number,String],default:0},fixed:{type:Boolean,default:!1},fixedNumber:{type:Array,default:()=>[1,1]},fixedBox:{type:Boolean,default:!1},full:{type:Boolean,default:!1},canMove:{type:Boolean,default:!0},canMoveBox:{type:Boolean,default:!0},original:{type:Boolean,default:!1},centerBox:{type:Boolean,default:!1},high:{type:Boolean,default:!0},infoTrue:{type:Boolean,default:!1},maxImgSize:{type:[Number,String],default:2e3},enlarge:{type:[Number,String],default:1},preW:{type:[Number,String],default:0},mode:{type:String,default:"contain"},limitMinSize:{type:[Number,Array,String],default:()=>10,validator:function(e){return Array.isArray(e)?Number(e[0])>=0&&Number(e[1])>=0:Number(e)>=0}},fillColor:{type:String,default:""}},computed:{cropInfo(){let e={};if(e.top=this.cropOffsertY>21?"-21px":"0px",e.width=this.cropW>0?this.cropW:0,e.height=this.cropH>0?this.cropH:0,this.infoTrue){let s=1;this.high&&!this.full&&(s=window.devicePixelRatio),this.enlarge!==1&!this.full&&(s=Math.abs(Number(this.enlarge))),e.width=e.width*s,e.height=e.height*s,this.full&&(e.width=e.width/this.scale,e.height=e.height/this.scale)}return e.width=e.width.toFixed(0),e.height=e.height.toFixed(0),e},isIE(){return!!window.ActiveXObject||"ActiveXObject"in window},passive(){return this.isIE?null:{passive:!1}},isRotateRightOrLeft(){return[1,-1,3,-3].includes(this.rotate)}},watch:{img(){this.checkedImg()},imgs(e){e!==""&&this.reload()},cropW(){this.showPreview()},cropH(){this.showPreview()},cropOffsertX(){this.showPreview()},cropOffsertY(){this.showPreview()},scale(e,s){this.showPreview()},x(){this.showPreview()},y(){this.showPreview()},autoCrop(e){e&&this.goAutoCrop()},autoCropWidth(){this.autoCrop&&this.goAutoCrop()},autoCropHeight(){this.autoCrop&&this.goAutoCrop()},mode(){this.checkedImg()},rotate(){this.showPreview(),this.autoCrop?this.goAutoCrop(this.cropW,this.cropH):(this.cropW>0||this.cropH>0)&&this.goAutoCrop(this.cropW,this.cropH)}},methods:{getVersion(e){var s=navigator.userAgent.split(" "),i="";let t=0;const o=new RegExp(e,"i");for(var r=0;r<s.length;r++)o.test(s[r])&&(i=s[r]);return i?t=i.split("/")[1].split("."):t=["0","0","0"],t},checkOrientationImage(e,s,i,t){if(this.getVersion("chrome")[0]>=81)s=-1;else if(this.getVersion("safari")[0]>=605){const a=this.getVersion("version");a[0]>13&&a[1]>1&&(s=-1)}else{const a=navigator.userAgent.toLowerCase().match(/cpu iphone os (.*?) like mac os/);if(a){let c=a[1];c=c.split("_"),(c[0]>13||c[0]>=13&&c[1]>=4)&&(s=-1)}}let o=document.createElement("canvas"),r=o.getContext("2d");switch(r.save(),s){case 2:o.width=i,o.height=t,r.translate(i,0),r.scale(-1,1);break;case 3:o.width=i,o.height=t,r.translate(i/2,t/2),r.rotate(180*Math.PI/180),r.translate(-i/2,-t/2);break;case 4:o.width=i,o.height=t,r.translate(0,t),r.scale(1,-1);break;case 5:o.height=i,o.width=t,r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:o.width=t,o.height=i,r.translate(t/2,i/2),r.rotate(90*Math.PI/180),r.translate(-i/2,-t/2);break;case 7:o.height=i,o.width=t,r.rotate(.5*Math.PI),r.translate(i,-t),r.scale(-1,1);break;case 8:o.height=i,o.width=t,r.translate(t/2,i/2),r.rotate(-90*Math.PI/180),r.translate(-i/2,-t/2);break;default:o.width=i,o.height=t}r.drawImage(e,0,0,i,t),r.restore(),o.toBlob(a=>{let c=URL.createObjectURL(a);URL.revokeObjectURL(this.imgs),this.imgs=c},"image/"+this.outputType,1)},checkedImg(){if(this.img===null||this.img===""){this.imgs="",this.clearCrop();return}this.loading=!0,this.scale=1,this.rotate=0,this.imgIsQqualCrop=!1,this.clearCrop();let e=new Image;if(e.onload=()=>{if(this.img==="")return this.$emit("img-load",new Error("å›¾ç‰‡ä¸èƒ½ä¸ºç©º")),!1;let i=e.width,t=e.height;ge.getData(e).then(o=>{this.orientation=o.orientation||1;let r=Number(this.maxImgSize);if(!this.orientation&&i<r&t<r){this.imgs=this.img;return}i>r&&(t=t/i*r,i=r),t>r&&(i=i/t*r,t=r),this.checkOrientationImage(e,this.orientation,i,t)}).catch(o=>{this.$emit("img-load","error"),this.$emit("img-load-error",o)})},e.onerror=i=>{this.$emit("img-load","error"),this.$emit("img-load-error",i)},this.img.substr(0,4)!=="data"&&(e.crossOrigin=""),this.isIE){var s=new XMLHttpRequest;s.onload=function(){var i=URL.createObjectURL(this.response);e.src=i},s.open("GET",this.img,!0),s.responseType="blob",s.send()}else e.src=this.img},startMove(e){if(e.preventDefault(),this.move&&!this.crop){if(!this.canMove)return!1;this.moveX=("clientX"in e?e.clientX:e.touches[0].clientX)-this.x,this.moveY=("clientY"in e?e.clientY:e.touches[0].clientY)-this.y,e.touches?(window.addEventListener("touchmove",this.moveImg),window.addEventListener("touchend",this.leaveImg),e.touches.length==2&&(this.touches=e.touches,window.addEventListener("touchmove",this.touchScale),window.addEventListener("touchend",this.cancelTouchScale))):(window.addEventListener("mousemove",this.moveImg),window.addEventListener("mouseup",this.leaveImg)),this.$emit("img-moving",{moving:!0,axis:this.getImgAxis()})}else this.cropping=!0,window.addEventListener("mousemove",this.createCrop),window.addEventListener("mouseup",this.endCrop),window.addEventListener("touchmove",this.createCrop),window.addEventListener("touchend",this.endCrop),this.cropOffsertX=e.offsetX?e.offsetX:e.touches[0].pageX-this.$refs.cropper.offsetLeft,this.cropOffsertY=e.offsetY?e.offsetY:e.touches[0].pageY-this.$refs.cropper.offsetTop,this.cropX="clientX"in e?e.clientX:e.touches[0].clientX,this.cropY="clientY"in e?e.clientY:e.touches[0].clientY,this.cropChangeX=this.cropOffsertX,this.cropChangeY=this.cropOffsertY,this.cropW=0,this.cropH=0},touchScale(e){e.preventDefault();let s=this.scale;var i={x:this.touches[0].clientX,y:this.touches[0].clientY},t={x:e.touches[0].clientX,y:e.touches[0].clientY},o={x:this.touches[1].clientX,y:this.touches[1].clientY},r={x:e.touches[1].clientX,y:e.touches[1].clientY},a=Math.sqrt(Math.pow(i.x-o.x,2)+Math.pow(i.y-o.y,2)),c=Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2)),p=c-a,u=1;u=u/this.trueWidth>u/this.trueHeight?u/this.trueHeight:u/this.trueWidth,u=u>.1?.1:u;var f=u*p;if(!this.touchNow){if(this.touchNow=!0,p>0?s+=Math.abs(f):p<0&&s>Math.abs(f)&&(s-=Math.abs(f)),this.touches=e.touches,setTimeout(()=>{this.touchNow=!1},8),!this.checkoutImgAxis(this.x,this.y,s))return!1;this.scale=s}},cancelTouchScale(e){window.removeEventListener("touchmove",this.touchScale)},moveImg(e){if(e.preventDefault(),e.touches&&e.touches.length===2)return this.touches=e.touches,window.addEventListener("touchmove",this.touchScale),window.addEventListener("touchend",this.cancelTouchScale),window.removeEventListener("touchmove",this.moveImg),!1;let s="clientX"in e?e.clientX:e.touches[0].clientX,i="clientY"in e?e.clientY:e.touches[0].clientY,t,o;t=s-this.moveX,o=i-this.moveY,this.$nextTick(()=>{if(this.centerBox){let r=this.getImgAxis(t,o,this.scale),a=this.getCropAxis(),c=this.trueHeight*this.scale,p=this.trueWidth*this.scale,u,f,b,m;switch(this.rotate){case 1:case-1:case 3:case-3:u=this.cropOffsertX-this.trueWidth*(1-this.scale)/2+(c-p)/2,f=this.cropOffsertY-this.trueHeight*(1-this.scale)/2+(p-c)/2,b=u-c+this.cropW,m=f-p+this.cropH;break;default:u=this.cropOffsertX-this.trueWidth*(1-this.scale)/2,f=this.cropOffsertY-this.trueHeight*(1-this.scale)/2,b=u-p+this.cropW,m=f-c+this.cropH;break}r.x1>=a.x1&&(t=u),r.y1>=a.y1&&(o=f),r.x2<=a.x2&&(t=b),r.y2<=a.y2&&(o=m)}this.x=t,this.y=o,this.$emit("img-moving",{moving:!0,axis:this.getImgAxis()})})},leaveImg(e){window.removeEventListener("mousemove",this.moveImg),window.removeEventListener("touchmove",this.moveImg),window.removeEventListener("mouseup",this.leaveImg),window.removeEventListener("touchend",this.leaveImg),this.$emit("img-moving",{moving:!1,axis:this.getImgAxis()})},scaleImg(){this.canScale&&window.addEventListener(this.support,this.changeSize,this.passive)},cancelScale(){this.canScale&&window.removeEventListener(this.support,this.changeSize)},changeSize(e){e.preventDefault();let s=this.scale;var i=e.deltaY||e.wheelDelta,t=navigator.userAgent.indexOf("Firefox");i=t>0?i*30:i,this.isIE&&(i=-i);var o=this.coe;o=o/this.trueWidth>o/this.trueHeight?o/this.trueHeight:o/this.trueWidth;var r=o*i;r<0?s+=Math.abs(r):s>Math.abs(r)&&(s-=Math.abs(r));let a=r<0?"add":"reduce";if(a!==this.coeStatus&&(this.coeStatus=a,this.coe=.2),this.scaling||(this.scalingSet=setTimeout(()=>{this.scaling=!1,this.coe=this.coe+=.01},50)),this.scaling=!0,!this.checkoutImgAxis(this.x,this.y,s))return!1;this.scale=s},changeScale(e){let s=this.scale;e=e||1;var i=20;if(i=i/this.trueWidth>i/this.trueHeight?i/this.trueHeight:i/this.trueWidth,e=e*i,e>0?s+=Math.abs(e):s>Math.abs(e)&&(s-=Math.abs(e)),!this.checkoutImgAxis(this.x,this.y,s))return!1;this.scale=s},createCrop(e){e.preventDefault();var s="clientX"in e?e.clientX:e.touches?e.touches[0].clientX:0,i="clientY"in e?e.clientY:e.touches?e.touches[0].clientY:0;this.$nextTick(()=>{var t=s-this.cropX,o=i-this.cropY;if(t>0?(this.cropW=t+this.cropChangeX>this.w?this.w-this.cropChangeX:t,this.cropOffsertX=this.cropChangeX):(this.cropW=this.w-this.cropChangeX+Math.abs(t)>this.w?this.cropChangeX:Math.abs(t),this.cropOffsertX=this.cropChangeX+t>0?this.cropChangeX+t:0),!this.fixed)o>0?(this.cropH=o+this.cropChangeY>this.h?this.h-this.cropChangeY:o,this.cropOffsertY=this.cropChangeY):(this.cropH=this.h-this.cropChangeY+Math.abs(o)>this.h?this.cropChangeY:Math.abs(o),this.cropOffsertY=this.cropChangeY+o>0?this.cropChangeY+o:0);else{var r=this.cropW/this.fixedNumber[0]*this.fixedNumber[1];r+this.cropOffsertY>this.h?(this.cropH=this.h-this.cropOffsertY,this.cropW=this.cropH/this.fixedNumber[1]*this.fixedNumber[0],t>0?this.cropOffsertX=this.cropChangeX:this.cropOffsertX=this.cropChangeX-this.cropW):this.cropH=r,this.cropOffsertY=this.cropOffsertY}})},changeCropSize(e,s,i,t,o){e.preventDefault(),window.addEventListener("mousemove",this.changeCropNow),window.addEventListener("mouseup",this.changeCropEnd),window.addEventListener("touchmove",this.changeCropNow),window.addEventListener("touchend",this.changeCropEnd),this.canChangeX=s,this.canChangeY=i,this.changeCropTypeX=t,this.changeCropTypeY=o,this.cropX="clientX"in e?e.clientX:e.touches[0].clientX,this.cropY="clientY"in e?e.clientY:e.touches[0].clientY,this.cropOldW=this.cropW,this.cropOldH=this.cropH,this.cropChangeX=this.cropOffsertX,this.cropChangeY=this.cropOffsertY,this.fixed&&this.canChangeX&&this.canChangeY&&(this.canChangeY=0),this.$emit("change-crop-size",{width:this.cropW,height:this.cropH})},changeCropNow(e){e.preventDefault();var s="clientX"in e?e.clientX:e.touches?e.touches[0].clientX:0,i="clientY"in e?e.clientY:e.touches?e.touches[0].clientY:0;let t=this.w,o=this.h,r=0,a=0;if(this.centerBox){let u=this.getImgAxis(),f=u.x2,b=u.y2;r=u.x1>0?u.x1:0,a=u.y1>0?u.y1:0,t>f&&(t=f),o>b&&(o=b)}const[c,p]=this.checkCropLimitSize();this.$nextTick(()=>{var u=s-this.cropX,f=i-this.cropY;if(this.canChangeX&&(this.changeCropTypeX===1?this.cropOldW-u<c?(this.cropW=c,this.cropOffsertX=this.cropOldW+this.cropChangeX-r-c):this.cropOldW-u>0?(this.cropW=t-this.cropChangeX-u<=t-r?this.cropOldW-u:this.cropOldW+this.cropChangeX-r,this.cropOffsertX=t-this.cropChangeX-u<=t-r?this.cropChangeX+u:r):(this.cropW=Math.abs(u)+this.cropChangeX<=t?Math.abs(u)-this.cropOldW:t-this.cropOldW-this.cropChangeX,this.cropOffsertX=this.cropChangeX+this.cropOldW):this.changeCropTypeX===2&&(this.cropOldW+u<c?this.cropW=c:this.cropOldW+u>0?(this.cropW=this.cropOldW+u+this.cropOffsertX<=t?this.cropOldW+u:t-this.cropOffsertX,this.cropOffsertX=this.cropChangeX):(this.cropW=t-this.cropChangeX+Math.abs(u+this.cropOldW)<=t-r?Math.abs(u+this.cropOldW):this.cropChangeX-r,this.cropOffsertX=t-this.cropChangeX+Math.abs(u+this.cropOldW)<=t-r?this.cropChangeX-Math.abs(u+this.cropOldW):r))),this.canChangeY&&(this.changeCropTypeY===1?this.cropOldH-f<p?(this.cropH=p,this.cropOffsertY=this.cropOldH+this.cropChangeY-a-p):this.cropOldH-f>0?(this.cropH=o-this.cropChangeY-f<=o-a?this.cropOldH-f:this.cropOldH+this.cropChangeY-a,this.cropOffsertY=o-this.cropChangeY-f<=o-a?this.cropChangeY+f:a):(this.cropH=Math.abs(f)+this.cropChangeY<=o?Math.abs(f)-this.cropOldH:o-this.cropOldH-this.cropChangeY,this.cropOffsertY=this.cropChangeY+this.cropOldH):this.changeCropTypeY===2&&(this.cropOldH+f<p?this.cropH=p:this.cropOldH+f>0?(this.cropH=this.cropOldH+f+this.cropOffsertY<=o?this.cropOldH+f:o-this.cropOffsertY,this.cropOffsertY=this.cropChangeY):(this.cropH=o-this.cropChangeY+Math.abs(f+this.cropOldH)<=o-a?Math.abs(f+this.cropOldH):this.cropChangeY-a,this.cropOffsertY=o-this.cropChangeY+Math.abs(f+this.cropOldH)<=o-a?this.cropChangeY-Math.abs(f+this.cropOldH):a))),this.canChangeX&&this.fixed){var b=this.cropW/this.fixedNumber[0]*this.fixedNumber[1];b<p?(this.cropH=p,this.cropW=this.fixedNumber[0]*p/this.fixedNumber[1],this.changeCropTypeX===1&&(this.cropOffsertX=this.cropChangeX+(this.cropOldW-this.cropW))):b+this.cropOffsertY>o?(this.cropH=o-this.cropOffsertY,this.cropW=this.cropH/this.fixedNumber[1]*this.fixedNumber[0],this.changeCropTypeX===1&&(this.cropOffsertX=this.cropChangeX+(this.cropOldW-this.cropW))):this.cropH=b}if(this.canChangeY&&this.fixed){var m=this.cropH/this.fixedNumber[1]*this.fixedNumber[0];m<c?(this.cropW=c,this.cropH=this.fixedNumber[1]*c/this.fixedNumber[0],this.cropOffsertY=this.cropOldH+this.cropChangeY-this.cropH):m+this.cropOffsertX>t?(this.cropW=t-this.cropOffsertX,this.cropH=this.cropW/this.fixedNumber[0]*this.fixedNumber[1]):this.cropW=m}})},checkCropLimitSize(){let{cropW:e,cropH:s,limitMinSize:i}=this,t=new Array;return Array.isArray(i)?t=i:t=[i,i],e=parseFloat(t[0]),s=parseFloat(t[1]),[e,s]},changeCropEnd(e){window.removeEventListener("mousemove",this.changeCropNow),window.removeEventListener("mouseup",this.changeCropEnd),window.removeEventListener("touchmove",this.changeCropNow),window.removeEventListener("touchend",this.changeCropEnd)},calculateSize(e,s,i,t,o,r){const a=e/s;let c=o,p=r;return c<i&&(c=i,p=Math.ceil(c/a)),p<t&&(p=t,c=Math.ceil(p*a),c<i&&(c=i,p=Math.ceil(c/a))),c<o&&(c=o,p=Math.ceil(c/a)),p<r&&(p=r,c=Math.ceil(p*a)),{width:c,height:p}},endCrop(){this.cropW===0&&this.cropH===0&&(this.cropping=!1);let[e,s]=this.checkCropLimitSize();const{width:i,height:t}=this.fixed?this.calculateSize(this.fixedNumber[0],this.fixedNumber[1],e,s,this.cropW,this.cropH):{width:e,height:s};i>this.cropW&&(this.cropW=i,this.cropOffsertX+i>this.w&&(this.cropOffsertX=this.w-i)),t>this.cropH&&(this.cropH=t,this.cropOffsertY+t>this.h&&(this.cropOffsertY=this.h-t)),window.removeEventListener("mousemove",this.createCrop),window.removeEventListener("mouseup",this.endCrop),window.removeEventListener("touchmove",this.createCrop),window.removeEventListener("touchend",this.endCrop)},startCrop(){this.crop=!0},stopCrop(){this.crop=!1},clearCrop(){this.cropping=!1,this.cropW=0,this.cropH=0},cropMove(e){if(e.preventDefault(),!this.canMoveBox)return this.crop=!1,this.startMove(e),!1;if(e.touches&&e.touches.length===2)return this.crop=!1,this.startMove(e),this.leaveCrop(),!1;window.addEventListener("mousemove",this.moveCrop),window.addEventListener("mouseup",this.leaveCrop),window.addEventListener("touchmove",this.moveCrop),window.addEventListener("touchend",this.leaveCrop);let s="clientX"in e?e.clientX:e.touches[0].clientX,i="clientY"in e?e.clientY:e.touches[0].clientY,t,o;t=s-this.cropOffsertX,o=i-this.cropOffsertY,this.cropX=t,this.cropY=o,this.$emit("crop-moving",{moving:!0,axis:this.getCropAxis()})},moveCrop(e,s){let i=0,t=0;e&&(e.preventDefault(),i="clientX"in e?e.clientX:e.touches[0].clientX,t="clientY"in e?e.clientY:e.touches[0].clientY),this.$nextTick(()=>{let o,r,a=i-this.cropX,c=t-this.cropY;if(s&&(a=this.cropOffsertX,c=this.cropOffsertY),a<=0?o=0:a+this.cropW>this.w?o=this.w-this.cropW:o=a,c<=0?r=0:c+this.cropH>this.h?r=this.h-this.cropH:r=c,this.centerBox){let p=this.getImgAxis();o<=p.x1&&(o=p.x1),o+this.cropW>p.x2&&(o=p.x2-this.cropW),r<=p.y1&&(r=p.y1),r+this.cropH>p.y2&&(r=p.y2-this.cropH)}this.cropOffsertX=o,this.cropOffsertY=r,this.$emit("crop-moving",{moving:!0,axis:this.getCropAxis()})})},getImgAxis(e,s,i){e=e||this.x,s=s||this.y,i=i||this.scale;let t={x1:0,x2:0,y1:0,y2:0},o=this.trueWidth*i,r=this.trueHeight*i;switch(this.rotate){case 0:t.x1=e+this.trueWidth*(1-i)/2,t.x2=t.x1+this.trueWidth*i,t.y1=s+this.trueHeight*(1-i)/2,t.y2=t.y1+this.trueHeight*i;break;case 1:case-1:case 3:case-3:t.x1=e+this.trueWidth*(1-i)/2+(o-r)/2,t.x2=t.x1+this.trueHeight*i,t.y1=s+this.trueHeight*(1-i)/2+(r-o)/2,t.y2=t.y1+this.trueWidth*i;break;default:t.x1=e+this.trueWidth*(1-i)/2,t.x2=t.x1+this.trueWidth*i,t.y1=s+this.trueHeight*(1-i)/2,t.y2=t.y1+this.trueHeight*i;break}return t},getCropAxis(){let e={x1:0,x2:0,y1:0,y2:0};return e.x1=this.cropOffsertX,e.x2=e.x1+this.cropW,e.y1=this.cropOffsertY,e.y2=e.y1+this.cropH,e},leaveCrop(e){window.removeEventListener("mousemove",this.moveCrop),window.removeEventListener("mouseup",this.leaveCrop),window.removeEventListener("touchmove",this.moveCrop),window.removeEventListener("touchend",this.leaveCrop),this.$emit("crop-moving",{moving:!1,axis:this.getCropAxis()})},getCropChecked(e){let s=document.createElement("canvas"),i=s.getContext("2d"),t=new Image,o=this.rotate,r=this.trueWidth,a=this.trueHeight,c=this.cropOffsertX,p=this.cropOffsertY;t.onload=()=>{if(this.cropW!==0){let m=1;this.high&!this.full&&(m=window.devicePixelRatio),this.enlarge!==1&!this.full&&(m=Math.abs(Number(this.enlarge)));let O=this.cropW*m,U=this.cropH*m,M=r*this.scale*m,x=a*this.scale*m,g=(this.x-c+this.trueWidth*(1-this.scale)/2)*m,v=(this.y-p+this.trueHeight*(1-this.scale)/2)*m;switch(b(O,U),i.save(),o){case 0:this.full?(b(O/this.scale,U/this.scale),i.drawImage(t,g/this.scale,v/this.scale,M/this.scale,x/this.scale)):i.drawImage(t,g,v,M,x);break;case 1:case-3:this.full?(b(O/this.scale,U/this.scale),g=g/this.scale+(M/this.scale-x/this.scale)/2,v=v/this.scale+(x/this.scale-M/this.scale)/2,i.rotate(o*90*Math.PI/180),i.drawImage(t,v,-g-x/this.scale,M/this.scale,x/this.scale)):(g=g+(M-x)/2,v=v+(x-M)/2,i.rotate(o*90*Math.PI/180),i.drawImage(t,v,-g-x,M,x));break;case 2:case-2:this.full?(b(O/this.scale,U/this.scale),i.rotate(o*90*Math.PI/180),g=g/this.scale,v=v/this.scale,i.drawImage(t,-g-M/this.scale,-v-x/this.scale,M/this.scale,x/this.scale)):(i.rotate(o*90*Math.PI/180),i.drawImage(t,-g-M,-v-x,M,x));break;case 3:case-1:this.full?(b(O/this.scale,U/this.scale),g=g/this.scale+(M/this.scale-x/this.scale)/2,v=v/this.scale+(x/this.scale-M/this.scale)/2,i.rotate(o*90*Math.PI/180),i.drawImage(t,-v-M/this.scale,g,M/this.scale,x/this.scale)):(g=g+(M-x)/2,v=v+(x-M)/2,i.rotate(o*90*Math.PI/180),i.drawImage(t,-v-M,g,M,x));break;default:this.full?(b(O/this.scale,U/this.scale),i.drawImage(t,g/this.scale,v/this.scale,M/this.scale,x/this.scale)):i.drawImage(t,g,v,M,x)}i.restore()}else{let m=r*this.scale,O=a*this.scale;switch(i.save(),o){case 0:b(m,O),i.drawImage(t,0,0,m,O);break;case 1:case-3:b(O,m),i.rotate(o*90*Math.PI/180),i.drawImage(t,0,-O,m,O);break;case 2:case-2:b(m,O),i.rotate(o*90*Math.PI/180),i.drawImage(t,-m,-O,m,O);break;case 3:case-1:b(O,m),i.rotate(o*90*Math.PI/180),i.drawImage(t,-m,0,m,O);break;default:b(m,O),i.drawImage(t,0,0,m,O)}i.restore()}e(s)};var u=this.img.substr(0,4);u!=="data"&&(t.crossOrigin="Anonymous"),t.src=this.imgs;const f=this.fillColor;function b(m,O){s.width=Math.round(m),s.height=Math.round(O),f&&(i.fillStyle=f,i.fillRect(0,0,s.width,s.height))}},getCropData(e){this.getCropChecked(s=>{e(s.toDataURL("image/"+this.outputType,this.outputSize))})},getCropBlob(e){this.getCropChecked(s=>{s.toBlob(i=>e(i),"image/"+this.outputType,this.outputSize)})},showPreview(){if(this.isCanShow)this.isCanShow=!1,setTimeout(()=>{this.isCanShow=!0},16);else return!1;let e=this.cropW,s=this.cropH,i=this.scale;var t={};t.div={width:`${e}px`,height:`${s}px`};let o=(this.x-this.cropOffsertX)/i,r=(this.y-this.cropOffsertY)/i,a=0;t.w=e,t.h=s,t.url=this.imgs,t.img={width:`${this.trueWidth}px`,height:`${this.trueHeight}px`,transform:`scale(${i})translate3d(${o}px, ${r}px, ${a}px)rotateZ(${this.rotate*90}deg)`},t.html=`
      <div class="show-preview" style="width: ${t.w}px; height: ${t.h}px,; overflow: hidden">
        <div style="width: ${e}px; height: ${s}px">
          <img src=${t.url} style="width: ${this.trueWidth}px; height: ${this.trueHeight}px; transform:
          scale(${i})translate3d(${o}px, ${r}px, ${a}px)rotateZ(${this.rotate*90}deg)">
        </div>
      </div>`,this.$emit("real-time",t)},reload(){let e=new Image;e.onload=()=>{this.w=parseFloat(window.getComputedStyle(this.$refs.cropper).width),this.h=parseFloat(window.getComputedStyle(this.$refs.cropper).height),this.trueWidth=e.width,this.trueHeight=e.height,this.original?this.scale=1:this.scale=this.checkedMode(),this.$nextTick(()=>{this.x=-(this.trueWidth-this.trueWidth*this.scale)/2+(this.w-this.trueWidth*this.scale)/2,this.y=-(this.trueHeight-this.trueHeight*this.scale)/2+(this.h-this.trueHeight*this.scale)/2,this.loading=!1,this.autoCrop&&this.goAutoCrop(),this.$emit("img-load","success"),setTimeout(()=>{this.showPreview()},20)})},e.onerror=()=>{this.$emit("img-load","error")},e.src=this.imgs},checkedMode(){let e=1,s=this.trueWidth,i=this.trueHeight;const t=this.mode.split(" ");switch(t[0]){case"contain":this.trueWidth>this.w&&(e=this.w/this.trueWidth),this.trueHeight*e>this.h&&(e=this.h/this.trueHeight);break;case"cover":s=this.w,e=s/this.trueWidth,i=i*e,i<this.h&&(i=this.h,e=i/this.trueHeight);break;default:try{let o=t[0];if(o.search("px")!==-1){o=o.replace("px",""),s=parseFloat(o);const r=s/this.trueWidth;let a=1,c=t[1];c.search("px")!==-1&&(c=c.replace("px",""),i=parseFloat(c),a=i/this.trueHeight),e=Math.min(r,a)}if(o.search("%")!==-1&&(o=o.replace("%",""),s=parseFloat(o)/100*this.w,e=s/this.trueWidth),t.length===2&&o==="auto"){let r=t[1];r.search("px")!==-1&&(r=r.replace("px",""),i=parseFloat(r),e=i/this.trueHeight),r.search("%")!==-1&&(r=r.replace("%",""),i=parseFloat(r)/100*this.h,e=i/this.trueHeight)}}catch{e=1}}return e},goAutoCrop(e,s){if(this.imgs===""||this.imgs===null)return;this.clearCrop(),this.cropping=!0;let i=this.w,t=this.h;if(this.centerBox){const a=Math.abs(this.rotate)%2>0;let c=(a?this.trueHeight:this.trueWidth)*this.scale,p=(a?this.trueWidth:this.trueHeight)*this.scale;i=c<i?c:i,t=p<t?p:t}var o=e||parseFloat(this.autoCropWidth),r=s||parseFloat(this.autoCropHeight);(o===0||r===0)&&(o=i*.8,r=t*.8),o=o>i?i:o,r=r>t?t:r,this.fixed&&(r=o/this.fixedNumber[0]*this.fixedNumber[1]),r>this.h&&(r=this.h,o=r/this.fixedNumber[1]*this.fixedNumber[0]),this.changeCrop(o,r)},changeCrop(e,s){if(this.centerBox){let i=this.getImgAxis();e>i.x2-i.x1&&(e=i.x2-i.x1,s=e/this.fixedNumber[0]*this.fixedNumber[1]),s>i.y2-i.y1&&(s=i.y2-i.y1,e=s/this.fixedNumber[1]*this.fixedNumber[0])}this.cropW=e,this.cropH=s,this.checkCropLimitSize(),this.$nextTick(()=>{this.cropOffsertX=(this.w-this.cropW)/2,this.cropOffsertY=(this.h-this.cropH)/2,this.centerBox&&this.moveCrop(null,!0)})},refresh(){this.img,this.imgs="",this.scale=1,this.crop=!1,this.rotate=0,this.w=0,this.h=0,this.trueWidth=0,this.trueHeight=0,this.imgIsQqualCrop=!1,this.clearCrop(),this.$nextTick(()=>{this.checkedImg()})},rotateLeft(){this.rotate=this.rotate<=-3?0:this.rotate-1},rotateRight(){this.rotate=this.rotate>=3?0:this.rotate+1},rotateClear(){this.rotate=0},checkoutImgAxis(e,s,i){e=e||this.x,s=s||this.y,i=i||this.scale;let t=!0;if(this.centerBox){let o=this.getImgAxis(e,s,i),r=this.getCropAxis();o.x1>=r.x1&&(t=!1),o.x2<=r.x2&&(t=!1),o.y1>=r.y1&&(t=!1),o.y2<=r.y2&&(t=!1),t||this.changeImgScale(o,r,i)}return t},changeImgScale(e,s,i){let t=this.trueWidth,o=this.trueHeight,r=t*i,a=o*i;if(r>=this.cropW&&a>=this.cropH)this.scale=i;else{const c=this.cropW/t,p=this.cropH/o,u=this.cropH<=o*c?c:p;this.scale=u,r=t*u,a=o*u}this.imgIsQqualCrop||(e.x1>=s.x1&&(this.isRotateRightOrLeft?this.x=s.x1-(t-r)/2-(r-a)/2:this.x=s.x1-(t-r)/2),e.x2<=s.x2&&(this.isRotateRightOrLeft?this.x=s.x1-(t-r)/2-(r-a)/2-a+this.cropW:this.x=s.x2-(t-r)/2-r),e.y1>=s.y1&&(this.isRotateRightOrLeft?this.y=s.y1-(o-a)/2-(a-r)/2:this.y=s.y1-(o-a)/2),e.y2<=s.y2&&(this.isRotateRightOrLeft?this.y=s.y2-(o-a)/2-(a-r)/2-r:this.y=s.y2-(o-a)/2-a)),(r<this.cropW||a<this.cropH)&&(this.imgIsQqualCrop=!0)}},mounted(){this.support="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll";let e=this;var s=navigator.userAgent;this.isIOS=!!s.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(i,t,o){for(var r=atob(this.toDataURL(t,o).split(",")[1]),a=r.length,c=new Uint8Array(a),p=0;p<a;p++)c[p]=r.charCodeAt(p);i(new Blob([c],{type:e.type||"image/png"}))}}),this.showPreview(),this.checkedImg()},unmounted(){window.removeEventListener("mousemove",this.moveCrop),window.removeEventListener("mouseup",this.leaveCrop),window.removeEventListener("touchmove",this.moveCrop),window.removeEventListener("touchend",this.leaveCrop),this.cancelScale()}}),$e={key:0,class:"cropper-box"},Be=["src"],Ee={class:"cropper-view-box"},Ae=["src"],Te={key:1};function Ue(e,s,i,t,o,r){return w(),y("div",{class:"vue-cropper",ref:"cropper",onMouseover:s[28]||(s[28]=(...a)=>e.scaleImg&&e.scaleImg(...a)),onMouseout:s[29]||(s[29]=(...a)=>e.cancelScale&&e.cancelScale(...a))},[e.imgs?(w(),y("div",$e,[T(l("div",{class:"cropper-box-canvas",style:P({width:e.trueWidth+"px",height:e.trueHeight+"px",transform:"scale("+e.scale+","+e.scale+") translate3d("+e.x/e.scale+"px,"+e.y/e.scale+"px,0)rotateZ("+e.rotate*90+"deg)"})},[l("img",{src:e.imgs,alt:"cropper-img",ref:"cropperImg"},null,8,Be)],4),[[he,!e.loading]])])):S("",!0),l("div",{class:E(["cropper-drag-box",{"cropper-move":e.move&&!e.crop,"cropper-crop":e.crop,"cropper-modal":e.cropping}]),onMousedown:s[0]||(s[0]=(...a)=>e.startMove&&e.startMove(...a)),onTouchstart:s[1]||(s[1]=(...a)=>e.startMove&&e.startMove(...a))},null,34),T(l("div",{class:"cropper-crop-box",style:P({width:e.cropW+"px",height:e.cropH+"px",transform:"translate3d("+e.cropOffsertX+"px,"+e.cropOffsertY+"px,0)"})},[l("span",Ee,[l("img",{style:P({width:e.trueWidth+"px",height:e.trueHeight+"px",transform:"scale("+e.scale+","+e.scale+") translate3d("+(e.x-e.cropOffsertX)/e.scale+"px,"+(e.y-e.cropOffsertY)/e.scale+"px,0)rotateZ("+e.rotate*90+"deg)"}),src:e.imgs,alt:"cropper-img"},null,12,Ae)]),l("span",{class:"cropper-face cropper-move",onMousedown:s[2]||(s[2]=(...a)=>e.cropMove&&e.cropMove(...a)),onTouchstart:s[3]||(s[3]=(...a)=>e.cropMove&&e.cropMove(...a))},null,32),e.info?(w(),y("span",{key:0,class:"crop-info",style:P({top:e.cropInfo.top})},L(e.cropInfo.width)+" Ã— "+L(e.cropInfo.height),5)):S("",!0),e.fixedBox?S("",!0):(w(),y("span",Te,[l("span",{class:"crop-line line-w",onMousedown:s[4]||(s[4]=a=>e.changeCropSize(a,!1,!0,0,1)),onTouchstart:s[5]||(s[5]=a=>e.changeCropSize(a,!1,!0,0,1))},null,32),l("span",{class:"crop-line line-a",onMousedown:s[6]||(s[6]=a=>e.changeCropSize(a,!0,!1,1,0)),onTouchstart:s[7]||(s[7]=a=>e.changeCropSize(a,!0,!1,1,0))},null,32),l("span",{class:"crop-line line-s",onMousedown:s[8]||(s[8]=a=>e.changeCropSize(a,!1,!0,0,2)),onTouchstart:s[9]||(s[9]=a=>e.changeCropSize(a,!1,!0,0,2))},null,32),l("span",{class:"crop-line line-d",onMousedown:s[10]||(s[10]=a=>e.changeCropSize(a,!0,!1,2,0)),onTouchstart:s[11]||(s[11]=a=>e.changeCropSize(a,!0,!1,2,0))},null,32),l("span",{class:"crop-point point1",onMousedown:s[12]||(s[12]=a=>e.changeCropSize(a,!0,!0,1,1)),onTouchstart:s[13]||(s[13]=a=>e.changeCropSize(a,!0,!0,1,1))},null,32),l("span",{class:"crop-point point2",onMousedown:s[14]||(s[14]=a=>e.changeCropSize(a,!1,!0,0,1)),onTouchstart:s[15]||(s[15]=a=>e.changeCropSize(a,!1,!0,0,1))},null,32),l("span",{class:"crop-point point3",onMousedown:s[16]||(s[16]=a=>e.changeCropSize(a,!0,!0,2,1)),onTouchstart:s[17]||(s[17]=a=>e.changeCropSize(a,!0,!0,2,1))},null,32),l("span",{class:"crop-point point4",onMousedown:s[18]||(s[18]=a=>e.changeCropSize(a,!0,!1,1,0)),onTouchstart:s[19]||(s[19]=a=>e.changeCropSize(a,!0,!1,1,0))},null,32),l("span",{class:"crop-point point5",onMousedown:s[20]||(s[20]=a=>e.changeCropSize(a,!0,!1,2,0)),onTouchstart:s[21]||(s[21]=a=>e.changeCropSize(a,!0,!1,2,0))},null,32),l("span",{class:"crop-point point6",onMousedown:s[22]||(s[22]=a=>e.changeCropSize(a,!0,!0,1,2)),onTouchstart:s[23]||(s[23]=a=>e.changeCropSize(a,!0,!0,1,2))},null,32),l("span",{class:"crop-point point7",onMousedown:s[24]||(s[24]=a=>e.changeCropSize(a,!1,!0,0,2)),onTouchstart:s[25]||(s[25]=a=>e.changeCropSize(a,!1,!0,0,2))},null,32),l("span",{class:"crop-point point8",onMousedown:s[26]||(s[26]=a=>e.changeCropSize(a,!0,!0,2,2)),onTouchstart:s[27]||(s[27]=a=>e.changeCropSize(a,!0,!0,2,2))},null,32)]))],4),[[he,e.cropping]])],544)}const ze=Ye(Le,[["render",Ue],["__scopeId","data-v-a742df44"]]),Pe={class:"bg-white md:rounded-2xl shadow-2xl w-full md:max-w-5xl h-full md:h-[85vh] flex flex-col overflow-hidden animate-in fade-in zoom-in duration-200"},Ne={class:"px-4 pb-3 pt-[calc(0.75rem+env(safe-area-inset-top))] md:px-6 md:py-4 border-b border-gray-100 flex justify-between items-center bg-white"},Re={class:"flex items-center gap-4"},je={class:"text-lg font-bold text-gray-800"},_e={class:"flex items-center bg-gray-100 rounded-lg p-1"},Ve={class:"px-1.5 py-0.5 rounded-full bg-gray-200 text-gray-600 text-[10px]"},De={class:"px-1.5 py-0.5 rounded-full bg-gray-200 text-gray-600 text-[10px]"},Fe={class:"px-4 py-3 md:px-6 bg-white border-b border-gray-100 flex flex-col md:flex-row justify-between items-start md:items-center gap-3 md:gap-0"},qe={class:"flex flex-wrap gap-2 md:gap-3 items-center w-full md:w-auto"},Qe={class:"flex items-center gap-2 mr-2 bg-gray-50 p-1 rounded-lg border border-gray-100"},Ze=["title"],Ge={class:"flex items-center gap-1 px-1"},Je={key:1,class:"text-[10px] text-gray-400"},Ke={key:1,class:"flex items-center gap-2 mr-2 bg-gray-50 p-1 rounded-lg border border-gray-100"},et={class:"flex items-center gap-1 px-1"},tt={class:"flex items-center gap-1 px-1"},st={key:2,class:"flex items-center gap-2 mr-2 bg-gray-50 p-1 rounded-lg border border-gray-100"},it={class:"flex items-center gap-1 px-1"},ot={class:"flex items-center gap-1 px-1"},rt=["disabled"],at={key:0},lt={key:1},nt={class:"flex-1 overflow-y-auto p-6 bg-gray-50"},ht={key:0,class:"h-full flex flex-col items-center justify-center text-gray-400"},ct={key:1,class:"h-full flex flex-col items-center justify-center text-gray-400"},pt=["src"],ut={key:0,class:"absolute top-2 left-2 bg-green-500 text-white text-[10px] font-bold px-2 py-1 rounded-full shadow-sm z-10 flex items-center gap-1"},dt=["onClick"],gt=["onClick"],ft={key:3,class:"space-y-6 p-1"},mt={class:"border border-gray-200 rounded-xl bg-white p-6 shadow-sm"},vt={class:"space-y-4"},bt={key:0,class:"grid grid-cols-2 gap-4"},xt={class:"space-y-2"},wt={class:"relative h-48 w-full rounded-lg overflow-hidden border border-gray-200 bg-gray-100 group"},yt=["src"],Ct={class:"bg-gray-50 p-2 rounded-lg border border-gray-100 flex items-center justify-center gap-4"},kt={class:"flex items-center gap-1"},Ot={class:"flex items-center gap-1"},Mt=["disabled"],Wt={class:"space-y-2"},It={class:"relative h-48 w-full flex justify-center rounded-lg border border-gray-200 bg-gray-100 overflow-hidden"},Ht={class:"relative h-full aspect-[9/16]"},Xt=["src"],St={class:"bg-gray-50 p-2 rounded-lg border border-gray-100 flex items-center justify-center gap-4"},Yt={class:"flex items-center gap-1"},Lt={class:"flex items-center gap-1"},$t=["disabled"],Bt={key:0,class:"block w-4 h-4 border-2 border-blue-200 border-t-blue-600 rounded-full animate-spin"},Et={key:1,xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},At={class:"flex gap-2"},Tt=["disabled"],Ut={key:0,class:"inline-block animate-spin"},zt={key:1},Pt={class:"flex flex-wrap gap-2"},Nt=["onClick"],Rt={class:"pt-4 flex items-center gap-3 border-t border-gray-100 mt-4"},jt=["disabled"],_t={key:0,class:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"},Vt=["disabled"],Dt={key:0,class:"w-4 h-4 border-2 border-gray-400 border-t-gray-600 rounded-full animate-spin"},Ft={class:"bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 transform transition-all scale-100 animate-in fade-in zoom-in duration-200"},qt={class:"flex items-start gap-4 mb-4"},Qt={class:"text-sm text-gray-600 leading-relaxed"},Y="default-wallpaper.svg",Zt=oe({__name:"WallpaperLibrary",props:{show:{type:Boolean},title:{}},emits:["update:show","select"],setup(e,{emit:s}){const i=s,t=de(),o=X("pc"),r=X([]),a=X([]),c=X(!1),p=X(!1),u=X(null),f=X(!1),b=X(""),m=X(()=>{}),O=()=>{f.value=!1},U=()=>{m.value(),O()},M=_(()=>t.appConfig.wallpaperApiPcList||"/api/backgrounds"),x=_(()=>t.appConfig.wallpaperApiMobileList||"/api/mobile_backgrounds"),g=async()=>{c.value=!0;try{const d=await fetch(M.value);if(d.ok){const W=(await d.json()).filter(k=>k!==Y),H=t.appConfig.pcWallpaperOrder||[],B=[],A=new Set(W);B.push(Y),H.forEach(k=>{A.has(k)&&k!==Y&&(B.push(k),A.delete(k))}),A.forEach(k=>{k!==Y&&B.push(k)}),r.value=B}else r.value=[Y];const n=await fetch(x.value);if(n.ok){const W=(await n.json()).filter(k=>k!==Y),H=t.appConfig.mobileWallpaperOrder||[],B=[],A=new Set(W);B.push(Y),H.forEach(k=>{A.has(k)&&k!==Y&&(B.push(k),A.delete(k))}),A.forEach(k=>{k!==Y&&B.push(k)}),a.value=B}else a.value=[Y]}catch(d){console.error(d),r.value.includes(Y)||(r.value=[Y,...r.value]),a.value.includes(Y)||(a.value=[Y,...a.value])}finally{c.value=!1}},v=(d,n)=>{if(d===Y)return t.getAssetUrl(`/${Y}`);const h=n==="pc"?t.appConfig.wallpaperPcImageBase||"/backgrounds":t.appConfig.wallpaperMobileImageBase||"/mobile_backgrounds",W=h.endsWith("/")?h.slice(0,-1):h;return t.getAssetUrl(`${W}/${encodeURIComponent(d)}`)},R=(d,n)=>{if(re(d,n)){const h=v(d,n);i("select",{url:h,type:n}),i("update:show",!1)}},re=(d,n)=>{const h=v(d,n);return n==="pc"?t.appConfig.background=h:t.appConfig.mobileBackground=h,!0},G=_({get(){const d=o.value==="pc"?[...r.value]:[...a.value],n=o.value==="pc"?t.appConfig.background:t.appConfig.mobileBackground,h=o.value==="pc"?"pc":"mobile",W=d.findIndex(H=>v(H,h)===n);if(W>-1){const[H]=d.splice(W,1);H&&d.unshift(H)}return d},set(d){o.value==="pc"?(r.value=d,t.appConfig.pcWallpaperOrder=d):(a.value=d,t.appConfig.mobileWallpaperOrder=d);const n=d[0];if(n){const h=o.value==="pc"?"pc":"mobile",W=h==="pc"?t.appConfig.background:t.appConfig.mobileBackground;v(n,h)!==W&&re(n,h)}}}),fe=()=>{u.value?.click()},V=X([]),me=d=>{const n=d.target;if(!n.files||n.files.length===0)return;V.value=Array.from(n.files),V.value.some(W=>W.size>10*1024*1024)?(b.value="æ£€æµ‹åˆ°æ–‡ä»¶è¶…è¿‡ 10MBï¼Œå¯èƒ½å¯¼è‡´å†…å­˜å ç”¨è¿‡é«˜ï¼Œæ˜¯å¦ç»§ç»­ä¸Šä¼ ï¼Ÿ",m.value=ae,f.value=!0):ae(),n.value=""},ae=async()=>{if(V.value.length===0)return;p.value=!0;const d=new FormData;V.value.forEach(h=>{d.append("files",h)});const n=o.value==="pc"?t.appConfig.wallpaperApiPcUpload||"/api/backgrounds/upload":t.appConfig.wallpaperApiMobileUpload||"/api/mobile_backgrounds/upload";try{const h=localStorage.getItem("flat-nas-token"),W={};h&&(W.Authorization=`Bearer ${h}`),(await fetch(n,{method:"POST",headers:W,body:d})).ok?(await g(),t.refreshResources()):alert("ä¸Šä¼ å¤±è´¥")}catch(h){console.error(h),alert("ä¸Šä¼ å‡ºé”™")}finally{p.value=!1,V.value=[]}},ve=(d,n)=>{if(d===Y){alert("é»˜è®¤å£çº¸æ— æ³•åˆ é™¤");return}b.value="ç¡®å®šè¦åˆ é™¤è¿™å¼ å£çº¸å—ï¼Ÿ",m.value=()=>be(d,n),f.value=!0},be=async(d,n)=>{const h=v(d,n),W=n==="pc"?t.appConfig.background:t.appConfig.mobileBackground;if(h===W){const k=v(Y,n);n==="pc"?t.appConfig.background=k:t.appConfig.mobileBackground=k}const H=n==="pc"?t.appConfig.wallpaperApiPcDeleteBase||"/api/backgrounds":t.appConfig.wallpaperApiMobileDeleteBase||"/api/mobile_backgrounds",A=`${H.endsWith("/")?H.slice(0,-1):H}/${encodeURIComponent(d)}`;try{const k=localStorage.getItem("flat-nas-token"),q={};k&&(q.Authorization=`Bearer ${k}`),(await fetch(A,{method:"DELETE",headers:q})).ok?(n==="pc"?r.value=r.value.filter(ee=>ee!==d):a.value=a.value.filter(ee=>ee!==d),t.refreshResources()):alert("åˆ é™¤å¤±è´¥")}catch(k){console.error(k)}},j=_({get:()=>o.value==="pc"?t.appConfig.pcRotation:t.appConfig.mobileRotation,set:d=>{o.value==="pc"?t.appConfig.pcRotation=d:t.appConfig.mobileRotation=d}}),le=_({get:()=>o.value==="pc"?t.appConfig.pcRotationInterval??30:t.appConfig.mobileRotationInterval??30,set:d=>{o.value==="pc"?t.appConfig.pcRotationInterval=d:t.appConfig.mobileRotationInterval=d}}),D=_({get:()=>o.value==="pc"?t.appConfig.pcRotationMode??"random":t.appConfig.mobileRotationMode??"random",set:d=>{o.value==="pc"?t.appConfig.pcRotationMode=d:t.appConfig.mobileRotationMode=d}}),xe=()=>{j.value=!j.value},we=()=>{D.value=D.value==="random"?"sequential":"random"},I=X(""),F=X(""),Q=X(!1),ne=[{name:"Bing æ¯æ—¥å£çº¸",url:"https://bing.biturl.top/?resolution=1920&format=image&index=0&mkt=zh-CN",autoUpdate:!0},{name:"éšæœºé£æ™¯ (Picsum)",url:"https://picsum.photos/1920/1080",autoUpdate:!1},{name:"éšæœºäºŒæ¬¡å…ƒ (PC)",url:"https://www.loliapi.com/acg/pc/",autoUpdate:!1},{name:"éšæœºäºŒæ¬¡å…ƒ (PE)",url:"https://www.loliapi.com/acg/pe/",autoUpdate:!1}],J=async d=>{Q.value=!0;try{const n=await fetch("/api/wallpaper/resolve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:d})});if(n.ok){const h=await n.json();I.value=h.url}else I.value=d}catch{I.value=d}finally{Q.value=!1}},ye=d=>{F.value=d,J(d)},Ce=()=>{F.value?J(F.value):J(I.value)},$=X(!1),Z=async(d,n=!0)=>{if(I.value){$.value=!0;try{const h=localStorage.getItem("flat-nas-token"),W=await fetch("/api/wallpaper/fetch",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({url:I.value,type:d,apply:n})});if(W.ok){const H=await W.json();if(n){const B=ne.find(K=>K.url===F.value||K.url===I.value),A=B?B.autoUpdate:!1,q={type:"api",url:A&&F.value||I.value,enabled:!!A,lastUpdated:Date.now()};d==="pc"?(t.appConfig.background=H.path,t.appConfig.wallpaperConfig=q):(t.appConfig.mobileBackground=H.path,t.appConfig.mobileWallpaperConfig=q),t.saveData(),alert("è®¾ç½®æˆåŠŸ")}else await g(),alert(d==="pc"?"å·²ä¿å­˜åˆ° PC å£çº¸åº“":"å·²ä¿å­˜åˆ°æ‰‹æœºå£çº¸åº“")}else{const H=await W.json();alert("ä¿å­˜å¤±è´¥: "+(H.error||"æœªçŸ¥é”™è¯¯"))}}catch(h){console.error(h),alert("è¯·æ±‚å‡ºé”™ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ")}finally{$.value=!1}}};return ke(()=>{g(),t.appConfig.background?.startsWith("http")&&(I.value=t.appConfig.background)}),(d,n)=>(w(),y(te,null,[(w(),se(pe,{to:"body"},[e.show?(w(),y("div",{key:0,class:"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:n[21]||(n[21]=ie(h=>d.$emit("update:show",!1),["self"]))},[l("div",Pe,[l("div",Ne,[l("div",Re,[l("h3",je,L(e.title||"å£çº¸åº“"),1),l("div",_e,[l("button",{onClick:n[0]||(n[0]=h=>o.value="pc"),class:E(["px-3 py-1.5 text-xs font-bold rounded-md transition-all flex items-center gap-2",o.value==="pc"?"bg-white text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700"])},[n[22]||(n[22]=N(" PC å£çº¸ ",-1)),l("span",Ve,L(r.value.length),1)],2),l("button",{onClick:n[1]||(n[1]=h=>o.value="mobile"),class:E(["px-3 py-1.5 text-xs font-bold rounded-md transition-all flex items-center gap-2",o.value==="mobile"?"bg-white text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700"])},[n[23]||(n[23]=N(" æ‰‹æœºå£çº¸ ",-1)),l("span",De,L(a.value.length),1)],2),l("button",{onClick:n[2]||(n[2]=h=>o.value="api"),class:E(["px-3 py-1.5 text-xs font-bold rounded-md transition-all flex items-center gap-2",o.value==="api"?"bg-white text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700"])}," API æ¥å£ ",2)])]),l("button",{onClick:n[3]||(n[3]=h=>d.$emit("update:show",!1)),class:"w-8 h-8 rounded-full bg-red-100 hover:bg-red-200 flex items-center justify-center text-red-500 hover:text-red-900 transition-colors"}," âœ• ")]),l("div",Fe,[n[31]||(n[31]=l("div",{class:"text-xs text-gray-400 hidden md:block"},"è¯·æ‹–åŠ¨é€‰æ‹©",-1)),l("div",qe,[l("div",Qe,[l("button",{onClick:we,class:E(["px-2 py-1 text-xs font-medium rounded transition-colors flex items-center gap-1",D.value==="random"?"text-purple-600 bg-purple-50":"text-blue-600 bg-blue-50"]),title:D.value==="random"?"å½“å‰ï¼šéšæœºæ’­æ”¾":"å½“å‰ï¼šé¡ºåºæ’­æ”¾"},[l("span",null,L(D.value==="random"?"éšæœº":"é¡ºæ’­"),1)],10,Ze),n[24]||(n[24]=l("div",{class:"h-4 w-px bg-gray-300"},null,-1)),l("div",Ge,[l("button",{onClick:xe,class:E(["text-xs font-medium transition-colors flex items-center gap-1 px-2 py-1 rounded",j.value?"bg-green-100 text-green-700":"text-gray-600 hover:bg-white"])},[l("span",null,L(j.value?"è½®æ’­ä¸­":"ç‚¹å‡»è½®æ’­"),1)],2),j.value?S("",!0):T((w(),y("input",{key:0,type:"number","onUpdate:modelValue":n[4]||(n[4]=h=>le.value=h),min:"5",class:"w-10 text-xs border border-gray-200 rounded px-1 py-0.5 text-center outline-none focus:border-blue-500",title:"è½®æ’­é—´éš”(åˆ†é’Ÿ)"},null,512)),[[z,le.value]]),j.value?S("",!0):(w(),y("span",Je,"åˆ†"))])]),j.value?S("",!0):(w(),y("button",{key:0,onClick:n[5]||(n[5]=h=>C(t).appConfig.fixedWallpaper=!C(t).appConfig.fixedWallpaper),class:E(["px-3 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-1 shadow-sm",C(t).appConfig.fixedWallpaper?"bg-blue-500 text-white hover:bg-blue-600 shadow-blue-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"]),title:"å›ºå®šå½“å‰å£çº¸ï¼Œä¸å‚ä¸è½®æ’­"},[l("span",null,L(C(t).appConfig.fixedWallpaper?"å·²å›ºå®š":"å›ºå®š"),1)],2)),o.value==="pc"?(w(),y("div",Ke,[l("div",et,[n[25]||(n[25]=l("span",{class:"text-[13px] text-gray-500"},"æ¨¡ç³Š",-1)),T(l("input",{type:"range","onUpdate:modelValue":n[6]||(n[6]=h=>C(t).appConfig.backgroundBlur=h),min:"0",max:"20",step:"1",class:"w-16 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500",title:"æ¨¡ç³ŠåŠå¾„"},null,512),[[z,C(t).appConfig.backgroundBlur,void 0,{number:!0}]])]),n[27]||(n[27]=l("div",{class:"w-px h-3 bg-gray-300"},null,-1)),l("div",tt,[n[26]||(n[26]=l("span",{class:"text-[13px] text-gray-500"},"é®ç½©",-1)),T(l("input",{type:"range","onUpdate:modelValue":n[7]||(n[7]=h=>C(t).appConfig.backgroundMask=h),min:"0",max:"1",step:"0.1",class:"w-16 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500",title:"é®ç½©æµ“åº¦"},null,512),[[z,C(t).appConfig.backgroundMask,void 0,{number:!0}]])])])):S("",!0),o.value==="mobile"?(w(),y("div",st,[l("div",it,[n[28]||(n[28]=l("span",{class:"text-[13px] text-gray-500"},"æ¨¡ç³Š",-1)),T(l("input",{type:"range","onUpdate:modelValue":n[8]||(n[8]=h=>C(t).appConfig.mobileBackgroundBlur=h),min:"0",max:"20",step:"1",class:"w-16 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-400",title:"æ¨¡ç³ŠåŠå¾„"},null,512),[[z,C(t).appConfig.mobileBackgroundBlur,void 0,{number:!0}]])]),n[30]||(n[30]=l("div",{class:"w-px h-3 bg-gray-300"},null,-1)),l("div",ot,[n[29]||(n[29]=l("span",{class:"text-[13px] text-gray-500"},"é®ç½©",-1)),T(l("input",{type:"range","onUpdate:modelValue":n[9]||(n[9]=h=>C(t).appConfig.mobileBackgroundMask=h),min:"0",max:"1",step:"0.1",class:"w-16 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-400",title:"é®ç½©æµ“åº¦"},null,512),[[z,C(t).appConfig.mobileBackgroundMask,void 0,{number:!0}]])])])):S("",!0),o.value==="mobile"?(w(),y("button",{key:3,onClick:n[10]||(n[10]=h=>C(t).appConfig.enableMobileWallpaper=!C(t).appConfig.enableMobileWallpaper),class:E(["px-3 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-1 shadow-sm",C(t).appConfig.enableMobileWallpaper?"bg-green-500 text-white hover:bg-green-600 shadow-green-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"]),title:"å¼€å¯åï¼Œæ‰‹æœºç«¯å°†ä¼˜å…ˆä½¿ç”¨æ‰‹æœºå£çº¸ï¼›å…³é—­åï¼Œæ‰‹æœºç«¯å°†ä½¿ç”¨ PC ç«¯å£çº¸"},[l("span",null,L(C(t).appConfig.enableMobileWallpaper?"å·²å¯ç”¨æ‰‹æœºå£çº¸":"å¯ç”¨æ‰‹æœºå£çº¸"),1)],2)):S("",!0),l("button",{onClick:g,class:"px-3 py-1.5 rounded-lg text-xs font-medium text-gray-600 hover:bg-gray-100 transition-colors flex items-center gap-1"}," åˆ·æ–° "),l("button",{onClick:fe,class:"px-4 py-1.5 rounded-lg text-xs font-bold text-white bg-blue-600 hover:bg-blue-700 shadow-sm shadow-blue-200 transition-all flex items-center gap-1",disabled:p.value},[p.value?(w(),y("span",at,"ä¸Šä¼ ä¸­...")):(w(),y("span",lt,"ä¸Šä¼ å£çº¸"))],8,rt),l("input",{ref_key:"fileInput",ref:u,type:"file",accept:"image/*",multiple:"",class:"hidden",onChange:me},null,544)])]),l("div",nt,[c.value?(w(),y("div",ht,[...n[32]||(n[32]=[l("div",{class:"w-8 h-8 border-4 border-blue-200 border-t-blue-500 rounded-full animate-spin mb-2"},null,-1),l("span",{class:"text-xs"},"åŠ è½½ä¸­...",-1)])])):o.value==="pc"&&r.value.length===0||o.value==="mobile"&&a.value.length===0?(w(),y("div",ct,[...n[33]||(n[33]=[l("span",{class:"text-4xl mb-2"},"ğŸ–¼ï¸",-1),l("span",{class:"text-sm"},"æš‚æ— å£çº¸ï¼Œè¯·å…ˆä¸Šä¼ ",-1)])])):o.value!=="api"?(w(),se(C(Oe),{key:2,modelValue:G.value,"onUpdate:modelValue":n[11]||(n[11]=h=>G.value=h),class:E(["grid gap-2 md:gap-4",o.value==="pc"?"grid-cols-1 md:grid-cols-2 lg:grid-cols-3":"grid-cols-2 md:grid-cols-3 lg:grid-cols-4"]),animation:150,forceFallback:!0},{default:Me(()=>[(w(!0),y(te,null,ce(G.value,(h,W)=>(w(),y("div",{key:h,class:E(["group relative rounded-xl overflow-hidden cursor-grab border-2 border-transparent hover:border-blue-500 transition-all shadow-sm hover:shadow-md bg-white",o.value==="pc"?"aspect-video":"aspect-[9/16]"])},[l("img",{src:v(h,o.value==="pc"?"pc":"mobile"),class:"w-full h-full object-cover transition-all duration-300 group-hover:scale-110",loading:"lazy"},null,8,pt),W===0?(w(),y("div",ut,[...n[34]||(n[34]=[l("span",null,"é»˜è®¤å£çº¸",-1)])])):S("",!0),n[36]||(n[36]=l("div",{class:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"},null,-1)),l("div",{class:"absolute inset-0 flex items-center justify-center bg-black/50 text-white text-lg font-bold opacity-0 group-hover:opacity-100 transition-opacity z-10",onClick:H=>R(h,o.value==="pc"?"pc":"mobile")}," è®¾ä¸ºé»˜è®¤å£çº¸ ",8,dt),l("button",{onClick:ie(H=>ve(h,o.value==="pc"?"pc":"mobile"),["stop"]),class:"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600 shadow-sm z-20",title:"åˆ é™¤"},[...n[35]||(n[35]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,gt)],2))),128))]),_:1},8,["modelValue","class"])):S("",!0),o.value==="api"?(w(),y("div",ft,[n[51]||(n[51]=l("div",{class:"bg-blue-50 text-blue-800 p-4 rounded-xl text-sm leading-relaxed"},[l("ul",{class:"list-disc list-inside space-y-1"},[l("li",null,"åœ¨æ­¤å¤„å¯ä»¥ç›´æ¥è¾“å…¥å›¾ç‰‡çš„ URL åœ°å€ï¼Œæˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹éšæœºå£çº¸ APIã€‚"),l("li",null,[N(" æ”¯æŒ "),l("b",null,"JSON æ ¼å¼ API"),N("ï¼ˆå¦‚ Unsplash/Bingï¼‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è§£æå¹¶æå–å›¾ç‰‡é“¾æ¥ã€‚ ")]),l("li",null,[N("æ”¯æŒ "),l("b",null,"å±€åŸŸç½‘/è‡ªå»º API"),N("ï¼ˆå¦‚ http://192.168.x.xï¼‰ï¼Œä¸å†å—å†…ç½‘è®¿é—®é™åˆ¶ã€‚")])]),l("div",{class:"mt-2 text-xs opacity-80"}," è®¾ç½®åï¼Œæ¯æ¬¡åˆ·æ–°é¡µé¢å¯èƒ½ä¼šæ ¹æ® API è¿”å›ä¸åŒçš„å›¾ç‰‡ï¼ˆå–å†³äº API è¡Œä¸ºï¼‰ã€‚ ")],-1)),l("div",mt,[n[50]||(n[50]=l("h4",{class:"text-sm font-bold text-gray-800 mb-4 flex items-center gap-2"},[l("span",null,"ğŸ”—"),N(" è‡ªå®šä¹‰å£çº¸æ¥å£ ")],-1)),l("div",vt,[I.value?(w(),y("div",bt,[l("div",xt,[n[42]||(n[42]=l("div",{class:"text-[10px] text-gray-500 text-center font-bold"},"PC ç«¯é¢„è§ˆ",-1)),l("div",wt,[l("img",{src:I.value,class:"w-full h-full object-cover transition-all duration-700",style:P({filter:`blur(${C(t).appConfig.backgroundBlur}px)`})},null,12,yt),l("div",{class:"absolute inset-0 pointer-events-none transition-all duration-300",style:P({backgroundColor:`rgba(0,0,0,${C(t).appConfig.backgroundMask})`})},null,4)]),l("div",Ct,[l("div",kt,[n[37]||(n[37]=l("span",{class:"text-[10px] text-gray-500"},"æ¨¡ç³Š",-1)),T(l("input",{type:"range","onUpdate:modelValue":n[12]||(n[12]=h=>C(t).appConfig.backgroundBlur=h),min:"0",max:"20",step:"1",class:"w-20 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500"},null,512),[[z,C(t).appConfig.backgroundBlur,void 0,{number:!0}]])]),n[40]||(n[40]=l("div",{class:"w-px h-3 bg-gray-300"},null,-1)),l("div",Ot,[n[38]||(n[38]=l("span",{class:"text-[10px] text-gray-500"},"é®ç½©",-1)),T(l("input",{type:"range","onUpdate:modelValue":n[13]||(n[13]=h=>C(t).appConfig.backgroundMask=h),min:"0",max:"1",step:"0.1",class:"w-20 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500"},null,512),[[z,C(t).appConfig.backgroundMask,void 0,{number:!0}]])]),n[41]||(n[41]=l("div",{class:"w-px h-3 bg-gray-300"},null,-1)),l("button",{onClick:n[14]||(n[14]=h=>Z("pc",!1)),class:"p-1.5 text-blue-600 hover:bg-blue-50 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:!I.value||$.value,title:"ä¸‹è½½åˆ° PC å£çº¸åº“"},[...n[39]||(n[39]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])],8,Mt)])]),l("div",Wt,[n[48]||(n[48]=l("div",{class:"text-[10px] text-gray-500 text-center font-bold"},"æ‰‹æœºç«¯é¢„è§ˆ",-1)),l("div",It,[l("div",Ht,[l("img",{src:I.value,class:"w-full h-full object-cover transition-all duration-700",style:P({filter:`blur(${C(t).appConfig.mobileBackgroundBlur}px)`})},null,12,Xt),l("div",{class:"absolute inset-0 pointer-events-none transition-all duration-300",style:P({backgroundColor:`rgba(0,0,0,${C(t).appConfig.mobileBackgroundMask})`})},null,4)])]),l("div",St,[l("div",Yt,[n[43]||(n[43]=l("span",{class:"text-[10px] text-gray-500"},"æ¨¡ç³Š",-1)),T(l("input",{type:"range","onUpdate:modelValue":n[15]||(n[15]=h=>C(t).appConfig.mobileBackgroundBlur=h),min:"0",max:"20",step:"1",class:"w-20 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500"},null,512),[[z,C(t).appConfig.mobileBackgroundBlur,void 0,{number:!0}]])]),n[46]||(n[46]=l("div",{class:"w-px h-3 bg-gray-300"},null,-1)),l("div",Lt,[n[44]||(n[44]=l("span",{class:"text-[10px] text-gray-500"},"é®ç½©",-1)),T(l("input",{type:"range","onUpdate:modelValue":n[16]||(n[16]=h=>C(t).appConfig.mobileBackgroundMask=h),min:"0",max:"1",step:"0.1",class:"w-20 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500"},null,512),[[z,C(t).appConfig.mobileBackgroundMask,void 0,{number:!0}]])]),n[47]||(n[47]=l("div",{class:"w-px h-3 bg-gray-300"},null,-1)),l("button",{onClick:n[17]||(n[17]=h=>Z("mobile",!1)),class:"p-1.5 text-blue-600 hover:bg-blue-50 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:!I.value||$.value,title:"ä¸‹è½½åˆ° æ‰‹æœºå£çº¸åº“"},[$.value?(w(),y("span",Bt)):(w(),y("svg",Et,[...n[45]||(n[45]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)])]))],8,$t)])])])):S("",!0),l("div",null,[n[49]||(n[49]=l("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"å›¾ç‰‡ URL / API åœ°å€",-1)),l("div",At,[T(l("input",{"onUpdate:modelValue":n[18]||(n[18]=h=>I.value=h),class:"flex-1 px-4 py-3 border border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none transition-all",placeholder:"https://example.com/image.jpg æˆ– éšæœºå›¾ç‰‡API"},null,512),[[z,I.value]]),l("button",{onClick:Ce,class:"px-3 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg border border-gray-200 transition-colors disabled:opacity-50",title:"åˆ·æ–°é¢„è§ˆ (è¿½åŠ æ—¶é—´æˆ³)",disabled:Q.value},[Q.value?(w(),y("span",Ut,"ğŸ”„")):(w(),y("span",zt,"ğŸ”„"))],8,Tt)])]),l("div",Pt,[(w(),y(te,null,ce(ne,h=>l("button",{key:h.name,onClick:W=>ye(h.url),class:"px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 text-xs rounded-lg transition-colors"},L(h.name),9,Nt)),64))]),l("div",Rt,[l("button",{onClick:n[19]||(n[19]=h=>Z("pc")),class:E(["flex-1 px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-sm transition-all active:scale-95 flex items-center justify-center gap-2",!I.value||$.value?"opacity-50 cursor-not-allowed":""]),disabled:!I.value||$.value},[$.value?(w(),y("span",_t)):S("",!0),N(" "+L($.value?"ä¿å­˜ä¸­...":"åº”ç”¨åˆ° PC å£çº¸"),1)],10,jt),l("button",{onClick:n[20]||(n[20]=h=>Z("mobile")),class:E(["flex-1 px-4 py-2.5 bg-white border border-gray-200 hover:bg-gray-50 text-gray-700 text-sm font-bold rounded-lg shadow-sm transition-all active:scale-95 flex items-center justify-center gap-2",!I.value||$.value?"opacity-50 cursor-not-allowed":""]),disabled:!I.value||$.value},[$.value?(w(),y("span",Dt)):S("",!0),N(" "+L($.value?"ä¿å­˜ä¸­...":"åº”ç”¨åˆ° æ‰‹æœºå£çº¸"),1)],10,Vt)])])])])):S("",!0)])])])):S("",!0)])),(w(),se(pe,{to:"body"},[f.value?(w(),y("div",{key:0,class:"fixed inset-0 z-[200] flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:ie(O,["self"])},[l("div",Ft,[l("div",qt,[n[53]||(n[53]=l("div",{class:"p-2 bg-yellow-100 rounded-full text-yellow-600 shrink-0"},[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),l("div",null,[n[52]||(n[52]=l("h3",{class:"text-lg font-bold text-gray-900 mb-2"},"æç¤º",-1)),l("p",Qt,L(b.value),1)])]),l("div",{class:"flex justify-end gap-3"},[l("button",{onClick:O,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors"}," å–æ¶ˆ "),l("button",{onClick:U,class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors shadow-sm"}," ç¡®å®š ")])])])):S("",!0)]))],64))}}),Gt={class:"w-full"},Jt={key:0,class:"absolute inset-0 z-0 overflow-hidden"},Kt=["src"],es={class:"text-xs text-gray-500 group-hover:text-blue-600"},ts={key:0,class:"fixed inset-0 z-[999] bg-black/60 flex items-center justify-center p-4 backdrop-blur-sm"},ss={class:"bg-white w-full max-w-lg rounded-2xl overflow-hidden shadow-2xl flex flex-col h-[500px]"},is={class:"px-4 py-3 border-b border-gray-100 flex justify-between items-center"},os={class:"flex-1 bg-gray-900 relative"},rs={class:"px-4 py-2 bg-gray-800 flex items-center gap-3 border-t border-gray-700"},as=["value"],ls={class:"text-gray-400 text-xs font-mono w-10 text-right"},ns={class:"p-4 bg-gray-50 flex justify-end gap-3"},cs=oe({__name:"IconUploader",props:{modelValue:{},crop:{type:Boolean,default:!0},previewStyle:{default:()=>({})},overlayStyle:{default:()=>({})},uploadOnly:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:s}){const i=e,t=s,o=de(),r=X(!1),a=X(!1),c=X(""),p=X(),u=X(null),f=X(1),b=()=>{i.uploadOnly||i.crop?u.value?.click():a.value=!0},m=x=>{const g=typeof x=="string"?x:x.url;t("update:modelValue",g)},O=x=>{const g=x.target.files?.[0];if(!g)return;if(g.size>5*1024*1024){alert("å›¾ç‰‡å¤ªå¤§å•¦ï¼Œè¯·ä¸Šä¼ å°äº 5MB çš„å›¾ç‰‡");return}const v=new FileReader;v.onload=R=>{c.value=R.target?.result,i.crop?(f.value=1,r.value=!0):t("update:modelValue",c.value)},v.readAsDataURL(g),u.value&&(u.value.value="")},U=x=>{const g=parseFloat(x.target.value),v=g-f.value;p.value.changeScale(v),f.value=g},M=()=>{p.value.getCropData(x=>{const g=new Image;g.onload=()=>{const v=document.createElement("canvas");v.width=216,v.height=216;const R=v.getContext("2d");R?(R.imageSmoothingEnabled=!0,R.imageSmoothingQuality="high",R.drawImage(g,0,0,216,216),t("update:modelValue",v.toDataURL("image/png"))):t("update:modelValue",x),r.value=!1},g.src=x})};return(x,g)=>(w(),y("div",Gt,[l("input",{ref_key:"fileInput",ref:u,type:"file",accept:"image/*",class:"hidden",onChange:O},null,544),l("div",{class:"w-full h-32 border-2 border-dashed border-gray-300 rounded-xl flex flex-col items-center justify-center cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-all group relative overflow-hidden",onClick:b},[e.modelValue?(w(),y("div",Jt,[l("img",{src:C(o).getAssetUrl(e.modelValue),class:"w-full h-full object-cover transition-all duration-300",style:P(e.previewStyle)},null,12,Kt),l("div",{class:"absolute inset-0 transition-all duration-300",style:P(e.overlayStyle)},null,4)])):S("",!0),l("div",{class:E(["z-10 flex flex-col items-center justify-center",e.modelValue?"opacity-0 group-hover:opacity-100 bg-white/80 absolute inset-0 transition-opacity":""])},[g[3]||(g[3]=l("span",{class:"text-2xl text-gray-400 mb-1 group-hover:text-blue-500"},"+",-1)),l("span",es,L(e.uploadOnly?"ç‚¹å‡»ä¸Šä¼ ":e.crop?"ç‚¹å‡»ä¸Šä¼  / è£å‰ª":"ä»å£çº¸åº“é€‰æ‹©"),1)],2)]),ue(Zt,{show:a.value,"onUpdate:show":g[0]||(g[0]=v=>a.value=v),onSelect:m},null,8,["show"]),r.value?(w(),y("div",ts,[l("div",ss,[l("div",is,[g[4]||(g[4]=l("h3",{class:"font-bold text-gray-700"},"è£å‰ªå›¾ç‰‡",-1)),l("button",{onClick:g[1]||(g[1]=v=>r.value=!1),class:"text-gray-400 hover:text-gray-600 text-xl"}," Ã— ")]),l("div",os,[ue(C(ze),{ref_key:"cropper",ref:p,img:c.value,autoCrop:!0,autoCropWidth:216,autoCropHeight:216,fixed:!0,fixedNumber:[1,1],centerBox:!0,outputType:"png"},null,8,["img"])]),l("div",rs,[g[5]||(g[5]=l("span",{class:"text-gray-400 text-xs"},"ğŸ”",-1)),l("input",{type:"range",min:"0.1",max:"3",step:"0.1",value:f.value,onInput:U,class:"flex-1 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-blue-400"},null,40,as),l("span",ls,L(Math.round(f.value*100))+"%",1)]),l("div",ns,[l("button",{onClick:g[2]||(g[2]=v=>r.value=!1),class:"px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-200 transition-colors"}," å–æ¶ˆ "),l("button",{onClick:M,class:"px-6 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 shadow-lg shadow-blue-200 transition-all"}," ç¡®è®¤ä½¿ç”¨ ")])])])):S("",!0)]))}});export{cs as _,Zt as a};
