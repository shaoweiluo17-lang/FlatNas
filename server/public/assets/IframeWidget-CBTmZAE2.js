import{d as L,r as i,M as R,w as y,y as S,c as u,a as l,e as a,b as p,g as t,q as U,p as E}from"./index-CwNRDDxv.js";const T={key:0,class:"absolute inset-0 flex items-center justify-center bg-gray-50/50 dark:bg-gray-900/50 z-10"},W=["src"],P={key:2,class:"absolute inset-0 flex items-center justify-center text-red-400 text-xs flex-col gap-2 bg-red-50 dark:bg-red-900/20"},$={key:3,class:"absolute inset-0 flex items-center justify-center text-gray-400 dark:text-gray-500 text-xs flex-col gap-2"},N={class:"absolute left-2 top-1/2 -translate-y-1/2 opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity z-20 flex flex-col gap-1.5"},I=["title"],V={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},q={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},A=["href"],F={key:4,class:"absolute bottom-0 left-0 right-0 bg-red-500/90 backdrop-blur text-white text-[10px] p-1.5 text-center transform translate-y-full group-hover:translate-y-0 transition-transform duration-300 z-20 flex items-center justify-center gap-2"},K=L({__name:"IframeWidget",props:{widget:{},isLanMode:{type:Boolean},isEditMode:{type:Boolean}},setup(x){const r=x,d=i(!0),M=i(null),g=i(null),{width:v,height:f}=R(g),n=i(!!r.widget.data?.scaled);y(()=>r.widget.data?.scaled,o=>{n.value=!!o});const w=i(0),b=i("");S(()=>{b.value=window.location.protocol});const m=u(()=>{const{lanUrl:o,wanUrl:e,url:c}=r.widget.data||{},k=e||c||"",H=o||k;return r.isLanMode?H:k}),h=u(()=>{const o=m.value;return!!(o&&o.includes("gitee.com/gjx0808/FlatNas"))}),s=u(()=>{if(h.value)return"";const o=m.value;return r.widget.data?.useProxy&&o?`/proxy?url=${encodeURIComponent(o)}`:o}),_=u(()=>{if(!n.value||!v.value||!f.value)return{};const o=1280,e=v.value/o,c=f.value/e;return{width:`${o}px`,height:`${c}px`,transform:`scale(${e})`,transformOrigin:"top left"}}),j=()=>{n.value=!n.value,r.widget.data||(r.widget.data={}),r.widget.data.scaled=n.value},B=()=>{d.value=!1},C=()=>{d.value=!1},z=()=>{d.value=!0,w.value++};return y(()=>s.value,()=>{d.value=!0}),(o,e)=>(a(),l("div",{ref_key:"containerRef",ref:g,class:"w-full h-full rounded-2xl bg-white dark:bg-gray-800 backdrop-blur border border-white/10 overflow-hidden relative group"},[d.value&&s.value?(a(),l("div",T,[...e[0]||(e[0]=[t("div",{class:"animate-spin rounded-full h-6 w-6 border-2 border-blue-500 border-t-transparent"},null,-1)])])):p("",!0),s.value?(a(),l("iframe",{key:w.value,ref_key:"iframeRef",ref:M,src:s.value,class:E(["w-full h-full border-0 transition-all duration-300",r.isEditMode?"pointer-events-none":""]),style:U(_.value),allowfullscreen:"",allow:"geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; clipboard-write",sandbox:"allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts allow-downloads allow-pointer-lock",referrerpolicy:"no-referrer",loading:"lazy",onLoad:B,onError:C},null,46,W)):h.value?(a(),l("div",P,[...e[1]||(e[1]=[t("span",{class:"font-bold"},"⚠️ 禁止访问此链接",-1),t("span",{class:"text-[10px] opacity-70"},"Gitee 仓库页不支持嵌入",-1)])])):(a(),l("div",$,[...e[2]||(e[2]=[t("span",null,"未设置 URL",-1),t("span",{class:"text-[10px] opacity-50"},"请在编辑模式下配置",-1)])])),t("div",N,[t("button",{onClick:z,class:"p-1.5 bg-black/40 dark:bg-gray-700/60 text-white rounded-full hover:bg-blue-500/80 dark:hover:bg-blue-600/80 backdrop-blur-md transition-colors shadow-sm border border-white/20",title:"刷新"},[...e[3]||(e[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])]),t("button",{onClick:j,class:"p-1.5 bg-black/40 dark:bg-gray-700/60 text-white rounded-full hover:bg-blue-500/80 dark:hover:bg-blue-600/80 backdrop-blur-md transition-colors shadow-sm border border-white/20",title:n.value?"恢复默认视图":"缩放适应窗口"},[n.value?(a(),l("svg",q,[...e[5]||(e[5]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"},null,-1)])])):(a(),l("svg",V,[...e[4]||(e[4]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"},null,-1)])]))],8,I),s.value?(a(),l("a",{key:0,href:s.value,target:"_blank",rel:"noopener noreferrer",class:"p-1.5 bg-black/40 dark:bg-gray-700/60 text-white rounded-full hover:bg-blue-500/80 dark:hover:bg-blue-600/80 backdrop-blur-md transition-colors shadow-sm flex items-center justify-center border border-white/20",title:"在新窗口打开 (解决显示异常)"},[...e[6]||(e[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})],-1)])],8,A)):p("",!0)]),s.value&&s.value.startsWith("http://")&&b.value==="https:"?(a(),l("div",F,[...e[7]||(e[7]=[t("span",null,"⚠️ 检测到混合内容 (HTTPS引用HTTP)",-1)])])):p("",!0)],512))}});export{K as default};
