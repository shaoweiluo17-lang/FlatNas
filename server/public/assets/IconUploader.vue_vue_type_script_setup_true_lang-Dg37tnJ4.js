import{d as ge,a as C,e as y,b as $,g as n,l as z,I as ye,q as _,p as N,t as A,u as We,r as H,c as te,y as Re,F as he,E as pe,f as ue,j as q,m as D,i as O,z as Ae,A as Te,h as Ce,T as ke,k as Oe}from"./index-DKu6tPtM.js";const Ie={};Ie.getData=e=>new Promise((s,o)=>{let t={};Pe(e).then(i=>{t.arrayBuffer=i;try{t.orientation=De(i)}catch{t.orientation=-1}s(t)}).catch(i=>{o(i)})});function Pe(e){let s=null;return new Promise((o,t)=>{if(e.src)if(/^data\:/i.test(e.src))s=ze(e.src),o(s);else if(/^blob\:/i.test(e.src)){var i=new FileReader;i.onload=function(a){s=a.target.result,o(s)},Ne(e.src,function(a){i.readAsArrayBuffer(a)})}else{var r=new XMLHttpRequest;r.onload=function(){if(this.status==200||this.status===0)s=r.response,o(s);else throw"Could not load image";r=null},r.open("GET",e.src,!0),r.responseType="arraybuffer",r.send(null)}else t("img error")})}function Ne(e,s){var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="blob",o.onload=function(t){(this.status==200||this.status===0)&&s(this.response)},o.send()}function ze(e,s){s=s||e.match(/^data\:([^\;]+)\;base64,/mi)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gmi,"");for(var o=atob(e),t=o.length%2==0?o.length:o.length+1,i=new ArrayBuffer(t),r=new Uint16Array(i),a=0;a<t;a++)r[a]=o.charCodeAt(a);return i}function je(e,s,o){var t="",i;for(i=s,o+=s;i<o;i++)t+=String.fromCharCode(e.getUint8(i));return t}function De(e){var s=new DataView(e),o=s.byteLength,t,i,r,a,h,u,d,f,b,m;if(s.getUint8(0)===255&&s.getUint8(1)===216)for(b=2;b<o;){if(s.getUint8(b)===255&&s.getUint8(b+1)===225){d=b;break}b++}if(d&&(i=d+4,r=d+10,je(s,i,4)==="Exif"&&(u=s.getUint16(r),h=u===18761,(h||u===19789)&&s.getUint16(r+2,h)===42&&(a=s.getUint32(r+4,h),a>=8&&(f=r+a)))),f){for(o=s.getUint16(f,h),m=0;m<o;m++)if(b=f+m*12+2,s.getUint16(b,h)===274){b+=8,t=s.getUint16(b,h);break}}return t}const _e=(e,s)=>{const o=e.__vccOpts||e;for(const[t,i]of s)o[t]=i;return o},Ve=ge({data:function(){return{w:0,h:0,scale:1,x:0,y:0,loading:!0,trueWidth:0,trueHeight:0,move:!0,moveX:0,moveY:0,crop:!1,cropping:!1,cropW:0,cropH:0,cropOldW:0,cropOldH:0,canChangeX:!1,canChangeY:!1,changeCropTypeX:1,changeCropTypeY:1,cropX:0,cropY:0,cropChangeX:0,cropChangeY:0,cropOffsertX:0,cropOffsertY:0,support:"",touches:[],touchNow:!1,rotate:0,isIos:!1,orientation:0,imgs:"",coe:.2,scaling:!1,scalingSet:"",coeStatus:"",isCanShow:!0,imgIsQqualCrop:!1}},props:{img:{type:[String,Blob,null,File],default:""},outputSize:{type:Number,default:1},outputType:{type:String,default:"jpeg"},info:{type:Boolean,default:!0},canScale:{type:Boolean,default:!0},autoCrop:{type:Boolean,default:!1},autoCropWidth:{type:[Number,String],default:0},autoCropHeight:{type:[Number,String],default:0},fixed:{type:Boolean,default:!1},fixedNumber:{type:Array,default:()=>[1,1]},fixedBox:{type:Boolean,default:!1},full:{type:Boolean,default:!1},canMove:{type:Boolean,default:!0},canMoveBox:{type:Boolean,default:!0},original:{type:Boolean,default:!1},centerBox:{type:Boolean,default:!1},high:{type:Boolean,default:!0},infoTrue:{type:Boolean,default:!1},maxImgSize:{type:[Number,String],default:2e3},enlarge:{type:[Number,String],default:1},preW:{type:[Number,String],default:0},mode:{type:String,default:"contain"},limitMinSize:{type:[Number,Array,String],default:()=>10,validator:function(e){return Array.isArray(e)?Number(e[0])>=0&&Number(e[1])>=0:Number(e)>=0}},fillColor:{type:String,default:""}},computed:{cropInfo(){let e={};if(e.top=this.cropOffsertY>21?"-21px":"0px",e.width=this.cropW>0?this.cropW:0,e.height=this.cropH>0?this.cropH:0,this.infoTrue){let s=1;this.high&&!this.full&&(s=window.devicePixelRatio),this.enlarge!==1&!this.full&&(s=Math.abs(Number(this.enlarge))),e.width=e.width*s,e.height=e.height*s,this.full&&(e.width=e.width/this.scale,e.height=e.height/this.scale)}return e.width=e.width.toFixed(0),e.height=e.height.toFixed(0),e},isIE(){return!!window.ActiveXObject||"ActiveXObject"in window},passive(){return this.isIE?null:{passive:!1}},isRotateRightOrLeft(){return[1,-1,3,-3].includes(this.rotate)}},watch:{img(){this.checkedImg()},imgs(e){e!==""&&this.reload()},cropW(){this.showPreview()},cropH(){this.showPreview()},cropOffsertX(){this.showPreview()},cropOffsertY(){this.showPreview()},scale(e,s){this.showPreview()},x(){this.showPreview()},y(){this.showPreview()},autoCrop(e){e&&this.goAutoCrop()},autoCropWidth(){this.autoCrop&&this.goAutoCrop()},autoCropHeight(){this.autoCrop&&this.goAutoCrop()},mode(){this.checkedImg()},rotate(){this.showPreview(),this.autoCrop?this.goAutoCrop(this.cropW,this.cropH):(this.cropW>0||this.cropH>0)&&this.goAutoCrop(this.cropW,this.cropH)}},methods:{getVersion(e){var s=navigator.userAgent.split(" "),o="";let t=0;const i=new RegExp(e,"i");for(var r=0;r<s.length;r++)i.test(s[r])&&(o=s[r]);return o?t=o.split("/")[1].split("."):t=["0","0","0"],t},checkOrientationImage(e,s,o,t){if(this.getVersion("chrome")[0]>=81)s=-1;else if(this.getVersion("safari")[0]>=605){const a=this.getVersion("version");a[0]>13&&a[1]>1&&(s=-1)}else{const a=navigator.userAgent.toLowerCase().match(/cpu iphone os (.*?) like mac os/);if(a){let h=a[1];h=h.split("_"),(h[0]>13||h[0]>=13&&h[1]>=4)&&(s=-1)}}let i=document.createElement("canvas"),r=i.getContext("2d");switch(r.save(),s){case 2:i.width=o,i.height=t,r.translate(o,0),r.scale(-1,1);break;case 3:i.width=o,i.height=t,r.translate(o/2,t/2),r.rotate(180*Math.PI/180),r.translate(-o/2,-t/2);break;case 4:i.width=o,i.height=t,r.translate(0,t),r.scale(1,-1);break;case 5:i.height=o,i.width=t,r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:i.width=t,i.height=o,r.translate(t/2,o/2),r.rotate(90*Math.PI/180),r.translate(-o/2,-t/2);break;case 7:i.height=o,i.width=t,r.rotate(.5*Math.PI),r.translate(o,-t),r.scale(-1,1);break;case 8:i.height=o,i.width=t,r.translate(t/2,o/2),r.rotate(-90*Math.PI/180),r.translate(-o/2,-t/2);break;default:i.width=o,i.height=t}r.drawImage(e,0,0,o,t),r.restore(),i.toBlob(a=>{let h=URL.createObjectURL(a);URL.revokeObjectURL(this.imgs),this.imgs=h},"image/"+this.outputType,1)},checkedImg(){if(this.img===null||this.img===""){this.imgs="",this.clearCrop();return}this.loading=!0,this.scale=1,this.rotate=0,this.imgIsQqualCrop=!1,this.clearCrop();let e=new Image;if(e.onload=()=>{if(this.img==="")return this.$emit("img-load",new Error("图片不能为空")),!1;let o=e.width,t=e.height;Ie.getData(e).then(i=>{this.orientation=i.orientation||1;let r=Number(this.maxImgSize);if(!this.orientation&&o<r&t<r){this.imgs=this.img;return}o>r&&(t=t/o*r,o=r),t>r&&(o=o/t*r,t=r),this.checkOrientationImage(e,this.orientation,o,t)}).catch(i=>{this.$emit("img-load","error"),this.$emit("img-load-error",i)})},e.onerror=o=>{this.$emit("img-load","error"),this.$emit("img-load-error",o)},this.img.substr(0,4)!=="data"&&(e.crossOrigin=""),this.isIE){var s=new XMLHttpRequest;s.onload=function(){var o=URL.createObjectURL(this.response);e.src=o},s.open("GET",this.img,!0),s.responseType="blob",s.send()}else e.src=this.img},startMove(e){if(e.preventDefault(),this.move&&!this.crop){if(!this.canMove)return!1;this.moveX=("clientX"in e?e.clientX:e.touches[0].clientX)-this.x,this.moveY=("clientY"in e?e.clientY:e.touches[0].clientY)-this.y,e.touches?(window.addEventListener("touchmove",this.moveImg),window.addEventListener("touchend",this.leaveImg),e.touches.length==2&&(this.touches=e.touches,window.addEventListener("touchmove",this.touchScale),window.addEventListener("touchend",this.cancelTouchScale))):(window.addEventListener("mousemove",this.moveImg),window.addEventListener("mouseup",this.leaveImg)),this.$emit("img-moving",{moving:!0,axis:this.getImgAxis()})}else this.cropping=!0,window.addEventListener("mousemove",this.createCrop),window.addEventListener("mouseup",this.endCrop),window.addEventListener("touchmove",this.createCrop),window.addEventListener("touchend",this.endCrop),this.cropOffsertX=e.offsetX?e.offsetX:e.touches[0].pageX-this.$refs.cropper.offsetLeft,this.cropOffsertY=e.offsetY?e.offsetY:e.touches[0].pageY-this.$refs.cropper.offsetTop,this.cropX="clientX"in e?e.clientX:e.touches[0].clientX,this.cropY="clientY"in e?e.clientY:e.touches[0].clientY,this.cropChangeX=this.cropOffsertX,this.cropChangeY=this.cropOffsertY,this.cropW=0,this.cropH=0},touchScale(e){e.preventDefault();let s=this.scale;var o={x:this.touches[0].clientX,y:this.touches[0].clientY},t={x:e.touches[0].clientX,y:e.touches[0].clientY},i={x:this.touches[1].clientX,y:this.touches[1].clientY},r={x:e.touches[1].clientX,y:e.touches[1].clientY},a=Math.sqrt(Math.pow(o.x-i.x,2)+Math.pow(o.y-i.y,2)),h=Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2)),u=h-a,d=1;d=d/this.trueWidth>d/this.trueHeight?d/this.trueHeight:d/this.trueWidth,d=d>.1?.1:d;var f=d*u;if(!this.touchNow){if(this.touchNow=!0,u>0?s+=Math.abs(f):u<0&&s>Math.abs(f)&&(s-=Math.abs(f)),this.touches=e.touches,setTimeout(()=>{this.touchNow=!1},8),!this.checkoutImgAxis(this.x,this.y,s))return!1;this.scale=s}},cancelTouchScale(e){window.removeEventListener("touchmove",this.touchScale)},moveImg(e){if(e.preventDefault(),e.touches&&e.touches.length===2)return this.touches=e.touches,window.addEventListener("touchmove",this.touchScale),window.addEventListener("touchend",this.cancelTouchScale),window.removeEventListener("touchmove",this.moveImg),!1;let s="clientX"in e?e.clientX:e.touches[0].clientX,o="clientY"in e?e.clientY:e.touches[0].clientY,t,i;t=s-this.moveX,i=o-this.moveY,this.$nextTick(()=>{if(this.centerBox){let r=this.getImgAxis(t,i,this.scale),a=this.getCropAxis(),h=this.trueHeight*this.scale,u=this.trueWidth*this.scale,d,f,b,m;switch(this.rotate){case 1:case-1:case 3:case-3:d=this.cropOffsertX-this.trueWidth*(1-this.scale)/2+(h-u)/2,f=this.cropOffsertY-this.trueHeight*(1-this.scale)/2+(u-h)/2,b=d-h+this.cropW,m=f-u+this.cropH;break;default:d=this.cropOffsertX-this.trueWidth*(1-this.scale)/2,f=this.cropOffsertY-this.trueHeight*(1-this.scale)/2,b=d-u+this.cropW,m=f-h+this.cropH;break}r.x1>=a.x1&&(t=d),r.y1>=a.y1&&(i=f),r.x2<=a.x2&&(t=b),r.y2<=a.y2&&(i=m)}this.x=t,this.y=i,this.$emit("img-moving",{moving:!0,axis:this.getImgAxis()})})},leaveImg(e){window.removeEventListener("mousemove",this.moveImg),window.removeEventListener("touchmove",this.moveImg),window.removeEventListener("mouseup",this.leaveImg),window.removeEventListener("touchend",this.leaveImg),this.$emit("img-moving",{moving:!1,axis:this.getImgAxis()})},scaleImg(){this.canScale&&window.addEventListener(this.support,this.changeSize,this.passive)},cancelScale(){this.canScale&&window.removeEventListener(this.support,this.changeSize)},changeSize(e){e.preventDefault();let s=this.scale;var o=e.deltaY||e.wheelDelta,t=navigator.userAgent.indexOf("Firefox");o=t>0?o*30:o,this.isIE&&(o=-o);var i=this.coe;i=i/this.trueWidth>i/this.trueHeight?i/this.trueHeight:i/this.trueWidth;var r=i*o;r<0?s+=Math.abs(r):s>Math.abs(r)&&(s-=Math.abs(r));let a=r<0?"add":"reduce";if(a!==this.coeStatus&&(this.coeStatus=a,this.coe=.2),this.scaling||(this.scalingSet=setTimeout(()=>{this.scaling=!1,this.coe=this.coe+=.01},50)),this.scaling=!0,!this.checkoutImgAxis(this.x,this.y,s))return!1;this.scale=s},changeScale(e){let s=this.scale;e=e||1;var o=20;if(o=o/this.trueWidth>o/this.trueHeight?o/this.trueHeight:o/this.trueWidth,e=e*o,e>0?s+=Math.abs(e):s>Math.abs(e)&&(s-=Math.abs(e)),!this.checkoutImgAxis(this.x,this.y,s))return!1;this.scale=s},createCrop(e){e.preventDefault();var s="clientX"in e?e.clientX:e.touches?e.touches[0].clientX:0,o="clientY"in e?e.clientY:e.touches?e.touches[0].clientY:0;this.$nextTick(()=>{var t=s-this.cropX,i=o-this.cropY;if(t>0?(this.cropW=t+this.cropChangeX>this.w?this.w-this.cropChangeX:t,this.cropOffsertX=this.cropChangeX):(this.cropW=this.w-this.cropChangeX+Math.abs(t)>this.w?this.cropChangeX:Math.abs(t),this.cropOffsertX=this.cropChangeX+t>0?this.cropChangeX+t:0),!this.fixed)i>0?(this.cropH=i+this.cropChangeY>this.h?this.h-this.cropChangeY:i,this.cropOffsertY=this.cropChangeY):(this.cropH=this.h-this.cropChangeY+Math.abs(i)>this.h?this.cropChangeY:Math.abs(i),this.cropOffsertY=this.cropChangeY+i>0?this.cropChangeY+i:0);else{var r=this.cropW/this.fixedNumber[0]*this.fixedNumber[1];r+this.cropOffsertY>this.h?(this.cropH=this.h-this.cropOffsertY,this.cropW=this.cropH/this.fixedNumber[1]*this.fixedNumber[0],t>0?this.cropOffsertX=this.cropChangeX:this.cropOffsertX=this.cropChangeX-this.cropW):this.cropH=r,this.cropOffsertY=this.cropOffsertY}})},changeCropSize(e,s,o,t,i){e.preventDefault(),window.addEventListener("mousemove",this.changeCropNow),window.addEventListener("mouseup",this.changeCropEnd),window.addEventListener("touchmove",this.changeCropNow),window.addEventListener("touchend",this.changeCropEnd),this.canChangeX=s,this.canChangeY=o,this.changeCropTypeX=t,this.changeCropTypeY=i,this.cropX="clientX"in e?e.clientX:e.touches[0].clientX,this.cropY="clientY"in e?e.clientY:e.touches[0].clientY,this.cropOldW=this.cropW,this.cropOldH=this.cropH,this.cropChangeX=this.cropOffsertX,this.cropChangeY=this.cropOffsertY,this.fixed&&this.canChangeX&&this.canChangeY&&(this.canChangeY=0),this.$emit("change-crop-size",{width:this.cropW,height:this.cropH})},changeCropNow(e){e.preventDefault();var s="clientX"in e?e.clientX:e.touches?e.touches[0].clientX:0,o="clientY"in e?e.clientY:e.touches?e.touches[0].clientY:0;let t=this.w,i=this.h,r=0,a=0;if(this.centerBox){let d=this.getImgAxis(),f=d.x2,b=d.y2;r=d.x1>0?d.x1:0,a=d.y1>0?d.y1:0,t>f&&(t=f),i>b&&(i=b)}const[h,u]=this.checkCropLimitSize();this.$nextTick(()=>{var d=s-this.cropX,f=o-this.cropY;if(this.canChangeX&&(this.changeCropTypeX===1?this.cropOldW-d<h?(this.cropW=h,this.cropOffsertX=this.cropOldW+this.cropChangeX-r-h):this.cropOldW-d>0?(this.cropW=t-this.cropChangeX-d<=t-r?this.cropOldW-d:this.cropOldW+this.cropChangeX-r,this.cropOffsertX=t-this.cropChangeX-d<=t-r?this.cropChangeX+d:r):(this.cropW=Math.abs(d)+this.cropChangeX<=t?Math.abs(d)-this.cropOldW:t-this.cropOldW-this.cropChangeX,this.cropOffsertX=this.cropChangeX+this.cropOldW):this.changeCropTypeX===2&&(this.cropOldW+d<h?this.cropW=h:this.cropOldW+d>0?(this.cropW=this.cropOldW+d+this.cropOffsertX<=t?this.cropOldW+d:t-this.cropOffsertX,this.cropOffsertX=this.cropChangeX):(this.cropW=t-this.cropChangeX+Math.abs(d+this.cropOldW)<=t-r?Math.abs(d+this.cropOldW):this.cropChangeX-r,this.cropOffsertX=t-this.cropChangeX+Math.abs(d+this.cropOldW)<=t-r?this.cropChangeX-Math.abs(d+this.cropOldW):r))),this.canChangeY&&(this.changeCropTypeY===1?this.cropOldH-f<u?(this.cropH=u,this.cropOffsertY=this.cropOldH+this.cropChangeY-a-u):this.cropOldH-f>0?(this.cropH=i-this.cropChangeY-f<=i-a?this.cropOldH-f:this.cropOldH+this.cropChangeY-a,this.cropOffsertY=i-this.cropChangeY-f<=i-a?this.cropChangeY+f:a):(this.cropH=Math.abs(f)+this.cropChangeY<=i?Math.abs(f)-this.cropOldH:i-this.cropOldH-this.cropChangeY,this.cropOffsertY=this.cropChangeY+this.cropOldH):this.changeCropTypeY===2&&(this.cropOldH+f<u?this.cropH=u:this.cropOldH+f>0?(this.cropH=this.cropOldH+f+this.cropOffsertY<=i?this.cropOldH+f:i-this.cropOffsertY,this.cropOffsertY=this.cropChangeY):(this.cropH=i-this.cropChangeY+Math.abs(f+this.cropOldH)<=i-a?Math.abs(f+this.cropOldH):this.cropChangeY-a,this.cropOffsertY=i-this.cropChangeY+Math.abs(f+this.cropOldH)<=i-a?this.cropChangeY-Math.abs(f+this.cropOldH):a))),this.canChangeX&&this.fixed){var b=this.cropW/this.fixedNumber[0]*this.fixedNumber[1];b<u?(this.cropH=u,this.cropW=this.fixedNumber[0]*u/this.fixedNumber[1],this.changeCropTypeX===1&&(this.cropOffsertX=this.cropChangeX+(this.cropOldW-this.cropW))):b+this.cropOffsertY>i?(this.cropH=i-this.cropOffsertY,this.cropW=this.cropH/this.fixedNumber[1]*this.fixedNumber[0],this.changeCropTypeX===1&&(this.cropOffsertX=this.cropChangeX+(this.cropOldW-this.cropW))):this.cropH=b}if(this.canChangeY&&this.fixed){var m=this.cropH/this.fixedNumber[1]*this.fixedNumber[0];m<h?(this.cropW=h,this.cropH=this.fixedNumber[1]*h/this.fixedNumber[0],this.cropOffsertY=this.cropOldH+this.cropChangeY-this.cropH):m+this.cropOffsertX>t?(this.cropW=t-this.cropOffsertX,this.cropH=this.cropW/this.fixedNumber[0]*this.fixedNumber[1]):this.cropW=m}})},checkCropLimitSize(){let{cropW:e,cropH:s,limitMinSize:o}=this,t=new Array;return Array.isArray(o)?t=o:t=[o,o],e=parseFloat(t[0]),s=parseFloat(t[1]),[e,s]},changeCropEnd(e){window.removeEventListener("mousemove",this.changeCropNow),window.removeEventListener("mouseup",this.changeCropEnd),window.removeEventListener("touchmove",this.changeCropNow),window.removeEventListener("touchend",this.changeCropEnd)},calculateSize(e,s,o,t,i,r){const a=e/s;let h=i,u=r;return h<o&&(h=o,u=Math.ceil(h/a)),u<t&&(u=t,h=Math.ceil(u*a),h<o&&(h=o,u=Math.ceil(h/a))),h<i&&(h=i,u=Math.ceil(h/a)),u<r&&(u=r,h=Math.ceil(u*a)),{width:h,height:u}},endCrop(){this.cropW===0&&this.cropH===0&&(this.cropping=!1);let[e,s]=this.checkCropLimitSize();const{width:o,height:t}=this.fixed?this.calculateSize(this.fixedNumber[0],this.fixedNumber[1],e,s,this.cropW,this.cropH):{width:e,height:s};o>this.cropW&&(this.cropW=o,this.cropOffsertX+o>this.w&&(this.cropOffsertX=this.w-o)),t>this.cropH&&(this.cropH=t,this.cropOffsertY+t>this.h&&(this.cropOffsertY=this.h-t)),window.removeEventListener("mousemove",this.createCrop),window.removeEventListener("mouseup",this.endCrop),window.removeEventListener("touchmove",this.createCrop),window.removeEventListener("touchend",this.endCrop)},startCrop(){this.crop=!0},stopCrop(){this.crop=!1},clearCrop(){this.cropping=!1,this.cropW=0,this.cropH=0},cropMove(e){if(e.preventDefault(),!this.canMoveBox)return this.crop=!1,this.startMove(e),!1;if(e.touches&&e.touches.length===2)return this.crop=!1,this.startMove(e),this.leaveCrop(),!1;window.addEventListener("mousemove",this.moveCrop),window.addEventListener("mouseup",this.leaveCrop),window.addEventListener("touchmove",this.moveCrop),window.addEventListener("touchend",this.leaveCrop);let s="clientX"in e?e.clientX:e.touches[0].clientX,o="clientY"in e?e.clientY:e.touches[0].clientY,t,i;t=s-this.cropOffsertX,i=o-this.cropOffsertY,this.cropX=t,this.cropY=i,this.$emit("crop-moving",{moving:!0,axis:this.getCropAxis()})},moveCrop(e,s){let o=0,t=0;e&&(e.preventDefault(),o="clientX"in e?e.clientX:e.touches[0].clientX,t="clientY"in e?e.clientY:e.touches[0].clientY),this.$nextTick(()=>{let i,r,a=o-this.cropX,h=t-this.cropY;if(s&&(a=this.cropOffsertX,h=this.cropOffsertY),a<=0?i=0:a+this.cropW>this.w?i=this.w-this.cropW:i=a,h<=0?r=0:h+this.cropH>this.h?r=this.h-this.cropH:r=h,this.centerBox){let u=this.getImgAxis();i<=u.x1&&(i=u.x1),i+this.cropW>u.x2&&(i=u.x2-this.cropW),r<=u.y1&&(r=u.y1),r+this.cropH>u.y2&&(r=u.y2-this.cropH)}this.cropOffsertX=i,this.cropOffsertY=r,this.$emit("crop-moving",{moving:!0,axis:this.getCropAxis()})})},getImgAxis(e,s,o){e=e||this.x,s=s||this.y,o=o||this.scale;let t={x1:0,x2:0,y1:0,y2:0},i=this.trueWidth*o,r=this.trueHeight*o;switch(this.rotate){case 0:t.x1=e+this.trueWidth*(1-o)/2,t.x2=t.x1+this.trueWidth*o,t.y1=s+this.trueHeight*(1-o)/2,t.y2=t.y1+this.trueHeight*o;break;case 1:case-1:case 3:case-3:t.x1=e+this.trueWidth*(1-o)/2+(i-r)/2,t.x2=t.x1+this.trueHeight*o,t.y1=s+this.trueHeight*(1-o)/2+(r-i)/2,t.y2=t.y1+this.trueWidth*o;break;default:t.x1=e+this.trueWidth*(1-o)/2,t.x2=t.x1+this.trueWidth*o,t.y1=s+this.trueHeight*(1-o)/2,t.y2=t.y1+this.trueHeight*o;break}return t},getCropAxis(){let e={x1:0,x2:0,y1:0,y2:0};return e.x1=this.cropOffsertX,e.x2=e.x1+this.cropW,e.y1=this.cropOffsertY,e.y2=e.y1+this.cropH,e},leaveCrop(e){window.removeEventListener("mousemove",this.moveCrop),window.removeEventListener("mouseup",this.leaveCrop),window.removeEventListener("touchmove",this.moveCrop),window.removeEventListener("touchend",this.leaveCrop),this.$emit("crop-moving",{moving:!1,axis:this.getCropAxis()})},getCropChecked(e){let s=document.createElement("canvas"),o=s.getContext("2d"),t=new Image,i=this.rotate,r=this.trueWidth,a=this.trueHeight,h=this.cropOffsertX,u=this.cropOffsertY;t.onload=()=>{if(this.cropW!==0){let m=1;this.high&!this.full&&(m=window.devicePixelRatio),this.enlarge!==1&!this.full&&(m=Math.abs(Number(this.enlarge)));let I=this.cropW*m,j=this.cropH*m,S=r*this.scale*m,w=a*this.scale*m,g=(this.x-h+this.trueWidth*(1-this.scale)/2)*m,v=(this.y-u+this.trueHeight*(1-this.scale)/2)*m;switch(b(I,j),o.save(),i){case 0:this.full?(b(I/this.scale,j/this.scale),o.drawImage(t,g/this.scale,v/this.scale,S/this.scale,w/this.scale)):o.drawImage(t,g,v,S,w);break;case 1:case-3:this.full?(b(I/this.scale,j/this.scale),g=g/this.scale+(S/this.scale-w/this.scale)/2,v=v/this.scale+(w/this.scale-S/this.scale)/2,o.rotate(i*90*Math.PI/180),o.drawImage(t,v,-g-w/this.scale,S/this.scale,w/this.scale)):(g=g+(S-w)/2,v=v+(w-S)/2,o.rotate(i*90*Math.PI/180),o.drawImage(t,v,-g-w,S,w));break;case 2:case-2:this.full?(b(I/this.scale,j/this.scale),o.rotate(i*90*Math.PI/180),g=g/this.scale,v=v/this.scale,o.drawImage(t,-g-S/this.scale,-v-w/this.scale,S/this.scale,w/this.scale)):(o.rotate(i*90*Math.PI/180),o.drawImage(t,-g-S,-v-w,S,w));break;case 3:case-1:this.full?(b(I/this.scale,j/this.scale),g=g/this.scale+(S/this.scale-w/this.scale)/2,v=v/this.scale+(w/this.scale-S/this.scale)/2,o.rotate(i*90*Math.PI/180),o.drawImage(t,-v-S/this.scale,g,S/this.scale,w/this.scale)):(g=g+(S-w)/2,v=v+(w-S)/2,o.rotate(i*90*Math.PI/180),o.drawImage(t,-v-S,g,S,w));break;default:this.full?(b(I/this.scale,j/this.scale),o.drawImage(t,g/this.scale,v/this.scale,S/this.scale,w/this.scale)):o.drawImage(t,g,v,S,w)}o.restore()}else{let m=r*this.scale,I=a*this.scale;switch(o.save(),i){case 0:b(m,I),o.drawImage(t,0,0,m,I);break;case 1:case-3:b(I,m),o.rotate(i*90*Math.PI/180),o.drawImage(t,0,-I,m,I);break;case 2:case-2:b(m,I),o.rotate(i*90*Math.PI/180),o.drawImage(t,-m,-I,m,I);break;case 3:case-1:b(I,m),o.rotate(i*90*Math.PI/180),o.drawImage(t,-m,0,m,I);break;default:b(m,I),o.drawImage(t,0,0,m,I)}o.restore()}e(s)};var d=this.img.substr(0,4);d!=="data"&&(t.crossOrigin="Anonymous"),t.src=this.imgs;const f=this.fillColor;function b(m,I){s.width=Math.round(m),s.height=Math.round(I),f&&(o.fillStyle=f,o.fillRect(0,0,s.width,s.height))}},getCropData(e){this.getCropChecked(s=>{e(s.toDataURL("image/"+this.outputType,this.outputSize))})},getCropBlob(e){this.getCropChecked(s=>{s.toBlob(o=>e(o),"image/"+this.outputType,this.outputSize)})},showPreview(){if(this.isCanShow)this.isCanShow=!1,setTimeout(()=>{this.isCanShow=!0},16);else return!1;let e=this.cropW,s=this.cropH,o=this.scale;var t={};t.div={width:`${e}px`,height:`${s}px`};let i=(this.x-this.cropOffsertX)/o,r=(this.y-this.cropOffsertY)/o,a=0;t.w=e,t.h=s,t.url=this.imgs,t.img={width:`${this.trueWidth}px`,height:`${this.trueHeight}px`,transform:`scale(${o})translate3d(${i}px, ${r}px, ${a}px)rotateZ(${this.rotate*90}deg)`},t.html=`
      <div class="show-preview" style="width: ${t.w}px; height: ${t.h}px,; overflow: hidden">
        <div style="width: ${e}px; height: ${s}px">
          <img src=${t.url} style="width: ${this.trueWidth}px; height: ${this.trueHeight}px; transform:
          scale(${o})translate3d(${i}px, ${r}px, ${a}px)rotateZ(${this.rotate*90}deg)">
        </div>
      </div>`,this.$emit("real-time",t)},reload(){let e=new Image;e.onload=()=>{this.w=parseFloat(window.getComputedStyle(this.$refs.cropper).width),this.h=parseFloat(window.getComputedStyle(this.$refs.cropper).height),this.trueWidth=e.width,this.trueHeight=e.height,this.original?this.scale=1:this.scale=this.checkedMode(),this.$nextTick(()=>{this.x=-(this.trueWidth-this.trueWidth*this.scale)/2+(this.w-this.trueWidth*this.scale)/2,this.y=-(this.trueHeight-this.trueHeight*this.scale)/2+(this.h-this.trueHeight*this.scale)/2,this.loading=!1,this.autoCrop&&this.goAutoCrop(),this.$emit("img-load","success"),setTimeout(()=>{this.showPreview()},20)})},e.onerror=()=>{this.$emit("img-load","error")},e.src=this.imgs},checkedMode(){let e=1,s=this.trueWidth,o=this.trueHeight;const t=this.mode.split(" ");switch(t[0]){case"contain":this.trueWidth>this.w&&(e=this.w/this.trueWidth),this.trueHeight*e>this.h&&(e=this.h/this.trueHeight);break;case"cover":s=this.w,e=s/this.trueWidth,o=o*e,o<this.h&&(o=this.h,e=o/this.trueHeight);break;default:try{let i=t[0];if(i.search("px")!==-1){i=i.replace("px",""),s=parseFloat(i);const r=s/this.trueWidth;let a=1,h=t[1];h.search("px")!==-1&&(h=h.replace("px",""),o=parseFloat(h),a=o/this.trueHeight),e=Math.min(r,a)}if(i.search("%")!==-1&&(i=i.replace("%",""),s=parseFloat(i)/100*this.w,e=s/this.trueWidth),t.length===2&&i==="auto"){let r=t[1];r.search("px")!==-1&&(r=r.replace("px",""),o=parseFloat(r),e=o/this.trueHeight),r.search("%")!==-1&&(r=r.replace("%",""),o=parseFloat(r)/100*this.h,e=o/this.trueHeight)}}catch{e=1}}return e},goAutoCrop(e,s){if(this.imgs===""||this.imgs===null)return;this.clearCrop(),this.cropping=!0;let o=this.w,t=this.h;if(this.centerBox){const a=Math.abs(this.rotate)%2>0;let h=(a?this.trueHeight:this.trueWidth)*this.scale,u=(a?this.trueWidth:this.trueHeight)*this.scale;o=h<o?h:o,t=u<t?u:t}var i=e||parseFloat(this.autoCropWidth),r=s||parseFloat(this.autoCropHeight);(i===0||r===0)&&(i=o*.8,r=t*.8),i=i>o?o:i,r=r>t?t:r,this.fixed&&(r=i/this.fixedNumber[0]*this.fixedNumber[1]),r>this.h&&(r=this.h,i=r/this.fixedNumber[1]*this.fixedNumber[0]),this.changeCrop(i,r)},changeCrop(e,s){if(this.centerBox){let o=this.getImgAxis();e>o.x2-o.x1&&(e=o.x2-o.x1,s=e/this.fixedNumber[0]*this.fixedNumber[1]),s>o.y2-o.y1&&(s=o.y2-o.y1,e=s/this.fixedNumber[1]*this.fixedNumber[0])}this.cropW=e,this.cropH=s,this.checkCropLimitSize(),this.$nextTick(()=>{this.cropOffsertX=(this.w-this.cropW)/2,this.cropOffsertY=(this.h-this.cropH)/2,this.centerBox&&this.moveCrop(null,!0)})},refresh(){this.img,this.imgs="",this.scale=1,this.crop=!1,this.rotate=0,this.w=0,this.h=0,this.trueWidth=0,this.trueHeight=0,this.imgIsQqualCrop=!1,this.clearCrop(),this.$nextTick(()=>{this.checkedImg()})},rotateLeft(){this.rotate=this.rotate<=-3?0:this.rotate-1},rotateRight(){this.rotate=this.rotate>=3?0:this.rotate+1},rotateClear(){this.rotate=0},checkoutImgAxis(e,s,o){e=e||this.x,s=s||this.y,o=o||this.scale;let t=!0;if(this.centerBox){let i=this.getImgAxis(e,s,o),r=this.getCropAxis();i.x1>=r.x1&&(t=!1),i.x2<=r.x2&&(t=!1),i.y1>=r.y1&&(t=!1),i.y2<=r.y2&&(t=!1),t||this.changeImgScale(i,r,o)}return t},changeImgScale(e,s,o){let t=this.trueWidth,i=this.trueHeight,r=t*o,a=i*o;if(r>=this.cropW&&a>=this.cropH)this.scale=o;else{const h=this.cropW/t,u=this.cropH/i,d=this.cropH<=i*h?h:u;this.scale=d,r=t*d,a=i*d}this.imgIsQqualCrop||(e.x1>=s.x1&&(this.isRotateRightOrLeft?this.x=s.x1-(t-r)/2-(r-a)/2:this.x=s.x1-(t-r)/2),e.x2<=s.x2&&(this.isRotateRightOrLeft?this.x=s.x1-(t-r)/2-(r-a)/2-a+this.cropW:this.x=s.x2-(t-r)/2-r),e.y1>=s.y1&&(this.isRotateRightOrLeft?this.y=s.y1-(i-a)/2-(a-r)/2:this.y=s.y1-(i-a)/2),e.y2<=s.y2&&(this.isRotateRightOrLeft?this.y=s.y2-(i-a)/2-(a-r)/2-r:this.y=s.y2-(i-a)/2-a)),(r<this.cropW||a<this.cropH)&&(this.imgIsQqualCrop=!0)}},mounted(){this.support="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll";let e=this;var s=navigator.userAgent;this.isIOS=!!s.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(o,t,i){for(var r=atob(this.toDataURL(t,i).split(",")[1]),a=r.length,h=new Uint8Array(a),u=0;u<a;u++)h[u]=r.charCodeAt(u);o(new Blob([h],{type:e.type||"image/png"}))}}),this.showPreview(),this.checkedImg()},unmounted(){window.removeEventListener("mousemove",this.moveCrop),window.removeEventListener("mouseup",this.leaveCrop),window.removeEventListener("touchmove",this.moveCrop),window.removeEventListener("touchend",this.leaveCrop),this.cancelScale()}}),Fe={key:0,class:"cropper-box"},qe=["src"],Qe={class:"cropper-view-box"},Je=["src"],Ze={key:1};function Ge(e,s,o,t,i,r){return y(),C("div",{class:"vue-cropper",ref:"cropper",onMouseover:s[28]||(s[28]=(...a)=>e.scaleImg&&e.scaleImg(...a)),onMouseout:s[29]||(s[29]=(...a)=>e.cancelScale&&e.cancelScale(...a))},[e.imgs?(y(),C("div",Fe,[z(n("div",{class:"cropper-box-canvas",style:_({width:e.trueWidth+"px",height:e.trueHeight+"px",transform:"scale("+e.scale+","+e.scale+") translate3d("+e.x/e.scale+"px,"+e.y/e.scale+"px,0)rotateZ("+e.rotate*90+"deg)"})},[n("img",{src:e.imgs,alt:"cropper-img",ref:"cropperImg"},null,8,qe)],4),[[ye,!e.loading]])])):$("",!0),n("div",{class:N(["cropper-drag-box",{"cropper-move":e.move&&!e.crop,"cropper-crop":e.crop,"cropper-modal":e.cropping}]),onMousedown:s[0]||(s[0]=(...a)=>e.startMove&&e.startMove(...a)),onTouchstart:s[1]||(s[1]=(...a)=>e.startMove&&e.startMove(...a))},null,34),z(n("div",{class:"cropper-crop-box",style:_({width:e.cropW+"px",height:e.cropH+"px",transform:"translate3d("+e.cropOffsertX+"px,"+e.cropOffsertY+"px,0)"})},[n("span",Qe,[n("img",{style:_({width:e.trueWidth+"px",height:e.trueHeight+"px",transform:"scale("+e.scale+","+e.scale+") translate3d("+(e.x-e.cropOffsertX)/e.scale+"px,"+(e.y-e.cropOffsertY)/e.scale+"px,0)rotateZ("+e.rotate*90+"deg)"}),src:e.imgs,alt:"cropper-img"},null,12,Je)]),n("span",{class:"cropper-face cropper-move",onMousedown:s[2]||(s[2]=(...a)=>e.cropMove&&e.cropMove(...a)),onTouchstart:s[3]||(s[3]=(...a)=>e.cropMove&&e.cropMove(...a))},null,32),e.info?(y(),C("span",{key:0,class:"crop-info",style:_({top:e.cropInfo.top})},A(e.cropInfo.width)+" × "+A(e.cropInfo.height),5)):$("",!0),e.fixedBox?$("",!0):(y(),C("span",Ze,[n("span",{class:"crop-line line-w",onMousedown:s[4]||(s[4]=a=>e.changeCropSize(a,!1,!0,0,1)),onTouchstart:s[5]||(s[5]=a=>e.changeCropSize(a,!1,!0,0,1))},null,32),n("span",{class:"crop-line line-a",onMousedown:s[6]||(s[6]=a=>e.changeCropSize(a,!0,!1,1,0)),onTouchstart:s[7]||(s[7]=a=>e.changeCropSize(a,!0,!1,1,0))},null,32),n("span",{class:"crop-line line-s",onMousedown:s[8]||(s[8]=a=>e.changeCropSize(a,!1,!0,0,2)),onTouchstart:s[9]||(s[9]=a=>e.changeCropSize(a,!1,!0,0,2))},null,32),n("span",{class:"crop-line line-d",onMousedown:s[10]||(s[10]=a=>e.changeCropSize(a,!0,!1,2,0)),onTouchstart:s[11]||(s[11]=a=>e.changeCropSize(a,!0,!1,2,0))},null,32),n("span",{class:"crop-point point1",onMousedown:s[12]||(s[12]=a=>e.changeCropSize(a,!0,!0,1,1)),onTouchstart:s[13]||(s[13]=a=>e.changeCropSize(a,!0,!0,1,1))},null,32),n("span",{class:"crop-point point2",onMousedown:s[14]||(s[14]=a=>e.changeCropSize(a,!1,!0,0,1)),onTouchstart:s[15]||(s[15]=a=>e.changeCropSize(a,!1,!0,0,1))},null,32),n("span",{class:"crop-point point3",onMousedown:s[16]||(s[16]=a=>e.changeCropSize(a,!0,!0,2,1)),onTouchstart:s[17]||(s[17]=a=>e.changeCropSize(a,!0,!0,2,1))},null,32),n("span",{class:"crop-point point4",onMousedown:s[18]||(s[18]=a=>e.changeCropSize(a,!0,!1,1,0)),onTouchstart:s[19]||(s[19]=a=>e.changeCropSize(a,!0,!1,1,0))},null,32),n("span",{class:"crop-point point5",onMousedown:s[20]||(s[20]=a=>e.changeCropSize(a,!0,!1,2,0)),onTouchstart:s[21]||(s[21]=a=>e.changeCropSize(a,!0,!1,2,0))},null,32),n("span",{class:"crop-point point6",onMousedown:s[22]||(s[22]=a=>e.changeCropSize(a,!0,!0,1,2)),onTouchstart:s[23]||(s[23]=a=>e.changeCropSize(a,!0,!0,1,2))},null,32),n("span",{class:"crop-point point7",onMousedown:s[24]||(s[24]=a=>e.changeCropSize(a,!1,!0,0,2)),onTouchstart:s[25]||(s[25]=a=>e.changeCropSize(a,!1,!0,0,2))},null,32),n("span",{class:"crop-point point8",onMousedown:s[26]||(s[26]=a=>e.changeCropSize(a,!0,!0,2,2)),onTouchstart:s[27]||(s[27]=a=>e.changeCropSize(a,!0,!0,2,2))},null,32)]))],4),[[ye,e.cropping]])],544)}const Ke=_e(Ve,[["render",Ge],["__scopeId","data-v-a742df44"]]),et="FlatNasImageCache",se="images",tt=1,Se=()=>new Promise((e,s)=>{const o=indexedDB.open(et,tt);o.onerror=()=>s(o.error),o.onsuccess=()=>e(o.result),o.onupgradeneeded=t=>{const i=t.target.result;i.objectStoreNames.contains(se)||i.createObjectStore(se,{keyPath:"url"})}}),st=async(e,s,o)=>{const r=(await Se()).transaction(se,"readwrite").objectStore(se);await new Promise((a,h)=>{const u=r.put({url:e,blob:s,timestamp:Date.now(),etag:o});u.onsuccess=()=>a(),u.onerror=()=>h(u.error)}),localStorage.setItem(`cache_meta_${e}`,JSON.stringify({timestamp:Date.now(),etag:o}))},ot=async e=>{const s=localStorage.getItem(`cache_meta_${e}`);if(s){const r=JSON.parse(s);if(Date.now()-r.timestamp>1440*60*1e3)return null}else return null;const i=(await Se()).transaction(se,"readonly").objectStore(se);return new Promise((r,a)=>{const h=i.get(e);h.onsuccess=()=>{const u=h.result;r(u?u.blob:null)},h.onerror=()=>a(h.error)})},E=[];for(let e=0;e<256;++e)E.push((e+256).toString(16).slice(1));function it(e,s=0){return(E[e[s+0]]+E[e[s+1]]+E[e[s+2]]+E[e[s+3]]+"-"+E[e[s+4]]+E[e[s+5]]+"-"+E[e[s+6]]+E[e[s+7]]+"-"+E[e[s+8]]+E[e[s+9]]+"-"+E[e[s+10]]+E[e[s+11]]+E[e[s+12]]+E[e[s+13]]+E[e[s+14]]+E[e[s+15]]).toLowerCase()}let de;const rt=new Uint8Array(16);function at(){if(!de){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");de=crypto.getRandomValues.bind(crypto)}return de(rt)}const lt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Me={randomUUID:lt};function nt(e,s,o){e=e||{};const t=e.random??e.rng?.()??at();if(t.length<16)throw new Error("Random bytes length must be >= 16");return t[6]=t[6]&15|64,t[8]=t[8]&63|128,it(t)}function ct(e,s,o){return Me.randomUUID&&!e?Me.randomUUID():nt(e)}const ht={class:"bg-white md:rounded-2xl shadow-2xl w-full md:max-w-5xl h-full md:h-[85vh] flex flex-col overflow-hidden animate-in fade-in zoom-in duration-200"},pt={class:"px-4 pb-3 pt-[calc(0.75rem+env(safe-area-inset-top))] md:px-6 md:py-4 border-b border-gray-100 flex justify-between items-center bg-white"},ut={class:"flex items-center gap-4"},dt={class:"text-lg font-bold text-gray-800"},gt={class:"flex items-center bg-gray-100 rounded-lg p-1"},ft={class:"px-1.5 py-0.5 rounded-full bg-gray-200 text-gray-600 text-[10px]"},mt={class:"px-1.5 py-0.5 rounded-full bg-gray-200 text-gray-600 text-[10px]"},vt={class:"px-4 py-3 md:px-6 bg-white border-b border-gray-100 flex flex-col md:flex-row justify-between items-start md:items-center gap-3 md:gap-0"},bt={class:"flex flex-wrap gap-2 md:gap-3 items-center w-full md:w-auto"},xt={class:"flex items-center gap-2 mr-2 bg-gray-50 p-1 rounded-lg border border-gray-100"},wt=["title"],yt={class:"flex items-center gap-1 px-1"},Ct={key:1,class:"text-[10px] text-gray-400"},kt={key:1,class:"flex items-center gap-2 mr-2 bg-gray-50 p-1 rounded-lg border border-gray-100"},Ot={class:"flex items-center gap-1 px-1"},Mt={class:"flex items-center gap-1 px-1"},Wt={key:2,class:"flex items-center gap-2 mr-2 bg-gray-50 p-1 rounded-lg border border-gray-100"},It={class:"flex items-center gap-1 px-1"},St={class:"flex items-center gap-1 px-1"},Ht=["disabled"],Xt={key:0},Lt={key:1},Yt={class:"flex-1 overflow-y-auto p-6 bg-gray-50"},$t={key:0,class:"absolute inset-x-0 top-[120px] bottom-0 z-50 bg-white/60 backdrop-blur-[2px] flex flex-col items-center justify-center text-blue-600 gap-3"},Ut={key:1,class:"h-full flex flex-col items-center justify-center text-gray-400"},Bt={key:2,class:"h-full flex flex-col items-center justify-center text-gray-400"},Et=["src"],Rt={key:0,class:"absolute top-2 left-2 bg-green-500 text-white text-[10px] font-bold px-2 py-1 rounded-full shadow-sm z-10 flex items-center gap-1"},At=["onClick"],Tt=["onClick"],Pt={key:4,class:"space-y-6 p-1"},Nt={class:"border border-gray-200 rounded-xl bg-white p-6 shadow-sm"},zt={class:"space-y-4"},jt={key:0,class:"grid grid-cols-2 gap-4"},Dt={class:"space-y-2"},_t={class:"relative h-48 w-full rounded-lg overflow-hidden border border-gray-200 bg-gray-100 group"},Vt=["src"],Ft={class:"bg-gray-50 p-2 rounded-lg border border-gray-100 flex items-center justify-center gap-4"},qt={class:"flex items-center gap-1"},Qt={class:"flex items-center gap-1"},Jt=["disabled"],Zt={class:"space-y-2"},Gt={class:"relative h-48 w-full flex justify-center rounded-lg border border-gray-200 bg-gray-100 overflow-hidden"},Kt={class:"relative h-full aspect-[9/16]"},es=["src"],ts={class:"bg-gray-50 p-2 rounded-lg border border-gray-100 flex items-center justify-center gap-4"},ss={class:"flex items-center gap-1"},os={class:"flex items-center gap-1"},is=["disabled"],rs={key:0,class:"block w-4 h-4 border-2 border-blue-200 border-t-blue-600 rounded-full animate-spin"},as={key:1,xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ls={class:"flex gap-2"},ns=["disabled"],cs={key:0,class:"inline-block animate-spin"},hs={key:1},ps={class:"flex flex-wrap gap-2"},us=["onClick"],ds={class:"pt-4 flex items-center gap-3 border-t border-gray-100 mt-4"},gs=["disabled"],fs={key:0,class:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"},ms=["disabled"],vs={key:0,class:"w-4 h-4 border-2 border-gray-400 border-t-gray-600 rounded-full animate-spin"},bs={class:"bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 transform transition-all scale-100 animate-in fade-in zoom-in duration-200"},xs={class:"flex items-start gap-4 mb-4"},ws={class:"text-sm text-gray-600 leading-relaxed"},U="default-wallpaper.svg",ys=ge({__name:"WallpaperLibrary",props:{show:{type:Boolean},title:{}},emits:["update:show","select"],setup(e,{emit:s}){const o=s,t=We(),i=H("pc"),r=H([]),a=H([]),h=H(!1),u=H(!1),d=H(null),f=H(!1),b=H(""),m=H(()=>{}),I=()=>{f.value=!1},j=()=>{m.value(),I()},S=te(()=>t.appConfig.wallpaperApiPcList||"/api/backgrounds"),w=te(()=>t.appConfig.wallpaperApiMobileList||"/api/mobile_backgrounds"),g=async()=>{h.value=!0;const p=t.getHeaders();try{const l=await fetch(S.value,{headers:p});if(l.ok){const L=(await l.json()).filter(x=>x!==U),R=t.appConfig.pcWallpaperOrder||[],W=[],k=new Set(L);W.push(U),R.forEach(x=>{k.has(x)&&x!==U&&(W.push(x),k.delete(x))}),k.forEach(x=>{x!==U&&W.push(x)}),r.value=W}else r.value=[U];const c=await fetch(w.value,{headers:p});if(c.ok){const L=(await c.json()).filter(x=>x!==U),R=t.appConfig.mobileWallpaperOrder||[],W=[],k=new Set(L);W.push(U),R.forEach(x=>{k.has(x)&&x!==U&&(W.push(x),k.delete(x))}),k.forEach(x=>{x!==U&&W.push(x)}),a.value=W}else a.value=[U]}catch(l){console.error(l),r.value.includes(U)||(r.value=[U,...r.value]),a.value.includes(U)||(a.value=[U,...a.value])}finally{h.value=!1}},v=(p,l)=>{if(p===U)return t.getAssetUrl(`/${U}`);const c=l==="pc"?t.appConfig.wallpaperPcImageBase||"/backgrounds":t.appConfig.wallpaperMobileImageBase||"/mobile_backgrounds",M=c.endsWith("/")?c.slice(0,-1):c;return t.getAssetUrl(`${M}/${encodeURIComponent(p)}`)},Q=(p,l)=>{if(fe(p,l)){const c=v(p,l);o("select",{url:c,type:l}),o("update:show",!1)}},fe=(p,l)=>{const c=v(p,l);return l==="pc"?t.appConfig.background=c:t.appConfig.mobileBackground=c,!0},le=te({get(){const p=i.value==="pc"?[...r.value]:[...a.value],l=i.value==="pc"?t.appConfig.background:t.appConfig.mobileBackground,c=i.value==="pc"?"pc":"mobile",M=p.findIndex(L=>v(L,c)===l);if(M>-1){const[L]=p.splice(M,1);L&&p.unshift(L)}return p},set(p){i.value==="pc"?(r.value=p,t.appConfig.pcWallpaperOrder=p):(a.value=p,t.appConfig.mobileWallpaperOrder=p);const l=p[0];if(l){const c=i.value==="pc"?"pc":"mobile",M=c==="pc"?t.appConfig.background:t.appConfig.mobileBackground;v(l,c)!==M&&fe(l,c)}}}),He=()=>{d.value?.click()},oe=H([]),Xe=p=>{const l=p.target;if(!l.files||l.files.length===0)return;oe.value=Array.from(l.files),oe.value.some(M=>M.size>10*1024*1024)?(b.value="检测到文件超过 10MB，可能导致内存占用过高，是否继续上传？",m.value=me,f.value=!0):me(),l.value=""},me=async()=>{if(oe.value.length===0)return;u.value=!0;const p=new FormData;oe.value.forEach(c=>{p.append("files",c)});const l=i.value==="pc"?t.appConfig.wallpaperApiPcUpload||"/api/backgrounds/upload":t.appConfig.wallpaperApiMobileUpload||"/api/mobile_backgrounds/upload";try{const c=localStorage.getItem("flat-nas-token"),M={};c&&(M.Authorization=`Bearer ${c}`),(await fetch(l,{method:"POST",headers:M,body:p})).ok?(await g(),t.refreshResources()):alert("上传失败")}catch(c){console.error(c),alert("上传出错")}finally{u.value=!1,oe.value=[]}},Le=(p,l)=>{if(p===U){alert("默认壁纸无法删除");return}b.value="确定要删除这张壁纸吗？",m.value=()=>Ye(p,l),f.value=!0},Ye=async(p,l)=>{const c=v(p,l),M=l==="pc"?t.appConfig.background:t.appConfig.mobileBackground;if(c===M){const k=v(U,l);l==="pc"?t.appConfig.background=k:t.appConfig.mobileBackground=k}const L=l==="pc"?t.appConfig.wallpaperApiPcDeleteBase||"/api/backgrounds":t.appConfig.wallpaperApiMobileDeleteBase||"/api/mobile_backgrounds",W=`${L.endsWith("/")?L.slice(0,-1):L}/${encodeURIComponent(p)}`;try{const k=localStorage.getItem("flat-nas-token"),x={};k&&(x.Authorization=`Bearer ${k}`),(await fetch(W,{method:"DELETE",headers:x})).ok?(l==="pc"?r.value=r.value.filter(Y=>Y!==p):a.value=a.value.filter(Y=>Y!==p),t.refreshResources()):alert("删除失败")}catch(k){console.error(k)}},G=te({get:()=>i.value==="pc"?t.appConfig.pcRotation:t.appConfig.mobileRotation,set:p=>{i.value==="pc"?t.appConfig.pcRotation=p:t.appConfig.mobileRotation=p}}),ve=te({get:()=>i.value==="pc"?t.appConfig.pcRotationInterval??30:t.appConfig.mobileRotationInterval??30,set:p=>{i.value==="pc"?t.appConfig.pcRotationInterval=p:t.appConfig.mobileRotationInterval=p}}),ie=te({get:()=>i.value==="pc"?t.appConfig.pcRotationMode??"random":t.appConfig.mobileRotationMode??"random",set:p=>{i.value==="pc"?t.appConfig.pcRotationMode=p:t.appConfig.mobileRotationMode=p}}),$e=()=>{G.value=!G.value},Ue=()=>{ie.value=ie.value==="random"?"sequential":"random"},X=H(""),K=H(""),V=H(!1),T=H(null),F=H(""),ee=H(0),re=H(""),be=[{name:"Bing 每日壁纸",url:"https://bing.biturl.top/?resolution=1920&format=image&index=0&mkt=zh-CN",autoUpdate:!0},{name:"随机风景 (Picsum)",url:"https://picsum.photos/1920/1080",autoUpdate:!1},{name:"随机二次元 (PC)",url:"https://www.loliapi.com/acg/pc/",autoUpdate:!1},{name:"随机二次元 (PE)",url:"https://www.loliapi.com/acg/pe/",autoUpdate:!1}],J=p=>{re.value&&(URL.revokeObjectURL(re.value),re.value=""),X.value=p,p.startsWith("blob:")&&(re.value=p)},ne=async p=>{K.value=p;const l=++ee.value;V.value=!0;try{const c=await ot(p);if(l!==ee.value)return;if(c){T.value=c,F.value=p,J(URL.createObjectURL(c)),V.value=!1;return}}catch(c){console.warn("Cache lookup failed",c)}try{const c=ct(),M=new AbortController,L=setTimeout(()=>M.abort(),1e4),R=await fetch(`/api/wallpaper/proxy?url=${encodeURIComponent(p)}&uuid=${c}`,{signal:M.signal});if(clearTimeout(L),l!==ee.value)return;if(R.ok){const W=await R.blob();await st(p,W,R.headers.get("ETag")||void 0),T.value=W,F.value=p,J(URL.createObjectURL(W)),V.value=!1;return}}catch(c){console.warn("Proxy fetch failed, falling back to direct URL",c)}try{const c=p.includes("?")?"&":"?",M=`${p}${c}v=${Date.now()}`,L=await fetch("/api/wallpaper/resolve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:M})});if(l!==ee.value)return;const R=L.ok?(await L.json()).url:M;F.value=R;try{const W=await fetch(`/api/wallpaper/proxy?url=${encodeURIComponent(R)}&uuid=${l}`);if(l!==ee.value)return;if(W.ok){const k=await W.blob();T.value=k,J(URL.createObjectURL(k));return}}catch(W){console.warn("Resolve proxy fetch failed, using URL preview",W)}T.value=null,J(R)}catch{if(l!==ee.value)return;T.value=null,F.value=p,J(p)}finally{l===ee.value&&(V.value=!1)}},Be=async p=>{await ne(p)},Ee=()=>{const p=K.value||X.value;if(p){const l=p.replace(/([?&])v=\d+/,"$1").replace(/[?&]$/,"");ne(l)}},P=H(!1),ae=async(p,l=!0)=>{if(X.value){P.value=!0;try{const c=localStorage.getItem("flat-nas-token");let M="";const R=await(async()=>{if(V.value)for(let x=0;x<20&&V.value;x+=1)await new Promise(B=>setTimeout(B,100));const W=async x=>{try{const B=await fetch(x,{cache:"no-store"});if(!B.ok)return null;const Y=await B.blob();return T.value=Y,J(URL.createObjectURL(Y)),Y}catch{return null}};if(T.value||(!F.value&&(K.value||X.value)&&await ne(K.value||X.value),T.value))return T.value;const k=K.value||F.value||X.value;if(k){const x=await fetch(`/api/wallpaper/proxy?url=${encodeURIComponent(k)}&uuid=apply`);if(x.ok){const Y=await x.blob();return T.value=Y,F.value=k,J(URL.createObjectURL(Y)),Y}const B=await W(k);if(B)return B}if(k&&k.startsWith("http")){const x=k.includes("?")?"&":"?",B=`${k}${x}v=${Date.now()}`,Y=await fetch("/api/wallpaper/resolve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:B})});if(Y.ok){const Z=await Y.json();F.value=Z.url;const xe=await fetch(`/api/wallpaper/proxy?url=${encodeURIComponent(Z.url)}&uuid=apply-resolve`);if(xe.ok){const ce=await xe.blob();return T.value=ce,J(URL.createObjectURL(ce)),ce}const we=await W(Z.url);if(we)return we}}if(X.value.startsWith("blob:")){const x=await fetch(X.value).then(B=>B.blob());return T.value=x,x}return null})();if(R){l&&p==="pc"&&(document.body.style.backgroundImage=`url(${X.value})`);const W=new FormData,k=R.type.split("/")[1]||"jpg",x=`blob_${Date.now()}.${k}`;W.append("files",R,x);const B=p==="pc"?t.appConfig.wallpaperApiPcUpload||"/api/backgrounds/upload":t.appConfig.wallpaperApiMobileUpload||"/api/mobile_backgrounds/upload",Y=await fetch(B,{method:"POST",headers:{Authorization:`Bearer ${c}`},body:W});if(Y.ok){const Z=await Y.json();if(Z.success&&Z.files&&Z.files.length>0)M=Z.files[0].path;else throw new Error("Upload failed: No path returned")}else throw new Error("Upload failed: "+Y.statusText)}else throw new Error("No preview image available");if(l){const W=be.find(Y=>Y.url===K.value||Y.url===X.value),k=W?W.autoUpdate:!1,B={type:"api",url:k?K.value||X.value:M,enabled:!!k,lastUpdated:Date.now()};p==="pc"?(t.appConfig.background=M,t.appConfig.wallpaperConfig=B):(t.appConfig.mobileBackground=M,t.appConfig.mobileWallpaperConfig=B),t.saveData(),alert("设置成功")}else await g(),alert(p==="pc"?"已保存到 PC 壁纸库":"已保存到手机壁纸库")}catch(c){console.error(c),alert("请求出错，请检查网络"),p==="pc"&&(t.appConfig.background=t.getAssetUrl(`/${U}`))}finally{P.value=!1}}};return Re(()=>{g(),t.appConfig.background?.startsWith("http")&&(X.value=t.appConfig.background,F.value=t.appConfig.background)}),(p,l)=>(y(),C(he,null,[(y(),pe(ke,{to:"body"},[e.show?(y(),C("div",{key:0,class:"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:l[21]||(l[21]=ue(c=>p.$emit("update:show",!1),["self"]))},[n("div",ht,[n("div",pt,[n("div",ut,[n("h3",dt,A(e.title||"壁纸库"),1),n("div",gt,[n("button",{onClick:l[0]||(l[0]=c=>i.value="pc"),class:N(["px-3 py-1.5 text-xs font-bold rounded-md transition-all flex items-center gap-2",i.value==="pc"?"bg-white text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700"])},[l[22]||(l[22]=q(" PC 壁纸 ",-1)),n("span",ft,A(r.value.length),1)],2),n("button",{onClick:l[1]||(l[1]=c=>i.value="mobile"),class:N(["px-3 py-1.5 text-xs font-bold rounded-md transition-all flex items-center gap-2",i.value==="mobile"?"bg-white text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700"])},[l[23]||(l[23]=q(" 手机壁纸 ",-1)),n("span",mt,A(a.value.length),1)],2),n("button",{onClick:l[2]||(l[2]=c=>i.value="api"),class:N(["px-3 py-1.5 text-xs font-bold rounded-md transition-all flex items-center gap-2",i.value==="api"?"bg-white text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700"])}," API 接口 ",2)])]),n("button",{onClick:l[3]||(l[3]=c=>p.$emit("update:show",!1)),class:"w-8 h-8 rounded-full bg-red-100 hover:bg-red-200 flex items-center justify-center text-red-500 hover:text-red-900 transition-colors"}," ✕ ")]),n("div",vt,[l[31]||(l[31]=n("div",{class:"text-xs text-gray-400 hidden md:block"},"请拖动选择",-1)),n("div",bt,[n("div",xt,[n("button",{onClick:Ue,class:N(["px-2 py-1 text-xs font-medium rounded transition-colors flex items-center gap-1",ie.value==="random"?"text-purple-600 bg-purple-50":"text-blue-600 bg-blue-50"]),title:ie.value==="random"?"当前：随机播放":"当前：顺序播放"},[n("span",null,A(ie.value==="random"?"随机":"顺播"),1)],10,wt),l[24]||(l[24]=n("div",{class:"h-4 w-px bg-gray-300"},null,-1)),n("div",yt,[n("button",{onClick:$e,class:N(["text-xs font-medium transition-colors flex items-center gap-1 px-2 py-1 rounded",G.value?"bg-green-100 text-green-700":"text-gray-600 hover:bg-white"])},[n("span",null,A(G.value?"轮播中":"点击轮播"),1)],2),G.value?$("",!0):z((y(),C("input",{key:0,type:"number","onUpdate:modelValue":l[4]||(l[4]=c=>ve.value=c),min:"5",class:"w-10 text-xs border border-gray-200 rounded px-1 py-0.5 text-center outline-none focus:border-blue-500",title:"轮播间隔(分钟)"},null,512)),[[D,ve.value]]),G.value?$("",!0):(y(),C("span",Ct,"分"))])]),G.value?$("",!0):(y(),C("button",{key:0,onClick:l[5]||(l[5]=c=>O(t).appConfig.fixedWallpaper=!O(t).appConfig.fixedWallpaper),class:N(["px-3 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-1 shadow-sm",O(t).appConfig.fixedWallpaper?"bg-blue-500 text-white hover:bg-blue-600 shadow-blue-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"]),title:"固定当前壁纸，不参与轮播"},[n("span",null,A(O(t).appConfig.fixedWallpaper?"已固定":"固定"),1)],2)),i.value==="pc"?(y(),C("div",kt,[n("div",Ot,[l[25]||(l[25]=n("span",{class:"text-[13px] text-gray-500"},"模糊",-1)),z(n("input",{type:"range","onUpdate:modelValue":l[6]||(l[6]=c=>O(t).appConfig.backgroundBlur=c),min:"0",max:"20",step:"1",class:"w-16 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500",title:"模糊半径"},null,512),[[D,O(t).appConfig.backgroundBlur,void 0,{number:!0}]])]),l[27]||(l[27]=n("div",{class:"w-px h-3 bg-gray-300"},null,-1)),n("div",Mt,[l[26]||(l[26]=n("span",{class:"text-[13px] text-gray-500"},"遮罩",-1)),z(n("input",{type:"range","onUpdate:modelValue":l[7]||(l[7]=c=>O(t).appConfig.backgroundMask=c),min:"0",max:"1",step:"0.1",class:"w-16 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500",title:"遮罩浓度"},null,512),[[D,O(t).appConfig.backgroundMask,void 0,{number:!0}]])])])):$("",!0),i.value==="mobile"?(y(),C("div",Wt,[n("div",It,[l[28]||(l[28]=n("span",{class:"text-[13px] text-gray-500"},"模糊",-1)),z(n("input",{type:"range","onUpdate:modelValue":l[8]||(l[8]=c=>O(t).appConfig.mobileBackgroundBlur=c),min:"0",max:"20",step:"1",class:"w-16 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-400",title:"模糊半径"},null,512),[[D,O(t).appConfig.mobileBackgroundBlur,void 0,{number:!0}]])]),l[30]||(l[30]=n("div",{class:"w-px h-3 bg-gray-300"},null,-1)),n("div",St,[l[29]||(l[29]=n("span",{class:"text-[13px] text-gray-500"},"遮罩",-1)),z(n("input",{type:"range","onUpdate:modelValue":l[9]||(l[9]=c=>O(t).appConfig.mobileBackgroundMask=c),min:"0",max:"1",step:"0.1",class:"w-16 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-400",title:"遮罩浓度"},null,512),[[D,O(t).appConfig.mobileBackgroundMask,void 0,{number:!0}]])])])):$("",!0),i.value==="mobile"?(y(),C("button",{key:3,onClick:l[10]||(l[10]=c=>O(t).appConfig.enableMobileWallpaper=!O(t).appConfig.enableMobileWallpaper),class:N(["px-3 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-1 shadow-sm",O(t).appConfig.enableMobileWallpaper?"bg-green-500 text-white hover:bg-green-600 shadow-green-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"]),title:"开启后，手机端将优先使用手机壁纸；关闭后，手机端将使用 PC 端壁纸"},[n("span",null,A(O(t).appConfig.enableMobileWallpaper?"已启用手机壁纸":"启用手机壁纸"),1)],2)):$("",!0),n("button",{onClick:g,class:"px-3 py-1.5 rounded-lg text-xs font-medium text-gray-600 hover:bg-gray-100 transition-colors flex items-center gap-1"}," 刷新 "),n("button",{onClick:He,class:"px-4 py-1.5 rounded-lg text-xs font-bold text-white bg-blue-600 hover:bg-blue-700 shadow-sm shadow-blue-200 transition-all flex items-center gap-1",disabled:u.value},[u.value?(y(),C("span",Xt,"上传中...")):(y(),C("span",Lt,"上传壁纸"))],8,Ht),n("input",{ref_key:"fileInput",ref:d,type:"file",accept:"image/*",multiple:"",class:"hidden",onChange:Xe},null,544)])]),n("div",Yt,[V.value?(y(),C("div",$t,[...l[32]||(l[32]=[n("div",{class:"w-10 h-10 border-4 border-blue-100 border-t-blue-500 rounded-full animate-spin"},null,-1),n("span",{class:"text-sm font-bold bg-white/80 px-4 py-1.5 rounded-full shadow-sm"},"正在通过代理获取并优化壁纸一致性...",-1)])])):$("",!0),h.value?(y(),C("div",Ut,[...l[33]||(l[33]=[n("div",{class:"w-8 h-8 border-4 border-blue-200 border-t-blue-500 rounded-full animate-spin mb-2"},null,-1),n("span",{class:"text-xs"},"加载中...",-1)])])):i.value==="pc"&&r.value.length===0||i.value==="mobile"&&a.value.length===0?(y(),C("div",Bt,[...l[34]||(l[34]=[n("span",{class:"text-4xl mb-2"},"🖼️",-1),n("span",{class:"text-sm"},"暂无壁纸，请先上传",-1)])])):i.value!=="api"?(y(),pe(O(Ae),{key:3,modelValue:le.value,"onUpdate:modelValue":l[11]||(l[11]=c=>le.value=c),class:N(["grid gap-2 md:gap-4",i.value==="pc"?"grid-cols-1 md:grid-cols-2 lg:grid-cols-3":"grid-cols-2 md:grid-cols-3 lg:grid-cols-4"]),animation:150,forceFallback:!0},{default:Te(()=>[(y(!0),C(he,null,Ce(le.value,(c,M)=>(y(),C("div",{key:c,class:N(["group relative rounded-xl overflow-hidden cursor-grab border-2 border-transparent hover:border-blue-500 transition-all shadow-sm hover:shadow-md bg-white",i.value==="pc"?"aspect-video":"aspect-[9/16]"])},[n("img",{src:v(c,i.value==="pc"?"pc":"mobile"),class:"w-full h-full object-cover transition-all duration-300 group-hover:scale-110",loading:"lazy"},null,8,Et),M===0?(y(),C("div",Rt,[...l[35]||(l[35]=[n("span",null,"默认壁纸",-1)])])):$("",!0),l[37]||(l[37]=n("div",{class:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"},null,-1)),n("div",{class:"absolute inset-0 flex items-center justify-center bg-black/50 text-white text-lg font-bold opacity-0 group-hover:opacity-100 transition-opacity z-10",onClick:L=>Q(c,i.value==="pc"?"pc":"mobile")}," 设为默认壁纸 ",8,At),n("button",{onClick:ue(L=>Le(c,i.value==="pc"?"pc":"mobile"),["stop"]),class:"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600 shadow-sm z-20",title:"删除"},[...l[36]||(l[36]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Tt)],2))),128))]),_:1},8,["modelValue","class"])):$("",!0),i.value==="api"?(y(),C("div",Pt,[l[52]||(l[52]=n("div",{class:"bg-blue-50 text-blue-800 p-4 rounded-xl text-sm leading-relaxed"},[n("ul",{class:"list-disc list-inside space-y-1"},[n("li",null,"在此处可以直接输入图片的 URL 地址，或使用第三方随机壁纸 API。"),n("li",null,[q(" 支持 "),n("b",null,"JSON 格式 API"),q("（如 Unsplash/Bing），系统会自动解析并提取图片链接。 ")]),n("li",null,[q("支持 "),n("b",null,"局域网/自建 API"),q("（如 http://192.168.x.x），不再受内网访问限制。")])]),n("div",{class:"mt-2 text-xs opacity-80"}," 设置后，每次刷新页面可能会根据 API 返回不同的图片（取决于 API 行为）。 ")],-1)),n("div",Nt,[l[51]||(l[51]=n("h4",{class:"text-sm font-bold text-gray-800 mb-4 flex items-center gap-2"},[n("span",null,"🔗"),q(" 自定义壁纸接口 ")],-1)),n("div",zt,[X.value?(y(),C("div",jt,[n("div",Dt,[l[43]||(l[43]=n("div",{class:"text-[10px] text-gray-500 text-center font-bold"},"PC 端预览",-1)),n("div",_t,[n("img",{src:X.value,class:"w-full h-full object-cover transition-all duration-700",style:_({filter:`blur(${O(t).appConfig.backgroundBlur}px)`})},null,12,Vt),n("div",{class:"absolute inset-0 pointer-events-none transition-all duration-300",style:_({backgroundColor:`rgba(0,0,0,${O(t).appConfig.backgroundMask})`})},null,4)]),n("div",Ft,[n("div",qt,[l[38]||(l[38]=n("span",{class:"text-[10px] text-gray-500"},"模糊",-1)),z(n("input",{type:"range","onUpdate:modelValue":l[12]||(l[12]=c=>O(t).appConfig.backgroundBlur=c),min:"0",max:"20",step:"1",class:"w-20 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500"},null,512),[[D,O(t).appConfig.backgroundBlur,void 0,{number:!0}]])]),l[41]||(l[41]=n("div",{class:"w-px h-3 bg-gray-300"},null,-1)),n("div",Qt,[l[39]||(l[39]=n("span",{class:"text-[10px] text-gray-500"},"遮罩",-1)),z(n("input",{type:"range","onUpdate:modelValue":l[13]||(l[13]=c=>O(t).appConfig.backgroundMask=c),min:"0",max:"1",step:"0.1",class:"w-20 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500"},null,512),[[D,O(t).appConfig.backgroundMask,void 0,{number:!0}]])]),l[42]||(l[42]=n("div",{class:"w-px h-3 bg-gray-300"},null,-1)),n("button",{onClick:l[14]||(l[14]=c=>ae("pc",!1)),class:"p-1.5 text-blue-600 hover:bg-blue-50 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:!X.value||P.value,title:"下载到 PC 壁纸库"},[...l[40]||(l[40]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])],8,Jt)])]),n("div",Zt,[l[49]||(l[49]=n("div",{class:"text-[10px] text-gray-500 text-center font-bold"},"手机端预览",-1)),n("div",Gt,[n("div",Kt,[n("img",{src:X.value,class:"w-full h-full object-cover transition-all duration-700",style:_({filter:`blur(${O(t).appConfig.mobileBackgroundBlur}px)`})},null,12,es),n("div",{class:"absolute inset-0 pointer-events-none transition-all duration-300",style:_({backgroundColor:`rgba(0,0,0,${O(t).appConfig.mobileBackgroundMask})`})},null,4)])]),n("div",ts,[n("div",ss,[l[44]||(l[44]=n("span",{class:"text-[10px] text-gray-500"},"模糊",-1)),z(n("input",{type:"range","onUpdate:modelValue":l[15]||(l[15]=c=>O(t).appConfig.mobileBackgroundBlur=c),min:"0",max:"20",step:"1",class:"w-20 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500"},null,512),[[D,O(t).appConfig.mobileBackgroundBlur,void 0,{number:!0}]])]),l[47]||(l[47]=n("div",{class:"w-px h-3 bg-gray-300"},null,-1)),n("div",os,[l[45]||(l[45]=n("span",{class:"text-[10px] text-gray-500"},"遮罩",-1)),z(n("input",{type:"range","onUpdate:modelValue":l[16]||(l[16]=c=>O(t).appConfig.mobileBackgroundMask=c),min:"0",max:"1",step:"0.1",class:"w-20 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500"},null,512),[[D,O(t).appConfig.mobileBackgroundMask,void 0,{number:!0}]])]),l[48]||(l[48]=n("div",{class:"w-px h-3 bg-gray-300"},null,-1)),n("button",{onClick:l[17]||(l[17]=c=>ae("mobile",!1)),class:"p-1.5 text-blue-600 hover:bg-blue-50 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:!X.value||P.value,title:"下载到 手机壁纸库"},[P.value?(y(),C("span",rs)):(y(),C("svg",as,[...l[46]||(l[46]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)])]))],8,is)])])])):$("",!0),n("div",null,[l[50]||(l[50]=n("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"图片 URL / API 地址",-1)),n("div",ls,[z(n("input",{"onUpdate:modelValue":l[18]||(l[18]=c=>X.value=c),class:"flex-1 px-4 py-3 border border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none transition-all",placeholder:"https://example.com/image.jpg 或 随机图片API"},null,512),[[D,X.value]]),n("button",{onClick:Ee,class:"px-3 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg border border-gray-200 transition-colors disabled:opacity-50",title:"刷新预览 (追加时间戳)",disabled:V.value},[V.value?(y(),C("span",cs,"🔄")):(y(),C("span",hs,"🔄"))],8,ns)])]),n("div",ps,[(y(),C(he,null,Ce(be,c=>n("button",{key:c.name,onClick:M=>Be(c.url),class:"px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 text-xs rounded-lg transition-colors"},A(c.name),9,us)),64))]),n("div",ds,[n("button",{onClick:l[19]||(l[19]=c=>ae("pc")),class:N(["flex-1 px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-sm transition-all active:scale-95 flex items-center justify-center gap-2",!X.value||P.value?"opacity-50 cursor-not-allowed":""]),disabled:!X.value||P.value},[P.value?(y(),C("span",fs)):$("",!0),q(" "+A(P.value?"保存中...":"应用到 PC 壁纸"),1)],10,gs),n("button",{onClick:l[20]||(l[20]=c=>ae("mobile")),class:N(["flex-1 px-4 py-2.5 bg-white border border-gray-200 hover:bg-gray-50 text-gray-700 text-sm font-bold rounded-lg shadow-sm transition-all active:scale-95 flex items-center justify-center gap-2",!X.value||P.value?"opacity-50 cursor-not-allowed":""]),disabled:!X.value||P.value},[P.value?(y(),C("span",vs)):$("",!0),q(" "+A(P.value?"保存中...":"应用到 手机壁纸"),1)],10,ms)])])])])):$("",!0)])])])):$("",!0)])),(y(),pe(ke,{to:"body"},[f.value?(y(),C("div",{key:0,class:"fixed inset-0 z-[200] flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:ue(I,["self"])},[n("div",bs,[n("div",xs,[l[54]||(l[54]=n("div",{class:"p-2 bg-yellow-100 rounded-full text-yellow-600 shrink-0"},[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),n("div",null,[l[53]||(l[53]=n("h3",{class:"text-lg font-bold text-gray-900 mb-2"},"提示",-1)),n("p",ws,A(b.value),1)])]),n("div",{class:"flex justify-end gap-3"},[n("button",{onClick:I,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors"}," 取消 "),n("button",{onClick:j,class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors shadow-sm"}," 确定 ")])])])):$("",!0)]))],64))}}),Cs={class:"w-full"},ks={key:0,class:"absolute inset-0 z-0 overflow-hidden"},Os=["src"],Ms={class:"text-xs text-gray-500 group-hover:text-blue-600"},Ws={key:0,class:"fixed inset-0 z-[999] bg-black/60 flex items-center justify-center p-4 backdrop-blur-sm"},Is={class:"bg-white w-full max-w-lg rounded-2xl overflow-hidden shadow-2xl flex flex-col h-[500px]"},Ss={class:"px-4 py-3 border-b border-gray-100 flex justify-between items-center"},Hs={class:"flex-1 bg-gray-900 relative"},Xs={class:"px-4 py-2 bg-gray-800 flex items-center gap-3 border-t border-gray-700"},Ls=["value"],Ys={class:"text-gray-400 text-xs font-mono w-10 text-right"},$s={class:"p-4 bg-gray-50 flex justify-end gap-3"},Bs=ge({__name:"IconUploader",props:{modelValue:{},crop:{type:Boolean,default:!0},previewStyle:{default:()=>({})},overlayStyle:{default:()=>({})},uploadOnly:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:s}){const o=e,t=s,i=We(),r=H(!1),a=H(!1),h=H(""),u=H(),d=H(null),f=H(1),b=()=>{o.uploadOnly||o.crop?d.value?.click():a.value=!0},m=w=>{const g=typeof w=="string"?w:w.url;t("update:modelValue",g)},I=w=>{const g=w.target.files?.[0];if(!g)return;if(g.size>5*1024*1024){alert("图片太大啦，请上传小于 5MB 的图片");return}const v=new FileReader;v.onload=Q=>{h.value=Q.target?.result,o.crop?(f.value=1,r.value=!0):t("update:modelValue",h.value)},v.readAsDataURL(g),d.value&&(d.value.value="")},j=w=>{const g=parseFloat(w.target.value),v=g-f.value;u.value.changeScale(v),f.value=g},S=()=>{u.value.getCropData(w=>{const g=new Image;g.onload=()=>{const v=document.createElement("canvas");v.width=216,v.height=216;const Q=v.getContext("2d");Q?(Q.imageSmoothingEnabled=!0,Q.imageSmoothingQuality="high",Q.drawImage(g,0,0,216,216),t("update:modelValue",v.toDataURL("image/png"))):t("update:modelValue",w),r.value=!1},g.src=w})};return(w,g)=>(y(),C("div",Cs,[n("input",{ref_key:"fileInput",ref:d,type:"file",accept:"image/*",class:"hidden",onChange:I},null,544),n("div",{class:"w-full h-32 border-2 border-dashed border-gray-300 rounded-xl flex flex-col items-center justify-center cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-all group relative overflow-hidden",onClick:b},[e.modelValue?(y(),C("div",ks,[n("img",{src:O(i).getAssetUrl(e.modelValue),class:"w-full h-full object-cover transition-all duration-300",style:_(e.previewStyle)},null,12,Os),n("div",{class:"absolute inset-0 transition-all duration-300",style:_(e.overlayStyle)},null,4)])):$("",!0),n("div",{class:N(["z-10 flex flex-col items-center justify-center",e.modelValue?"opacity-0 group-hover:opacity-100 bg-white/80 absolute inset-0 transition-opacity":""])},[g[3]||(g[3]=n("span",{class:"text-2xl text-gray-400 mb-1 group-hover:text-blue-500"},"+",-1)),n("span",Ms,A(e.uploadOnly?"点击上传":e.crop?"点击上传 / 裁剪":"从壁纸库选择"),1)],2)]),Oe(ys,{show:a.value,"onUpdate:show":g[0]||(g[0]=v=>a.value=v),onSelect:m},null,8,["show"]),r.value?(y(),C("div",Ws,[n("div",Is,[n("div",Ss,[g[4]||(g[4]=n("h3",{class:"font-bold text-gray-700"},"裁剪图片",-1)),n("button",{onClick:g[1]||(g[1]=v=>r.value=!1),class:"text-gray-400 hover:text-gray-600 text-xl"}," × ")]),n("div",Hs,[Oe(O(Ke),{ref_key:"cropper",ref:u,img:h.value,autoCrop:!0,autoCropWidth:216,autoCropHeight:216,fixed:!0,fixedNumber:[1,1],centerBox:!0,outputType:"png"},null,8,["img"])]),n("div",Xs,[g[5]||(g[5]=n("span",{class:"text-gray-400 text-xs"},"🔍",-1)),n("input",{type:"range",min:"0.1",max:"3",step:"0.1",value:f.value,onInput:j,class:"flex-1 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-blue-400"},null,40,Ls),n("span",Ys,A(Math.round(f.value*100))+"%",1)]),n("div",$s,[n("button",{onClick:g[2]||(g[2]=v=>r.value=!1),class:"px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-200 transition-colors"}," 取消 "),n("button",{onClick:S,class:"px-6 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 shadow-lg shadow-blue-200 transition-all"}," 确认使用 ")])])])):$("",!0)]))}});export{Bs as _,ys as a};
