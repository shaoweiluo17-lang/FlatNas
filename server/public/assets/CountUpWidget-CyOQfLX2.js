import{d as X,u as Z,r as V,y as _,o as tt,c as et,a as c,e as u,E as at,g as a,b as H,f as T,l as j,m as U,D as lt,F as I,h as st,p as D,t as F,T as ot,j as it}from"./index-DFZ1jKdv.js";const nt={class:"bg-white text-gray-800 rounded-xl shadow-2xl w-full max-w-sm overflow-hidden flex flex-col animate-fade-in-up"},dt={class:"p-5 flex flex-col gap-4"},rt={class:"grid grid-cols-3 gap-2"},ut=["onClick"],mt={class:"w-full h-full flex flex-col items-center justify-center p-2 relative z-10"},ct={class:"text-xs font-medium opacity-80 mb-1 uppercase tracking-wider truncate max-w-full"},gt={class:"flex flex-col items-center"},ft={key:0},yt={key:0,class:"flex items-center gap-2 mt-2"},vt=["title"],wt={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},pt={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},kt=X({__name:"CountUpWidget",props:{widget:{}},setup(i){const g=i,w=Z();(()=>{const t=w.widgets.find(e=>e.id===g.widget.id);t&&!t.data?t.data={startTime:new Date().toISOString().slice(0,16),title:"正计时",style:"card",isRunning:!1,totalPauseDuration:0,pauseStartTime:null}:t&&t.data&&(t.data.isRunning===void 0&&(t.data.isRunning=!1),t.data.totalPauseDuration===void 0&&(t.data.totalPauseDuration=0),t.data.pauseStartTime===void 0&&(t.data.pauseStartTime=null),t.data.displayFormat===void 0&&(t.data.displayFormat="d-hms"),(t.data.displayFormat==="full-colon"||t.data.displayFormat==="full-slash"||t.data.displayFormat==="full-hyphen")&&(t.data.displayFormat="d-hms"))})();const C=V(!1),d=V({startTime:"",title:"",style:"card",displayFormat:"d-hms"}),A=()=>{const t=g.widget.data||{startTime:new Date().toISOString().slice(0,16),title:"正计时",style:"card",displayFormat:"d-hms"};d.value={...t},C.value=!0},P=()=>{const t=w.widgets.find(e=>e.id===g.widget.id);if(t){const e=t.data?.startTime!==d.value.startTime;t.data={...t.data,...d.value},e&&(t.data.totalPauseDuration=0,t.data.pauseStartTime=null,t.data.isRunning=!1),w.saveData(),S()}C.value=!1},k=V({full:"0天 00时00分00秒",datePart:"0天",timePart:"00时00分00秒",days:0,hours:0,minutes:0,seconds:0});let z=null;const m=t=>t.toString().padStart(2,"0"),Y=(t,e)=>new Date(t,e+1,0).getDate(),E=(t,e)=>{let l=0,f=e.getSeconds()-t.getSeconds();f<0?(f+=60,l=1):l=0;let $=e.getMinutes()-t.getMinutes()-l;$<0?($+=60,l=1):l=0;let y=e.getHours()-t.getHours()-l;y<0?(y+=24,l=1):l=0;const M=e.getDate();let v=e.getMonth(),h=e.getFullYear(),b=M-t.getDate()-l;b<0?(v-=1,v<0&&(v=11,h-=1),b+=Y(h,v),l=1):l=0;let x=v-t.getMonth()-l;return x<0?(x+=12,l=1):l=0,{years:h-t.getFullYear()-l,months:x,days:b,hours:y,minutes:$,seconds:f}},S=()=>{const t=g.widget.data;if(!t||!t.startTime)return;let l=Date.now();!t.isRunning&&t.pauseStartTime&&(l=t.pauseStartTime);const f=new Date(t.startTime).getTime(),$=f+(t.totalPauseDuration||0);let y=l-$;y<0&&(y=0);const M=Math.floor(y/1e3),v=M%60,h=Math.floor(M/60),b=h%60,x=Math.floor(h/60),B=x%24,L=Math.floor(x/24),G=new Date(f+y),s=E(new Date(f),G),N=L.toString(),J=m(B),K=m(b),Q=m(v);let p="",n="",r="";const o=t.displayFormat==="d-hms"||t.displayFormat==="d-only"||t.displayFormat==="ym-only"||t.displayFormat==="ymd-only"||t.displayFormat==="mdhms"||t.displayFormat==="ymdhms"?t.displayFormat:"d-hms";o==="d-only"?(n=`${N}天`,r="",p=n):o==="ym-only"?(n=`${s.years}年${s.months}月`,r="",p=n):o==="ymd-only"?(n=`${s.years}年${s.months}月${s.days}日`,r="",p=n):o==="mdhms"?(n=`${s.years*12+s.months}月${s.days}日`,r=`${m(s.hours)}时${m(s.minutes)}分${m(s.seconds)}秒`,p=`${n} ${r}`):o==="ymdhms"?(n=`${s.years}年${s.months}月${s.days}日`,r=`${m(s.hours)}时${m(s.minutes)}分${m(s.seconds)}秒`,p=`${n} ${r}`):(n=`${N}天`,r=`${J}时${K}分${Q}秒`,p=`${n} ${r}`),k.value={full:p,datePart:n,timePart:r,days:o==="d-hms"||o==="d-only"?L:s.days,hours:o==="d-hms"?B:o==="mdhms"||o==="ymdhms"?s.hours:0,minutes:o==="d-hms"?b:o==="mdhms"||o==="ymdhms"?s.minutes:0,seconds:o==="d-hms"?v:o==="mdhms"||o==="ymdhms"?s.seconds:0}},O=()=>{const t=w.widgets.find(e=>e.id===g.widget.id);if(!(!t||!t.data)){if(t.data.isRunning)t.data.isRunning=!1,t.data.pauseStartTime=Date.now();else{const e=Date.now();t.data.pauseStartTime&&(t.data.totalPauseDuration=(t.data.totalPauseDuration||0)+(e-t.data.pauseStartTime),t.data.pauseStartTime=null),t.data.isRunning=!0}w.saveData(),S()}},W=()=>{const t=w.widgets.find(e=>e.id===g.widget.id);!t||!t.data||(t.data.isRunning=!1,t.data.totalPauseDuration=0,t.data.pauseStartTime=null,w.saveData(),S())};_(()=>{S(),z=setInterval(S,1e3)}),tt(()=>{z&&clearInterval(z)});const q=[{label:"卡片风格",value:"card"},{label:"极简文字",value:"simple"},{label:"霓虹光效",value:"neon"}],R=et(()=>(g.widget.colSpan??1)<=1&&(g.widget.rowSpan??1)<=1);return(t,e)=>(u(),c("div",{class:D(["w-full h-full relative group overflow-hidden rounded-2xl transition-all select-none",[i.widget.data?.style==="neon"?"bg-gray-900 text-white border border-green-500/30":i.widget.data?.style==="simple"?"bg-white/90 text-gray-800 border border-white/40":"bg-gradient-to-br from-emerald-500 to-teal-600 text-white shadow-lg border border-white/10"]])},[(u(),at(ot,{to:"body"},[C.value?(u(),c("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",onMousedown:T(P,["self"])},[a("div",nt,[a("div",{class:"p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50"},[e[4]||(e[4]=a("div",{class:"font-bold text-lg"},"正计时设置",-1)),a("button",{onClick:P,class:"text-gray-400 hover:text-gray-600"},[...e[3]||(e[3]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])]),a("div",dt,[a("div",null,[e[5]||(e[5]=a("label",{class:"text-xs font-bold text-gray-500 uppercase tracking-wider block mb-1.5"},"标题",-1)),j(a("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>d.value.title=l),class:"w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20 outline-none transition-all",placeholder:"例如：工作时长"},null,512),[[U,d.value.title]])]),a("div",null,[e[6]||(e[6]=a("label",{class:"text-xs font-bold text-gray-500 uppercase tracking-wider block mb-1.5"},"开始时间",-1)),j(a("input",{type:"datetime-local",step:"1","onUpdate:modelValue":e[1]||(e[1]=l=>d.value.startTime=l),class:"w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20 outline-none transition-all"},null,512),[[U,d.value.startTime]])]),a("div",null,[e[8]||(e[8]=a("label",{class:"text-xs font-bold text-gray-500 uppercase tracking-wider block mb-1.5"},"显示格式",-1)),j(a("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>d.value.displayFormat=l),class:"w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20 outline-none transition-all bg-white"},[...e[7]||(e[7]=[a("option",{value:"d-hms"},"按天时分秒",-1),a("option",{value:"d-only"},"只显示天数",-1),a("option",{value:"mdhms"},"按月日时分秒",-1),a("option",{value:"ym-only"},"只显示年月",-1),a("option",{value:"ymdhms"},"按年月日时分秒",-1),a("option",{value:"ymd-only"},"只显示年月日",-1)])],512),[[lt,d.value.displayFormat]])]),a("div",null,[e[9]||(e[9]=a("label",{class:"text-xs font-bold text-gray-500 uppercase tracking-wider block mb-1.5"},"风格",-1)),a("div",rt,[(u(),c(I,null,st(q,l=>a("button",{key:l.value,onClick:f=>d.value.style=l.value,class:D(["px-2 py-2 text-xs font-medium rounded-lg border transition-all text-center",d.value.style===l.value?"border-emerald-500 bg-emerald-50 text-emerald-600":"border-gray-200 hover:border-gray-300 text-gray-600"])},F(l.label),11,ut)),64))])])]),a("div",{class:"p-4 bg-gray-50 border-t border-gray-100"},[a("button",{onClick:P,class:"w-full py-2.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-sm font-bold transition-colors shadow-sm"}," 保存设置 ")])])],32)):H("",!0)])),a("div",mt,[a("button",{onClick:T(A,["stop"]),class:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity p-1.5 rounded-full hover:bg-black/10 active:scale-95 z-20",title:"设置"},[...e[10]||(e[10]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-4 h-4"},[a("path",{"fill-rule":"evenodd",d:"M11.078 2.25c-.917 0-1.699.663-1.85 1.567l-.091.549a.798.798 0 01-.517.608 7.45 7.45 0 00-.478.198.798.798 0 01-.796-.064l-.453-.324a1.875 1.875 0 00-2.416.2l-.043.044a1.875 1.875 0 00-.204 2.416l.325.454a.798.798 0 01.064.796 7.448 7.448 0 00-.198.478.798.798 0 01-.608.517l-.55.092a1.875 1.875 0 00-1.566 1.849v.044c0 .917.663 1.699 1.567 1.85l.549.091c.281.047.508.25.608.517.06.162.127.321.198.478a.798.798 0 01-.064.796l-.324.453a1.875 1.875 0 00.2 2.416l.044.043a1.875 1.875 0 002.416.204l.454-.325a.798.798 0 01.796-.064c.157.071.316.137.478.198.267.1.47.327.517.608l.092.55c.15.903.932 1.566 1.849 1.566h.044c.917 0 1.699-.663 1.85-1.567l.091-.549a.798.798 0 01.517-.608 7.52 7.52 0 00.478-.198.798.798 0 01.796.064l.453.324a1.875 1.875 0 002.416-.2l.043-.044a1.875 1.875 0 00.204-2.416l-.325-.454a.798.798 0 01-.064-.796c.071-.157.137-.316.198-.478.1-.267.327-.47.608-.517l.55-.092a1.875 1.875 0 001.566-1.849v-.044c0-.917-.663-1.699-1.567-1.85l-.549-.091a.798.798 0 01-.608-.517 7.507 7.507 0 00-.198-.478.798.798 0 01.064-.796l.324-.453a1.875 1.875 0 00-.2-2.416l-.044-.043a1.875 1.875 0 00-2.416-.204l-.454.325a.798.798 0 01-.796.064 7.462 7.462 0 00-.478-.198.798.798 0 01-.517-.608l-.092-.55a1.875 1.875 0 00-1.849-1.566h-.044zM12 15.75a3.75 3.75 0 100-7.5 3.75 3.75 0 000 7.5z","clip-rule":"evenodd"})],-1)])]),a("div",ct,F(i.widget.data?.title||"正计时"),1),a("div",gt,[a("div",{class:D(["font-bold font-mono tracking-tight flex flex-col items-center justify-center",[R.value?"text-lg":"text-2xl",i.widget.data?.style==="neon"?"text-transparent bg-clip-text bg-gradient-to-r from-green-300 to-emerald-300 drop-shadow-[0_0_5px_rgba(52,211,153,0.5)]":i.widget.data?.style==="simple"?"text-emerald-600":"text-white"]])},[i.widget.data?.displayFormat==="d-hms"||i.widget.data?.displayFormat==="d-only"||i.widget.data?.displayFormat==="mdhms"||i.widget.data?.displayFormat==="ym-only"||i.widget.data?.displayFormat==="ymdhms"||i.widget.data?.displayFormat==="ymd-only"?(u(),c(I,{key:0},[a("div",{class:D(R.value?"text-2xl":"text-4xl opacity-90")},F(k.value.datePart),3),k.value.timePart?(u(),c("div",ft,F(k.value.timePart),1)):H("",!0)],64)):(u(),c(I,{key:1},[it(F(k.value.full),1)],64))],2)]),R.value?H("",!0):(u(),c("div",yt,[a("button",{onClick:T(O,["stop"]),class:"p-1.5 rounded-full hover:bg-black/20 transition-colors active:scale-95",title:i.widget.data?.isRunning?"暂停":"开始"},[i.widget.data?.isRunning?(u(),c("svg",pt,[...e[12]||(e[12]=[a("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)])])):(u(),c("svg",wt,[...e[11]||(e[11]=[a("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z","clip-rule":"evenodd"},null,-1)])]))],8,vt),a("button",{onClick:T(W,["stop"]),class:"p-1.5 rounded-full hover:bg-black/20 transition-colors active:scale-95",title:"重置"},[...e[13]||(e[13]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"})],-1)])])]))])],2))}});export{kt as default};
