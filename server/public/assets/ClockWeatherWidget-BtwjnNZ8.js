import{d as Z,u as tt,w as O,r as p,c as L,y as et,o as at,a as s,e as i,g as e,b as r,G as q,F as S,h as j,q as F,p as I,i as ot,f as J,t as d,E as it,l as st,m as lt,n as nt,T as rt,j as dt,L as ct,_ as ut}from"./index-BKCwBmTe.js";const ht={class:"h-full w-full relative overflow-hidden text-white group select-none transition-all duration-500 rounded-2xl"},pt={key:0,class:"absolute -top-10 -right-10 w-48 h-48 opacity-30 animate-spin-slow"},vt={key:1,class:"absolute inset-0"},wt={key:2,class:"absolute inset-0 overflow-hidden"},mt={key:3,class:"absolute inset-0 flex justify-around items-start overflow-hidden opacity-50"},ft={key:4,class:"absolute inset-0 overflow-hidden"},gt={key:5,class:"absolute inset-0 overflow-hidden"},yt={key:0,class:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity z-20"},bt={class:"relative z-10 h-full flex flex-col justify-between p-2 sm:p-3"},xt={class:"flex items-start justify-between"},_t={class:"text-[10px] sm:text-xs font-bold tracking-widest uppercase bg-white/10 px-1.5 py-0.5 rounded backdrop-blur-md border border-white/10 shadow-sm"},kt={class:"relative z-20"},Ct={class:"text-xs font-medium truncate max-w-[60px]"},It={class:"bg-gray-900/90 p-6 rounded-2xl border border-white/10 shadow-2xl max-w-sm w-full backdrop-blur-xl"},Dt={class:"mb-6 w-full"},Mt={class:"flex items-center gap-2 mb-2 text-sm"},St={key:0,class:"text-white/30"},jt={key:1,class:"text-white font-bold"},$t={key:0,class:"grid grid-cols-4 gap-2 mb-4"},Tt=["onClick"],zt={key:1,class:"grid grid-cols-4 gap-2 max-h-[200px] overflow-y-auto pr-1 custom-scrollbar"},Lt=["onClick"],Nt={key:2,class:"h-[200px] flex items-center justify-center text-white/40 text-xs"},Bt={class:"flex gap-3 justify-end"},Et={class:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none pt-8"},Wt={class:"flex items-center gap-2 mt-2"},Ut={class:"text-sm sm:text-base font-medium opacity-90 drop-shadow-md"},Vt={key:0,class:"w-1.5 h-1.5 rounded-full bg-green-400 shadow-[0_0_8px_rgba(74,222,128,0.6)]"},Kt={class:"flex items-end justify-between pb-0.5"},Rt={class:"flex flex-col justify-end"},Pt={class:"text-2xl sm:text-3xl font-bold tracking-tight drop-shadow-md leading-none"},At={key:0,class:"flex flex-col items-end gap-0.5 text-xs sm:text-sm font-medium opacity-80"},Ot={key:0},qt=Z({__name:"ClockWeatherWidget",props:{widget:{}},setup(H){const c=H,n=tt();O(()=>[n.appConfig.weatherSource,n.appConfig.amapKey],()=>{D(!0)});const m=p(null),G=async()=>{if(!m.value)try{const a=await ct(()=>import("./cityData-DPPCip0y.js"),[]);m.value=a.cityData}catch(a){console.error("Failed to load city data",a)}},y=p(!1),b=p(""),u=p("");O(y,a=>{a&&G()});const N=p(""),B=p(""),l=p({temp:"--",city:(()=>{if(c.widget?.data?.city)return c.widget.data.city;try{const a=localStorage.getItem("flatnas_auto_city");if(a)return JSON.parse(a).city}catch{}return"ÂÆö‰Ωç‰∏≠..."})(),text:"...",humidity:"",today:{min:"",max:""}}),E=p(!1);let x=null,$=null,_=null;const Q=p(Array.from({length:6},(a,t)=>({id:t+1,animationDelay:`${Math.random()}s`,opacity:Math.random()}))),X=p(Array.from({length:12},(a,t)=>({id:t+1,left:`${Math.random()*100}%`,top:"-10px",animationDelay:`${Math.random()*5}s`,animationDuration:`${3+Math.random()*4}s`})));c.widget?.data?.city&&(b.value=c.widget.data.city);const T=()=>{try{if(c.widget){const a=b.value.trim(),t={...c.widget.data||{},city:a};n.saveWidget(c.widget.id,t),D(!0)}}catch(a){console.error("Failed to save city",a)}finally{y.value=!1}},h=L(()=>{const a=l.value.text;return a.includes("Èõ®")?"rain":a.includes("Èõ™")?"snow":a.includes("Èõæ")||a.includes("Èúæ")?"fog":a.includes("‰∫ë")||a.includes("Èò¥")?"cloudy":a.includes("Êô¥")?E.value?"clear-night":"sunny":"default"}),Y=L(()=>{switch(h.value){case"sunny":return"bg-gradient-to-br from-blue-400 via-blue-300 to-orange-200";case"clear-night":return"bg-gradient-to-br from-indigo-900 via-purple-900 to-slate-900";case"cloudy":return"bg-gradient-to-br from-slate-400 via-slate-300 to-gray-200";case"rain":return"bg-gradient-to-br from-slate-700 via-blue-900 to-slate-800";case"snow":return"bg-gradient-to-br from-blue-100 via-white to-blue-50";case"fog":return"bg-gradient-to-br from-gray-500 via-slate-400 to-zinc-400";default:return"bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-500"}}),W=L(()=>["snow","cloudy","fog"].includes(h.value)),z=()=>{const a=new Date;N.value=a.toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit"}),B.value=a.toLocaleDateString("zh-CN",{month:"short",day:"numeric",weekday:"short"});const t=a.getHours();E.value=t<6||t>=18},U=(a,t)=>Date.now()-a<t,D=async(a=!1)=>{try{let t="Êú¨Âú∞";if(c.widget?.data?.city)t=c.widget.data.city;else{const w=localStorage.getItem("flatnas_auto_city");let M=!1;if(w&&!a)try{const f=JSON.parse(w);U(f.timestamp,3600*1e3)&&(t=f.city,M=!0)}catch{localStorage.removeItem("flatnas_auto_city")}if(!M)if(n.appConfig.weatherSource==="amap"&&n.appConfig.amapKey||n.appConfig.weatherSource==="qweather")t="auto";else{const f=await fetch("/api/ip");if(!f.ok)throw new Error("IP API Error");const C=await f.json();if(C.success&&C.location){let g=C.location.split(" ")[0];g=g.replace(/^(?:.*?ÁúÅ|.*?Ëá™Ê≤ªÂå∫|.*?ÁâπÂà´Ë°åÊîøÂå∫)/,"");const A=g.match(/^(.*?[Â∏ÇÂ∑ûÁõüÂú∞Âå∫])/);A&&(g=A[1]),t=g,localStorage.setItem("flatnas_auto_city",JSON.stringify({city:t,timestamp:Date.now()}))}}}const o=localStorage.getItem(`flatnas_weather_${t}`);if(o&&!a)try{const w=JSON.parse(o);if(U(w.timestamp,3600*1e3)){l.value=w.weather;return}}catch{localStorage.removeItem(`flatnas_weather_${t}`)}let v=`/api/weather?city=${encodeURIComponent(t)}`;if(n.appConfig.weatherApiUrl)v=n.appConfig.weatherApiUrl,v.includes("{city}")&&(v=v.replace("{city}",encodeURIComponent(t)));else{const w=n.appConfig.weatherSource||"uapi",M=n.appConfig.amapKey||"",f=n.appConfig.qweatherProjectId||"",C=n.appConfig.qweatherKeyId||"",g=n.appConfig.qweatherPrivateKey||"";v+=`&source=${w}&key=${encodeURIComponent(M)}`,w==="qweather"&&(v+=`&projectId=${encodeURIComponent(f)}&keyId=${encodeURIComponent(C)}&privateKey=${encodeURIComponent(g)}`)}const P=await fetch(v);if(!P.ok)throw new Error("Weather API Error");const k=await P.json();if(k.success&&k.data)l.value={temp:k.data.temp,city:t,text:k.data.text,humidity:k.data.humidity,today:k.data.today},localStorage.setItem(`flatnas_weather_${t}`,JSON.stringify({weather:l.value,timestamp:Date.now()}));else throw new Error("Weather data invalid")}catch(t){console.warn("[Weather] Ëé∑ÂèñÂ§±Ë¥•ÔºåËΩ¨‰∏∫Á¶ªÁ∫øÊ®°Âºè",t),l.value={temp:"22",city:"Êú¨Âú∞",text:"ËàíÈÄÇ",humidity:"50%",today:{min:"18",max:"25"}}}},V=()=>{z(),_&&clearTimeout(_),x&&clearInterval(x);const a=(60-new Date().getSeconds())*1e3;_=setTimeout(()=>{z(),x=setInterval(z,6e4)},a)},K=()=>{_&&clearTimeout(_),_=null,x&&clearInterval(x),x=null},R=()=>{document.visibilityState==="hidden"?K():V()};return et(()=>{D(),V(),$=setInterval(()=>D(),36e5),document.addEventListener("visibilitychange",R)}),at(()=>{$&&clearInterval($),K(),document.removeEventListener("visibilitychange",R)}),(a,t)=>(i(),s("div",ht,[e("div",{class:I(["absolute inset-0 transition-colors duration-1000 ease-in-out",Y.value])},[h.value==="sunny"?(i(),s("div",pt,[...t[6]||(t[6]=[e("svg",{viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("circle",{cx:"50",cy:"50",r:"20",fill:"yellow"}),e("path",{d:"M50 10V20 M50 80V90 M10 50H20 M80 50H90 M22 22L29 29 M71 71L78 78 M22 78L29 71 M71 29L78 22",stroke:"yellow","stroke-width":"4","stroke-linecap":"round"})],-1)])])):r("",!0),h.value==="clear-night"?(i(),s("div",vt,[...t[7]||(t[7]=[q('<div class="absolute top-10 right-10 w-16 h-16 text-yellow-100 opacity-80 animate-pulse" data-v-c3cd595e><svg viewBox="0 0 24 24" fill="currentColor" data-v-c3cd595e><path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z" data-v-c3cd595e></path></svg></div><div class="star absolute top-1/4 left-1/4 w-1 h-1 bg-white rounded-full animate-twinkle" data-v-c3cd595e></div><div class="star absolute top-3/4 right-1/3 w-1 h-1 bg-white rounded-full animate-twinkle delay-75" data-v-c3cd595e></div><div class="star absolute bottom-1/4 left-1/3 w-1 h-1 bg-white rounded-full animate-twinkle delay-150" data-v-c3cd595e></div>',4)])])):r("",!0),h.value==="cloudy"?(i(),s("div",wt,[...t[8]||(t[8]=[q('<div class="absolute top-4 right-[-20%] w-32 h-20 opacity-40 animate-float-slow" data-v-c3cd595e><svg viewBox="0 0 24 24" fill="currentColor" class="text-white" data-v-c3cd595e><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z" data-v-c3cd595e></path></svg></div><div class="absolute bottom-8 left-[-10%] w-24 h-16 opacity-30 animate-float-slower" data-v-c3cd595e><svg viewBox="0 0 24 24" fill="currentColor" class="text-white" data-v-c3cd595e><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z" data-v-c3cd595e></path></svg></div>',2)])])):r("",!0),h.value==="rain"?(i(),s("div",mt,[(i(!0),s(S,null,j(Q.value,o=>(i(),s("div",{key:o.id,class:"w-0.5 h-16 bg-gradient-to-b from-transparent to-white animate-rain",style:F({animationDelay:o.animationDelay,opacity:o.opacity})},null,4))),128))])):r("",!0),h.value==="snow"?(i(),s("div",ft,[(i(!0),s(S,null,j(X.value,o=>(i(),s("div",{key:o.id,class:"absolute w-1.5 h-1.5 bg-white rounded-full animate-snow opacity-80",style:F({left:o.left,top:o.top,animationDelay:o.animationDelay,animationDuration:o.animationDuration})},null,4))),128))])):r("",!0),h.value==="fog"?(i(),s("div",gt,[...t[9]||(t[9]=[e("div",{class:"absolute bottom-0 left-[-50%] w-[200%] h-[60%] bg-white/20 blur-[40px] animate-fog-flow"},null,-1),e("div",{class:"absolute bottom-[-20%] left-[-20%] w-[150%] h-[50%] bg-white/10 blur-[30px] animate-fog-flow-reverse"},null,-1)])])):r("",!0)],2),e("div",{class:I(["absolute inset-0 backdrop-blur-[0px] group-hover:backdrop-blur-[2px] transition-all duration-500",W.value?"bg-black/30":"bg-black/5"])},null,2),c.widget&&ot(n).isLogged?(i(),s("div",yt,[e("button",{onClick:t[0]||(t[0]=J(o=>y.value=!0,["stop"])),class:"p-1.5 bg-black/10 text-white/70 hover:text-white rounded-full hover:bg-black/30 backdrop-blur-md transition-colors",title:"ËÆæÁΩÆÂüéÂ∏Ç"},[...t[10]||(t[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})],-1)])])])):r("",!0),e("div",bt,[e("div",xt,[e("span",_t,d(B.value),1),e("div",kt,[e("div",{onClick:t[1]||(t[1]=o=>{y.value=!0,b.value=l.value.city}),class:"flex items-center gap-1 opacity-90 cursor-pointer hover:opacity-100 transition-opacity"},[t[11]||(t[11]=e("svg",{class:"w-3 h-3 opacity-80",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),e("span",Ct,d(l.value.city),1)]),(i(),it(rt,{to:"body"},[y.value?(i(),s("div",{key:0,class:"fixed inset-0 bg-black/60 backdrop-blur-md z-[9999] flex flex-col items-center justify-center p-4",onClick:t[5]||(t[5]=J(()=>{},["stop"]))},[e("div",It,[t[12]||(t[12]=e("div",{class:"text-lg font-medium mb-4 text-white"},"ËÆæÁΩÆÂüéÂ∏Ç",-1)),st(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>b.value=o),onKeyup:nt(T,["enter"]),placeholder:"ËæìÂÖ•ÂüéÂ∏Ç (‰∏∫Á©∫Ëá™Âä®)",class:"w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/40 text-left outline-none focus:bg-white/20 focus:border-white/40 mb-4 transition-all",autofocus:""},null,544),[[lt,b.value]]),e("div",Dt,[e("div",Mt,[e("button",{onClick:t[3]||(t[3]=o=>u.value=""),class:I(["text-white/50 hover:text-white transition-colors",{"font-bold text-white":!u.value}])}," ÁúÅ‰ªΩ/Âú∞Âå∫ ",2),u.value?(i(),s("span",St,"/")):r("",!0),u.value?(i(),s("span",jt,d(u.value),1)):r("",!0)]),u.value?m.value&&m.value[u.value]?(i(),s("div",zt,[(i(!0),s(S,null,j(m.value[u.value],o=>(i(),s("button",{key:o,onClick:v=>{b.value=o,T()},class:"px-1 py-1.5 bg-white/5 hover:bg-white/20 text-white/70 hover:text-white rounded text-xs transition-colors truncate border border-white/5 hover:border-white/20"},d(o),9,Lt))),128))])):(i(),s("div",Nt," Âä†ËΩΩ‰∏≠... ")):(i(),s("div",$t,[(i(!0),s(S,null,j(m.value?Object.keys(m.value):[],o=>(i(),s("button",{key:o,onClick:v=>u.value=o,class:I(["px-2 py-1.5 text-xs rounded transition-colors text-center truncate border",u.value===o?"bg-blue-500 border-blue-500 text-white shadow-md":"bg-white/5 border-white/10 text-white/70 hover:bg-white/10 hover:border-white/20"])},d(o),11,Tt))),128))]))]),e("div",Bt,[e("button",{onClick:t[4]||(t[4]=o=>y.value=!1),class:"px-4 py-2 bg-white/5 hover:bg-white/10 text-white/80 rounded-lg text-sm transition-colors"}," ÂèñÊ∂à "),e("button",{onClick:T,class:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-sm transition-colors font-medium shadow-lg shadow-blue-900/20"}," Á°ÆÂÆö ")])])])):r("",!0)]))])]),e("div",Et,[e("div",{class:I(["text-3xl sm:text-4xl font-bold tracking-tighter font-mono leading-none bg-gradient-to-b from-white to-white/80 bg-clip-text text-transparent",W.value?"drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]":"drop-shadow-lg"])},d(N.value),3),e("div",Wt,[e("span",Ut,d(l.value.text),1),h.value==="sunny"||h.value==="clear-night"?(i(),s("div",Vt)):r("",!0)])]),e("div",Kt,[e("div",Rt,[e("div",Pt,[dt(d(l.value.temp),1),t[13]||(t[13]=e("span",{class:"text-base align-top"},"¬∞",-1))])]),l.value.today&&l.value.today.min?(i(),s("div",At,[e("span",null,"üå°Ô∏è "+d(l.value.today.min)+"¬∞/"+d(l.value.today.max)+"¬∞",1),l.value.humidity?(i(),s("span",Ot,"üíß "+d(l.value.humidity)+"%",1)):r("",!0)])):r("",!0)])])]))}}),Ht=ut(qt,[["__scopeId","data-v-c3cd595e"]]);export{Ht as default};
