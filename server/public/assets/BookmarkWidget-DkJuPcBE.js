import{d as te,u as oe,r as c,c as le,C as ie,w as se,y as ne,a,e as r,g as l,E as re,b as g,l as $,m as T,i as U,n as ae,F as A,h as H,j as z,p as de,t as k,f as R,q as N,T as ce,x as ue,_ as he}from"./index-CEb9R0bB.js";import{p as pe}from"./bookmark-CmOe2tB3.js";const fe=(d,s="")=>{try{const p=new URL(d.startsWith("http")?d:`https://${d}`).hostname;if(p==="localhost"||p.startsWith("127.")||p.startsWith("192.168.")||p.startsWith("10.")||/^172\.(1[6-9]|2[0-9]|3[0-1])\./.test(p))return!0;if(s){const j=s.split(`
`).map(m=>m.trim()).filter(Boolean);for(const m of j)if(p.includes(m))return!0}return!1}catch{return!1}},we=d=>(d.startsWith("http://")?d=d.replace("http://","https://"):d.startsWith("https://")||(d=`https://${d}`),encodeURI(d)),xe={class:"px-4 py-3 border-b border-white/10 flex justify-between items-center bg-white/10 shrink-0"},ve={class:"flex-1 mx-4"},ge={key:0,class:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},be={key:0,class:"mb-4 p-3 bg-white/5 rounded-xl border border-white/10 animate-fade-in"},me={class:"flex gap-2"},ye={class:"flex items-center justify-between mb-3 group/cat border-b border-white/10 pb-1"},_e=["onClick"],ke={key:0,class:"flex gap-2 opacity-0 group-hover/cat:opacity-100 transition-opacity"},Ce=["onClick"],Ie=["onClick"],Me={key:0,class:"flex flex-col gap-2"},Le=["onClick"],$e={class:"w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center shrink-0 overflow-hidden border border-white/10"},Te=["src","onError"],Ue={class:"flex flex-col min-w-0 flex-1"},Be={class:"font-medium text-sm truncate text-white/80 group-hover:text-white"},We={class:"text-xs text-white/50 truncate"},Re={key:0,class:"flex gap-1 ml-auto pl-2 opacity-0 group-hover/link:opacity-100 transition-opacity"},je=["onClick"],Ae=["onClick"],De={key:0,class:"text-sm text-white/50 py-2 px-4 border border-dashed border-white/10 rounded-lg select-none"},Se={class:"text-xs font-bold text-white/80 mb-2"},Ee={class:"grid grid-cols-1 gap-3 mb-3"},Fe={class:"flex gap-2"},Ve=["disabled"],He={key:0,class:"w-3 h-3 border-2 border-current border-t-transparent rounded-full animate-spin"},ze={class:"flex gap-2 items-center"},Ne={class:"w-8 h-8 rounded bg-white/10 flex items-center justify-center border border-white/10 overflow-hidden shrink-0"},Ye=["src"],qe={key:1,class:"text-xs text-white/40"},Ke={class:"flex justify-end gap-2 border-t border-white/10 pt-3"},Pe=te({__name:"BookmarkWidget",props:{widget:{}},setup(d){const s=d,b=oe(),p=c(""),j=le(()=>{if(!p.value)return s.widget.data||[];const o=p.value.toLowerCase();return(s.widget.data||[]).map(e=>{const t=e.title.toLowerCase().includes(o),i=e.children.filter(n=>"url"in n?n.title.toLowerCase().includes(o)||n.url.toLowerCase().includes(o):n.title.toLowerCase().includes(o));return t||i.length>0?{...e,children:t?e.children:i}:null}).filter(e=>e!==null)}),m=ie(`flatnas-bookmark-backup-${s.widget.id}`,[]);se(()=>s.widget.data,o=>{o&&o.length>0&&(m.value=o)},{deep:!0}),ne(()=>{(!s.widget.data||s.widget.data.length===0)&&m.value.length>0&&(s.widget.data=m.value)});const C=c(null),y=c(null),B=c({x:0,y:0}),w=c(null),x=c(""),f=c(""),u=c(""),I=c(!1),W=c(!1),M=c(""),D=c(null),S=c(null),Y=()=>{S.value?.click()},q=o=>{const e=o.target.files?.[0];if(!e)return;const t=new FileReader;t.onload=i=>{const n=i.target?.result;try{const h=pe(n);if(h.length>0){s.widget.data||(s.widget.data=[]);const _=[],L=[];for(const v of h)"url"in v?L.push(v):_.push(v);if(s.widget.data.push(..._),L.length>0){let v=s.widget.data.find(ee=>ee.title==="é»˜è®¤æ”¶è—");v||(v={id:Date.now().toString()+"_default",title:"é»˜è®¤æ”¶è—",collapsed:!1,children:[]},s.widget.data.push(v)),v.children.push(...L)}alert(`æˆåŠŸå¯¼å…¥ ${h.length} ä¸ªä¹¦ç­¾`)}else alert("æœªæ‰¾åˆ°å¯å¯¼å…¥çš„ä¹¦ç­¾")}catch(h){console.error("Import failed",h),alert("å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼")}},t.readAsText(e),o.target&&(o.target.value="")},K=()=>{W.value=!0,M.value="",ue(()=>{D.value?.focus()})},E=()=>{M.value&&(s.widget.data||(s.widget.data=[]),s.widget.data.push({id:Date.now().toString(),title:M.value,collapsed:!1,children:[]}),W.value=!1)},P=()=>{W.value=!1},F=async()=>{if(f.value){I.value=!0;try{const o=await fetch(`/api/fetch-meta?url=${encodeURIComponent(f.value)}`);if(o.ok){const e=await o.json();e.title&&(x.value=e.title),e.icon?u.value=e.icon:u.value=`https://www.favicon.vip/get.php?url=${encodeURIComponent(f.value)}`}}catch(o){console.error(o)}finally{I.value=!1}}},X=(o,e)=>{C.value=e.id,y.value=e;const t=320,i=300,n=Math.min(o.clientX,window.innerWidth-t-20),h=Math.min(o.clientY+10,window.innerHeight-i-20);B.value={x:Math.max(10,n),y:Math.max(10,h)},w.value=null,x.value="",f.value="",u.value=""},Q=(o,e,t)=>{C.value=e.id,y.value=e;const i=320,n=300,h=Math.min(o.clientX,window.innerWidth-i-20),_=Math.min(o.clientY+10,window.innerHeight-n-20);B.value={x:Math.max(10,h),y:Math.max(10,_)},w.value=t.id,x.value=t.title,f.value=t.url,u.value=t.icon||""},G=()=>{const o=y.value;if(o&&x.value&&f.value){let e=f.value;if(e.startsWith("http")||(e="https://"+e),!u.value)try{u.value=`https://www.favicon.vip/get.php?url=${encodeURIComponent(e)}`}catch{}if(w.value){const t=o.children.find(i=>i.id===w.value);t&&"url"in t&&(t.title=x.value,t.url=e,t.icon=u.value)}else o.children.push({id:Date.now().toString(),title:x.value,url:e,icon:u.value});C.value=null,y.value=null,w.value=null}},J=()=>{y.value=null,C.value=null,w.value=null},V=(o,e)=>{if(!confirm("ç¡®å®šåˆ é™¤å—ï¼Ÿ")||!s.widget.data)return;const t=s.widget.data.findIndex(i=>i.id===o);if(t!==-1)if(e){const i=s.widget.data[t].children.findIndex(n=>n.id===e);i>-1&&s.widget.data[t].children.splice(i,1)}else s.widget.data.splice(t,1)},O=o=>{if(o){if(!b.isLogged){if(fe(o)){alert("ä¸ºäº†æ‚¨çš„å®‰å…¨ï¼Œæœªç™»å½•çŠ¶æ€ä¸‹ç¦æ­¢è®¿é—®å†…ç½‘èµ„æº");return}const e=we(o);window.location.href=e;return}window.open(o,"_blank")}},Z=o=>{const e=o.currentTarget,{scrollTop:t,scrollHeight:i,clientHeight:n}=e,h=o.deltaY,_=t<=0,L=t+n>=i-1;(_&&h<0||L&&h>0)&&(o.preventDefault(),o.stopPropagation())};return(o,e)=>(r(),a(A,null,[l("div",{class:"w-full h-full rounded-2xl backdrop-blur border border-white/10 overflow-hidden flex flex-col text-white relative transition-shadow group",style:N({backgroundColor:`rgba(0,0,0,${Math.min(.85,Math.max(.15,d.widget.opacity??.35))})`,color:"#fff"})},[l("div",xe,[e[6]||(e[6]=l("div",{class:"font-bold text-sm flex items-center gap-2 text-white"}," ğŸ“‘ æ”¶è—å¤¹ ",-1)),l("div",ve,[$(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),type:"text",placeholder:"æœç´¢ä¹¦ç­¾...",class:"w-full text-xs px-2 py-1 rounded-md border border-white/20 focus:outline-none focus:border-white/40 bg-white/10 text-white placeholder-white/50"},null,512),[[T,p.value]])]),U(b).isLogged?(r(),a("div",ge,[l("input",{type:"file",ref_key:"fileInputRef",ref:S,accept:".html",class:"hidden",onChange:q},null,544),l("button",{onClick:Y,class:"text-xs bg-white/10 text-white/70 px-2 py-0.5 rounded hover:bg-white/20",title:"å¯¼å…¥æµè§ˆå™¨æ”¶è—å¤¹HTML"}," å¯¼å…¥ "),l("button",{onClick:K,class:"text-xs bg-white/10 text-white/70 px-2 py-0.5 rounded hover:bg-white/20"}," + åˆ†ç±» ")])):g("",!0)]),l("div",{class:"flex-1 overflow-y-auto p-4 space-y-6 scrollbar-hide",onWheel:Z},[W.value?(r(),a("div",be,[e[7]||(e[7]=l("div",{class:"text-xs font-bold text-white/80 mb-2"},"æ·»åŠ æ–°åˆ†ç±»",-1)),l("div",me,[$(l("input",{ref_key:"categoryInputRef",ref:D,"onUpdate:modelValue":e[1]||(e[1]=t=>M.value=t),placeholder:"åˆ†ç±»åç§°",class:"flex-1 text-sm px-3 py-2 rounded-lg border bg-white/10 text-white placeholder-white/50 focus:outline-none focus:border-white/40",onKeyup:ae(E,["enter"])},null,544),[[T,M.value]]),l("button",{onClick:E,class:"bg-white/20 text-white text-xs px-3 py-2 rounded-lg hover:bg-white/30 whitespace-nowrap"}," ç¡®å®š "),l("button",{onClick:P,class:"bg-white/10 text-white/70 text-xs px-3 py-2 rounded-lg hover:bg-white/20 whitespace-nowrap"}," å–æ¶ˆ ")])])):g("",!0),(r(!0),a(A,null,H(j.value,t=>(r(),a("div",{key:t.id},[l("div",ye,[l("span",{class:"font-bold text-sm flex items-center gap-1 cursor-pointer select-none text-white/70",onClick:i=>t.collapsed=!t.collapsed},[l("span",{class:de(["transform transition-transform text-xs",t.collapsed?"-rotate-90":""])},"â–¼",2),z(" "+k(t.title),1)],8,_e),U(b).isLogged?(r(),a("div",ke,[l("button",{onClick:i=>X(i,t),class:"text-white/70 hover:text-white text-xs font-bold"}," + æ·»åŠ  ",8,Ce),l("button",{onClick:i=>V(t.id),class:"text-white/50 hover:text-white/80 text-xs"}," åˆ é™¤åˆ†ç±» ",8,Ie)])):g("",!0)]),t.collapsed?g("",!0):(r(),a("div",Me,[(r(!0),a(A,null,H(t.children,i=>(r(),a("div",{key:i.id,class:"flex items-center gap-3 p-2 hover:bg-white/10 rounded-xl cursor-pointer transition-all group/link border border-transparent hover:border-white/10",onClick:R(n=>O(i.url),["stop"]),title:"ç‚¹å‡»è·³è½¬"},[l("div",$e,[l("img",{src:U(b).getAssetUrl(i.icon),class:"w-6 h-6 object-cover",onError:n=>i.icon="https://www.favicon.vip/get.php?url=unknown"},null,40,Te)]),l("div",Ue,[l("span",Be,k(i.title),1),l("span",We,k(i.url),1)]),U(b).isLogged?(r(),a("div",Re,[l("button",{onClick:R(n=>Q(n,t,i),["stop"]),class:"text-white/60 hover:text-white p-1",title:"ç¼–è¾‘"}," âœ ",8,je),l("button",{onClick:R(n=>V(t.id,i.id),["stop"]),class:"text-white/50 hover:text-white/80 p-1",title:"åˆ é™¤"}," Ã— ",8,Ae)])):g("",!0)],8,Le))),128)),t.children.length===0&&C.value!==t.id?(r(),a("div",De," (ç©ºæ–‡ä»¶å¤¹) ")):g("",!0)]))]))),128))],32)],4),(r(),re(ce,{to:"body"},[y.value?(r(),a("div",{key:0,class:"fixed p-4 bg-black/60 backdrop-blur rounded-xl border border-white/10 shadow-xl z-[9999] text-white",style:N({top:B.value.y+"px",left:B.value.x+"px",width:"320px"}),onClick:e[5]||(e[5]=R(()=>{},["stop"]))},[l("div",Se,k(w.value?"ç¼–è¾‘ä¹¦ç­¾":"æ·»åŠ æ–°ä¹¦ç­¾"),1),l("div",Ee,[l("div",Fe,[$(l("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t),placeholder:"ç½‘å€ (ä¾‹å¦‚: www.example.com)",class:"flex-1 text-sm px-3 py-2 rounded-lg border bg-white/10 text-white placeholder-white/50 focus:bg-white/10 outline-none transition-all",onBlur:F},null,544),[[T,f.value]]),l("button",{onClick:F,disabled:I.value,class:"px-3 bg-white/10 text-white/80 text-xs rounded-lg font-bold hover:bg-white/20 transition-colors flex items-center gap-1",title:"è‡ªåŠ¨è·å–æ ‡é¢˜å’Œå›¾æ ‡"},[I.value?(r(),a("span",He)):g("",!0),z(" "+k(I.value?"è·å–ä¸­":"âš¡"),1)],8,Ve)]),$(l("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>x.value=t),placeholder:"æ ‡é¢˜ (è‡ªåŠ¨è·å–)",class:"w-full text-sm px-3 py-2 rounded-lg border bg-white/10 text-white placeholder-white/50 focus:bg-white/10 outline-none transition-all"},null,512),[[T,x.value]]),l("div",ze,[l("div",Ne,[u.value?(r(),a("img",{key:0,src:U(b).getAssetUrl(u.value),class:"w-full h-full object-cover"},null,8,Ye)):(r(),a("span",qe,"icon"))]),$(l("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>u.value=t),placeholder:"å›¾æ ‡åœ°å€ (è‡ªåŠ¨è·å–)",class:"flex-1 text-sm px-3 py-2 rounded-lg border bg-white/10 text-white placeholder-white/50 focus:bg-white/10 outline-none transition-all"},null,512),[[T,u.value]])])]),l("div",Ke,[l("button",{onClick:J,class:"text-sm text-white/70 hover:bg-white/10 px-3 py-1.5 rounded transition-colors"}," å–æ¶ˆ "),l("button",{onClick:G,class:"text-sm bg-white/20 text-white px-4 py-1.5 rounded hover:bg-white/30 shadow-md transition-all"},k(w.value?"ä¿å­˜":"æ·»åŠ "),1)])],4)):g("",!0)]))],64))}}),Ge=he(Pe,[["__scopeId","data-v-40737f3b"]]);export{Ge as default};
