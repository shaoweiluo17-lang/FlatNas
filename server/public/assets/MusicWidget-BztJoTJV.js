import{d as Lt,u as zt,r as p,w as Y,c as S,x as Rt,y as Bt,J as Ft,o as Dt,a as n,e as o,g as l,q as O,f as T,p as I,t as c,b as P,j as me,l as ge,I as Re,F as V,h as q,D as Vt,i as be,G as qt,_ as Jt}from"./index-CVQJtkH-.js";import{_ as Wt}from"./daoliyu-CAYE7_Pg.js";const Ht={key:1,class:"absolute inset-0 bg-white/5 transition-all pointer-events-none"},Gt={key:2,class:"w-full h-full relative z-10"},Kt={class:"aplayer-body"},Qt={class:"aplayer-pic"},Xt=["title"],Yt={class:"aplayer-info"},Zt={class:"aplayer-music-text-wrap"},ea={key:0,class:"ml-8"},ta={class:"aplayer-music-text-wrap"},aa={key:0,class:"ml-8"},la=["title"],sa={class:"aplayer-time-main"},ia={class:"aplayer-controls"},ra={class:"aplayer-right"},na=["title"],oa={class:"aplayer-volume"},ca=["value"],ua={class:"aplayer-bar-container"},da={class:"aplayer-bar"},va=["max","value","disabled"],fa={class:"aplayer-ptime"},pa={key:3,class:"w-full h-full relative z-10"},ya={class:"aplayer-body"},ha={class:"aplayer-pic"},ma=["title"],ga={class:"aplayer-info"},ba={class:"aplayer-music-text-wrap"},wa={key:0,class:"ml-8"},xa={class:"aplayer-music-text-wrap"},ka={key:0,class:"ml-8"},_a={class:"aplayer-time-main"},Ta={class:"aplayer-controls"},$a={class:"aplayer-right"},Ia=["title"],Pa={class:"aplayer-volume"},Ua=["value"],Ca={class:"aplayer-bar-container"},Aa={class:"aplayer-bar"},Ma=["max","value","disabled"],Sa={class:"aplayer-ptime"},ja={class:"aplayer-list-body"},Na={key:0,class:"aplayer-list-state"},Ea={key:1,class:"aplayer-list-state is-error"},Oa={key:2,class:"aplayer-list-state"},La={key:4,class:"flex h-full relative z-10"},za={class:"flex flex-col min-w-0 transition-all duration-300 w-[39.2%] border-r border-white/10"},Ra={class:"border-b border-white/10 bg-white/5 flex flex-col shrink-0"},Ba={class:"p-3 flex gap-1.5 items-center relative"},Fa={class:"w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center overflow-hidden shadow-sm shrink-0"},Da=["src"],Va={key:1,src:Wt,class:"w-6 h-6 object-contain opacity-50"},qa={class:"flex-1 min-w-0 flex flex-col"},Ja={class:"font-bold text-white truncate text-sm leading-tight"},Wa={class:"text-xs text-white/60 truncate leading-tight"},Ha=["title"],Ga={class:"px-1 pb-2"},Ka={class:"flex items-center gap-1 text-[12px] text-white/70"},Qa={class:"tabular-nums w-9 text-right"},Xa=["max","value"],Ya={class:"tabular-nums w-9"},Za={class:"px-3 py-1.5 border-b border-white/10 bg-white/5 flex flex-col gap-1.5"},el={class:"flex gap-1 overflow-x-auto custom-scrollbar pb-0.5"},tl=["onClick"],al=["value"],ll={key:0,class:"p-4 text-center text-xs text-white/40"},sl={key:1,class:"p-4 text-center text-xs text-red-400"},il={key:2},rl={key:0,class:"grid grid-cols-3 gap-2 p-2"},nl=["onClick"],ol={class:"w-14 h-14 rounded-full overflow-hidden bg-white/10 shadow-sm group-hover:scale-105 transition-transform border border-white/5"},cl=["src"],ul={key:1,class:"w-full h-full flex items-center justify-center text-2xl opacity-50"},dl={class:"text-[10px] text-white/80 text-center truncate w-full"},vl={key:1,class:"grid grid-cols-3 gap-2 p-2"},fl=["onClick"],pl={class:"w-14 h-14 rounded overflow-hidden bg-white/10 shadow-sm group-hover:scale-105 transition-transform border border-white/5"},yl=["src"],hl={key:1,class:"w-full h-full flex items-center justify-center text-2xl opacity-50"},ml={class:"text-[10px] text-white/80 text-center truncate w-full"},gl={key:2},bl={key:0,class:"sticky top-0 z-10 bg-black/40 backdrop-blur-md border-b border-white/10 px-3 py-2 flex items-center gap-2 mb-1"},wl={class:"flex items-center gap-2 overflow-hidden flex-1"},xl=["src"],kl={class:"text-xs font-bold text-white truncate"},_l={key:1,class:"sticky top-0 z-10 bg-black/40 backdrop-blur-md border-b border-white/10 px-3 py-2 flex items-center gap-2 mb-1"},Tl={class:"flex items-center gap-2 overflow-hidden flex-1"},$l=["src"],Il={class:"text-xs font-bold text-white truncate"},Pl=["onClick"],Ul={class:"text-xs text-white/40 w-4 text-center"},Cl={key:0,class:"animate-pulse text-blue-400"},Al={key:1},Ml={class:"flex-1 min-w-0"},Sl={class:"text-[10px] text-white/50 truncate"},jl={class:"text-[10px] text-white/40 opacity-0 group-hover/item:opacity-100 transition-opacity"},Nl={key:0,class:"absolute right-0 mt-2 w-40 bg-black/80 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl py-1 z-40 overflow-hidden"},El=["onClick"],Ol={class:"text-sm"},Ll={key:0,class:"pt-[40%] pb-[60%]"},zl={key:1,class:"text-xs text-white/90 whitespace-pre-line leading-7 font-medium tracking-wide"},Rl={key:2,class:"h-full flex flex-col items-center justify-center text-white/40 gap-2"},Bl={key:1,class:"flex-1 flex flex-col items-center justify-center p-4"},Fl={class:"text-white/40 flex flex-col items-center gap-6"},Dl={class:"flex items-end gap-1.5 h-20"},Vl={class:"flex flex-col items-center gap-2 w-full max-w-[80%]"},ql={key:0,class:"flex flex-col items-center gap-2"},Jl={class:"text-sm font-bold text-white text-center drop-shadow-md"},Wl={key:0,class:"text-[11px] text-white/40 text-center line-clamp-1 italic"},Hl={key:1,class:"flex flex-col items-center gap-1"},Gl={key:2,class:"flex-1 flex flex-col items-center justify-center p-4 overflow-hidden"},Kl={class:"flex flex-col items-center gap-2 mt-8 w-full max-w-[80%]"},Ql={key:0,class:"flex flex-col items-center gap-2"},Xl={class:"text-sm font-bold text-white text-center drop-shadow-md"},Yl={key:0,class:"text-[11px] text-white/40 text-center line-clamp-1 italic"},Zl={key:1,class:"flex flex-col items-center gap-1"},es={key:3,class:"flex-1 flex flex-col items-center justify-center p-4"},ts={class:"relative group mt-[-20px] scale-[1.1]"},as={class:"w-20 h-20 rounded-full overflow-hidden border-4 border-[#111] z-10 shadow-inner"},ls=["src"],ss={key:1,class:"w-full h-full bg-zinc-800 flex items-center justify-center text-white/20"},is={class:"flex flex-col items-center gap-2 mt-12 w-full max-w-[80%]"},rs={key:0,class:"flex flex-col items-center gap-2"},ns={class:"text-sm font-bold text-white text-center drop-shadow-md"},os={key:0,class:"text-[11px] text-white/40 text-center line-clamp-1 italic"},cs={key:1,class:"flex flex-col items-center gap-1"},us={class:"absolute left-1/2 -translate-x-1/2 bottom-3 z-20 max-w-[calc(100vw-2rem)]"},ds={class:"bg-black/40 backdrop-blur-md rounded-xl px-4 py-2 shadow-lg flex items-center gap-6 w-fit min-w-[280px] max-w-[calc(100vw-2rem)] transition-all opacity-0 group-hover:opacity-100 duration-300"},vs={class:"flex items-center justify-center gap-4 shrink-0"},fs={class:"flex items-center gap-2 shrink-0 border-l border-white/10 pl-6"},ps=["value"],Be="‚èÆÔ∏é",Fe="‚è≠Ô∏é",De="‚ñ∂Ô∏é",Ve="‚è∏Ô∏é",yt="üîÅÔ∏é",ht="üîÄÔ∏é",mt="üîÇÔ∏é",qe="flatnas_music_player_state",ys=Lt({__name:"MusicWidget",props:{widget:{}},setup(Z){const b=Z,U=zt(),u=p([]),we=p([]),L=p([]),B=p([]),m=p("songs"),J=p("lyrics"),ie=p(!1),Je=[{id:"lyrics",label:"Ê≠åËØç",icon:"üìù"},{id:"spectrum",label:"È¢ëË∞±ÂàÜÊûê",icon:"üìä"},{id:"abstract",label:"ÊäΩË±°Âä®Áîª",icon:"‚ú®"},{id:"vinyl",label:"Â∞ÅÈù¢‰∏éÈªëËÉ∂",icon:"üíø"}],gt=e=>{J.value=e,ie.value=!1},j=p(null),h=p(null),w=p(null),s=p({isPlaying:!1,currentTime:0,duration:0,volume:.7,currentTrackId:null,playbackMode:"sequence"});Y(()=>U.activeMusicPlayer,e=>{e!=="music-widget"&&s.value.isPlaying&&(v.value&&v.value.pause(),s.value.isPlaying=!1)});const v=p(null),We=p(null),xe=p(!1),ee=p(!1),k=p(""),A=S(()=>b.widget.data?.syncPlayerState===!0),He=S(()=>b.widget.colSpan===1&&b.widget.rowSpan===1),ke=S(()=>b.widget.colSpan===1&&b.widget.rowSpan===3),W=p([]),_e=p(!1),re=p(""),Ge=p(!1),H=p(!1),de=p(0),ne=p(null),Te=p(null),$e=S(()=>ke.value?!0:Ge.value),F=S(()=>{if(ae.value)return at(ae.value);if(m.value==="artists"&&h.value){const e=L.value.find(t=>t.id===h.value);return U.getAssetUrl(e?.coverUrl)}}),Ke=S(()=>{const e=s.value.duration||0;return e?Math.max(0,Math.min(100,s.value.currentTime/e*100)):0}),Qe=S(()=>{const e=s.value.duration||0;return e?Math.max(0,Math.min(100,de.value/e*100)):0}),f=S(()=>{let e=b.widget.data?.apiUrl||"/api";return e=e.replace(/\/$/,""),/\/api(\/v\d+)?$/.test(e)||(e+="/api"),e}),g=()=>{const e={};return b.widget.data?.token&&(e.Authorization=`Bearer ${b.widget.data.token}`),e},Ie=async()=>{if(!(!b.widget.data?.username||!b.widget.data?.password))try{const e=await fetch(`${f.value}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:b.widget.data.username,password:b.widget.data.password})});if(e.ok){const t=await e.json();if(t.token){const a=U.widgets.find(r=>r.id===b.widget.id);a&&a.data&&(a.data.token=t.token,U.saveData()),bt()}}}catch(e){console.error("Login failed",e)}},bt=async()=>{try{const e=await fetch(`${f.value}/auth/me`,{headers:g()});if(e.ok){const t=await e.json();console.log("User profile:",t)}}catch(e){console.error("Fetch profile failed",e)}},te=async()=>{try{const e=await fetch(`${f.value}/player`,{headers:g()});if(e.ok){const t=await e.json();s.value.isPlaying=t.isPlaying,le.value||(s.value.currentTime=t.progress||t.currentTime||0),s.value.volume=t.volume??.7,s.value.currentTrackId=t.currentTrack?.id||t.currentTrackId,(t.lyrics||t.currentTrack?.lyrics)&&(s.value.lyrics=t.lyrics||t.currentTrack?.lyrics),t.queue&&Array.isArray(t.queue)&&(u.value=t.queue.map(K).filter(Boolean));const a=K(t.currentTrack);a&&!u.value.find(r=>r.id===a.id)&&u.value.push(a),v.value&&(v.value.volume=s.value.volume)}}catch(e){console.error("Fetch player state failed",e)}},Xe=async()=>{if(u.value.length===0){k.value="ÂàóË°®‰∏∫Á©∫ÔºåÊó†Ê≥ïÊí≠Êîæ";return}const e=u.value.map(t=>t.id);ee.value=!0,k.value="";try{const t=await fetch(`${f.value}/player/queue`,{method:"PUT",headers:{...g(),"Content-Type":"application/json"},body:JSON.stringify({trackIds:e})});t.ok||console.warn("Queue replace failed",t.status),u.value.length>0&&u.value[0]&&await R(u.value[0]),A.value&&te()}catch(t){console.error("Play all failed",t),k.value="Êí≠ÊîæÂÖ®ÈÉ®Â§±Ë¥•: "+(t instanceof Error?t.message:String(t))}finally{ee.value=!1}},wt=async e=>{try{const t={};e&&(t.trackId=e),await fetch(`${f.value}/player/play`,{method:"POST",headers:{...g(),"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(t){console.error(t)}},xt=async()=>{try{await fetch(`${f.value}/player/pause`,{method:"POST",headers:g()})}catch(e){console.error(e)}},Ye=async()=>{try{await fetch(`${f.value}/player/next`,{method:"POST",headers:g()}),A.value&&te()}catch(e){console.error(e)}},kt=async()=>{try{await fetch(`${f.value}/player/prev`,{method:"POST",headers:g()}),A.value&&te()}catch(e){console.error(e)}},_t=async e=>{try{await fetch(`${f.value}/player/volume`,{method:"POST",headers:{...g(),"Content-Type":"application/json"},body:JSON.stringify({volume:e})}),s.value.volume=e}catch(t){console.error(t)}},G=e=>{if(Array.isArray(e))return e;if(e&&typeof e=="object"){const t=e;if(Array.isArray(t.data))return t.data;if(Array.isArray(t.items))return t.items;if(Array.isArray(t.tracks))return t.tracks;if(Array.isArray(t.songs))return t.songs}return[]},K=e=>{if(!e||typeof e!="object")return null;const t=e,a=t.track&&typeof t.track=="object"?t.track:t,i=(N=>typeof N=="string"?N:typeof N=="number"&&Number.isFinite(N)?String(N):null)(a.id??t.trackId??a.trackId??t.songId??a.songId??t.id),d=typeof a.title=="string"?a.title:typeof a.name=="string"?a.name:typeof a.songName=="string"?a.songName:typeof t.title=="string"?t.title:typeof t.name=="string"?t.name:typeof t.songName=="string"?t.songName:null;if(!i||!d)return null;const y=a.album&&typeof a.album=="object"?a.album:null,Q=Array.isArray(a.artists)&&a.artists.length>0?a.artists.map(N=>{if(typeof N=="string")return N;if(N&&typeof N=="object"){const pt=N;if(typeof pt.name=="string")return pt.name}return""}).filter(Boolean).join(", "):typeof a.artist=="string"?a.artist:a.artist&&typeof a.artist=="object"&&typeof a.artist.name=="string"?a.artist.name:typeof a.singer=="string"?a.singer:typeof a.artistName=="string"?a.artistName:typeof t.artistName=="string"?t.artistName:typeof t.singer=="string"?t.singer:void 0,M=a.album&&typeof a.album=="object"&&typeof a.album.title=="string"?a.album.title:typeof a.album=="string"?a.album:typeof a.albumName=="string"?a.albumName:typeof a.albumTitle=="string"?a.albumTitle:typeof t.albumTitle=="string"?t.albumTitle:typeof t.albumName=="string"?t.albumName:void 0,se=typeof a.duration=="number"?a.duration:typeof t.duration=="number"?t.duration:typeof a.length=="number"?a.length:typeof t.length=="number"?t.length:void 0,x=a.cover&&typeof a.cover=="object"?a.cover:t.cover&&typeof t.cover=="object"?t.cover:null,ft=typeof a.coverArtUrl=="string"?a.coverArtUrl:typeof a.coverUrl=="string"?a.coverUrl:y&&typeof y.coverArtUrl=="string"?y.coverArtUrl:y&&typeof y.coverUrl=="string"?y.coverUrl:x&&typeof x.url=="string"?x.url:x&&typeof x.src=="string"?x.src:x&&typeof x.path=="string"?x.path:x&&typeof x.imageUrl=="string"?x.imageUrl:typeof a.imageUrl=="string"?a.imageUrl:typeof a.coverArtPath=="string"?a.coverArtPath:y&&typeof y.coverArtPath=="string"?y.coverArtPath:typeof t.coverArtUrl=="string"?t.coverArtUrl:typeof t.coverUrl=="string"?t.coverUrl:typeof t.imageUrl=="string"?t.imageUrl:void 0,X=typeof a.coverId=="string"?a.coverId:typeof t.coverId=="string"?t.coverId:void 0,Ot=typeof a.lyrics=="string"?a.lyrics:typeof t.lyrics=="string"?t.lyrics:void 0;return{id:i,title:d,artist:Q,album:M,duration:se,coverUrl:ft,coverId:X,lyrics:Ot}},E=async(e,t)=>{const a=await fetch(e,{...t,headers:{...g()}});return a.status!==401?a:(await Ie(),fetch(e,{...t,headers:{...g()}}))},Pe=async()=>{_e.value=!0,re.value="";try{let e=await E(`${f.value}/songs?take=1000`);if(e.ok||(e=await E(`${f.value}/tracks?take=1000`)),!e.ok)throw new Error(await e.text());const t=await e.json(),r=G(t).map(K).filter(Boolean);W.value=r}catch(e){W.value=[],re.value=e.message||"Âä†ËΩΩÂ§±Ë¥•"}finally{_e.value=!1}},Tt=(e,t)=>{if(!e.length)return;u.value=e;const a=e[0];a&&R(a)},Ze=async()=>{re.value="",W.value.length===0&&await Pe();const e=W.value;e.length&&(Tt(e),Ge.value=!1)},et=async()=>{try{let e=await E(`${f.value}/playlists?take=1000`);if(e.ok||(e=await E(`${f.value}/music/playlists?take=1000`)),e.ok){const t=await e.json(),a=G(t);we.value=a.map(r=>{const i=r;return{id:i.id,name:i.name||i.title||"Êú™ÂëΩÂêçÊ≠åÂçï",coverUrl:fe(i.coverUrl||i.cover)}})}}catch(e){console.error("Fetch playlists failed",e)}},$t=async()=>{try{const e=await E(`${f.value}/library/artists?take=1000`);if(e.ok){const t=await e.json(),a=G(t);L.value=a.map(r=>{const i=r;return{id:i.id,name:i.name||i.artist||"Unknown Artist",coverUrl:fe(i.coverUrl||i.cover)}})}}catch(e){console.error("Fetch artists failed",e)}},It=async()=>{try{const e=await E(`${f.value}/library/albums?take=1000`);if(e.ok){const t=await e.json(),a=G(t);B.value=a.map(r=>{const i=r;return{id:i.id,title:i.title||i.name||"Unknown Album",artist:i.artist,coverUrl:fe(i.coverUrl||i.cover)}})}}catch(e){console.error("Fetch albums failed",e)}},D=async()=>{!b.widget.data?.token&&b.widget.data?.username&&b.widget.data?.password&&await Ie(),ee.value=!0,k.value="";try{let e=`${f.value}/songs?take=1000`;m.value==="playlists"&&j.value?e=`${f.value}/playlists/${j.value}/tracks?take=1000`:m.value==="artists"&&h.value?e=`${f.value}/library/artists/${h.value}/songs?take=1000`:m.value==="albums"&&w.value&&(e=`${f.value}/library/albums/${w.value}`);let t=await fetch(e,{headers:g()});if(!t.ok)if(m.value==="playlists"&&j.value)e=`${f.value}/playlists/${j.value}/songs?take=1000`,t=await fetch(e,{headers:g()});else if(m.value==="artists"&&h.value){if(e=`${f.value}/library/artists/${h.value}/tracks?take=1000`,t=await fetch(e,{headers:g()}),!t.ok){const i=L.value.find(d=>d.id===h.value);i&&i.name&&(e=`${f.value}/tracks?search=${encodeURIComponent(i.name)}&take=1000`,t=await fetch(e,{headers:g()}))}}else if(m.value==="albums"&&w.value){const i=B.value.find(d=>d.id===w.value);i&&i.title&&(e=`${f.value}/tracks?search=${encodeURIComponent(i.title)}&take=1000`,t=await fetch(e,{headers:g()}))}else e.includes("/songs")&&(e=e.replace("/songs","/tracks"),t=await fetch(e,{headers:g()}));if(t.status===401&&(await Ie(),t=await fetch(e,{headers:g()})),!t.ok)throw new Error(`API Error: ${t.status}`);const a=await t.json(),r=G(a);if(r.length===0&&m.value==="albums"&&w.value){const i=B.value.find(d=>d.id===w.value);if(i&&i.title){const d=`${f.value}/tracks?search=${encodeURIComponent(i.title)}&take=1000`,y=await E(d);if(y.ok){const Q=await y.json(),M=G(Q);if(M.length>0){u.value=M.map(K).filter(Boolean),ee.value=!1;return}}}}if(u.value=r.map(K).filter(Boolean),u.value.length===0&&!j.value){let i=await fetch(`${f.value}/songs?take=100`,{headers:g()});if(i.ok||(i=await fetch(`${f.value}/tracks?take=100`,{headers:g()})),i.ok){const d=await i.json(),y=G(d);u.value=y.map(K).filter(Boolean)}}u.value.length===0&&(k.value="ÊöÇÊó†Ê≠åÊõ≤ÔºåËØ∑Ê£ÄÊü• API ÈÖçÁΩÆÊàñÊî∂Ëóè")}catch(e){console.error("Fetch tracks failed",e),k.value=`Âä†ËΩΩÂ§±Ë¥•: ${e.message}`,u.value=[]}finally{ee.value=!1}},Pt=e=>{m.value=e,j.value=null,h.value=null,w.value=null,e==="playlists"&&we.value.length===0&&et(),e==="artists"&&L.value.length===0&&$t(),e==="albums"&&B.value.length===0&&It(),e==="songs"?D():u.value=[]},Ut=e=>({songs:"Ê≠åÊõ≤",playlists:"Ê≠åÂçï",artists:"Ëâ∫‰∫∫",albums:"‰∏ìËæë"})[e]||e,Ct=e=>{h.value=e,D()},At=e=>{w.value=e,D()},ve=()=>{ne.value&&(URL.revokeObjectURL(ne.value),ne.value=null,Te.value=null)},tt=async(e,t=0,a=!0)=>{if(!v.value)return;const r=[`${f.value}/tracks/${encodeURIComponent(e)}/stream`,`${f.value}/songs/${encodeURIComponent(e)}/stream`];let i=null,d=null;for(const M of r){try{i=await E(M)}catch(X){throw new Error(`ËøûÊé•Â§±Ë¥•: ${X.message}`)}if(i.ok){d=null;break}const se=await i.text();let x=se;try{const X=JSON.parse(se);typeof X.error=="string"?x=X.error:x=JSON.stringify(X)}catch{}if(d={status:i.status,detail:x},!(i.status===404||x.includes("TRACK_NOT_FOUND")||x.toLowerCase().includes("not found")))break}if(!i||!i.ok)throw d?new Error(`Stream API Error ${d.status}: ${d.detail}`):new Error("Stream API Error: ËØ∑Ê±ÇÂ§±Ë¥•");const y=i.headers.get("content-type")||"";y&&!y.startsWith("audio/")&&!y.startsWith("application/octet-stream")&&!y.startsWith("video/")&&console.warn(`Unexpected content-type: ${y}`);const Q=await i.blob();if(ve(),ne.value=URL.createObjectURL(Q),Te.value=e,v.value.src=ne.value,v.value.currentTime=t,a)try{await v.value.play(),k.value=""}catch(M){throw s.value.isPlaying=!1,new Error(`Playback failed: ${M.name} - ${M.message}`)}},oe=p({}),Mt=async e=>{if(!oe.value[e])try{let t=await E(`${f.value}/tracks/${encodeURIComponent(e)}`);if(t.ok||(t=await E(`${f.value}/songs/${encodeURIComponent(e)}`)),!t.ok)return;const a=await t.json(),r=K(a);if(!r)return;oe.value={...oe.value,[e]:r}}catch{}};Y(()=>s.value.currentTrackId,e=>{e&&Mt(e)},{immediate:!0});const fe=e=>{if(!e)return;const t=b.widget.data?.token;if(e.startsWith("http")){const i=`${f.value}/proxy-image?url=${encodeURIComponent(e)}`;return t?`${i}&token=${t}`:i}const a=f.value.replace(/\/api(\/v\d+)?$/,""),r=e.startsWith("/")?`${a}${e}`:`${a}/${e}`;return t?`${r}${r.includes("?")?"&":"?"}token=${t}`:r},at=e=>{const t=b.widget.data?.token,r=oe.value[e.id]?.coverUrl||e.coverUrl;if(!r&&e.id){const i=`${f.value}/subsonic/rest/getCoverArt?id=track:${e.id}`,d=t?`${i}&token=${t}`:i;return U.getAssetUrl(d)}return U.getAssetUrl(fe(r))},C=S(()=>u.value.find(e=>e.id===s.value.currentTrackId)),ae=S(()=>{const e=C.value;return e?oe.value[e.id]??e:null});Y(()=>ae.value,e=>{e&&e.lyrics!==void 0&&(s.value.lyrics=e.lyrics)},{immediate:!0});const z=S(()=>{const e=ae.value;if(!e)return m.value==="artists"&&h.value&&L.value.find(i=>i.id===h.value)?.name||"";let t=e.artist||"";Array.isArray(t)&&(t=t.map(r=>{if(typeof r=="string")return r;if(r&&typeof r=="object"){const i=r;if(typeof i.name=="string")return i.name}return""}).filter(Boolean).join(", ")),t=t.trim();const a=(e.album||"").trim();return t&&a?`${t} ¬∑ ${a}`:t||a||""}),Ue=p(null),lt=p(null),$=S(()=>{if(!s.value.lyrics)return[];const e=s.value.lyrics.split(`
`),t=[],a=/\[(\d+):(\d+)(?:[:.](\d+))?\]/g;return e.forEach(r=>{const i=r.replace(/\[(\d+):(\d+)(?:[:.](\d+))?\]/g,"").trim();if(!i)return;let d;for(a.lastIndex=0;(d=a.exec(r))!==null;){const y=parseInt(d[1]??"0",10),Q=parseInt(d[2]??"0",10),M=d[3]?parseInt(d[3],10):0,se=y*60+Q+(M>99?M/1e3:M/100);t.push({time:se,text:i})}}),t.sort((r,i)=>r.time-i.time)}),_=S(()=>{const e=s.value.currentTime,t=$.value;if(t.length===0)return-1;for(let a=t.length-1;a>=0;a--){const r=t[a];if(r&&e>=r.time)return a}return 0});Y(_,async()=>{if(!Ue.value)return;await Rt();const e=Ue.value,t=lt.value;if(!t)return;const a=e.offsetHeight/2-60,r=t.offsetTop-a+t.offsetHeight/2;e.scrollTo({top:Math.max(0,r),behavior:le.value?"auto":"smooth"})},{immediate:!0});const st=new Set,it=async e=>{if(st.has(e.id))return;st.add(e.id),v.value&&v.value.pause(),ve();const t=u.value.findIndex(a=>a.id===e.id);if(t!==-1&&u.value.splice(t,1),s.value.currentTrackId=null,s.value.isPlaying=!1,u.value.length>0){const a=u.value[Math.min(t,u.value.length-1)]||u.value[0];a&&await R(a);return}await D()},R=async(e,t={})=>{const{startTime:a=0,autoPlay:r=!0}=t;if(s.value.currentTrackId===e.id&&!a){pe();return}if(s.value.currentTrackId=e.id,s.value.isPlaying=r,U.activeMusicPlayer="music-widget",v.value){v.value.src&&v.value.src.startsWith("blob:")&&URL.revokeObjectURL(v.value.src),ve();try{await tt(e.id,a,r)}catch(i){console.error("Play error",i);const d=i.message;if(d.includes("TRACK_NOT_FOUND")){k.value="Ê≠åÊõ≤‰∏çÂ≠òÂú®ÔºåÂ∑≤Ë∑≥Ëøá",await it(e);return}(d.includes("NotAllowedError")||d.toLowerCase().includes("playback failed"))&&(s.value.isPlaying=!1),k.value=`Êí≠ÊîæÂá∫Èîô: ${d}`}}},St=async()=>(W.value.length===0&&await Pe(),W.value.length===0?!1:(await Ze(),!0)),pe=()=>{if(v.value){if(!s.value.currentTrackId){const e=u.value[0];if(e){R(e);return}(async()=>await St()||await D())();return}s.value.isPlaying?(v.value.pause(),s.value.isPlaying=!1):(v.value.play().catch(()=>{}),s.value.isPlaying=!0,U.activeMusicPlayer="music-widget")}},Ce=()=>{const e=["sequence","random","single"],t=(e.indexOf(s.value.playbackMode)+1)%e.length;s.value.playbackMode=e[t]},ye=(e=!1)=>{if(!u.value.length)return;if(e&&s.value.playbackMode==="single"){v.value&&(v.value.currentTime=0,v.value.play().catch(()=>{}));return}if(s.value.playbackMode==="random"){const i=Math.floor(Math.random()*u.value.length),d=u.value[i];d&&R(d),A.value&&Ye();return}const a=(u.value.findIndex(i=>i.id===s.value.currentTrackId)+1)%u.value.length,r=u.value[a];r&&R(r),A.value&&Ye()},Ae=()=>{if(!u.value.length)return;const t=(u.value.findIndex(r=>r.id===s.value.currentTrackId)-1+u.value.length)%u.value.length,a=u.value[t];a&&R(a),A.value&&kt()},jt=Ft(()=>{const e={libraryMode:m.value,currentPlaylistId:j.value,currentArtistId:h.value,currentAlbumId:w.value,playerState:{volume:s.value.volume,playbackMode:s.value.playbackMode,currentTrackId:s.value.currentTrackId,currentTime:s.value.currentTime,isPlaying:s.value.isPlaying}};localStorage.setItem(qe,JSON.stringify(e))},1e3),Nt=()=>{const e={libraryMode:m.value,currentPlaylistId:j.value,currentArtistId:h.value,currentAlbumId:w.value,playerState:{volume:s.value.volume,playbackMode:s.value.playbackMode,currentTrackId:s.value.currentTrackId,currentTime:s.value.currentTime,isPlaying:s.value.isPlaying}};localStorage.setItem(qe,JSON.stringify(e))},Et=async()=>{const e=localStorage.getItem(qe);if(!e)return!1;try{const t=JSON.parse(e);if(m.value=t.libraryMode||"songs",j.value=t.currentPlaylistId||null,h.value=t.currentArtistId||null,w.value=t.currentAlbumId||null,t.playerState&&(s.value.volume=t.playerState.volume??.7,s.value.playbackMode=t.playerState.playbackMode||"sequence",t.playerState.currentTrackId)){await D();const a=u.value.find(r=>r.id===t.playerState.currentTrackId);if(a)return await R(a,{startTime:t.playerState.currentTime||0,autoPlay:t.playerState.isPlaying}),s.value.currentTime=t.playerState.currentTime||0,!0}}catch(t){console.error("Failed to restore playback state",t)}return!1},le=p(!1),rt=p(0),Me=()=>{v.value&&(le.value||(s.value.currentTime=v.value.currentTime),s.value.duration=v.value.duration||0,ct())},Se=()=>{ye(!0)},je=e=>{const t=e.target;s.value.volume=parseFloat(t.value),v.value&&(v.value.volume=s.value.volume),A.value&&_t(s.value.volume)},Ne=()=>{A.value&&wt(s.value.currentTrackId||void 0)},Ee=()=>{A.value&&xt()},Oe=()=>{const e=s.value.currentTrackId;if(e&&Te.value!==e){tt(e).catch(t=>{if((t.message||"").includes("TRACK_NOT_FOUND")){const r=u.value.find(i=>i.id===e);r&&it(r),k.value="Ê≠åÊõ≤‰∏çÂ≠òÂú®ÔºåÂ∑≤Ë∑≥Ëøá";return}k.value="Èü≥È¢ëÊ∫ê‰∏çÊîØÊåÅÊàñÊó†ÊùÉÈôê"});return}k.value="Èü≥È¢ëÊ∫ê‰∏çÊîØÊåÅÊàñÊó†ÊùÉÈôê"},Le=e=>{const t=e.target,a=parseFloat(t.value);isNaN(a)||(le.value=!0,rt.value=a,s.value.currentTime=a)},he=e=>{const t=e?parseFloat(e.target.value):NaN,a=isNaN(t)?rt.value:t;v.value&&!isNaN(a)&&(v.value.currentTime=a,s.value.currentTime=a),le.value=!1},nt=()=>{le.value&&he()},ot=()=>{H.value=!1},ct=()=>{const e=v.value;if(!e||!e.duration||e.duration<=0||!e.buffered||e.buffered.length===0){de.value=0;return}try{de.value=e.buffered.end(e.buffered.length-1)}catch{de.value=0}},ze=()=>{ct()},ut=e=>{const t=e.currentTarget,a=s.value.duration||0;if(!t||!a)return;const r=t.getBoundingClientRect();if(!r.width)return;const i=(e.clientX-r.left)/r.width,d=Math.max(0,Math.min(a,i*a));v.value&&(v.value.currentTime=d),s.value.currentTime=d},ce=e=>{if(!e||isNaN(e))return"0:00";const t=Math.floor(e/60),a=Math.floor(e%60);return`${t}:${a.toString().padStart(2,"0")}`};let ue=null;const dt=()=>{ue==null&&(ue=window.setInterval(te,3e3))},vt=()=>{ue!=null&&(window.clearInterval(ue),ue=null)};return Bt(()=>{const e=document.getElementById("flatnas-global-audio");e?(xe.value=!0,v.value=e,e.addEventListener("timeupdate",Me),e.addEventListener("ended",Se),e.addEventListener("play",Ne),e.addEventListener("pause",Ee),e.addEventListener("progress",ze),e.addEventListener("error",Oe),e.paused||(s.value.isPlaying=!0,s.value.currentTime=e.currentTime,U.activeMusicPlayer="music-widget")):v.value=We.value,D(),et(),A.value&&(te(),dt()),(He.value||ke.value)&&(Pe(),!A.value&&U.appConfig.autoPlayMusic&&Ze()),!xe.value&&!A.value&&Et().then(t=>{t||!He.value&&ke.value}),window.addEventListener("click",ot),window.addEventListener("pointerup",nt)}),Y(()=>s.value.currentTime,()=>{jt()}),Y([()=>s.value.currentTrackId,()=>s.value.volume,()=>s.value.playbackMode,()=>s.value.isPlaying,m,j,h,w],()=>{Nt()}),Dt(()=>{if(vt(),xe.value){const e=v.value;e&&(e.removeEventListener("timeupdate",Me),e.removeEventListener("ended",Se),e.removeEventListener("play",Ne),e.removeEventListener("pause",Ee),e.removeEventListener("progress",ze),e.removeEventListener("error",Oe))}else ve();window.removeEventListener("click",ot),window.removeEventListener("pointerup",nt)}),Y(A,e=>{e?(te(),dt()):vt()}),(e,t)=>(o(),n("div",{class:"w-full h-full backdrop-blur-md border border-white/20 rounded-2xl flex flex-col overflow-hidden shadow-lg hover:shadow-xl transition-all group relative",style:O({backgroundColor:`rgba(255, 255, 255, ${(Z.widget.opacity??.1)*.4})`})},[F.value?(o(),n("div",{key:0,class:"absolute inset-0 bg-cover bg-center transition-all duration-700 blur-md opacity-80 pointer-events-none",style:O({backgroundImage:`url('${F.value}')`})},null,4)):(o(),n("div",Ht)),l("audio",{ref_key:"localAudioRef",ref:We,onTimeupdate:Me,onEnded:Se,onPlay:Ne,onPause:Ee,onProgress:ze,onError:Oe,crossorigin:"anonymous"},null,544),Z.widget.colSpan===1&&Z.widget.rowSpan===1?(o(),n("div",Gt,[l("div",{class:I(["aplayer aplayer-mini",{"aplayer-withlist":$e.value}])},[l("div",Kt,[l("div",Qt,[l("button",{class:"aplayer-pic-btn",onClick:T(pe,["stop"]),title:s.value.isPlaying?"ÊöÇÂÅú":"Êí≠Êîæ",style:O(F.value?{backgroundImage:`url('${F.value}')`}:void 0)},[l("span",{class:I(["aplayer-pic-icon",{"is-playing":s.value.isPlaying}])},c(s.value.isPlaying?Ve:De),3)],12,Xt)]),l("div",Yt,[l("div",Zt,[l("span",{class:I(["aplayer-title",{"aplayer-marquee":(C.value?.title||"").length>15}])},[me(c(C.value?.title||"ÈÄâÊã©Êí≠Êîæ")+" ",1),(C.value?.title||"").length>15?(o(),n("span",ea,c(C.value?.title),1)):P("",!0)],2)]),l("div",ta,[l("span",{class:I(["aplayer-author",{"aplayer-marquee":z.value.length>20}])},[me(c(z.value)+" ",1),z.value.length>20?(o(),n("span",aa,c(z.value),1)):P("",!0)],2)]),k.value?(o(),n("div",{key:0,class:"text-xs text-red-400 mt-0.5 truncate",title:k.value},c(k.value),9,la)):P("",!0),l("div",sa,[l("div",ia,[l("button",{class:"aplayer-btn",onClick:T(Ae,["stop"]),title:"‰∏ä‰∏ÄÈ¶ñ"},c(Be)),l("button",{class:"aplayer-btn",onClick:t[0]||(t[0]=T(a=>ye(),["stop"])),title:"‰∏ã‰∏ÄÈ¶ñ"},c(Fe))]),l("div",ra,[l("button",{class:"aplayer-btn",onClick:T(Ce,["stop"]),title:s.value.playbackMode==="random"?"ÈöèÊú∫Êí≠Êîæ":s.value.playbackMode==="single"?"ÂçïÊõ≤Âæ™ÁéØ":"È°∫Â∫èÊí≠Êîæ"},c(s.value.playbackMode==="random"?ht:s.value.playbackMode==="single"?mt:yt),9,na),l("div",oa,[l("button",{class:"aplayer-btn",onClick:t[1]||(t[1]=T(a=>H.value=!H.value,["stop"])),title:"Èü≥Èáè"},[...t[14]||(t[14]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"},[l("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})],-1)])]),ge(l("div",{class:"aplayer-volume-panel",onClick:t[2]||(t[2]=T(()=>{},["stop"]))},[l("input",{type:"range",min:"0",max:"1",step:"0.05",value:s.value.volume,onInput:je,class:"aplayer-volume-slider"},null,40,ca)],512),[[Re,H.value]])])])]),l("div",ua,[l("div",{class:"aplayer-bar-wrap",onClick:T(ut,["stop"])},[l("div",da,[l("div",{class:"aplayer-loaded",style:O({width:`${Qe.value}%`})},null,4),l("div",{class:"aplayer-played",style:O({width:`${Ke.value}%`})},[...t[15]||(t[15]=[l("span",{class:"aplayer-thumb"},null,-1)])],4),l("input",{class:"aplayer-seek",type:"range",min:0,max:s.value.duration||0,value:s.value.currentTime,disabled:!s.value.duration,step:"0.1",onInput:Le,onChange:he},null,40,va)])]),l("span",fa,c(ce(s.value.currentTime)),1)])])])],2)])):Z.widget.colSpan===1&&Z.widget.rowSpan===3?(o(),n("div",pa,[l("div",{class:I(["aplayer aplayer-mini is-tall",{"aplayer-withlist":$e.value}])},[l("div",ya,[l("div",ha,[l("button",{class:"aplayer-pic-btn",onClick:T(pe,["stop"]),title:s.value.isPlaying?"ÊöÇÂÅú":"Êí≠Êîæ",style:O(F.value?{backgroundImage:`url('${F.value}')`}:void 0)},[l("span",{class:I(["aplayer-pic-icon",{"is-playing":s.value.isPlaying}])},c(s.value.isPlaying?Ve:De),3)],12,ma)]),l("div",ga,[l("div",ba,[l("span",{class:I(["aplayer-title",{"aplayer-marquee":(C.value?.title||"").length>15}])},[me(c(C.value?.title||"ÈÄâÊã©Êí≠Êîæ")+" ",1),(C.value?.title||"").length>15?(o(),n("span",wa,c(C.value?.title),1)):P("",!0)],2)]),l("div",xa,[l("span",{class:I(["aplayer-author",{"aplayer-marquee":z.value.length>20}])},[me(c(z.value)+" ",1),z.value.length>20?(o(),n("span",ka,c(z.value),1)):P("",!0)],2)]),l("div",_a,[l("div",Ta,[l("button",{class:"aplayer-btn",onClick:T(Ae,["stop"]),title:"‰∏ä‰∏ÄÈ¶ñ"},c(Be)),l("button",{class:"aplayer-btn",onClick:t[3]||(t[3]=T(a=>ye(),["stop"])),title:"‰∏ã‰∏ÄÈ¶ñ"},c(Fe))]),l("div",$a,[l("button",{class:"aplayer-btn",onClick:T(Ce,["stop"]),title:s.value.playbackMode==="random"?"ÈöèÊú∫Êí≠Êîæ":s.value.playbackMode==="single"?"ÂçïÊõ≤Âæ™ÁéØ":"È°∫Â∫èÊí≠Êîæ"},c(s.value.playbackMode==="random"?ht:s.value.playbackMode==="single"?mt:yt),9,Ia),l("div",Pa,[l("button",{class:"aplayer-btn",onClick:t[4]||(t[4]=T(a=>H.value=!H.value,["stop"])),title:"Èü≥Èáè"},[...t[16]||(t[16]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"},[l("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})],-1)])]),ge(l("div",{class:"aplayer-volume-panel",onClick:t[5]||(t[5]=T(()=>{},["stop"]))},[l("input",{type:"range",min:"0",max:"1",step:"0.05",value:s.value.volume,onInput:je,class:"aplayer-volume-slider"},null,40,Ua)],512),[[Re,H.value]])])])]),l("div",Ca,[l("div",{class:"aplayer-bar-wrap",onClick:T(ut,["stop"])},[l("div",Aa,[l("div",{class:"aplayer-loaded",style:O({width:`${Qe.value}%`})},null,4),l("div",{class:"aplayer-played",style:O({width:`${Ke.value}%`})},[...t[17]||(t[17]=[l("span",{class:"aplayer-thumb"},null,-1)])],4),l("input",{class:"aplayer-seek",type:"range",min:0,max:s.value.duration||0,value:s.value.currentTime,disabled:!s.value.duration,step:"0.1",onInput:Le,onChange:he},null,40,Ma)])]),l("span",Sa,c(ce(s.value.currentTime)),1)])])]),ge(l("div",{class:"aplayer-list",onClick:t[6]||(t[6]=T(()=>{},["stop"]))},[l("div",ja,[_e.value?(o(),n("div",Na,"Âä†ËΩΩ‰∏≠...")):re.value?(o(),n("div",Ea,c(re.value),1)):(o(),n("div",Oa," Â∑≤Âä†ËΩΩÂÖ®ÈÉ®Ê≠åÊõ≤Ôºà"+c(W.value.length)+"Ôºâ ",1))])],512),[[Re,$e.value]])],2)])):(o(),n("div",La,[l("div",za,[l("div",Ra,[l("div",Ba,[l("div",Fa,[F.value?(o(),n("img",{key:0,src:F.value,class:"w-full h-full object-cover"},null,8,Da)):(o(),n("img",Va))]),l("div",qa,[l("div",Ja,c(C.value?.title||"ÈÅìÁêÜÈ±ºÈü≥‰πê"),1),l("div",Wa,c(z.value||(C.value?"":"Êú™Êí≠Êîæ")),1)]),l("button",{onClick:Ce,class:"absolute bottom-1 right-2 flex items-center justify-center text-[12px] scale-[1.8] transition-all duration-200 ease-out text-white/50 hover:text-white/90",title:s.value.playbackMode==="random"?"ÈöèÊú∫Êí≠Êîæ":s.value.playbackMode==="single"?"Âæ™ÁéØÊí≠Êîæ":"È°∫Â∫èÊí≠Êîæ"},c(s.value.playbackMode==="random"?"‚•Æ":s.value.playbackMode==="single"?"‚ü≥":"‚áâ"),9,Ha)]),l("div",Ga,[l("div",Ka,[l("span",Qa,c(ce(s.value.currentTime)),1),l("input",{type:"range",max:s.value.duration||100,value:s.value.currentTime,onInput:Le,onChange:he,class:"flex-1 h-1 bg-white/20 rounded-lg appearance-none cursor-pointer accent-blue-400 min-w-0"},null,40,Xa),l("span",Ya,c(ce(s.value.duration)),1)])])]),l("div",Za,[l("div",el,[(o(),n(V,null,q(["songs","artists","albums"],a=>l("button",{key:a,onClick:r=>Pt(a),class:I(["px-2 py-0.5 text-[10px] rounded whitespace-nowrap transition-colors",m.value===a?"bg-blue-500 text-white shadow-sm":"bg-white/10 text-white/60 hover:bg-white/20"])},c(Ut(a)),11,tl)),64))]),m.value==="playlists"?ge((o(),n("select",{key:0,"onUpdate:modelValue":t[7]||(t[7]=a=>j.value=a),onChange:D,class:"w-full bg-black/20 text-white/90 text-xs rounded px-2 py-1 outline-none border border-white/10 focus:border-blue-500/50 hover:bg-black/30 transition-colors"},[t[18]||(t[18]=l("option",{value:null,class:"text-black"},"ËØ∑ÈÄâÊã©Ê≠åÂçï...",-1)),(o(!0),n(V,null,q(we.value,a=>(o(),n("option",{key:a.id,value:a.id,class:"text-black"},c(a.name),9,al))),128))],544)),[[Vt,j.value]]):P("",!0)]),l("div",{class:"flex-1 overflow-y-auto overflow-x-hidden custom-scrollbar",onWheel:t[10]||(t[10]=T(()=>{},["stop"]))},[ee.value?(o(),n("div",ll,"Âä†ËΩΩ‰∏≠...")):k.value?(o(),n("div",sl,c(k.value),1)):(o(),n("div",il,[m.value==="artists"&&!h.value?(o(),n("div",rl,[(o(!0),n(V,null,q(L.value,a=>(o(),n("div",{key:a.id,onClick:r=>Ct(a.id),class:"flex flex-col items-center gap-1 cursor-pointer group hover:bg-white/5 p-2 rounded-lg transition-colors"},[l("div",ol,[a.coverUrl?(o(),n("img",{key:0,src:be(U).getAssetUrl(a.coverUrl),class:"w-full h-full object-cover"},null,8,cl)):(o(),n("div",ul," üë§ "))]),l("span",dl,c(a.name),1)],8,nl))),128))])):m.value==="albums"&&!w.value?(o(),n("div",vl,[(o(!0),n(V,null,q(B.value,a=>(o(),n("div",{key:a.id,onClick:r=>At(a.id),class:"flex flex-col items-center gap-1 cursor-pointer group hover:bg-white/5 p-2 rounded-lg transition-colors"},[l("div",pl,[a.coverUrl?(o(),n("img",{key:0,src:be(U).getAssetUrl(a.coverUrl),class:"w-full h-full object-cover"},null,8,yl)):(o(),n("div",hl," üíø "))]),l("span",ml,c(a.title),1)],8,fl))),128))])):(o(),n("div",gl,[m.value==="artists"&&h.value?(o(),n("div",bl,[l("button",{onClick:t[8]||(t[8]=a=>h.value=null),class:"w-5 h-5 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center text-white/80 transition-colors text-xs",title:"ËøîÂõû"}," ‚Üê "),l("div",wl,[L.value.find(a=>a.id===h.value)?.coverUrl?(o(),n("img",{key:0,src:be(U).getAssetUrl(L.value.find(a=>a.id===h.value)?.coverUrl),class:"w-5 h-5 rounded-full object-cover border border-white/10"},null,8,xl)):P("",!0),l("span",kl,c(L.value.find(a=>a.id===h.value)?.name||"Ëâ∫‰∫∫Ê≠åÂçï"),1)]),l("button",{onClick:Xe,class:"text-[10px] bg-blue-500 hover:bg-blue-600 text-white px-2 py-0.5 rounded shadow-sm transition-colors"}," Êí≠ÊîæÂÖ®ÈÉ® ")])):P("",!0),m.value==="albums"&&w.value?(o(),n("div",_l,[l("button",{onClick:t[9]||(t[9]=a=>w.value=null),class:"w-5 h-5 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center text-white/80 transition-colors text-xs",title:"ËøîÂõû"}," ‚Üê "),l("div",Tl,[B.value.find(a=>a.id===w.value)?.coverUrl?(o(),n("img",{key:0,src:be(U).getAssetUrl(B.value.find(a=>a.id===w.value)?.coverUrl),class:"w-5 h-5 rounded object-cover border border-white/10"},null,8,$l)):P("",!0),l("span",Il,c(B.value.find(a=>a.id===w.value)?.title||"‰∏ìËæëÊ≠åÂçï"),1)]),l("button",{onClick:Xe,class:"text-[10px] bg-blue-500 hover:bg-blue-600 text-white px-2 py-0.5 rounded shadow-sm transition-colors"}," Êí≠ÊîæÂÖ®ÈÉ® ")])):P("",!0),(o(!0),n(V,null,q(u.value,(a,r)=>(o(),n("div",{key:a.id,onClick:i=>R(a),class:I(["px-3 py-0.5 hover:bg-white/10 cursor-pointer flex items-center gap-1.5 transition-colors group/item",{"bg-blue-500/20":C.value?.id===a.id}])},[l("div",Ul,[C.value?.id===a.id&&s.value.isPlaying?(o(),n("span",Cl,[...t[19]||(t[19]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-3.5 h-3.5 inline-block"},[l("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})],-1)])])):(o(),n("span",Al,c(r+1),1))]),l("div",Ml,[l("div",{class:I(["text-xs font-medium text-white/90 truncate",{"text-blue-400":C.value?.id===a.id}])},c(a.title),3),l("div",Sl,c(a.artist),1)]),l("div",jl,c(ce(a.duration||0)),1)],10,Pl))),128))]))]))],32)]),l("div",{class:"w-[61.8%] flex flex-col bg-black/10 h-full relative",onWheel:t[13]||(t[13]=T(()=>{},["stop"]))},[l("div",{class:I(["absolute top-4 right-4 z-30 transition-opacity duration-300",[ie.value?"opacity-100":"opacity-0 group-hover:opacity-100"]])},[l("button",{onClick:t[11]||(t[11]=a=>ie.value=!ie.value),class:"w-8 h-8 rounded-full bg-black/40 backdrop-blur-md flex items-center justify-center text-white/70 hover:text-white hover:bg-black/60 transition-all border border-white/10",title:"ÂàáÊç¢Êí≠ÊîæÊïàÊûú"},c(Je.find(a=>a.id===J.value)?.icon||"üé®"),1),ie.value?(o(),n("div",Nl,[(o(),n(V,null,q(Je,a=>l("button",{key:a.id,onClick:r=>gt(a.id),class:I(["w-full px-4 py-2.5 text-left text-xs flex items-center gap-3 transition-colors hover:bg-white/10",J.value===a.id?"text-blue-400 font-bold bg-white/5":"text-white/70"])},[l("span",Ol,c(a.icon),1),l("span",null,c(a.label),1)],10,El)),64))])):P("",!0)],2),J.value==="lyrics"?(o(),n("div",{key:0,ref_key:"lyricsContainer",ref:Ue,class:"flex-1 overflow-y-auto overflow-x-hidden custom-scrollbar p-4 text-center scroll-smooth"},[$.value.length>0?(o(),n("div",Ll,[(o(!0),n(V,null,q($.value,(a,r)=>(o(),n("div",{key:r,class:I(["transition-all duration-500 py-2 text-sm leading-relaxed tracking-wide origin-center break-words",r===_.value?"text-white font-bold scale-[1.5] opacity-100":r===_.value+1?"text-white/90 font-bold scale-[1.3] opacity-90":r<_.value?"text-white/80 font-bold scale-[1.1] opacity-80":"text-white/35 opacity-50"]),ref_for:!0,ref:i=>{r===_.value&&(lt.value=i)}},c(a.text),3))),128))])):s.value.lyrics?(o(),n("div",zl,c(s.value.lyrics),1)):(o(),n("div",Rl,[...t[20]||(t[20]=[l("span",{class:"text-2xl opacity-50"},"üìù",-1),l("span",{class:"text-xs"},"ÊöÇÊó†Ê≠åËØç",-1)])]))],512)):J.value==="spectrum"?(o(),n("div",Bl,[l("div",Fl,[l("div",Dl,[(o(),n(V,null,q(12,a=>l("div",{key:a,class:"w-1.5 bg-gradient-to-t from-blue-600/40 to-blue-400/80 rounded-t-sm animate-pulse",style:O({height:`${20+Math.random()*80}%`,animationDuration:`${.5+Math.random()*1}s`})},null,4)),64))]),l("div",Vl,[$.value.length>0&&_.value>=0?(o(),n("div",ql,[l("div",Jl,c($.value[_.value]?.text),1),$.value[_.value+1]?(o(),n("div",Wl,c($.value[_.value+1]?.text),1)):P("",!0)])):(o(),n("div",Hl,[...t[21]||(t[21]=[l("span",{class:"text-xs font-medium text-white/60"},"È¢ëË∞±ÂàÜÊûê",-1),l("span",{class:"text-[10px] opacity-50"},"Spectrum Analyzer",-1)])]))])])])):J.value==="abstract"?(o(),n("div",Gl,[t[23]||(t[23]=qt('<div class="relative w-40 h-40 flex items-center justify-center" data-v-f6159805><div class="absolute inset-0 rounded-full border border-blue-500/20 animate-[ping_3s_linear_infinite]" data-v-f6159805></div><div class="absolute inset-4 rounded-full border border-purple-500/20 animate-[ping_2s_linear_infinite]" data-v-f6159805></div><div class="absolute inset-8 rounded-full border border-pink-500/20 animate-pulse" data-v-f6159805></div><div class="z-10 text-3xl animate-bounce" data-v-f6159805>‚ú®</div></div>',1)),l("div",Kl,[$.value.length>0&&_.value>=0?(o(),n("div",Ql,[l("div",Xl,c($.value[_.value]?.text),1),$.value[_.value+1]?(o(),n("div",Yl,c($.value[_.value+1]?.text),1)):P("",!0)])):(o(),n("div",Zl,[...t[22]||(t[22]=[l("span",{class:"text-xs font-medium text-white/60"},"ÊäΩË±°Âä®Áîª",-1),l("span",{class:"text-[10px] opacity-50"},"Abstract Visualizations",-1)])]))])])):J.value==="vinyl"?(o(),n("div",es,[l("div",ts,[l("div",{class:I(["w-56 h-56 rounded-full bg-[#111] border-[6px] border-[#222] shadow-[0_0_50px_rgba(0,0,0,0.8)] flex items-center justify-center relative overflow-hidden",{"animate-[spin_10s_linear_infinite]":s.value.isPlaying}])},[t[24]||(t[24]=l("div",{class:"absolute inset-0 opacity-30",style:{background:`repeating-radial-gradient(
                      circle,
                      transparent 0,
                      transparent 3px,
                      rgba(255, 255, 255, 0.05) 4px,
                      transparent 5px
                    )`}},null,-1)),l("div",as,[ae.value?.coverUrl?(o(),n("img",{key:0,src:at(ae.value),class:"w-full h-full object-cover"},null,8,ls)):(o(),n("div",ss," üíø "))]),t[25]||(t[25]=l("div",{class:"absolute w-2 h-2 bg-black rounded-full z-20 shadow-inner"},null,-1))],2),l("div",{class:"absolute -top-6 -right-4 w-32 h-32 pointer-events-none transition-transform duration-700 ease-in-out origin-[85%_15%]",style:O({transform:s.value.isPlaying?"rotate(0deg)":"rotate(-25deg)"})},[...t[26]||(t[26]=[l("div",{class:"absolute top-[15%] right-[15%] w-4 h-4 bg-zinc-600 rounded-full"},null,-1),l("div",{class:"absolute top-[18%] right-[17%] w-1.5 h-24 bg-gradient-to-b from-zinc-500 to-zinc-700 rounded-full origin-top rotate-[25deg]"},null,-1),l("div",{class:"absolute bottom-[15%] left-[10%] w-4 h-6 bg-zinc-800 rounded-sm rotate-[25deg]"},null,-1)])],4)]),l("div",is,[$.value.length>0&&_.value>=0?(o(),n("div",rs,[l("div",ns,c($.value[_.value]?.text),1),$.value[_.value+1]?(o(),n("div",os,c($.value[_.value+1]?.text),1)):P("",!0)])):(o(),n("div",cs,[...t[27]||(t[27]=[l("span",{class:"text-xs font-medium text-white/60"},"Â∞ÅÈù¢‰∏éÈªëËÉ∂",-1),l("span",{class:"text-[10px] opacity-50"},"Cover Art & Vinyl",-1)])]))])])):P("",!0),l("div",us,[l("div",ds,[l("div",vs,[l("button",{onClick:Ae,class:"w-7 h-7 rounded-full flex items-center justify-center bg-white/5 hover:bg-white/10 transition-colors text-white/70"},c(Be)),l("button",{onClick:pe,class:"w-8 h-8 rounded-full flex items-center justify-center bg-white/10 hover:bg-white/20 transition-colors text-white scale-[1.3] transition-transform"},c(s.value.isPlaying?Ve:De),1),l("button",{onClick:t[12]||(t[12]=()=>ye()),class:"w-7 h-7 rounded-full flex items-center justify-center bg-white/5 hover:bg-white/10 transition-colors text-white/70"},c(Fe))]),l("div",fs,[t[28]||(t[28]=l("span",{class:"text-xs text-white/70"},[l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-4 h-4"},[l("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})])],-1)),l("input",{type:"range",min:"0",max:"1",step:"0.05",value:s.value.volume,onInput:je,class:"w-20 h-1 bg-white/20 rounded-lg appearance-none cursor-pointer accent-blue-400"},null,40,ps)])])])],32)]))],4))}}),gs=Jt(ys,[["__scopeId","data-v-f6159805"]]);export{gs as default};
