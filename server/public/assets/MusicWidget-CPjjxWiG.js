import{d as Lt,u as zt,r as y,w as Z,c as E,x as Rt,y as Bt,J as Ft,o as Dt,a as n,e as o,g as l,q as z,f as T,p as C,t as c,b as A,j as me,l as ge,I as Be,F as J,h as W,D as Vt,i as be,G as qt,_ as Jt}from"./index-BKCwBmTe.js";import{_ as Wt}from"./daoliyu-CAYE7_Pg.js";const Ht={key:1,class:"absolute inset-0 bg-white/5 transition-all pointer-events-none"},Gt={key:2,class:"w-full h-full relative z-10"},Kt={class:"aplayer-body"},Qt={class:"aplayer-pic"},Xt=["title"],Yt={class:"aplayer-info"},Zt={class:"aplayer-music-text-wrap"},ea={key:0,class:"ml-8"},ta={class:"aplayer-music-text-wrap"},aa={key:0,class:"ml-8"},la=["title"],sa={class:"aplayer-time-main"},ia={class:"aplayer-controls"},ra={class:"aplayer-right"},na=["title"],oa={class:"aplayer-volume"},ca=["value"],ua={class:"aplayer-bar-container"},da={class:"aplayer-bar"},va=["max","value","disabled"],pa={class:"aplayer-ptime"},fa={key:3,class:"w-full h-full relative z-10"},ya={class:"aplayer-body"},ha={class:"aplayer-pic"},ma=["title"],ga={class:"aplayer-info"},ba={class:"aplayer-music-text-wrap"},wa={key:0,class:"ml-8"},xa={class:"aplayer-music-text-wrap"},ka={key:0,class:"ml-8"},_a={class:"aplayer-time-main"},Ta={class:"aplayer-controls"},$a={class:"aplayer-right"},Ia=["title"],Pa={class:"aplayer-volume"},Ua=["value"],Ca={class:"aplayer-bar-container"},Aa={class:"aplayer-bar"},Ma=["max","value","disabled"],Sa={class:"aplayer-ptime"},ja={class:"aplayer-list-body"},Na={key:0,class:"aplayer-list-state"},Ea={key:1,class:"aplayer-list-state is-error"},Oa={key:2,class:"aplayer-list-state"},La={key:4,class:"flex h-full relative z-10"},za={class:"flex flex-col min-w-0 transition-all duration-300 w-[39.2%] border-r border-white/10"},Ra={class:"border-b border-white/10 bg-white/5 flex flex-col shrink-0"},Ba={class:"p-3 flex gap-1.5 items-center relative"},Fa={class:"w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center overflow-hidden shadow-sm shrink-0"},Da=["src"],Va={key:1,src:Wt,class:"w-6 h-6 object-contain opacity-50"},qa={class:"flex-1 min-w-0 flex flex-col"},Ja={class:"font-bold text-white truncate text-sm leading-tight"},Wa={class:"text-xs text-white/60 truncate leading-tight"},Ha=["title"],Ga={class:"px-1 pb-2"},Ka={class:"flex items-center gap-1 text-[12px] text-white/70"},Qa={class:"tabular-nums w-9 text-right"},Xa=["max","value"],Ya={class:"tabular-nums w-9"},Za={class:"px-3 py-1.5 border-b border-white/10 bg-white/5 flex flex-col gap-1.5"},el={class:"flex gap-1 overflow-x-auto custom-scrollbar pb-0.5"},tl=["onClick"],al=["value"],ll={key:0,class:"p-4 text-center text-xs text-white/40"},sl={key:1,class:"p-4 text-center text-xs text-red-400"},il={key:2},rl={key:0,class:"grid grid-cols-3 gap-2 p-2"},nl=["onClick"],ol={class:"w-14 h-14 rounded-full overflow-hidden bg-white/10 shadow-sm group-hover:scale-105 transition-transform border border-white/5"},cl=["src"],ul={key:1,class:"w-full h-full flex items-center justify-center text-2xl opacity-50"},dl={class:"text-[10px] text-white/80 text-center truncate w-full"},vl={key:1,class:"grid grid-cols-3 gap-2 p-2"},pl=["onClick"],fl={class:"w-14 h-14 rounded overflow-hidden bg-white/10 shadow-sm group-hover:scale-105 transition-transform border border-white/5"},yl=["src"],hl={key:1,class:"w-full h-full flex items-center justify-center text-2xl opacity-50"},ml={class:"text-[10px] text-white/80 text-center truncate w-full"},gl={key:2},bl={key:0,class:"sticky top-0 z-10 bg-black/40 backdrop-blur-md border-b border-white/10 px-3 py-2 flex items-center gap-2 mb-1"},wl={class:"flex items-center gap-2 overflow-hidden flex-1"},xl=["src"],kl={class:"text-xs font-bold text-white truncate"},_l={key:1,class:"sticky top-0 z-10 bg-black/40 backdrop-blur-md border-b border-white/10 px-3 py-2 flex items-center gap-2 mb-1"},Tl={class:"flex items-center gap-2 overflow-hidden flex-1"},$l=["src"],Il={class:"text-xs font-bold text-white truncate"},Pl=["onClick"],Ul={class:"text-xs text-white/40 w-4 text-center"},Cl={key:0,class:"animate-pulse text-blue-400"},Al={key:1},Ml={class:"flex-1 min-w-0"},Sl={class:"text-[10px] text-white/50 truncate"},jl={class:"text-[10px] text-white/40 opacity-0 group-hover/item:opacity-100 transition-opacity"},Nl={key:0,class:"absolute right-0 mt-2 w-40 bg-black/80 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl py-1 z-40 overflow-hidden"},El=["onClick"],Ol={class:"text-sm"},Ll={key:0,class:"pt-[40%] pb-[60%]"},zl={key:1,class:"text-xs text-white/90 whitespace-pre-line leading-7 font-medium tracking-wide"},Rl={key:2,class:"h-full flex flex-col items-center justify-center text-white/40 gap-2"},Bl={key:1,class:"flex-1 flex flex-col items-center justify-center p-4"},Fl={class:"text-white/40 flex flex-col items-center gap-6"},Dl={class:"flex items-end gap-1.5 h-20"},Vl={class:"flex flex-col items-center gap-2 w-full max-w-[80%]"},ql={key:0,class:"flex flex-col items-center gap-2"},Jl={class:"text-sm font-bold text-white text-center drop-shadow-md"},Wl={key:0,class:"text-[11px] text-white/40 text-center line-clamp-1 italic"},Hl={key:1,class:"flex flex-col items-center gap-1"},Gl={key:2,class:"flex-1 flex flex-col items-center justify-center p-4 overflow-hidden"},Kl={class:"flex flex-col items-center gap-2 mt-8 w-full max-w-[80%]"},Ql={key:0,class:"flex flex-col items-center gap-2"},Xl={class:"text-sm font-bold text-white text-center drop-shadow-md"},Yl={key:0,class:"text-[11px] text-white/40 text-center line-clamp-1 italic"},Zl={key:1,class:"flex flex-col items-center gap-1"},es={key:3,class:"flex-1 flex flex-col items-center justify-center p-4"},ts={class:"relative group mt-[-20px] scale-[1.1]"},as={class:"w-20 h-20 rounded-full overflow-hidden border-4 border-[#111] z-10 shadow-inner"},ls=["src"],ss={key:1,class:"w-full h-full bg-zinc-800 flex items-center justify-center text-white/20"},is={class:"flex flex-col items-center gap-2 mt-12 w-full max-w-[80%]"},rs={key:0,class:"flex flex-col items-center gap-2"},ns={class:"text-sm font-bold text-white text-center drop-shadow-md"},os={key:0,class:"text-[11px] text-white/40 text-center line-clamp-1 italic"},cs={key:1,class:"flex flex-col items-center gap-1"},us={class:"absolute left-1/2 -translate-x-1/2 bottom-3 z-20 max-w-[calc(100vw-2rem)]"},ds={class:"bg-black/40 backdrop-blur-md rounded-xl px-4 py-2 shadow-lg flex items-center gap-6 w-fit min-w-[280px] max-w-[calc(100vw-2rem)] transition-all opacity-0 group-hover:opacity-100 duration-300"},vs={class:"flex items-center justify-center gap-4 shrink-0"},ps={class:"flex items-center gap-2 shrink-0 border-l border-white/10 pl-6"},fs=["value"],Fe="‚èÆÔ∏é",De="‚è≠Ô∏é",Ve="‚ñ∂Ô∏é",qe="‚è∏Ô∏é",pt="üîÅÔ∏é",ft="üîÄÔ∏é",yt="üîÇÔ∏é",ys=Lt({__name:"MusicWidget",props:{widget:{}},setup(ee){const g=ee,M=zt(),d=y([]),we=y([]),R=y([]),D=y([]),b=y("songs"),H=y("lyrics"),ie=y(!1),Je=[{id:"lyrics",label:"Ê≠åËØç",icon:"üìù"},{id:"spectrum",label:"È¢ëË∞±ÂàÜÊûê",icon:"üìä"},{id:"abstract",label:"ÊäΩË±°Âä®Áîª",icon:"‚ú®"},{id:"vinyl",label:"Â∞ÅÈù¢‰∏éÈªëËÉ∂",icon:"üíø"}],ht=e=>{H.value=e,ie.value=!1},j=y(null),h=y(null),x=y(null),s=y({isPlaying:!1,currentTime:0,duration:0,volume:.7,currentTrackId:null,playbackMode:"sequence"});Z(()=>M.activeMusicPlayer,e=>{e!=="music-widget"&&s.value.isPlaying&&(p.value&&p.value.pause(),s.value.isPlaying=!1)});const p=y(null),We=y(null),xe=y(!1),te=y(!1),$=y(""),N=E(()=>g.widget.data?.syncPlayerState===!0),He=E(()=>g.widget.colSpan===1&&g.widget.rowSpan===1),ke=E(()=>g.widget.colSpan===1&&g.widget.rowSpan===3),G=y([]),_e=y(!1),re=y(""),Ge=y(!1),K=y(!1),ve=y(0),ne=y(null),Te=y(null),$e=E(()=>ke.value?!0:Ge.value),V=E(()=>{if(le.value)return tt(le.value);if(b.value==="artists"&&h.value){const e=R.value.find(t=>t.id===h.value);return M.getAssetUrl(e?.coverUrl)}}),Ke=E(()=>{const e=s.value.duration||0;return e?Math.max(0,Math.min(100,s.value.currentTime/e*100)):0}),Qe=E(()=>{const e=s.value.duration||0;return e?Math.max(0,Math.min(100,ve.value/e*100)):0}),v=E(()=>{let e=g.widget.data?.apiUrl||"/api";return e=e.replace(/\/$/,""),/\/api(\/v\d+)?$/.test(e)||(e+="/api"),e}),w=()=>{const e={};return g.widget.data?.token&&(e.Authorization=`Bearer ${g.widget.data.token}`),e},Ie=async()=>{if(!(!g.widget.data?.username||!g.widget.data?.password))try{const e=await fetch(`${v.value}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:g.widget.data.username,password:g.widget.data.password})});if(e.ok){const t=await e.json();if(t.token){const a=M.widgets.find(i=>i.id===g.widget.id);a&&a.data&&(a.data.token=t.token,M.saveData()),mt()}}}catch(e){console.error("Login failed",e)}},mt=async()=>{try{const e=await fetch(`${v.value}/auth/me`,{headers:w()});if(e.ok){const t=await e.json();console.log("User profile:",t)}}catch(e){console.error("Fetch profile failed",e)}},ae=async()=>{try{const e=await fetch(`${v.value}/player`,{headers:w()});if(e.ok){const t=await e.json();s.value.isPlaying=t.isPlaying,se.value||(s.value.currentTime=t.progress||t.currentTime||0),s.value.volume=t.volume??.7,s.value.currentTrackId=t.currentTrack?.id||t.currentTrackId,(t.lyrics||t.currentTrack?.lyrics)&&(s.value.lyrics=t.lyrics||t.currentTrack?.lyrics),t.queue&&Array.isArray(t.queue)&&(d.value=t.queue.map(X).filter(Boolean));const a=X(t.currentTrack);a&&!d.value.find(i=>i.id===a.id)&&d.value.push(a),p.value&&(p.value.volume=s.value.volume)}}catch(e){console.error("Fetch player state failed",e)}},Xe=async()=>{if(d.value.length===0){$.value="ÂàóË°®‰∏∫Á©∫ÔºåÊó†Ê≥ïÊí≠Êîæ";return}const e=d.value.map(t=>t.id);te.value=!0,$.value="";try{const t=await fetch(`${v.value}/player/queue`,{method:"PUT",headers:{...w(),"Content-Type":"application/json"},body:JSON.stringify({trackIds:e})});t.ok||console.warn("Queue replace failed",t.status),d.value.length>0&&d.value[0]&&await F(d.value[0]),N.value&&ae()}catch(t){console.error("Play all failed",t),$.value="Êí≠ÊîæÂÖ®ÈÉ®Â§±Ë¥•: "+(t instanceof Error?t.message:String(t))}finally{te.value=!1}},gt=async e=>{try{const t={};e&&(t.trackId=e),await fetch(`${v.value}/player/play`,{method:"POST",headers:{...w(),"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(t){console.error(t)}},bt=async()=>{try{await fetch(`${v.value}/player/pause`,{method:"POST",headers:w()})}catch(e){console.error(e)}},Ye=async()=>{try{await fetch(`${v.value}/player/next`,{method:"POST",headers:w()}),N.value&&ae()}catch(e){console.error(e)}},wt=async()=>{try{await fetch(`${v.value}/player/prev`,{method:"POST",headers:w()}),N.value&&ae()}catch(e){console.error(e)}},xt=async e=>{try{await fetch(`${v.value}/player/volume`,{method:"POST",headers:{...w(),"Content-Type":"application/json"},body:JSON.stringify({volume:e})}),s.value.volume=e}catch(t){console.error(t)}},Q=e=>{if(Array.isArray(e))return e;if(e&&typeof e=="object"){const t=e;if(Array.isArray(t.data))return t.data;if(Array.isArray(t.items))return t.items;if(Array.isArray(t.tracks))return t.tracks;if(Array.isArray(t.songs))return t.songs}return[]},X=e=>{if(!e||typeof e!="object")return null;const t=e,a=t.track&&typeof t.track=="object"?t.track:t,r=(O=>typeof O=="string"?O:typeof O=="number"&&Number.isFinite(O)?String(O):null)(a.id??t.trackId??a.trackId??t.songId??a.songId??t.id),u=typeof a.title=="string"?a.title:typeof a.name=="string"?a.name:typeof a.songName=="string"?a.songName:typeof t.title=="string"?t.title:typeof t.name=="string"?t.name:typeof t.songName=="string"?t.songName:null;if(!r||!u)return null;const f=a.album&&typeof a.album=="object"?a.album:null,I=Array.isArray(a.artists)&&a.artists.length>0?a.artists.map(O=>{if(typeof O=="string")return O;if(O&&typeof O=="object"){const vt=O;if(typeof vt.name=="string")return vt.name}return""}).filter(Boolean).join(", "):typeof a.artist=="string"?a.artist:a.artist&&typeof a.artist=="object"&&typeof a.artist.name=="string"?a.artist.name:typeof a.singer=="string"?a.singer:typeof a.artistName=="string"?a.artistName:typeof t.artistName=="string"?t.artistName:typeof t.singer=="string"?t.singer:void 0,m=a.album&&typeof a.album=="object"&&typeof a.album.title=="string"?a.album.title:typeof a.album=="string"?a.album:typeof a.albumName=="string"?a.albumName:typeof a.albumTitle=="string"?a.albumTitle:typeof t.albumTitle=="string"?t.albumTitle:typeof t.albumName=="string"?t.albumName:void 0,U=typeof a.duration=="number"?a.duration:typeof t.duration=="number"?t.duration:typeof a.length=="number"?a.length:typeof t.length=="number"?t.length:void 0,k=a.cover&&typeof a.cover=="object"?a.cover:t.cover&&typeof t.cover=="object"?t.cover:null,dt=typeof a.coverArtUrl=="string"?a.coverArtUrl:typeof a.coverUrl=="string"?a.coverUrl:f&&typeof f.coverArtUrl=="string"?f.coverArtUrl:f&&typeof f.coverUrl=="string"?f.coverUrl:k&&typeof k.url=="string"?k.url:k&&typeof k.src=="string"?k.src:k&&typeof k.path=="string"?k.path:k&&typeof k.imageUrl=="string"?k.imageUrl:typeof a.imageUrl=="string"?a.imageUrl:typeof a.coverArtPath=="string"?a.coverArtPath:f&&typeof f.coverArtPath=="string"?f.coverArtPath:typeof t.coverArtUrl=="string"?t.coverArtUrl:typeof t.coverUrl=="string"?t.coverUrl:typeof t.imageUrl=="string"?t.imageUrl:void 0,Y=typeof a.coverId=="string"?a.coverId:typeof t.coverId=="string"?t.coverId:void 0,Ot=typeof a.lyrics=="string"?a.lyrics:typeof t.lyrics=="string"?t.lyrics:void 0;return{id:r,title:u,artist:I,album:m,duration:U,coverUrl:dt,coverId:Y,lyrics:Ot}},L=async(e,t)=>{const a=await fetch(e,{...t,headers:{...w()}});return a.status!==401?a:(await Ie(),fetch(e,{...t,headers:{...w()}}))},Pe=async()=>{_e.value=!0,re.value="";try{let e=await L(`${v.value}/songs?take=1000`);if(e.ok||(e=await L(`${v.value}/tracks?take=1000`)),!e.ok)throw new Error(await e.text());const t=await e.json(),i=Q(t).map(X).filter(Boolean);G.value=i}catch(e){G.value=[],re.value=e.message||"Âä†ËΩΩÂ§±Ë¥•"}finally{_e.value=!1}},kt=(e,t)=>{if(!e.length)return;d.value=e;const a=e[0];a&&F(a)},Ze=async()=>{re.value="",G.value.length===0&&await Pe();const e=G.value;e.length&&(kt(e),Ge.value=!1)},et=async()=>{try{let e=await L(`${v.value}/playlists?take=1000`);if(e.ok||(e=await L(`${v.value}/music/playlists?take=1000`)),e.ok){const t=await e.json(),a=Q(t);we.value=a.map(i=>{const r=i;return{id:r.id,name:r.name||r.title||"Êú™ÂëΩÂêçÊ≠åÂçï",coverUrl:pe(r.coverUrl||r.cover)}})}}catch(e){console.error("Fetch playlists failed",e)}},_t=async()=>{try{const e=await L(`${v.value}/library/artists?take=1000`);if(e.ok){const t=await e.json(),a=Q(t);R.value=a.map(i=>{const r=i;return{id:r.id,name:r.name||r.artist||"Unknown Artist",coverUrl:pe(r.coverUrl||r.cover)}})}}catch(e){console.error("Fetch artists failed",e)}},Tt=async()=>{try{const e=await L(`${v.value}/library/albums?take=1000`);if(e.ok){const t=await e.json(),a=Q(t);D.value=a.map(i=>{const r=i;return{id:r.id,title:r.title||r.name||"Unknown Album",artist:r.artist,coverUrl:pe(r.coverUrl||r.cover)}})}}catch(e){console.error("Fetch albums failed",e)}},q=async()=>{!g.widget.data?.token&&g.widget.data?.username&&g.widget.data?.password&&await Ie(),te.value=!0,$.value="";try{let e=`${v.value}/songs?take=1000`;b.value==="playlists"&&j.value?e=`${v.value}/playlists/${j.value}/tracks?take=1000`:b.value==="artists"&&h.value?e=`${v.value}/library/artists/${h.value}/songs?take=1000`:b.value==="albums"&&x.value&&(e=`${v.value}/library/albums/${x.value}`);let t=await fetch(e,{headers:w()});if(!t.ok)if(b.value==="playlists"&&j.value)e=`${v.value}/playlists/${j.value}/songs?take=1000`,t=await fetch(e,{headers:w()});else if(b.value==="artists"&&h.value){if(e=`${v.value}/library/artists/${h.value}/tracks?take=1000`,t=await fetch(e,{headers:w()}),!t.ok){const u=R.value.find(f=>f.id===h.value);u&&u.name&&(e=`${v.value}/tracks?search=${encodeURIComponent(u.name)}&take=1000`,t=await fetch(e,{headers:w()}))}}else if(b.value==="albums"&&x.value){const u=D.value.find(f=>f.id===x.value);u&&u.title&&(e=`${v.value}/tracks?search=${encodeURIComponent(u.title)}&take=1000`,t=await fetch(e,{headers:w()}))}else e.includes("/songs")&&(e=e.replace("/songs","/tracks"),t=await fetch(e,{headers:w()}));if(t.status===401&&(await Ie(),t=await fetch(e,{headers:w()})),!t.ok)throw new Error(`API Error: ${t.status}`);const a=await t.json(),i=Q(a);if(i.length===0&&b.value==="albums"&&x.value){const u=D.value.find(f=>f.id===x.value);if(u&&u.title){const f=`${v.value}/tracks?search=${encodeURIComponent(u.title)}&take=1000`,I=await L(f);if(I.ok){const m=await I.json(),U=Q(m);if(U.length>0){d.value=U.map(X).filter(Boolean),te.value=!1;return}}}}if(d.value=i.map(X).filter(Boolean),d.value.length===0&&!j.value){let u=await fetch(`${v.value}/songs?take=100`,{headers:w()});if(u.ok||(u=await fetch(`${v.value}/tracks?take=100`,{headers:w()})),u.ok){const f=await u.json(),I=Q(f);d.value=I.map(X).filter(Boolean)}}const r=v.value==="/api"||v.value==="/api/";if(d.value.length===0&&!j.value&&r)try{const u=await fetch(`${v.value}/music-list`,{headers:w()});if(u.ok){const f=await u.json();Array.isArray(f)&&(d.value=f.map(I=>({id:I,title:I.split("/").pop()||I,artist:"Unknown Artist",album:"Unknown Album",duration:0,coverUrl:void 0})))}}catch(u){console.error("FlatNas music-list fallback failed",u)}d.value.length===0&&($.value="ÊöÇÊó†Ê≠åÊõ≤ÔºåËØ∑Ê£ÄÊü• API ÈÖçÁΩÆÊàñÊî∂Ëóè")}catch(e){console.error("Fetch tracks failed",e),$.value=`Âä†ËΩΩÂ§±Ë¥•: ${e.message}`,d.value=[]}finally{te.value=!1}},$t=e=>{b.value=e,j.value=null,h.value=null,x.value=null,e==="playlists"&&we.value.length===0&&et(),e==="artists"&&R.value.length===0&&_t(),e==="albums"&&D.value.length===0&&Tt(),e==="songs"?q():d.value=[]},It=e=>({songs:"Ê≠åÊõ≤",playlists:"Ê≠åÂçï",artists:"Ëâ∫‰∫∫",albums:"‰∏ìËæë"})[e]||e,Pt=e=>{h.value=e,q()},Ut=e=>{x.value=e,q()},oe=()=>{ne.value&&(URL.revokeObjectURL(ne.value),ne.value=null,Te.value=null)},Ct=async(e,t=0,a=!0)=>{if(!p.value)return;const i=[`${v.value}/tracks/${encodeURIComponent(e)}/stream`,`${v.value}/songs/${encodeURIComponent(e)}/stream`];let r=null,u=null;for(const m of i){try{r=await L(m)}catch(Y){throw new Error(`ËøûÊé•Â§±Ë¥•: ${Y.message}`)}if(r.ok){u=null;break}const U=await r.text();let k=U;try{const Y=JSON.parse(U);typeof Y.error=="string"?k=Y.error:k=JSON.stringify(Y)}catch{}if(u={status:r.status,detail:k},!(r.status===404||k.includes("TRACK_NOT_FOUND")||k.toLowerCase().includes("not found")))break}if(!r||!r.ok)throw u?new Error(`Stream API Error ${u.status}: ${u.detail}`):new Error("Stream API Error: ËØ∑Ê±ÇÂ§±Ë¥•");const f=r.headers.get("content-type")||"";f&&!f.startsWith("audio/")&&!f.startsWith("application/octet-stream")&&!f.startsWith("video/")&&console.warn(`Unexpected content-type: ${f}`);const I=await r.blob();if(oe(),ne.value=URL.createObjectURL(I),Te.value=e,p.value.src=ne.value,p.value.currentTime=t,a)try{await p.value.play(),$.value=""}catch(m){throw s.value.isPlaying=!1,new Error(`Playback failed: ${m.name} - ${m.message}`)}},ce=y({}),At=async e=>{if(!ce.value[e])try{let t=await L(`${v.value}/tracks/${encodeURIComponent(e)}`);if(t.ok||(t=await L(`${v.value}/songs/${encodeURIComponent(e)}`)),!t.ok)return;const a=await t.json(),i=X(a);if(!i)return;ce.value={...ce.value,[e]:i}}catch{}};Z(()=>s.value.currentTrackId,e=>{e&&At(e)},{immediate:!0});const pe=e=>{if(!e)return;const t=g.widget.data?.token;if(e.startsWith("http")){const r=`${v.value}/proxy-image?url=${encodeURIComponent(e)}`;return t?`${r}&token=${t}`:r}const a=v.value.replace(/\/api(\/v\d+)?$/,""),i=e.startsWith("/")?`${a}${e}`:`${a}/${e}`;return t?`${i}${i.includes("?")?"&":"?"}token=${t}`:i},tt=e=>{const t=g.widget.data?.token,i=ce.value[e.id]?.coverUrl||e.coverUrl;if(!i&&e.id){const r=`${v.value}/subsonic/rest/getCoverArt?id=track:${e.id}`,u=t?`${r}&token=${t}`:r;return M.getAssetUrl(u)}return M.getAssetUrl(pe(i))},S=E(()=>d.value.find(e=>e.id===s.value.currentTrackId)),le=E(()=>{const e=S.value;return e?ce.value[e.id]??e:null});Z(()=>le.value,e=>{e&&e.lyrics!==void 0&&(s.value.lyrics=e.lyrics)},{immediate:!0});const B=E(()=>{const e=le.value;if(!e)return b.value==="artists"&&h.value&&R.value.find(r=>r.id===h.value)?.name||"";let t=e.artist||"";Array.isArray(t)&&(t=t.map(i=>{if(typeof i=="string")return i;if(i&&typeof i=="object"){const r=i;if(typeof r.name=="string")return r.name}return""}).filter(Boolean).join(", ")),t=t.trim();const a=(e.album||"").trim();return t&&a?`${t} ¬∑ ${a}`:t||a||""}),Ue=y(null),at=y(null),P=E(()=>{if(!s.value.lyrics)return[];const e=s.value.lyrics.split(`
`),t=[],a=/\[(\d+):(\d+)(?:[:.](\d+))?\]/g;return e.forEach(i=>{const r=i.replace(/\[(\d+):(\d+)(?:[:.](\d+))?\]/g,"").trim();if(!r)return;let u;for(a.lastIndex=0;(u=a.exec(i))!==null;){const f=parseInt(u[1]??"0",10),I=parseInt(u[2]??"0",10),m=u[3]?parseInt(u[3],10):0,U=f*60+I+(m>99?m/1e3:m/100);t.push({time:U,text:r})}}),t.sort((i,r)=>i.time-r.time)}),_=E(()=>{const e=s.value.currentTime,t=P.value;if(t.length===0)return-1;for(let a=t.length-1;a>=0;a--){const i=t[a];if(i&&e>=i.time)return a}return 0});Z(_,async()=>{if(!Ue.value)return;await Rt();const e=Ue.value,t=at.value;if(!t)return;const a=e.offsetHeight/2-60,i=t.offsetTop-a+t.offsetHeight/2;e.scrollTo({top:Math.max(0,i),behavior:se.value?"auto":"smooth"})},{immediate:!0});const lt=new Set,Mt=async e=>{if(lt.has(e.id))return;lt.add(e.id),p.value&&p.value.pause(),oe();const t=d.value.findIndex(a=>a.id===e.id);if(t!==-1&&d.value.splice(t,1),s.value.currentTrackId=null,s.value.isPlaying=!1,d.value.length>0){const a=d.value[Math.min(t,d.value.length-1)]||d.value[0];a&&await F(a);return}await q()},F=async(e,t={})=>{const{startTime:a=0,autoPlay:i=!0}=t;if(s.value.currentTrackId===e.id&&!a){fe();return}if(s.value.currentTrackId=e.id,s.value.isPlaying=i,M.activeMusicPlayer="music-widget",p.value){p.value.src&&p.value.src.startsWith("blob:")&&URL.revokeObjectURL(p.value.src),oe(),oe();let r="";const u=m=>m.split("/").map(U=>encodeURIComponent(U)).join("/"),f=v.value==="/api"||v.value==="/api/",I=/\.[a-zA-Z0-9]{2,4}$/.test(e.id);if(f&&I)r=`/music/${u(e.id)}`;else{const m=g.widget.data?.token;r=`${v.value}/tracks/${encodeURIComponent(e.id)}/stream`,m&&(r+=r.includes("?")?`&token=${m}`:`?token=${m}`)}if(p.value.src=r,p.value.currentTime=a,i)try{await p.value.play()}catch(m){console.error("Play failed",m);const U=m.message;(U.includes("NotAllowedError")||U.toLowerCase().includes("playback failed"))&&(s.value.isPlaying=!1),$.value=`Êí≠ÊîæÂá∫Èîô: ${U}`}}},St=async()=>(G.value.length===0&&await Pe(),G.value.length===0?!1:(await Ze(),!0)),fe=()=>{if(p.value){if(!s.value.currentTrackId){const e=d.value[0];if(e){F(e);return}(async()=>await St()||await q())();return}s.value.isPlaying?(p.value.pause(),s.value.isPlaying=!1):(p.value.play().catch(()=>{}),s.value.isPlaying=!0,M.activeMusicPlayer="music-widget")}},Ce=()=>{const e=["sequence","random","single"],t=(e.indexOf(s.value.playbackMode)+1)%e.length;s.value.playbackMode=e[t]},ye=(e=!1)=>{if(!d.value.length)return;if(e&&s.value.playbackMode==="single"){p.value&&(p.value.currentTime=0,p.value.play().catch(()=>{}));return}if(s.value.playbackMode==="random"){const r=Math.floor(Math.random()*d.value.length),u=d.value[r];u&&F(u),N.value&&Ye();return}const a=(d.value.findIndex(r=>r.id===s.value.currentTrackId)+1)%d.value.length,i=d.value[a];i&&F(i),N.value&&Ye()},Ae=()=>{if(!d.value.length)return;const t=(d.value.findIndex(i=>i.id===s.value.currentTrackId)-1+d.value.length)%d.value.length,a=d.value[t];a&&F(a),N.value&&wt()},Me=()=>`flatnas_music_player_state_${g.widget.id}`,jt=Ft(()=>{const e={libraryMode:b.value,currentPlaylistId:j.value,currentArtistId:h.value,currentAlbumId:x.value,playerState:{volume:s.value.volume,playbackMode:s.value.playbackMode,currentTrackId:s.value.currentTrackId,currentTime:s.value.currentTime,isPlaying:s.value.isPlaying}};localStorage.setItem(Me(),JSON.stringify(e))},1e3),Nt=()=>{const e={libraryMode:b.value,currentPlaylistId:j.value,currentArtistId:h.value,currentAlbumId:x.value,playerState:{volume:s.value.volume,playbackMode:s.value.playbackMode,currentTrackId:s.value.currentTrackId,currentTime:s.value.currentTime,isPlaying:s.value.isPlaying}};localStorage.setItem(Me(),JSON.stringify(e))},Et=async()=>{const e=localStorage.getItem(Me());if(!e)return!1;try{const t=JSON.parse(e);if(b.value=t.libraryMode||"songs",j.value=t.currentPlaylistId||null,h.value=t.currentArtistId||null,x.value=t.currentAlbumId||null,t.playerState&&(s.value.volume=t.playerState.volume??.7,s.value.playbackMode=t.playerState.playbackMode||"sequence",t.playerState.currentTrackId)){await q();const a=d.value.find(i=>i.id===t.playerState.currentTrackId);if(a)return await F(a,{startTime:t.playerState.currentTime||0,autoPlay:t.playerState.isPlaying}),s.value.currentTime=t.playerState.currentTime||0,!0}}catch(t){console.error("Failed to restore playback state",t)}return!1},se=y(!1),st=y(0),Se=()=>{p.value&&(se.value||(s.value.currentTime=p.value.currentTime),s.value.duration=p.value.duration||0,nt())},je=()=>{ye(!0)},Ne=e=>{const t=e.target;s.value.volume=parseFloat(t.value),p.value&&(p.value.volume=s.value.volume),N.value&&xt(s.value.volume)},Ee=()=>{N.value&&gt(s.value.currentTrackId||void 0)},Oe=()=>{N.value&&bt()},Le=()=>{const e=s.value.currentTrackId;if(e&&Te.value!==e){Ct(e).catch(t=>{if((t.message||"").includes("TRACK_NOT_FOUND")){const i=d.value.find(r=>r.id===e);i&&Mt(i),$.value="Ê≠åÊõ≤‰∏çÂ≠òÂú®ÔºåÂ∑≤Ë∑≥Ëøá";return}$.value="Èü≥È¢ëÊ∫ê‰∏çÊîØÊåÅÊàñÊó†ÊùÉÈôê"});return}$.value="Èü≥È¢ëÊ∫ê‰∏çÊîØÊåÅÊàñÊó†ÊùÉÈôê"},ze=e=>{const t=e.target,a=parseFloat(t.value);isNaN(a)||(se.value=!0,st.value=a,s.value.currentTime=a)},he=e=>{const t=e?parseFloat(e.target.value):NaN,a=isNaN(t)?st.value:t;p.value&&!isNaN(a)&&(p.value.currentTime=a,s.value.currentTime=a),se.value=!1},it=()=>{se.value&&he()},rt=()=>{K.value=!1},nt=()=>{const e=p.value;if(!e||!e.duration||e.duration<=0||!e.buffered||e.buffered.length===0){ve.value=0;return}try{ve.value=e.buffered.end(e.buffered.length-1)}catch{ve.value=0}},Re=()=>{nt()},ot=e=>{const t=e.currentTarget,a=s.value.duration||0;if(!t||!a)return;const i=t.getBoundingClientRect();if(!i.width)return;const r=(e.clientX-i.left)/i.width,u=Math.max(0,Math.min(a,r*a));p.value&&(p.value.currentTime=u),s.value.currentTime=u},ue=e=>{if(!e||isNaN(e)||!isFinite(e))return"0:00";const t=Math.floor(e/60),a=Math.floor(e%60);return`${t}:${a.toString().padStart(2,"0")}`};let de=null;const ct=()=>{de==null&&(de=window.setInterval(ae,3e3))},ut=()=>{de!=null&&(window.clearInterval(de),de=null)};return Bt(()=>{const e=document.getElementById("flatnas-global-audio");e?(xe.value=!0,p.value=e,e.addEventListener("timeupdate",Se),e.addEventListener("ended",je),e.addEventListener("play",Ee),e.addEventListener("pause",Oe),e.addEventListener("progress",Re),e.addEventListener("error",Le),e.paused||(s.value.isPlaying=!0,s.value.currentTime=e.currentTime,M.activeMusicPlayer="music-widget")):p.value=We.value,q(),et(),N.value&&(ae(),ct()),(He.value||ke.value)&&(Pe(),!N.value&&M.appConfig.autoPlayMusic&&Ze());const t=xe.value&&p.value&&!p.value.paused;!N.value&&!t&&Et().then(a=>{a||!He.value&&ke.value}),window.addEventListener("click",rt),window.addEventListener("pointerup",it)}),Z(()=>s.value.currentTime,()=>{jt()}),Z([()=>s.value.currentTrackId,()=>s.value.volume,()=>s.value.playbackMode,()=>s.value.isPlaying,b,j,h,x],()=>{Nt()}),Dt(()=>{if(ut(),xe.value){const e=p.value;e&&(e.removeEventListener("timeupdate",Se),e.removeEventListener("ended",je),e.removeEventListener("play",Ee),e.removeEventListener("pause",Oe),e.removeEventListener("progress",Re),e.removeEventListener("error",Le))}else oe();window.removeEventListener("click",rt),window.removeEventListener("pointerup",it)}),Z(N,e=>{e?(ae(),ct()):ut()}),(e,t)=>(o(),n("div",{class:"w-full h-full backdrop-blur-md border border-white/20 rounded-2xl flex flex-col overflow-hidden shadow-lg hover:shadow-xl transition-all group relative",style:z({backgroundColor:`rgba(255, 255, 255, ${(ee.widget.opacity??.1)*.4})`})},[V.value?(o(),n("div",{key:0,class:"absolute inset-0 bg-cover bg-center transition-all duration-700 blur-md opacity-80 pointer-events-none",style:z({backgroundImage:`url('${V.value}')`})},null,4)):(o(),n("div",Ht)),l("audio",{ref_key:"localAudioRef",ref:We,onTimeupdate:Se,onEnded:je,onPlay:Ee,onPause:Oe,onProgress:Re,onError:Le,crossorigin:"anonymous"},null,544),ee.widget.colSpan===1&&ee.widget.rowSpan===1?(o(),n("div",Gt,[l("div",{class:C(["aplayer aplayer-mini",{"aplayer-withlist":$e.value}])},[l("div",Kt,[l("div",Qt,[l("button",{class:"aplayer-pic-btn",onClick:T(fe,["stop"]),title:s.value.isPlaying?"ÊöÇÂÅú":"Êí≠Êîæ",style:z(V.value?{backgroundImage:`url('${V.value}')`}:void 0)},[l("span",{class:C(["aplayer-pic-icon",{"is-playing":s.value.isPlaying}])},c(s.value.isPlaying?qe:Ve),3)],12,Xt)]),l("div",Yt,[l("div",Zt,[l("span",{class:C(["aplayer-title",{"aplayer-marquee":(S.value?.title||"").length>15}])},[me(c(S.value?.title||"ÈÄâÊã©Êí≠Êîæ")+" ",1),(S.value?.title||"").length>15?(o(),n("span",ea,c(S.value?.title),1)):A("",!0)],2)]),l("div",ta,[l("span",{class:C(["aplayer-author",{"aplayer-marquee":B.value.length>20}])},[me(c(B.value)+" ",1),B.value.length>20?(o(),n("span",aa,c(B.value),1)):A("",!0)],2)]),$.value?(o(),n("div",{key:0,class:"text-xs text-red-400 mt-0.5 truncate",title:$.value},c($.value),9,la)):A("",!0),l("div",sa,[l("div",ia,[l("button",{class:"aplayer-btn",onClick:T(Ae,["stop"]),title:"‰∏ä‰∏ÄÈ¶ñ"},c(Fe)),l("button",{class:"aplayer-btn",onClick:t[0]||(t[0]=T(a=>ye(),["stop"])),title:"‰∏ã‰∏ÄÈ¶ñ"},c(De))]),l("div",ra,[l("button",{class:"aplayer-btn",onClick:T(Ce,["stop"]),title:s.value.playbackMode==="random"?"ÈöèÊú∫Êí≠Êîæ":s.value.playbackMode==="single"?"ÂçïÊõ≤Âæ™ÁéØ":"È°∫Â∫èÊí≠Êîæ"},c(s.value.playbackMode==="random"?ft:s.value.playbackMode==="single"?yt:pt),9,na),l("div",oa,[l("button",{class:"aplayer-btn",onClick:t[1]||(t[1]=T(a=>K.value=!K.value,["stop"])),title:"Èü≥Èáè"},[...t[14]||(t[14]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"},[l("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})],-1)])]),ge(l("div",{class:"aplayer-volume-panel",onClick:t[2]||(t[2]=T(()=>{},["stop"]))},[l("input",{type:"range",min:"0",max:"1",step:"0.05",value:s.value.volume,onInput:Ne,class:"aplayer-volume-slider"},null,40,ca)],512),[[Be,K.value]])])])]),l("div",ua,[l("div",{class:"aplayer-bar-wrap",onClick:T(ot,["stop"])},[l("div",da,[l("div",{class:"aplayer-loaded",style:z({width:`${Qe.value}%`})},null,4),l("div",{class:"aplayer-played",style:z({width:`${Ke.value}%`})},[...t[15]||(t[15]=[l("span",{class:"aplayer-thumb"},null,-1)])],4),l("input",{class:"aplayer-seek",type:"range",min:0,max:s.value.duration||0,value:s.value.currentTime,disabled:!s.value.duration,step:"0.1",onInput:ze,onChange:he},null,40,va)])]),l("span",pa,c(ue(s.value.currentTime)),1)])])])],2)])):ee.widget.colSpan===1&&ee.widget.rowSpan===3?(o(),n("div",fa,[l("div",{class:C(["aplayer aplayer-mini is-tall",{"aplayer-withlist":$e.value}])},[l("div",ya,[l("div",ha,[l("button",{class:"aplayer-pic-btn",onClick:T(fe,["stop"]),title:s.value.isPlaying?"ÊöÇÂÅú":"Êí≠Êîæ",style:z(V.value?{backgroundImage:`url('${V.value}')`}:void 0)},[l("span",{class:C(["aplayer-pic-icon",{"is-playing":s.value.isPlaying}])},c(s.value.isPlaying?qe:Ve),3)],12,ma)]),l("div",ga,[l("div",ba,[l("span",{class:C(["aplayer-title",{"aplayer-marquee":(S.value?.title||"").length>15}])},[me(c(S.value?.title||"ÈÄâÊã©Êí≠Êîæ")+" ",1),(S.value?.title||"").length>15?(o(),n("span",wa,c(S.value?.title),1)):A("",!0)],2)]),l("div",xa,[l("span",{class:C(["aplayer-author",{"aplayer-marquee":B.value.length>20}])},[me(c(B.value)+" ",1),B.value.length>20?(o(),n("span",ka,c(B.value),1)):A("",!0)],2)]),l("div",_a,[l("div",Ta,[l("button",{class:"aplayer-btn",onClick:T(Ae,["stop"]),title:"‰∏ä‰∏ÄÈ¶ñ"},c(Fe)),l("button",{class:"aplayer-btn",onClick:t[3]||(t[3]=T(a=>ye(),["stop"])),title:"‰∏ã‰∏ÄÈ¶ñ"},c(De))]),l("div",$a,[l("button",{class:"aplayer-btn",onClick:T(Ce,["stop"]),title:s.value.playbackMode==="random"?"ÈöèÊú∫Êí≠Êîæ":s.value.playbackMode==="single"?"ÂçïÊõ≤Âæ™ÁéØ":"È°∫Â∫èÊí≠Êîæ"},c(s.value.playbackMode==="random"?ft:s.value.playbackMode==="single"?yt:pt),9,Ia),l("div",Pa,[l("button",{class:"aplayer-btn",onClick:t[4]||(t[4]=T(a=>K.value=!K.value,["stop"])),title:"Èü≥Èáè"},[...t[16]||(t[16]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"},[l("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})],-1)])]),ge(l("div",{class:"aplayer-volume-panel",onClick:t[5]||(t[5]=T(()=>{},["stop"]))},[l("input",{type:"range",min:"0",max:"1",step:"0.05",value:s.value.volume,onInput:Ne,class:"aplayer-volume-slider"},null,40,Ua)],512),[[Be,K.value]])])])]),l("div",Ca,[l("div",{class:"aplayer-bar-wrap",onClick:T(ot,["stop"])},[l("div",Aa,[l("div",{class:"aplayer-loaded",style:z({width:`${Qe.value}%`})},null,4),l("div",{class:"aplayer-played",style:z({width:`${Ke.value}%`})},[...t[17]||(t[17]=[l("span",{class:"aplayer-thumb"},null,-1)])],4),l("input",{class:"aplayer-seek",type:"range",min:0,max:s.value.duration||0,value:s.value.currentTime,disabled:!s.value.duration,step:"0.1",onInput:ze,onChange:he},null,40,Ma)])]),l("span",Sa,c(ue(s.value.currentTime)),1)])])]),ge(l("div",{class:"aplayer-list",onClick:t[6]||(t[6]=T(()=>{},["stop"]))},[l("div",ja,[_e.value?(o(),n("div",Na,"Âä†ËΩΩ‰∏≠...")):re.value?(o(),n("div",Ea,c(re.value),1)):(o(),n("div",Oa," Â∑≤Âä†ËΩΩÂÖ®ÈÉ®Ê≠åÊõ≤Ôºà"+c(G.value.length)+"Ôºâ ",1))])],512),[[Be,$e.value]])],2)])):(o(),n("div",La,[l("div",za,[l("div",Ra,[l("div",Ba,[l("div",Fa,[V.value?(o(),n("img",{key:0,src:V.value,class:"w-full h-full object-cover"},null,8,Da)):(o(),n("img",Va))]),l("div",qa,[l("div",Ja,c(S.value?.title||"ÈÅìÁêÜÈ±ºÈü≥‰πê"),1),l("div",Wa,c(B.value||(S.value?"":"Êú™Êí≠Êîæ")),1)]),l("button",{onClick:Ce,class:"absolute bottom-1 right-2 flex items-center justify-center text-[12px] scale-[1.8] transition-all duration-200 ease-out text-white/50 hover:text-white/90",title:s.value.playbackMode==="random"?"ÈöèÊú∫Êí≠Êîæ":s.value.playbackMode==="single"?"Âæ™ÁéØÊí≠Êîæ":"È°∫Â∫èÊí≠Êîæ"},c(s.value.playbackMode==="random"?"‚•Æ":s.value.playbackMode==="single"?"‚ü≥":"‚áâ"),9,Ha)]),l("div",Ga,[l("div",Ka,[l("span",Qa,c(ue(s.value.currentTime)),1),l("input",{type:"range",max:s.value.duration||100,value:s.value.currentTime,onInput:ze,onChange:he,class:"flex-1 h-1 bg-white/20 rounded-lg appearance-none cursor-pointer accent-blue-400 min-w-0"},null,40,Xa),l("span",Ya,c(ue(s.value.duration)),1)])])]),l("div",Za,[l("div",el,[(o(),n(J,null,W(["songs","artists","albums"],a=>l("button",{key:a,onClick:i=>$t(a),class:C(["px-2 py-0.5 text-[10px] rounded whitespace-nowrap transition-colors",b.value===a?"bg-blue-500 text-white shadow-sm":"bg-white/10 text-white/60 hover:bg-white/20"])},c(It(a)),11,tl)),64))]),b.value==="playlists"?ge((o(),n("select",{key:0,"onUpdate:modelValue":t[7]||(t[7]=a=>j.value=a),onChange:q,class:"w-full bg-black/20 text-white/90 text-xs rounded px-2 py-1 outline-none border border-white/10 focus:border-blue-500/50 hover:bg-black/30 transition-colors"},[t[18]||(t[18]=l("option",{value:null,class:"text-black"},"ËØ∑ÈÄâÊã©Ê≠åÂçï...",-1)),(o(!0),n(J,null,W(we.value,a=>(o(),n("option",{key:a.id,value:a.id,class:"text-black"},c(a.name),9,al))),128))],544)),[[Vt,j.value]]):A("",!0)]),l("div",{class:"flex-1 overflow-y-auto overflow-x-hidden custom-scrollbar",onWheel:t[10]||(t[10]=T(()=>{},["stop"]))},[te.value?(o(),n("div",ll,"Âä†ËΩΩ‰∏≠...")):$.value?(o(),n("div",sl,c($.value),1)):(o(),n("div",il,[b.value==="artists"&&!h.value?(o(),n("div",rl,[(o(!0),n(J,null,W(R.value,a=>(o(),n("div",{key:a.id,onClick:i=>Pt(a.id),class:"flex flex-col items-center gap-1 cursor-pointer group hover:bg-white/5 p-2 rounded-lg transition-colors"},[l("div",ol,[a.coverUrl?(o(),n("img",{key:0,src:be(M).getAssetUrl(a.coverUrl),class:"w-full h-full object-cover"},null,8,cl)):(o(),n("div",ul," üë§ "))]),l("span",dl,c(a.name),1)],8,nl))),128))])):b.value==="albums"&&!x.value?(o(),n("div",vl,[(o(!0),n(J,null,W(D.value,a=>(o(),n("div",{key:a.id,onClick:i=>Ut(a.id),class:"flex flex-col items-center gap-1 cursor-pointer group hover:bg-white/5 p-2 rounded-lg transition-colors"},[l("div",fl,[a.coverUrl?(o(),n("img",{key:0,src:be(M).getAssetUrl(a.coverUrl),class:"w-full h-full object-cover"},null,8,yl)):(o(),n("div",hl," üíø "))]),l("span",ml,c(a.title),1)],8,pl))),128))])):(o(),n("div",gl,[b.value==="artists"&&h.value?(o(),n("div",bl,[l("button",{onClick:t[8]||(t[8]=a=>h.value=null),class:"w-5 h-5 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center text-white/80 transition-colors text-xs",title:"ËøîÂõû"}," ‚Üê "),l("div",wl,[R.value.find(a=>a.id===h.value)?.coverUrl?(o(),n("img",{key:0,src:be(M).getAssetUrl(R.value.find(a=>a.id===h.value)?.coverUrl),class:"w-5 h-5 rounded-full object-cover border border-white/10"},null,8,xl)):A("",!0),l("span",kl,c(R.value.find(a=>a.id===h.value)?.name||"Ëâ∫‰∫∫Ê≠åÂçï"),1)]),l("button",{onClick:Xe,class:"text-[10px] bg-blue-500 hover:bg-blue-600 text-white px-2 py-0.5 rounded shadow-sm transition-colors"}," Êí≠ÊîæÂÖ®ÈÉ® ")])):A("",!0),b.value==="albums"&&x.value?(o(),n("div",_l,[l("button",{onClick:t[9]||(t[9]=a=>x.value=null),class:"w-5 h-5 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center text-white/80 transition-colors text-xs",title:"ËøîÂõû"}," ‚Üê "),l("div",Tl,[D.value.find(a=>a.id===x.value)?.coverUrl?(o(),n("img",{key:0,src:be(M).getAssetUrl(D.value.find(a=>a.id===x.value)?.coverUrl),class:"w-5 h-5 rounded object-cover border border-white/10"},null,8,$l)):A("",!0),l("span",Il,c(D.value.find(a=>a.id===x.value)?.title||"‰∏ìËæëÊ≠åÂçï"),1)]),l("button",{onClick:Xe,class:"text-[10px] bg-blue-500 hover:bg-blue-600 text-white px-2 py-0.5 rounded shadow-sm transition-colors"}," Êí≠ÊîæÂÖ®ÈÉ® ")])):A("",!0),(o(!0),n(J,null,W(d.value,(a,i)=>(o(),n("div",{key:a.id,onClick:r=>F(a),class:C(["px-3 py-0.5 hover:bg-white/10 cursor-pointer flex items-center gap-1.5 transition-colors group/item",{"bg-blue-500/20":S.value?.id===a.id}])},[l("div",Ul,[S.value?.id===a.id&&s.value.isPlaying?(o(),n("span",Cl,[...t[19]||(t[19]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-3.5 h-3.5 inline-block"},[l("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})],-1)])])):(o(),n("span",Al,c(i+1),1))]),l("div",Ml,[l("div",{class:C(["text-xs font-medium text-white/90 truncate",{"text-blue-400":S.value?.id===a.id}])},c(a.title),3),l("div",Sl,c(a.artist),1)]),l("div",jl,c(ue(a.duration||0)),1)],10,Pl))),128))]))]))],32)]),l("div",{class:"w-[61.8%] flex flex-col bg-black/10 h-full relative",onWheel:t[13]||(t[13]=T(()=>{},["stop"]))},[l("div",{class:C(["absolute top-4 right-4 z-30 transition-opacity duration-300",[ie.value?"opacity-100":"opacity-0 group-hover:opacity-100"]])},[l("button",{onClick:t[11]||(t[11]=a=>ie.value=!ie.value),class:"w-8 h-8 rounded-full bg-black/40 backdrop-blur-md flex items-center justify-center text-white/70 hover:text-white hover:bg-black/60 transition-all border border-white/10",title:"ÂàáÊç¢Êí≠ÊîæÊïàÊûú"},c(Je.find(a=>a.id===H.value)?.icon||"üé®"),1),ie.value?(o(),n("div",Nl,[(o(),n(J,null,W(Je,a=>l("button",{key:a.id,onClick:i=>ht(a.id),class:C(["w-full px-4 py-2.5 text-left text-xs flex items-center gap-3 transition-colors hover:bg-white/10",H.value===a.id?"text-blue-400 font-bold bg-white/5":"text-white/70"])},[l("span",Ol,c(a.icon),1),l("span",null,c(a.label),1)],10,El)),64))])):A("",!0)],2),H.value==="lyrics"?(o(),n("div",{key:0,ref_key:"lyricsContainer",ref:Ue,class:"flex-1 overflow-y-auto overflow-x-hidden custom-scrollbar p-4 text-center scroll-smooth"},[P.value.length>0?(o(),n("div",Ll,[(o(!0),n(J,null,W(P.value,(a,i)=>(o(),n("div",{key:i,class:C(["transition-all duration-500 py-2 text-sm leading-relaxed tracking-wide origin-center break-words",i===_.value?"text-white font-bold scale-[1.5] opacity-100":i===_.value+1?"text-white/90 font-bold scale-[1.3] opacity-90":i<_.value?"text-white/80 font-bold scale-[1.1] opacity-80":"text-white/35 opacity-50"]),ref_for:!0,ref:r=>{i===_.value&&(at.value=r)}},c(a.text),3))),128))])):s.value.lyrics?(o(),n("div",zl,c(s.value.lyrics),1)):(o(),n("div",Rl,[...t[20]||(t[20]=[l("span",{class:"text-2xl opacity-50"},"üìù",-1),l("span",{class:"text-xs"},"ÊöÇÊó†Ê≠åËØç",-1)])]))],512)):H.value==="spectrum"?(o(),n("div",Bl,[l("div",Fl,[l("div",Dl,[(o(),n(J,null,W(12,a=>l("div",{key:a,class:"w-1.5 bg-gradient-to-t from-blue-600/40 to-blue-400/80 rounded-t-sm animate-pulse",style:z({height:`${20+Math.random()*80}%`,animationDuration:`${.5+Math.random()*1}s`})},null,4)),64))]),l("div",Vl,[P.value.length>0&&_.value>=0?(o(),n("div",ql,[l("div",Jl,c(P.value[_.value]?.text),1),P.value[_.value+1]?(o(),n("div",Wl,c(P.value[_.value+1]?.text),1)):A("",!0)])):(o(),n("div",Hl,[...t[21]||(t[21]=[l("span",{class:"text-xs font-medium text-white/60"},"È¢ëË∞±ÂàÜÊûê",-1),l("span",{class:"text-[10px] opacity-50"},"Spectrum Analyzer",-1)])]))])])])):H.value==="abstract"?(o(),n("div",Gl,[t[23]||(t[23]=qt('<div class="relative w-40 h-40 flex items-center justify-center" data-v-17c29fca><div class="absolute inset-0 rounded-full border border-blue-500/20 animate-[ping_3s_linear_infinite]" data-v-17c29fca></div><div class="absolute inset-4 rounded-full border border-purple-500/20 animate-[ping_2s_linear_infinite]" data-v-17c29fca></div><div class="absolute inset-8 rounded-full border border-pink-500/20 animate-pulse" data-v-17c29fca></div><div class="z-10 text-3xl animate-bounce" data-v-17c29fca>‚ú®</div></div>',1)),l("div",Kl,[P.value.length>0&&_.value>=0?(o(),n("div",Ql,[l("div",Xl,c(P.value[_.value]?.text),1),P.value[_.value+1]?(o(),n("div",Yl,c(P.value[_.value+1]?.text),1)):A("",!0)])):(o(),n("div",Zl,[...t[22]||(t[22]=[l("span",{class:"text-xs font-medium text-white/60"},"ÊäΩË±°Âä®Áîª",-1),l("span",{class:"text-[10px] opacity-50"},"Abstract Visualizations",-1)])]))])])):H.value==="vinyl"?(o(),n("div",es,[l("div",ts,[l("div",{class:C(["w-56 h-56 rounded-full bg-[#111] border-[6px] border-[#222] shadow-[0_0_50px_rgba(0,0,0,0.8)] flex items-center justify-center relative overflow-hidden",{"animate-[spin_10s_linear_infinite]":s.value.isPlaying}])},[t[24]||(t[24]=l("div",{class:"absolute inset-0 opacity-30",style:{background:`repeating-radial-gradient(
                      circle,
                      transparent 0,
                      transparent 3px,
                      rgba(255, 255, 255, 0.05) 4px,
                      transparent 5px
                    )`}},null,-1)),l("div",as,[le.value?.coverUrl?(o(),n("img",{key:0,src:tt(le.value),class:"w-full h-full object-cover"},null,8,ls)):(o(),n("div",ss," üíø "))]),t[25]||(t[25]=l("div",{class:"absolute w-2 h-2 bg-black rounded-full z-20 shadow-inner"},null,-1))],2),l("div",{class:"absolute -top-6 -right-4 w-32 h-32 pointer-events-none transition-transform duration-700 ease-in-out origin-[85%_15%]",style:z({transform:s.value.isPlaying?"rotate(0deg)":"rotate(-25deg)"})},[...t[26]||(t[26]=[l("div",{class:"absolute top-[15%] right-[15%] w-4 h-4 bg-zinc-600 rounded-full"},null,-1),l("div",{class:"absolute top-[18%] right-[17%] w-1.5 h-24 bg-gradient-to-b from-zinc-500 to-zinc-700 rounded-full origin-top rotate-[25deg]"},null,-1),l("div",{class:"absolute bottom-[15%] left-[10%] w-4 h-6 bg-zinc-800 rounded-sm rotate-[25deg]"},null,-1)])],4)]),l("div",is,[P.value.length>0&&_.value>=0?(o(),n("div",rs,[l("div",ns,c(P.value[_.value]?.text),1),P.value[_.value+1]?(o(),n("div",os,c(P.value[_.value+1]?.text),1)):A("",!0)])):(o(),n("div",cs,[...t[27]||(t[27]=[l("span",{class:"text-xs font-medium text-white/60"},"Â∞ÅÈù¢‰∏éÈªëËÉ∂",-1),l("span",{class:"text-[10px] opacity-50"},"Cover Art & Vinyl",-1)])]))])])):A("",!0),l("div",us,[l("div",ds,[l("div",vs,[l("button",{onClick:Ae,class:"w-7 h-7 rounded-full flex items-center justify-center bg-white/5 hover:bg-white/10 transition-colors text-white/70"},c(Fe)),l("button",{onClick:fe,class:"w-8 h-8 rounded-full flex items-center justify-center bg-white/10 hover:bg-white/20 transition-colors text-white scale-[1.3] transition-transform"},c(s.value.isPlaying?qe:Ve),1),l("button",{onClick:t[12]||(t[12]=()=>ye()),class:"w-7 h-7 rounded-full flex items-center justify-center bg-white/5 hover:bg-white/10 transition-colors text-white/70"},c(De))]),l("div",ps,[t[28]||(t[28]=l("span",{class:"text-xs text-white/70"},[l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-4 h-4"},[l("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})])],-1)),l("input",{type:"range",min:"0",max:"1",step:"0.05",value:s.value.volume,onInput:Ne,class:"w-20 h-1 bg-white/20 rounded-lg appearance-none cursor-pointer accent-blue-400"},null,40,fs)])])])],32)]))],4))}}),gs=Jt(ys,[["__scopeId","data-v-17c29fca"]]);export{gs as default};
