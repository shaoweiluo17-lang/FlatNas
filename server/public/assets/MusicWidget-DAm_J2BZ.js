import{d as Bt,u as Ft,r as y,w as Z,c as N,x as Dt,y as Vt,J as qt,o as Jt,a as n,e as o,g as l,q as z,f as I,p as U,t as u,b as C,j as ge,l as be,I as Be,F as J,h as W,D as Wt,i as we,G as Ht,_ as Gt}from"./index-CwNRDDxv.js";import{_ as Kt}from"./daoliyu-CAYE7_Pg.js";const Qt={key:1,class:"absolute inset-0 bg-white/5 transition-all pointer-events-none"},Xt={key:2,class:"w-full h-full relative z-10"},Yt={class:"aplayer-body"},Zt={class:"aplayer-pic"},ea=["title"],ta={class:"aplayer-info"},aa={class:"aplayer-music-text-wrap"},la={key:0,class:"ml-8"},sa={class:"aplayer-music-text-wrap"},ia={key:0,class:"ml-8"},ra=["title"],na={class:"aplayer-time-main"},oa={class:"aplayer-controls"},ca={class:"aplayer-right"},ua=["title"],da={class:"aplayer-volume"},va=["value"],fa={class:"aplayer-bar-container"},pa={class:"aplayer-bar"},ya=["max","value","disabled"],ha={class:"aplayer-ptime"},ma={key:3,class:"w-full h-full relative z-10"},ga={class:"aplayer-body"},ba={class:"aplayer-pic"},wa=["title"],xa={class:"aplayer-info"},ka={class:"aplayer-music-text-wrap"},_a={key:0,class:"ml-8"},Ta={class:"aplayer-music-text-wrap"},$a={key:0,class:"ml-8"},Ia={class:"aplayer-time-main"},Pa={class:"aplayer-controls"},Ua={class:"aplayer-right"},Ca=["title"],Aa={class:"aplayer-volume"},Ma=["value"],ja={class:"aplayer-bar-container"},Sa={class:"aplayer-bar"},Na=["max","value","disabled"],Ea={class:"aplayer-ptime"},Oa={class:"aplayer-list-body"},La={key:0,class:"aplayer-list-state"},za={key:1,class:"aplayer-list-state is-error"},Ra={key:2,class:"aplayer-list-state"},Ba={key:4,class:"flex h-full relative z-10"},Fa={class:"flex flex-col min-w-0 transition-all duration-300 w-[39.2%] border-r border-white/10"},Da={class:"border-b border-white/10 bg-white/5 flex flex-col shrink-0"},Va={class:"p-3 flex gap-1.5 items-center relative"},qa={class:"w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center overflow-hidden shadow-sm shrink-0"},Ja=["src"],Wa={key:1,src:Kt,class:"w-6 h-6 object-contain opacity-50"},Ha={class:"flex-1 min-w-0 flex flex-col"},Ga={class:"font-bold text-white truncate text-sm leading-tight"},Ka={class:"text-xs text-white/60 truncate leading-tight"},Qa=["title"],Xa={class:"px-1 pb-2"},Ya={class:"flex items-center gap-1 text-[12px] text-white/70"},Za={class:"tabular-nums w-9 text-right"},el=["max","value"],tl={class:"tabular-nums w-9"},al={class:"px-3 py-1.5 border-b border-white/10 bg-white/5 flex flex-col gap-1.5"},ll={class:"flex gap-1 overflow-x-auto custom-scrollbar pb-0.5"},sl=["onClick"],il=["value"],rl={key:0,class:"p-4 text-center text-xs text-white/40"},nl={key:1,class:"p-4 text-center text-xs text-red-400"},ol={key:2},cl={key:0,class:"grid grid-cols-3 gap-2 p-2"},ul=["onClick"],dl={class:"w-14 h-14 rounded-full overflow-hidden bg-white/10 shadow-sm group-hover:scale-105 transition-transform border border-white/5"},vl=["src"],fl={key:1,class:"w-full h-full flex items-center justify-center text-2xl opacity-50"},pl={class:"text-[10px] text-white/80 text-center truncate w-full"},yl={key:1,class:"grid grid-cols-3 gap-2 p-2"},hl=["onClick"],ml={class:"w-14 h-14 rounded overflow-hidden bg-white/10 shadow-sm group-hover:scale-105 transition-transform border border-white/5"},gl=["src"],bl={key:1,class:"w-full h-full flex items-center justify-center text-2xl opacity-50"},wl={class:"text-[10px] text-white/80 text-center truncate w-full"},xl={key:2},kl={key:0,class:"sticky top-0 z-10 bg-black/40 backdrop-blur-md border-b border-white/10 px-3 py-2 flex items-center gap-2 mb-1"},_l={class:"flex items-center gap-2 overflow-hidden flex-1"},Tl=["src"],$l={class:"text-xs font-bold text-white truncate"},Il={key:1,class:"sticky top-0 z-10 bg-black/40 backdrop-blur-md border-b border-white/10 px-3 py-2 flex items-center gap-2 mb-1"},Pl={class:"flex items-center gap-2 overflow-hidden flex-1"},Ul=["src"],Cl={class:"text-xs font-bold text-white truncate"},Al=["onClick"],Ml={class:"text-xs text-white/40 w-4 text-center"},jl={key:0,class:"animate-pulse text-blue-400"},Sl={key:1},Nl={class:"flex-1 min-w-0"},El={class:"text-[10px] text-white/50 truncate"},Ol={class:"text-[10px] text-white/40 opacity-0 group-hover/item:opacity-100 transition-opacity"},Ll={key:0,class:"absolute right-0 mt-2 w-40 bg-black/80 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl py-1 z-40 overflow-hidden"},zl=["onClick"],Rl={class:"text-sm"},Bl={key:0,class:"pt-[40%] pb-[60%]"},Fl={key:1,class:"text-xs text-white/90 whitespace-pre-line leading-7 font-medium tracking-wide"},Dl={key:2,class:"h-full flex flex-col items-center justify-center text-white/40 gap-2"},Vl={key:1,class:"flex-1 flex flex-col items-center justify-center p-4"},ql={class:"text-white/40 flex flex-col items-center gap-6"},Jl={class:"flex items-end gap-1.5 h-20"},Wl={class:"flex flex-col items-center gap-2 w-full max-w-[80%]"},Hl={key:0,class:"flex flex-col items-center gap-2"},Gl={class:"text-sm font-bold text-white text-center drop-shadow-md"},Kl={key:0,class:"text-[11px] text-white/40 text-center line-clamp-1 italic"},Ql={key:1,class:"flex flex-col items-center gap-1"},Xl={key:2,class:"flex-1 flex flex-col items-center justify-center p-4 overflow-hidden"},Yl={class:"flex flex-col items-center gap-2 mt-8 w-full max-w-[80%]"},Zl={key:0,class:"flex flex-col items-center gap-2"},es={class:"text-sm font-bold text-white text-center drop-shadow-md"},ts={key:0,class:"text-[11px] text-white/40 text-center line-clamp-1 italic"},as={key:1,class:"flex flex-col items-center gap-1"},ls={key:3,class:"flex-1 flex flex-col items-center justify-center p-4"},ss={class:"relative group mt-[-20px] scale-[1.1]"},is={class:"w-20 h-20 rounded-full overflow-hidden border-4 border-[#111] z-10 shadow-inner"},rs=["src"],ns={key:1,class:"w-full h-full bg-zinc-800 flex items-center justify-center text-white/20"},os={class:"flex flex-col items-center gap-2 mt-12 w-full max-w-[80%]"},cs={key:0,class:"flex flex-col items-center gap-2"},us={class:"text-sm font-bold text-white text-center drop-shadow-md"},ds={key:0,class:"text-[11px] text-white/40 text-center line-clamp-1 italic"},vs={key:1,class:"flex flex-col items-center gap-1"},fs={class:"absolute left-1/2 -translate-x-1/2 bottom-3 z-20 max-w-[calc(100vw-2rem)]"},ps={class:"bg-black/40 backdrop-blur-md rounded-xl px-4 py-2 shadow-lg flex items-center gap-6 w-fit min-w-[280px] max-w-[calc(100vw-2rem)] transition-all opacity-0 group-hover:opacity-100 duration-300"},ys={class:"flex items-center justify-center gap-4 shrink-0"},hs={class:"flex items-center gap-2 shrink-0 border-l border-white/10 pl-6"},ms=["value"],Fe="‚èÆÔ∏é",De="‚è≠Ô∏é",Ve="‚ñ∂Ô∏é",qe="‚è∏Ô∏é",gt="üîÅÔ∏é",bt="üîÄÔ∏é",wt="üîÇÔ∏é",Je="flatnas_music_player_state",gs=Bt({__name:"MusicWidget",props:{widget:{}},setup(ee){const k=ee,A=Ft(),d=y([]),xe=y([]),O=y([]),R=y([]),h=y("songs"),H=y("lyrics"),ie=y(!1),We=[{id:"lyrics",label:"Ê≠åËØç",icon:"üìù"},{id:"spectrum",label:"È¢ëË∞±ÂàÜÊûê",icon:"üìä"},{id:"abstract",label:"ÊäΩË±°Âä®Áîª",icon:"‚ú®"},{id:"vinyl",label:"Â∞ÅÈù¢‰∏éÈªëËÉ∂",icon:"üíø"}],xt=e=>{H.value=e,ie.value=!1},j=y(null),m=y(null),g=y(null),s=y({isPlaying:!1,currentTime:0,duration:0,volume:.7,currentTrackId:null,playbackMode:"sequence"}),ke=y(null),He=e=>{const a=e.replace(/\\/g,"/").split("/"),i=(a[a.length-1]||"").replace(/\.[^/.]+$/,"");let c="Unknown Artist",f=i;if(i.includes(" - ")){const b=i.split(" - ");c=(b[0]||"").trim(),f=b.slice(1).join(" - ").trim()}else a.length>=3&&(c=a[a.length-3]||"Unknown Artist");let _="Unknown Album";return a.length>=2&&(_=a[a.length-2]||"Unknown Album"),{id:e,title:f,artist:c,album:_,duration:0,coverUrl:void 0,isLocal:!0}},Ge=async()=>{if(ke.value)return ke.value;try{const e=await fetch("/api/music-list");if(e.ok){const t=await e.json();return ke.value=t,t}}catch(e){console.error(e)}return[]};Z(()=>A.activeMusicPlayer,e=>{e!=="music-widget"&&s.value.isPlaying&&(v.value&&v.value.pause(),s.value.isPlaying=!1)});const v=y(null),Ke=y(null),_e=y(!1),G=y(!1),w=y(""),S=N(()=>k.widget.data?.syncPlayerState===!0),Qe=N(()=>k.widget.colSpan===1&&k.widget.rowSpan===1),Te=N(()=>k.widget.colSpan===1&&k.widget.rowSpan===3),D=y([]),de=y(!1),re=y(""),Xe=y(!1),K=y(!1),ve=y(0),ne=y(null),$e=y(null),Ie=N(()=>Te.value?!0:Xe.value),V=N(()=>{if(ae.value)return it(ae.value);if(h.value==="artists"&&m.value){const e=O.value.find(t=>t.id===m.value);return A.getAssetUrl(e?.coverUrl)}}),Ye=N(()=>{const e=s.value.duration||0;return e?Math.max(0,Math.min(100,s.value.currentTime/e*100)):0}),Ze=N(()=>{const e=s.value.duration||0;return e?Math.max(0,Math.min(100,ve.value/e*100)):0}),p=N(()=>{let e=k.widget.data?.apiUrl||"/api";return e=e.replace(/\/$/,""),/\/api(\/v\d+)?$/.test(e)||(e+="/api"),e}),x=()=>{const e={};return k.widget.data?.token&&(e.Authorization=`Bearer ${k.widget.data.token}`),e},Pe=async()=>{if(!(!k.widget.data?.username||!k.widget.data?.password))try{const e=await fetch(`${p.value}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:k.widget.data.username,password:k.widget.data.password})});if(e.ok){const t=await e.json();if(t.token){const a=A.widgets.find(r=>r.id===k.widget.id);a&&a.data&&(a.data.token=t.token,A.saveData()),kt()}}}catch(e){console.error("Login failed",e)}},kt=async()=>{try{const e=await fetch(`${p.value}/auth/me`,{headers:x()});if(e.ok){const t=await e.json();console.log("User profile:",t)}}catch(e){console.error("Fetch profile failed",e)}},te=async()=>{try{const e=await fetch(`${p.value}/player`,{headers:x()});if(e.ok){const t=await e.json();s.value.isPlaying=t.isPlaying,le.value||(s.value.currentTime=t.progress||t.currentTime||0),s.value.volume=t.volume??.7,s.value.currentTrackId=t.currentTrack?.id||t.currentTrackId,(t.lyrics||t.currentTrack?.lyrics)&&(s.value.lyrics=t.lyrics||t.currentTrack?.lyrics),t.queue&&Array.isArray(t.queue)&&(d.value=t.queue.map(X).filter(Boolean));const a=X(t.currentTrack);a&&!d.value.find(r=>r.id===a.id)&&d.value.push(a),v.value&&(v.value.volume=s.value.volume)}}catch(e){console.error("Fetch player state failed",e)}},et=async()=>{if(d.value.length===0){w.value="ÂàóË°®‰∏∫Á©∫ÔºåÊó†Ê≥ïÊí≠Êîæ";return}const e=d.value.map(t=>t.id);G.value=!0,w.value="";try{const t=await fetch(`${p.value}/player/queue`,{method:"PUT",headers:{...x(),"Content-Type":"application/json"},body:JSON.stringify({trackIds:e})});t.ok||console.warn("Queue replace failed",t.status),d.value.length>0&&d.value[0]&&await F(d.value[0]),S.value&&te()}catch(t){console.error("Play all failed",t),w.value="Êí≠ÊîæÂÖ®ÈÉ®Â§±Ë¥•: "+(t instanceof Error?t.message:String(t))}finally{G.value=!1}},_t=async e=>{try{const t={};e&&(t.trackId=e),await fetch(`${p.value}/player/play`,{method:"POST",headers:{...x(),"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(t){console.error(t)}},Tt=async()=>{try{await fetch(`${p.value}/player/pause`,{method:"POST",headers:x()})}catch(e){console.error(e)}},tt=async()=>{try{await fetch(`${p.value}/player/next`,{method:"POST",headers:x()}),S.value&&te()}catch(e){console.error(e)}},$t=async()=>{try{await fetch(`${p.value}/player/prev`,{method:"POST",headers:x()}),S.value&&te()}catch(e){console.error(e)}},It=async e=>{try{await fetch(`${p.value}/player/volume`,{method:"POST",headers:{...x(),"Content-Type":"application/json"},body:JSON.stringify({volume:e})}),s.value.volume=e}catch(t){console.error(t)}},Q=e=>{if(Array.isArray(e))return e;if(e&&typeof e=="object"){const t=e;if(Array.isArray(t.data))return t.data;if(Array.isArray(t.items))return t.items;if(Array.isArray(t.tracks))return t.tracks;if(Array.isArray(t.songs))return t.songs}return[]},X=e=>{if(!e||typeof e!="object")return null;const t=e,a=t.track&&typeof t.track=="object"?t.track:t,i=(E=>typeof E=="string"?E:typeof E=="number"&&Number.isFinite(E)?String(E):null)(a.id??t.trackId??a.trackId??t.songId??a.songId??t.id),c=typeof a.title=="string"?a.title:typeof a.name=="string"?a.name:typeof a.songName=="string"?a.songName:typeof t.title=="string"?t.title:typeof t.name=="string"?t.name:typeof t.songName=="string"?t.songName:null;if(!i||!c)return null;const f=a.album&&typeof a.album=="object"?a.album:null,_=Array.isArray(a.artists)&&a.artists.length>0?a.artists.map(E=>{if(typeof E=="string")return E;if(E&&typeof E=="object"){const mt=E;if(typeof mt.name=="string")return mt.name}return""}).filter(Boolean).join(", "):typeof a.artist=="string"?a.artist:a.artist&&typeof a.artist=="object"&&typeof a.artist.name=="string"?a.artist.name:typeof a.singer=="string"?a.singer:typeof a.artistName=="string"?a.artistName:typeof t.artistName=="string"?t.artistName:typeof t.singer=="string"?t.singer:void 0,b=a.album&&typeof a.album=="object"&&typeof a.album.title=="string"?a.album.title:typeof a.album=="string"?a.album:typeof a.albumName=="string"?a.albumName:typeof a.albumTitle=="string"?a.albumTitle:typeof t.albumTitle=="string"?t.albumTitle:typeof t.albumName=="string"?t.albumName:void 0,se=typeof a.duration=="number"?a.duration:typeof t.duration=="number"?t.duration:typeof a.length=="number"?a.length:typeof t.length=="number"?t.length:void 0,T=a.cover&&typeof a.cover=="object"?a.cover:t.cover&&typeof t.cover=="object"?t.cover:null,ht=typeof a.coverArtUrl=="string"?a.coverArtUrl:typeof a.coverUrl=="string"?a.coverUrl:f&&typeof f.coverArtUrl=="string"?f.coverArtUrl:f&&typeof f.coverUrl=="string"?f.coverUrl:T&&typeof T.url=="string"?T.url:T&&typeof T.src=="string"?T.src:T&&typeof T.path=="string"?T.path:T&&typeof T.imageUrl=="string"?T.imageUrl:typeof a.imageUrl=="string"?a.imageUrl:typeof a.coverArtPath=="string"?a.coverArtPath:f&&typeof f.coverArtPath=="string"?f.coverArtPath:typeof t.coverArtUrl=="string"?t.coverArtUrl:typeof t.coverUrl=="string"?t.coverUrl:typeof t.imageUrl=="string"?t.imageUrl:void 0,Y=typeof a.coverId=="string"?a.coverId:typeof t.coverId=="string"?t.coverId:void 0,Rt=typeof a.lyrics=="string"?a.lyrics:typeof t.lyrics=="string"?t.lyrics:void 0;return{id:i,title:c,artist:_,album:b,duration:se,coverUrl:ht,coverId:Y,lyrics:Rt}},L=async(e,t)=>{const a=await fetch(e,{...t,headers:{...x()}});return a.status!==401?a:(await Pe(),fetch(e,{...t,headers:{...x()}}))},Ue=async()=>{de.value=!0,re.value="";try{let e=await L(`${p.value}/songs?take=1000`);if(e.ok||(e=await L(`${p.value}/tracks?take=1000`)),!e.ok){const i=await Ge();if(i&&i.length>0){D.value=i.map(He),de.value=!1;return}throw new Error(await e.text())}const t=await e.json(),r=Q(t).map(X).filter(Boolean);D.value=r}catch(e){D.value=[],re.value=e.message||"Âä†ËΩΩÂ§±Ë¥•"}finally{de.value=!1}},Pt=(e,t)=>{if(!e.length)return;d.value=e;const a=e[0];a&&F(a)},at=async()=>{re.value="",D.value.length===0&&await Ue();const e=D.value;e.length&&(Pt(e),Xe.value=!1)},lt=async()=>{try{let e=await L(`${p.value}/playlists?take=1000`);if(e.ok||(e=await L(`${p.value}/music/playlists?take=1000`)),e.ok){const t=await e.json(),a=Q(t);xe.value=a.map(r=>{const i=r;return{id:i.id,name:i.name||i.title||"Êú™ÂëΩÂêçÊ≠åÂçï",coverUrl:pe(i.coverUrl||i.cover)}})}}catch(e){console.error("Fetch playlists failed",e)}},Ut=async()=>{try{const e=await L(`${p.value}/library/artists?take=1000`);if(e.ok){const t=await e.json(),a=Q(t);O.value=a.map(r=>{const i=r;return{id:i.id,name:i.name||i.artist||"Unknown Artist",coverUrl:pe(i.coverUrl||i.cover)}})}}catch(e){console.error("Fetch artists failed",e)}},Ct=async()=>{try{const e=await L(`${p.value}/library/albums?take=1000`);if(e.ok){const t=await e.json(),a=Q(t);R.value=a.map(r=>{const i=r;return{id:i.id,title:i.title||i.name||"Unknown Album",artist:i.artist,coverUrl:pe(i.coverUrl||i.cover)}})}}catch(e){console.error("Fetch albums failed",e)}},q=async()=>{!k.widget.data?.token&&k.widget.data?.username&&k.widget.data?.password&&await Pe(),G.value=!0,w.value="";try{let e=`${p.value}/songs?take=1000`;h.value==="playlists"&&j.value?e=`${p.value}/playlists/${j.value}/tracks?take=1000`:h.value==="artists"&&m.value?e=`${p.value}/library/artists/${m.value}/songs?take=1000`:h.value==="albums"&&g.value&&(e=`${p.value}/library/albums/${g.value}`);let t=await fetch(e,{headers:x()});if(!t.ok){console.warn(`Primary API ${e} failed with ${t.status}, trying fallback to /api/music-list`);const i=await Ge();if(i&&i.length>0){let c=i.map(He);if(h.value==="artists"&&m.value){const f=O.value.find(_=>_.id===m.value);if(f){const _=f.name.toLowerCase();c=c.filter(b=>b.artist?.toLowerCase().includes(_))}}else if(h.value==="albums"&&g.value){const f=R.value.find(_=>_.id===g.value);if(f){const _=f.title.toLowerCase();c=c.filter(b=>b.album?.toLowerCase().includes(_))}}else h.value==="playlists"&&j.value;if(c.length>0){d.value=c,G.value=!1;return}}if(h.value==="playlists"&&j.value)e=`${p.value}/playlists/${j.value}/songs?take=1000`,t=await fetch(e,{headers:x()});else if(h.value==="artists"&&m.value){if(e=`${p.value}/library/artists/${m.value}/tracks?take=1000`,t=await fetch(e,{headers:x()}),!t.ok){const c=O.value.find(f=>f.id===m.value);c&&c.name&&(e=`${p.value}/tracks?search=${encodeURIComponent(c.name)}&take=1000`,t=await fetch(e,{headers:x()}))}}else if(h.value==="albums"&&g.value){const c=R.value.find(f=>f.id===g.value);c&&c.title&&(e=`${p.value}/tracks?search=${encodeURIComponent(c.title)}&take=1000`,t=await fetch(e,{headers:x()}))}else e.includes("/songs")&&(e=e.replace("/songs","/tracks"),t=await fetch(e,{headers:x()}))}if(t.status===401&&(await Pe(),t=await fetch(e,{headers:x()})),!t.ok)throw new Error(`API Error: ${t.status}`);const a=await t.json(),r=Q(a);if(r.length===0&&h.value==="albums"&&g.value){const i=R.value.find(c=>c.id===g.value);if(i&&i.title){const c=`${p.value}/tracks?search=${encodeURIComponent(i.title)}&take=1000`,f=await L(c);if(f.ok){const _=await f.json(),b=Q(_);if(b.length>0){d.value=b.map(X).filter(Boolean),G.value=!1;return}}}}if(d.value=r.map(X).filter(Boolean),d.value.length===0&&!j.value){let i=await fetch(`${p.value}/songs?take=100`,{headers:x()});if(i.ok||(i=await fetch(`${p.value}/tracks?take=100`,{headers:x()})),i.ok){const c=await i.json(),f=Q(c);d.value=f.map(X).filter(Boolean)}}d.value.length===0&&(w.value="ÊöÇÊó†Ê≠åÊõ≤ÔºåËØ∑Ê£ÄÊü• API ÈÖçÁΩÆÊàñÊî∂Ëóè")}catch(e){console.error("Fetch tracks failed",e),w.value=`Âä†ËΩΩÂ§±Ë¥•: ${e.message}`,d.value=[]}finally{G.value=!1}},At=e=>{h.value=e,j.value=null,m.value=null,g.value=null,e==="playlists"&&xe.value.length===0&&lt(),e==="artists"&&O.value.length===0&&Ut(),e==="albums"&&R.value.length===0&&Ct(),e==="songs"?q():d.value=[]},Mt=e=>({songs:"Ê≠åÊõ≤",playlists:"Ê≠åÂçï",artists:"Ëâ∫‰∫∫",albums:"‰∏ìËæë"})[e]||e,jt=e=>{m.value=e,q()},St=e=>{g.value=e,q()},fe=()=>{ne.value&&(URL.revokeObjectURL(ne.value),ne.value=null,$e.value=null)},st=async(e,t=0,a=!0)=>{if(!v.value)return;const r=[`${p.value}/tracks/${encodeURIComponent(e)}/stream`,`${p.value}/songs/${encodeURIComponent(e)}/stream`];let i=null,c=null;for(const b of r){try{i=await L(b)}catch(Y){throw new Error(`ËøûÊé•Â§±Ë¥•: ${Y.message}`)}if(i.ok){c=null;break}const se=await i.text();let T=se;try{const Y=JSON.parse(se);typeof Y.error=="string"?T=Y.error:T=JSON.stringify(Y)}catch{}if(c={status:i.status,detail:T},!(i.status===404||T.includes("TRACK_NOT_FOUND")||T.toLowerCase().includes("not found")))break}if(!i||!i.ok)throw c?new Error(`Stream API Error ${c.status}: ${c.detail}`):new Error("Stream API Error: ËØ∑Ê±ÇÂ§±Ë¥•");const f=i.headers.get("content-type")||"";f&&!f.startsWith("audio/")&&!f.startsWith("application/octet-stream")&&!f.startsWith("video/")&&console.warn(`Unexpected content-type: ${f}`);const _=await i.blob();if(fe(),ne.value=URL.createObjectURL(_),$e.value=e,v.value.src=ne.value,v.value.currentTime=t,a)try{await v.value.play(),w.value=""}catch(b){throw s.value.isPlaying=!1,new Error(`Playback failed: ${b.name} - ${b.message}`)}},oe=y({}),Nt=async e=>{if(!oe.value[e])try{let t=await L(`${p.value}/tracks/${encodeURIComponent(e)}`);if(t.ok||(t=await L(`${p.value}/songs/${encodeURIComponent(e)}`)),!t.ok)return;const a=await t.json(),r=X(a);if(!r)return;oe.value={...oe.value,[e]:r}}catch{}};Z(()=>s.value.currentTrackId,e=>{e&&Nt(e)},{immediate:!0});const pe=e=>{if(!e)return;const t=k.widget.data?.token;if(e.startsWith("http")){const i=`${p.value}/proxy-image?url=${encodeURIComponent(e)}`;return t?`${i}&token=${t}`:i}const a=p.value.replace(/\/api(\/v\d+)?$/,""),r=e.startsWith("/")?`${a}${e}`:`${a}/${e}`;return t?`${r}${r.includes("?")?"&":"?"}token=${t}`:r},it=e=>{const t=k.widget.data?.token,r=oe.value[e.id]?.coverUrl||e.coverUrl;if(!r&&e.id){const i=`${p.value}/subsonic/rest/getCoverArt?id=track:${e.id}`,c=t?`${i}&token=${t}`:i;return A.getAssetUrl(c)}return A.getAssetUrl(pe(r))},M=N(()=>d.value.find(e=>e.id===s.value.currentTrackId)),ae=N(()=>{const e=M.value;return e?oe.value[e.id]??e:null});Z(()=>ae.value,e=>{e&&e.lyrics!==void 0&&(s.value.lyrics=e.lyrics)},{immediate:!0});const B=N(()=>{const e=ae.value;if(!e)return h.value==="artists"&&m.value&&O.value.find(i=>i.id===m.value)?.name||"";let t=e.artist||"";Array.isArray(t)&&(t=t.map(r=>{if(typeof r=="string")return r;if(r&&typeof r=="object"){const i=r;if(typeof i.name=="string")return i.name}return""}).filter(Boolean).join(", ")),t=t.trim();const a=(e.album||"").trim();return t&&a?`${t} ¬∑ ${a}`:t||a||""}),Ce=y(null),rt=y(null),P=N(()=>{if(!s.value.lyrics)return[];const e=s.value.lyrics.split(`
`),t=[],a=/\[(\d+):(\d+)(?:[:.](\d+))?\]/g;return e.forEach(r=>{const i=r.replace(/\[(\d+):(\d+)(?:[:.](\d+))?\]/g,"").trim();if(!i)return;let c;for(a.lastIndex=0;(c=a.exec(r))!==null;){const f=parseInt(c[1]??"0",10),_=parseInt(c[2]??"0",10),b=c[3]?parseInt(c[3],10):0,se=f*60+_+(b>99?b/1e3:b/100);t.push({time:se,text:i})}}),t.sort((r,i)=>r.time-i.time)}),$=N(()=>{const e=s.value.currentTime,t=P.value;if(t.length===0)return-1;for(let a=t.length-1;a>=0;a--){const r=t[a];if(r&&e>=r.time)return a}return 0});Z($,async()=>{if(!Ce.value)return;await Dt();const e=Ce.value,t=rt.value;if(!t)return;const a=e.offsetHeight/2-60,r=t.offsetTop-a+t.offsetHeight/2;e.scrollTo({top:Math.max(0,r),behavior:le.value?"auto":"smooth"})},{immediate:!0});const nt=new Set,ot=async e=>{if(nt.has(e.id))return;nt.add(e.id),v.value&&v.value.pause(),fe();const t=d.value.findIndex(a=>a.id===e.id);if(t!==-1&&d.value.splice(t,1),s.value.currentTrackId=null,s.value.isPlaying=!1,d.value.length>0){const a=d.value[Math.min(t,d.value.length-1)]||d.value[0];a&&await F(a);return}await q()},F=async(e,t={})=>{const{startTime:a=0,autoPlay:r=!0}=t;if(s.value.currentTrackId===e.id&&!a){ye();return}if(s.value.currentTrackId=e.id,s.value.isPlaying=r,A.activeMusicPlayer="music-widget",v.value){if(v.value.src&&v.value.src.startsWith("blob:")&&URL.revokeObjectURL(v.value.src),fe(),e.isLocal){const i=e.id.split("/").map(encodeURIComponent).join("/");if(v.value.src=`/music/${i}`,v.value.currentTime=a,r)try{await v.value.play(),w.value=""}catch(c){s.value.isPlaying=!1,w.value=`Êí≠ÊîæÂá∫Èîô: ${c.message}`}return}try{await st(e.id,a,r)}catch(i){console.error("Play error",i);const c=i.message;if(c.includes("TRACK_NOT_FOUND")){w.value="Ê≠åÊõ≤‰∏çÂ≠òÂú®ÔºåÂ∑≤Ë∑≥Ëøá",await ot(e);return}(c.includes("NotAllowedError")||c.toLowerCase().includes("playback failed"))&&(s.value.isPlaying=!1),w.value=`Êí≠ÊîæÂá∫Èîô: ${c}`}}},Et=async()=>(D.value.length===0&&await Ue(),D.value.length===0?!1:(await at(),!0)),ye=()=>{if(v.value){if(!s.value.currentTrackId){const e=d.value[0];if(e){F(e);return}(async()=>await Et()||await q())();return}s.value.isPlaying?(v.value.pause(),s.value.isPlaying=!1):(v.value.play().catch(()=>{}),s.value.isPlaying=!0,A.activeMusicPlayer="music-widget")}},Ae=()=>{const e=["sequence","random","single"],t=(e.indexOf(s.value.playbackMode)+1)%e.length;s.value.playbackMode=e[t]},he=(e=!1)=>{if(!d.value.length)return;if(e&&s.value.playbackMode==="single"){v.value&&(v.value.currentTime=0,v.value.play().catch(()=>{}));return}if(s.value.playbackMode==="random"){const i=Math.floor(Math.random()*d.value.length),c=d.value[i];c&&F(c),S.value&&tt();return}const a=(d.value.findIndex(i=>i.id===s.value.currentTrackId)+1)%d.value.length,r=d.value[a];r&&F(r),S.value&&tt()},Me=()=>{if(!d.value.length)return;const t=(d.value.findIndex(r=>r.id===s.value.currentTrackId)-1+d.value.length)%d.value.length,a=d.value[t];a&&F(a),S.value&&$t()},Ot=qt(()=>{const e={libraryMode:h.value,currentPlaylistId:j.value,currentArtistId:m.value,currentAlbumId:g.value,playerState:{volume:s.value.volume,playbackMode:s.value.playbackMode,currentTrackId:s.value.currentTrackId,currentTime:s.value.currentTime,isPlaying:s.value.isPlaying}};localStorage.setItem(Je,JSON.stringify(e))},1e3),Lt=()=>{const e={libraryMode:h.value,currentPlaylistId:j.value,currentArtistId:m.value,currentAlbumId:g.value,playerState:{volume:s.value.volume,playbackMode:s.value.playbackMode,currentTrackId:s.value.currentTrackId,currentTime:s.value.currentTime,isPlaying:s.value.isPlaying}};localStorage.setItem(Je,JSON.stringify(e))},zt=async()=>{const e=localStorage.getItem(Je);if(!e)return!1;try{const t=JSON.parse(e);if(h.value=t.libraryMode||"songs",j.value=t.currentPlaylistId||null,m.value=t.currentArtistId||null,g.value=t.currentAlbumId||null,t.playerState&&(s.value.volume=t.playerState.volume??.7,s.value.playbackMode=t.playerState.playbackMode||"sequence",t.playerState.currentTrackId)){await q();const a=d.value.find(r=>r.id===t.playerState.currentTrackId);if(a)return await F(a,{startTime:t.playerState.currentTime||0,autoPlay:t.playerState.isPlaying}),s.value.currentTime=t.playerState.currentTime||0,!0}}catch(t){console.error("Failed to restore playback state",t)}return!1},le=y(!1),ct=y(0),je=()=>{v.value&&(le.value||(s.value.currentTime=v.value.currentTime),s.value.duration=v.value.duration||0,vt())},Se=()=>{he(!0)},Ne=e=>{const t=e.target;s.value.volume=parseFloat(t.value),v.value&&(v.value.volume=s.value.volume),S.value&&It(s.value.volume)},Ee=()=>{S.value&&_t(s.value.currentTrackId||void 0)},Oe=()=>{S.value&&Tt()},Le=()=>{const e=s.value.currentTrackId;if(e&&$e.value!==e){st(e).catch(t=>{if((t.message||"").includes("TRACK_NOT_FOUND")){const r=d.value.find(i=>i.id===e);r&&ot(r),w.value="Ê≠åÊõ≤‰∏çÂ≠òÂú®ÔºåÂ∑≤Ë∑≥Ëøá";return}w.value="Èü≥È¢ëÊ∫ê‰∏çÊîØÊåÅÊàñÊó†ÊùÉÈôê"});return}w.value="Èü≥È¢ëÊ∫ê‰∏çÊîØÊåÅÊàñÊó†ÊùÉÈôê"},ze=e=>{const t=e.target,a=parseFloat(t.value);isNaN(a)||(le.value=!0,ct.value=a,s.value.currentTime=a)},me=e=>{const t=e?parseFloat(e.target.value):NaN,a=isNaN(t)?ct.value:t;v.value&&!isNaN(a)&&(v.value.currentTime=a,s.value.currentTime=a),le.value=!1},ut=()=>{le.value&&me()},dt=()=>{K.value=!1},vt=()=>{const e=v.value;if(!e||!e.duration||e.duration<=0||!e.buffered||e.buffered.length===0){ve.value=0;return}try{ve.value=e.buffered.end(e.buffered.length-1)}catch{ve.value=0}},Re=()=>{vt()},ft=e=>{const t=e.currentTarget,a=s.value.duration||0;if(!t||!a)return;const r=t.getBoundingClientRect();if(!r.width)return;const i=(e.clientX-r.left)/r.width,c=Math.max(0,Math.min(a,i*a));v.value&&(v.value.currentTime=c),s.value.currentTime=c},ce=e=>{if(!e||isNaN(e))return"0:00";const t=Math.floor(e/60),a=Math.floor(e%60);return`${t}:${a.toString().padStart(2,"0")}`};let ue=null;const pt=()=>{ue==null&&(ue=window.setInterval(te,3e3))},yt=()=>{ue!=null&&(window.clearInterval(ue),ue=null)};return Vt(()=>{const e=document.getElementById("flatnas-global-audio");e?(_e.value=!0,v.value=e,e.addEventListener("timeupdate",je),e.addEventListener("ended",Se),e.addEventListener("play",Ee),e.addEventListener("pause",Oe),e.addEventListener("progress",Re),e.addEventListener("error",Le),e.paused||(s.value.isPlaying=!0,s.value.currentTime=e.currentTime,A.activeMusicPlayer="music-widget")):v.value=Ke.value,q(),lt(),S.value&&(te(),pt()),(Qe.value||Te.value)&&(Ue(),!S.value&&A.appConfig.autoPlayMusic&&at()),!_e.value&&!S.value&&zt().then(t=>{t||!Qe.value&&Te.value}),window.addEventListener("click",dt),window.addEventListener("pointerup",ut)}),Z(()=>s.value.currentTime,()=>{Ot()}),Z([()=>s.value.currentTrackId,()=>s.value.volume,()=>s.value.playbackMode,()=>s.value.isPlaying,h,j,m,g],()=>{Lt()}),Jt(()=>{if(yt(),_e.value){const e=v.value;e&&(e.removeEventListener("timeupdate",je),e.removeEventListener("ended",Se),e.removeEventListener("play",Ee),e.removeEventListener("pause",Oe),e.removeEventListener("progress",Re),e.removeEventListener("error",Le))}else fe();window.removeEventListener("click",dt),window.removeEventListener("pointerup",ut)}),Z(S,e=>{e?(te(),pt()):yt()}),(e,t)=>(o(),n("div",{class:"w-full h-full backdrop-blur-md border border-white/20 rounded-2xl flex flex-col overflow-hidden shadow-lg hover:shadow-xl transition-all group relative",style:z({backgroundColor:`rgba(255, 255, 255, ${(ee.widget.opacity??.1)*.4})`})},[V.value?(o(),n("div",{key:0,class:"absolute inset-0 bg-cover bg-center transition-all duration-700 blur-md opacity-80 pointer-events-none",style:z({backgroundImage:`url('${V.value}')`})},null,4)):(o(),n("div",Qt)),l("audio",{ref_key:"localAudioRef",ref:Ke,onTimeupdate:je,onEnded:Se,onPlay:Ee,onPause:Oe,onProgress:Re,onError:Le,crossorigin:"anonymous"},null,544),ee.widget.colSpan===1&&ee.widget.rowSpan===1?(o(),n("div",Xt,[l("div",{class:U(["aplayer aplayer-mini",{"aplayer-withlist":Ie.value}])},[l("div",Yt,[l("div",Zt,[l("button",{class:"aplayer-pic-btn",onClick:I(ye,["stop"]),title:s.value.isPlaying?"ÊöÇÂÅú":"Êí≠Êîæ",style:z(V.value?{backgroundImage:`url('${V.value}')`}:void 0)},[l("span",{class:U(["aplayer-pic-icon",{"is-playing":s.value.isPlaying}])},u(s.value.isPlaying?qe:Ve),3)],12,ea)]),l("div",ta,[l("div",aa,[l("span",{class:U(["aplayer-title",{"aplayer-marquee":(M.value?.title||"").length>15}])},[ge(u(M.value?.title||"ÈÄâÊã©Êí≠Êîæ")+" ",1),(M.value?.title||"").length>15?(o(),n("span",la,u(M.value?.title),1)):C("",!0)],2)]),l("div",sa,[l("span",{class:U(["aplayer-author",{"aplayer-marquee":B.value.length>20}])},[ge(u(B.value)+" ",1),B.value.length>20?(o(),n("span",ia,u(B.value),1)):C("",!0)],2)]),w.value?(o(),n("div",{key:0,class:"text-xs text-red-400 mt-0.5 truncate",title:w.value},u(w.value),9,ra)):C("",!0),l("div",na,[l("div",oa,[l("button",{class:"aplayer-btn",onClick:I(Me,["stop"]),title:"‰∏ä‰∏ÄÈ¶ñ"},u(Fe)),l("button",{class:"aplayer-btn",onClick:t[0]||(t[0]=I(a=>he(),["stop"])),title:"‰∏ã‰∏ÄÈ¶ñ"},u(De))]),l("div",ca,[l("button",{class:"aplayer-btn",onClick:I(Ae,["stop"]),title:s.value.playbackMode==="random"?"ÈöèÊú∫Êí≠Êîæ":s.value.playbackMode==="single"?"ÂçïÊõ≤Âæ™ÁéØ":"È°∫Â∫èÊí≠Êîæ"},u(s.value.playbackMode==="random"?bt:s.value.playbackMode==="single"?wt:gt),9,ua),l("div",da,[l("button",{class:"aplayer-btn",onClick:t[1]||(t[1]=I(a=>K.value=!K.value,["stop"])),title:"Èü≥Èáè"},[...t[14]||(t[14]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"},[l("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})],-1)])]),be(l("div",{class:"aplayer-volume-panel",onClick:t[2]||(t[2]=I(()=>{},["stop"]))},[l("input",{type:"range",min:"0",max:"1",step:"0.05",value:s.value.volume,onInput:Ne,class:"aplayer-volume-slider"},null,40,va)],512),[[Be,K.value]])])])]),l("div",fa,[l("div",{class:"aplayer-bar-wrap",onClick:I(ft,["stop"])},[l("div",pa,[l("div",{class:"aplayer-loaded",style:z({width:`${Ze.value}%`})},null,4),l("div",{class:"aplayer-played",style:z({width:`${Ye.value}%`})},[...t[15]||(t[15]=[l("span",{class:"aplayer-thumb"},null,-1)])],4),l("input",{class:"aplayer-seek",type:"range",min:0,max:s.value.duration||0,value:s.value.currentTime,disabled:!s.value.duration,step:"0.1",onInput:ze,onChange:me},null,40,ya)])]),l("span",ha,u(ce(s.value.currentTime)),1)])])])],2)])):ee.widget.colSpan===1&&ee.widget.rowSpan===3?(o(),n("div",ma,[l("div",{class:U(["aplayer aplayer-mini is-tall",{"aplayer-withlist":Ie.value}])},[l("div",ga,[l("div",ba,[l("button",{class:"aplayer-pic-btn",onClick:I(ye,["stop"]),title:s.value.isPlaying?"ÊöÇÂÅú":"Êí≠Êîæ",style:z(V.value?{backgroundImage:`url('${V.value}')`}:void 0)},[l("span",{class:U(["aplayer-pic-icon",{"is-playing":s.value.isPlaying}])},u(s.value.isPlaying?qe:Ve),3)],12,wa)]),l("div",xa,[l("div",ka,[l("span",{class:U(["aplayer-title",{"aplayer-marquee":(M.value?.title||"").length>15}])},[ge(u(M.value?.title||"ÈÄâÊã©Êí≠Êîæ")+" ",1),(M.value?.title||"").length>15?(o(),n("span",_a,u(M.value?.title),1)):C("",!0)],2)]),l("div",Ta,[l("span",{class:U(["aplayer-author",{"aplayer-marquee":B.value.length>20}])},[ge(u(B.value)+" ",1),B.value.length>20?(o(),n("span",$a,u(B.value),1)):C("",!0)],2)]),l("div",Ia,[l("div",Pa,[l("button",{class:"aplayer-btn",onClick:I(Me,["stop"]),title:"‰∏ä‰∏ÄÈ¶ñ"},u(Fe)),l("button",{class:"aplayer-btn",onClick:t[3]||(t[3]=I(a=>he(),["stop"])),title:"‰∏ã‰∏ÄÈ¶ñ"},u(De))]),l("div",Ua,[l("button",{class:"aplayer-btn",onClick:I(Ae,["stop"]),title:s.value.playbackMode==="random"?"ÈöèÊú∫Êí≠Êîæ":s.value.playbackMode==="single"?"ÂçïÊõ≤Âæ™ÁéØ":"È°∫Â∫èÊí≠Êîæ"},u(s.value.playbackMode==="random"?bt:s.value.playbackMode==="single"?wt:gt),9,Ca),l("div",Aa,[l("button",{class:"aplayer-btn",onClick:t[4]||(t[4]=I(a=>K.value=!K.value,["stop"])),title:"Èü≥Èáè"},[...t[16]||(t[16]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"},[l("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})],-1)])]),be(l("div",{class:"aplayer-volume-panel",onClick:t[5]||(t[5]=I(()=>{},["stop"]))},[l("input",{type:"range",min:"0",max:"1",step:"0.05",value:s.value.volume,onInput:Ne,class:"aplayer-volume-slider"},null,40,Ma)],512),[[Be,K.value]])])])]),l("div",ja,[l("div",{class:"aplayer-bar-wrap",onClick:I(ft,["stop"])},[l("div",Sa,[l("div",{class:"aplayer-loaded",style:z({width:`${Ze.value}%`})},null,4),l("div",{class:"aplayer-played",style:z({width:`${Ye.value}%`})},[...t[17]||(t[17]=[l("span",{class:"aplayer-thumb"},null,-1)])],4),l("input",{class:"aplayer-seek",type:"range",min:0,max:s.value.duration||0,value:s.value.currentTime,disabled:!s.value.duration,step:"0.1",onInput:ze,onChange:me},null,40,Na)])]),l("span",Ea,u(ce(s.value.currentTime)),1)])])]),be(l("div",{class:"aplayer-list",onClick:t[6]||(t[6]=I(()=>{},["stop"]))},[l("div",Oa,[de.value?(o(),n("div",La,"Âä†ËΩΩ‰∏≠...")):re.value?(o(),n("div",za,u(re.value),1)):(o(),n("div",Ra," Â∑≤Âä†ËΩΩÂÖ®ÈÉ®Ê≠åÊõ≤Ôºà"+u(D.value.length)+"Ôºâ ",1))])],512),[[Be,Ie.value]])],2)])):(o(),n("div",Ba,[l("div",Fa,[l("div",Da,[l("div",Va,[l("div",qa,[V.value?(o(),n("img",{key:0,src:V.value,class:"w-full h-full object-cover"},null,8,Ja)):(o(),n("img",Wa))]),l("div",Ha,[l("div",Ga,u(M.value?.title||"ÈÅìÁêÜÈ±ºÈü≥‰πê"),1),l("div",Ka,u(B.value||(M.value?"":"Êú™Êí≠Êîæ")),1)]),l("button",{onClick:Ae,class:"absolute bottom-1 right-2 flex items-center justify-center text-[12px] scale-[1.8] transition-all duration-200 ease-out text-white/50 hover:text-white/90",title:s.value.playbackMode==="random"?"ÈöèÊú∫Êí≠Êîæ":s.value.playbackMode==="single"?"Âæ™ÁéØÊí≠Êîæ":"È°∫Â∫èÊí≠Êîæ"},u(s.value.playbackMode==="random"?"‚•Æ":s.value.playbackMode==="single"?"‚ü≥":"‚áâ"),9,Qa)]),l("div",Xa,[l("div",Ya,[l("span",Za,u(ce(s.value.currentTime)),1),l("input",{type:"range",max:s.value.duration||100,value:s.value.currentTime,onInput:ze,onChange:me,class:"flex-1 h-1 bg-white/20 rounded-lg appearance-none cursor-pointer accent-blue-400 min-w-0"},null,40,el),l("span",tl,u(ce(s.value.duration)),1)])])]),l("div",al,[l("div",ll,[(o(),n(J,null,W(["songs","artists","albums"],a=>l("button",{key:a,onClick:r=>At(a),class:U(["px-2 py-0.5 text-[10px] rounded whitespace-nowrap transition-colors",h.value===a?"bg-blue-500 text-white shadow-sm":"bg-white/10 text-white/60 hover:bg-white/20"])},u(Mt(a)),11,sl)),64))]),h.value==="playlists"?be((o(),n("select",{key:0,"onUpdate:modelValue":t[7]||(t[7]=a=>j.value=a),onChange:q,class:"w-full bg-black/20 text-white/90 text-xs rounded px-2 py-1 outline-none border border-white/10 focus:border-blue-500/50 hover:bg-black/30 transition-colors"},[t[18]||(t[18]=l("option",{value:null,class:"text-black"},"ËØ∑ÈÄâÊã©Ê≠åÂçï...",-1)),(o(!0),n(J,null,W(xe.value,a=>(o(),n("option",{key:a.id,value:a.id,class:"text-black"},u(a.name),9,il))),128))],544)),[[Wt,j.value]]):C("",!0)]),l("div",{class:"flex-1 overflow-y-auto overflow-x-hidden custom-scrollbar",onWheel:t[10]||(t[10]=I(()=>{},["stop"]))},[G.value?(o(),n("div",rl,"Âä†ËΩΩ‰∏≠...")):w.value?(o(),n("div",nl,u(w.value),1)):(o(),n("div",ol,[h.value==="artists"&&!m.value?(o(),n("div",cl,[(o(!0),n(J,null,W(O.value,a=>(o(),n("div",{key:a.id,onClick:r=>jt(a.id),class:"flex flex-col items-center gap-1 cursor-pointer group hover:bg-white/5 p-2 rounded-lg transition-colors"},[l("div",dl,[a.coverUrl?(o(),n("img",{key:0,src:we(A).getAssetUrl(a.coverUrl),class:"w-full h-full object-cover"},null,8,vl)):(o(),n("div",fl," üë§ "))]),l("span",pl,u(a.name),1)],8,ul))),128))])):h.value==="albums"&&!g.value?(o(),n("div",yl,[(o(!0),n(J,null,W(R.value,a=>(o(),n("div",{key:a.id,onClick:r=>St(a.id),class:"flex flex-col items-center gap-1 cursor-pointer group hover:bg-white/5 p-2 rounded-lg transition-colors"},[l("div",ml,[a.coverUrl?(o(),n("img",{key:0,src:we(A).getAssetUrl(a.coverUrl),class:"w-full h-full object-cover"},null,8,gl)):(o(),n("div",bl," üíø "))]),l("span",wl,u(a.title),1)],8,hl))),128))])):(o(),n("div",xl,[h.value==="artists"&&m.value?(o(),n("div",kl,[l("button",{onClick:t[8]||(t[8]=a=>m.value=null),class:"w-5 h-5 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center text-white/80 transition-colors text-xs",title:"ËøîÂõû"}," ‚Üê "),l("div",_l,[O.value.find(a=>a.id===m.value)?.coverUrl?(o(),n("img",{key:0,src:we(A).getAssetUrl(O.value.find(a=>a.id===m.value)?.coverUrl),class:"w-5 h-5 rounded-full object-cover border border-white/10"},null,8,Tl)):C("",!0),l("span",$l,u(O.value.find(a=>a.id===m.value)?.name||"Ëâ∫‰∫∫Ê≠åÂçï"),1)]),l("button",{onClick:et,class:"text-[10px] bg-blue-500 hover:bg-blue-600 text-white px-2 py-0.5 rounded shadow-sm transition-colors"}," Êí≠ÊîæÂÖ®ÈÉ® ")])):C("",!0),h.value==="albums"&&g.value?(o(),n("div",Il,[l("button",{onClick:t[9]||(t[9]=a=>g.value=null),class:"w-5 h-5 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center text-white/80 transition-colors text-xs",title:"ËøîÂõû"}," ‚Üê "),l("div",Pl,[R.value.find(a=>a.id===g.value)?.coverUrl?(o(),n("img",{key:0,src:we(A).getAssetUrl(R.value.find(a=>a.id===g.value)?.coverUrl),class:"w-5 h-5 rounded object-cover border border-white/10"},null,8,Ul)):C("",!0),l("span",Cl,u(R.value.find(a=>a.id===g.value)?.title||"‰∏ìËæëÊ≠åÂçï"),1)]),l("button",{onClick:et,class:"text-[10px] bg-blue-500 hover:bg-blue-600 text-white px-2 py-0.5 rounded shadow-sm transition-colors"}," Êí≠ÊîæÂÖ®ÈÉ® ")])):C("",!0),(o(!0),n(J,null,W(d.value,(a,r)=>(o(),n("div",{key:a.id,onClick:i=>F(a),class:U(["px-3 py-0.5 hover:bg-white/10 cursor-pointer flex items-center gap-1.5 transition-colors group/item",{"bg-blue-500/20":M.value?.id===a.id}])},[l("div",Ml,[M.value?.id===a.id&&s.value.isPlaying?(o(),n("span",jl,[...t[19]||(t[19]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-3.5 h-3.5 inline-block"},[l("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})],-1)])])):(o(),n("span",Sl,u(r+1),1))]),l("div",Nl,[l("div",{class:U(["text-xs font-medium text-white/90 truncate",{"text-blue-400":M.value?.id===a.id}])},u(a.title),3),l("div",El,u(a.artist),1)]),l("div",Ol,u(ce(a.duration||0)),1)],10,Al))),128))]))]))],32)]),l("div",{class:"w-[61.8%] flex flex-col bg-black/10 h-full relative",onWheel:t[13]||(t[13]=I(()=>{},["stop"]))},[l("div",{class:U(["absolute top-4 right-4 z-30 transition-opacity duration-300",[ie.value?"opacity-100":"opacity-0 group-hover:opacity-100"]])},[l("button",{onClick:t[11]||(t[11]=a=>ie.value=!ie.value),class:"w-8 h-8 rounded-full bg-black/40 backdrop-blur-md flex items-center justify-center text-white/70 hover:text-white hover:bg-black/60 transition-all border border-white/10",title:"ÂàáÊç¢Êí≠ÊîæÊïàÊûú"},u(We.find(a=>a.id===H.value)?.icon||"üé®"),1),ie.value?(o(),n("div",Ll,[(o(),n(J,null,W(We,a=>l("button",{key:a.id,onClick:r=>xt(a.id),class:U(["w-full px-4 py-2.5 text-left text-xs flex items-center gap-3 transition-colors hover:bg-white/10",H.value===a.id?"text-blue-400 font-bold bg-white/5":"text-white/70"])},[l("span",Rl,u(a.icon),1),l("span",null,u(a.label),1)],10,zl)),64))])):C("",!0)],2),H.value==="lyrics"?(o(),n("div",{key:0,ref_key:"lyricsContainer",ref:Ce,class:"flex-1 overflow-y-auto overflow-x-hidden custom-scrollbar p-4 text-center scroll-smooth"},[P.value.length>0?(o(),n("div",Bl,[(o(!0),n(J,null,W(P.value,(a,r)=>(o(),n("div",{key:r,class:U(["transition-all duration-500 py-2 text-sm leading-relaxed tracking-wide origin-center break-words",r===$.value?"text-white font-bold scale-[1.5] opacity-100":r===$.value+1?"text-white/90 font-bold scale-[1.3] opacity-90":r<$.value?"text-white/80 font-bold scale-[1.1] opacity-80":"text-white/35 opacity-50"]),ref_for:!0,ref:i=>{r===$.value&&(rt.value=i)}},u(a.text),3))),128))])):s.value.lyrics?(o(),n("div",Fl,u(s.value.lyrics),1)):(o(),n("div",Dl,[...t[20]||(t[20]=[l("span",{class:"text-2xl opacity-50"},"üìù",-1),l("span",{class:"text-xs"},"ÊöÇÊó†Ê≠åËØç",-1)])]))],512)):H.value==="spectrum"?(o(),n("div",Vl,[l("div",ql,[l("div",Jl,[(o(),n(J,null,W(12,a=>l("div",{key:a,class:"w-1.5 bg-gradient-to-t from-blue-600/40 to-blue-400/80 rounded-t-sm animate-pulse",style:z({height:`${20+Math.random()*80}%`,animationDuration:`${.5+Math.random()*1}s`})},null,4)),64))]),l("div",Wl,[P.value.length>0&&$.value>=0?(o(),n("div",Hl,[l("div",Gl,u(P.value[$.value]?.text),1),P.value[$.value+1]?(o(),n("div",Kl,u(P.value[$.value+1]?.text),1)):C("",!0)])):(o(),n("div",Ql,[...t[21]||(t[21]=[l("span",{class:"text-xs font-medium text-white/60"},"È¢ëË∞±ÂàÜÊûê",-1),l("span",{class:"text-[10px] opacity-50"},"Spectrum Analyzer",-1)])]))])])])):H.value==="abstract"?(o(),n("div",Xl,[t[23]||(t[23]=Ht('<div class="relative w-40 h-40 flex items-center justify-center" data-v-fbc48ef6><div class="absolute inset-0 rounded-full border border-blue-500/20 animate-[ping_3s_linear_infinite]" data-v-fbc48ef6></div><div class="absolute inset-4 rounded-full border border-purple-500/20 animate-[ping_2s_linear_infinite]" data-v-fbc48ef6></div><div class="absolute inset-8 rounded-full border border-pink-500/20 animate-pulse" data-v-fbc48ef6></div><div class="z-10 text-3xl animate-bounce" data-v-fbc48ef6>‚ú®</div></div>',1)),l("div",Yl,[P.value.length>0&&$.value>=0?(o(),n("div",Zl,[l("div",es,u(P.value[$.value]?.text),1),P.value[$.value+1]?(o(),n("div",ts,u(P.value[$.value+1]?.text),1)):C("",!0)])):(o(),n("div",as,[...t[22]||(t[22]=[l("span",{class:"text-xs font-medium text-white/60"},"ÊäΩË±°Âä®Áîª",-1),l("span",{class:"text-[10px] opacity-50"},"Abstract Visualizations",-1)])]))])])):H.value==="vinyl"?(o(),n("div",ls,[l("div",ss,[l("div",{class:U(["w-56 h-56 rounded-full bg-[#111] border-[6px] border-[#222] shadow-[0_0_50px_rgba(0,0,0,0.8)] flex items-center justify-center relative overflow-hidden",{"animate-[spin_10s_linear_infinite]":s.value.isPlaying}])},[t[24]||(t[24]=l("div",{class:"absolute inset-0 opacity-30",style:{background:`repeating-radial-gradient(
                      circle,
                      transparent 0,
                      transparent 3px,
                      rgba(255, 255, 255, 0.05) 4px,
                      transparent 5px
                    )`}},null,-1)),l("div",is,[ae.value?.coverUrl?(o(),n("img",{key:0,src:it(ae.value),class:"w-full h-full object-cover"},null,8,rs)):(o(),n("div",ns," üíø "))]),t[25]||(t[25]=l("div",{class:"absolute w-2 h-2 bg-black rounded-full z-20 shadow-inner"},null,-1))],2),l("div",{class:"absolute -top-6 -right-4 w-32 h-32 pointer-events-none transition-transform duration-700 ease-in-out origin-[85%_15%]",style:z({transform:s.value.isPlaying?"rotate(0deg)":"rotate(-25deg)"})},[...t[26]||(t[26]=[l("div",{class:"absolute top-[15%] right-[15%] w-4 h-4 bg-zinc-600 rounded-full"},null,-1),l("div",{class:"absolute top-[18%] right-[17%] w-1.5 h-24 bg-gradient-to-b from-zinc-500 to-zinc-700 rounded-full origin-top rotate-[25deg]"},null,-1),l("div",{class:"absolute bottom-[15%] left-[10%] w-4 h-6 bg-zinc-800 rounded-sm rotate-[25deg]"},null,-1)])],4)]),l("div",os,[P.value.length>0&&$.value>=0?(o(),n("div",cs,[l("div",us,u(P.value[$.value]?.text),1),P.value[$.value+1]?(o(),n("div",ds,u(P.value[$.value+1]?.text),1)):C("",!0)])):(o(),n("div",vs,[...t[27]||(t[27]=[l("span",{class:"text-xs font-medium text-white/60"},"Â∞ÅÈù¢‰∏éÈªëËÉ∂",-1),l("span",{class:"text-[10px] opacity-50"},"Cover Art & Vinyl",-1)])]))])])):C("",!0),l("div",fs,[l("div",ps,[l("div",ys,[l("button",{onClick:Me,class:"w-7 h-7 rounded-full flex items-center justify-center bg-white/5 hover:bg-white/10 transition-colors text-white/70"},u(Fe)),l("button",{onClick:ye,class:"w-8 h-8 rounded-full flex items-center justify-center bg-white/10 hover:bg-white/20 transition-colors text-white scale-[1.3] transition-transform"},u(s.value.isPlaying?qe:Ve),1),l("button",{onClick:t[12]||(t[12]=()=>he()),class:"w-7 h-7 rounded-full flex items-center justify-center bg-white/5 hover:bg-white/10 transition-colors text-white/70"},u(De))]),l("div",hs,[t[28]||(t[28]=l("span",{class:"text-xs text-white/70"},[l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-4 h-4"},[l("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})])],-1)),l("input",{type:"range",min:"0",max:"1",step:"0.05",value:s.value.volume,onInput:Ne,class:"w-20 h-1 bg-white/20 rounded-lg appearance-none cursor-pointer accent-blue-400"},null,40,ms)])])])],32)]))],4))}}),xs=Gt(gs,[["__scopeId","data-v-fbc48ef6"]]);export{xs as default};
