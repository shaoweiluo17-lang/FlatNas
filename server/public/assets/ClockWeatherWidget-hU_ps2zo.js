import{d as Q,u as X,r as v,w as Y,c as z,y as Z,o as tt,a as s,e as i,g as a,b as n,G as P,F as M,h as S,q as A,p as C,i as et,f as O,t as d,E as at,l as ot,m as it,n as st,T as lt,j as nt,L as rt,_ as dt}from"./index-CEb9R0bB.js";const ct={class:"h-full w-full relative overflow-hidden text-white group select-none transition-all duration-500 rounded-2xl"},ut={key:0,class:"absolute -top-10 -right-10 w-48 h-48 opacity-30 animate-spin-slow"},ht={key:1,class:"absolute inset-0"},vt={key:2,class:"absolute inset-0 overflow-hidden"},pt={key:3,class:"absolute inset-0 flex justify-around items-start overflow-hidden opacity-50"},wt={key:4,class:"absolute inset-0 overflow-hidden"},ft={key:5,class:"absolute inset-0 overflow-hidden"},mt={key:0,class:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity z-20"},gt={class:"relative z-10 h-full flex flex-col justify-between p-2 sm:p-3"},yt={class:"flex items-start justify-between"},bt={class:"text-[10px] sm:text-xs font-bold tracking-widest uppercase bg-white/10 px-1.5 py-0.5 rounded backdrop-blur-md border border-white/10 shadow-sm"},xt={class:"relative z-20"},_t={class:"text-xs font-medium truncate max-w-[60px]"},kt={class:"bg-gray-900/90 p-6 rounded-2xl border border-white/10 shadow-2xl max-w-sm w-full backdrop-blur-xl"},Ct={class:"mb-6 w-full"},It={class:"flex items-center gap-2 mb-2 text-sm"},Dt={key:0,class:"text-white/30"},Mt={key:1,class:"text-white font-bold"},St={key:0,class:"grid grid-cols-4 gap-2 mb-4"},jt=["onClick"],$t={key:1,class:"grid grid-cols-4 gap-2 max-h-[200px] overflow-y-auto pr-1 custom-scrollbar"},zt=["onClick"],Lt={key:2,class:"h-[200px] flex items-center justify-center text-white/40 text-xs"},Tt={class:"flex gap-3 justify-end"},Nt={class:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none pt-8"},Bt={class:"flex items-center gap-2 mt-2"},Et={class:"text-sm sm:text-base font-medium opacity-90 drop-shadow-md"},Wt={key:0,class:"w-1.5 h-1.5 rounded-full bg-green-400 shadow-[0_0_8px_rgba(74,222,128,0.6)]"},Ut={class:"flex items-end justify-between pb-0.5"},Vt={class:"flex flex-col justify-end"},Rt={class:"text-2xl sm:text-3xl font-bold tracking-tight drop-shadow-md leading-none"},Kt={key:0,class:"flex flex-col items-end gap-0.5 text-xs sm:text-sm font-medium opacity-80"},Pt={key:0},At=Q({__name:"ClockWeatherWidget",props:{widget:{}},setup(q){const c=q,r=X(),w=v(null),F=async()=>{if(!w.value)try{const t=await rt(()=>import("./cityData-DPPCip0y.js"),[]);w.value=t.cityData}catch(t){console.error("Failed to load city data",t)}},g=v(!1),y=v(""),u=v("");Y(g,t=>{t&&F()});const L=v(""),T=v(""),l=v({temp:"--",city:(()=>{if(c.widget?.data?.city)return c.widget.data.city;try{const t=localStorage.getItem("flatnas_auto_city");if(t)return JSON.parse(t).city}catch{}return"ÂÆö‰Ωç‰∏≠..."})(),text:"...",humidity:"",today:{min:"",max:""}}),N=v(!1);let b=null,x=null;const J=v(Array.from({length:6},(t,e)=>({id:e+1,animationDelay:`${Math.random()}s`,opacity:Math.random()}))),H=v(Array.from({length:12},(t,e)=>({id:e+1,left:`${Math.random()*100}%`,top:"-10px",animationDelay:`${Math.random()*5}s`,animationDuration:`${3+Math.random()*4}s`})));c.widget?.data?.city&&(y.value=c.widget.data.city);const j=()=>{try{if(c.widget){const t=y.value.trim(),e={...c.widget.data||{},city:t};r.saveWidget(c.widget.id,e),W()}}catch(t){console.error("Failed to save city",t)}finally{g.value=!1}},h=z(()=>{const t=l.value.text;return t.includes("Èõ®")?"rain":t.includes("Èõ™")?"snow":t.includes("Èõæ")||t.includes("Èúæ")?"fog":t.includes("‰∫ë")||t.includes("Èò¥")?"cloudy":t.includes("Êô¥")?N.value?"clear-night":"sunny":"default"}),G=z(()=>{switch(h.value){case"sunny":return"bg-gradient-to-br from-blue-400 via-blue-300 to-orange-200";case"clear-night":return"bg-gradient-to-br from-indigo-900 via-purple-900 to-slate-900";case"cloudy":return"bg-gradient-to-br from-slate-400 via-slate-300 to-gray-200";case"rain":return"bg-gradient-to-br from-slate-700 via-blue-900 to-slate-800";case"snow":return"bg-gradient-to-br from-blue-100 via-white to-blue-50";case"fog":return"bg-gradient-to-br from-gray-500 via-slate-400 to-zinc-400";default:return"bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-500"}}),B=z(()=>["snow","cloudy","fog"].includes(h.value)),$=()=>{const t=new Date;L.value=t.toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit"}),T.value=t.toLocaleDateString("zh-CN",{month:"short",day:"numeric",weekday:"short"});const e=t.getHours();N.value=e<6||e>=18},E=(t,e)=>Date.now()-t<e,W=async()=>{try{let t="Êú¨Âú∞";if(c.widget?.data?.city)t=c.widget.data.city;else{const p=localStorage.getItem("flatnas_auto_city");let D=!1;if(p)try{const f=JSON.parse(p);E(f.timestamp,3600*1e3)&&(t=f.city,D=!0)}catch{localStorage.removeItem("flatnas_auto_city")}if(!D)if(r.appConfig.weatherSource==="amap"&&r.appConfig.amapKey||r.appConfig.weatherSource==="qweather")t="auto";else{const f=await fetch("/api/ip");if(!f.ok)throw new Error("IP API Error");const k=await f.json();if(k.success&&k.location){let m=k.location.split(" ")[0];m=m.replace(/^(?:.*?ÁúÅ|.*?Ëá™Ê≤ªÂå∫|.*?ÁâπÂà´Ë°åÊîøÂå∫)/,"");const K=m.match(/^(.*?[Â∏ÇÂ∑ûÁõüÂú∞Âå∫])/);K&&(m=K[1]),t=m,localStorage.setItem("flatnas_auto_city",JSON.stringify({city:t,timestamp:Date.now()}))}}}const e=localStorage.getItem(`flatnas_weather_${t}`);if(e)try{const p=JSON.parse(e);if(E(p.timestamp,1200*1e3)){l.value=p.weather;return}}catch{localStorage.removeItem(`flatnas_weather_${t}`)}let o=`/api/weather?city=${encodeURIComponent(t)}`;if(r.appConfig.weatherApiUrl)o=r.appConfig.weatherApiUrl,o.includes("{city}")&&(o=o.replace("{city}",encodeURIComponent(t)));else{const p=r.appConfig.weatherSource||"wttr",D=r.appConfig.amapKey||"",f=r.appConfig.qweatherProjectId||"",k=r.appConfig.qweatherKeyId||"",m=r.appConfig.qweatherPrivateKey||"";o+=`&source=${p}&key=${encodeURIComponent(D)}`,p==="qweather"&&(o+=`&projectId=${encodeURIComponent(f)}&keyId=${encodeURIComponent(k)}&privateKey=${encodeURIComponent(m)}`)}const I=await fetch(o);if(!I.ok)throw new Error("Weather API Error");const _=await I.json();if(_.success&&_.data)l.value={temp:_.data.temp,city:t,text:_.data.text,humidity:_.data.humidity,today:_.data.today},localStorage.setItem(`flatnas_weather_${t}`,JSON.stringify({weather:l.value,timestamp:Date.now()}));else throw new Error("Weather data invalid")}catch(t){console.warn("[Weather] Ëé∑ÂèñÂ§±Ë¥•ÔºåËΩ¨‰∏∫Á¶ªÁ∫øÊ®°Âºè",t),l.value={temp:"22",city:"Êú¨Âú∞",text:"ËàíÈÄÇ",humidity:"50%",today:{min:"18",max:"25"}}}},U=()=>{$(),x&&clearTimeout(x),b&&clearInterval(b);const t=(60-new Date().getSeconds())*1e3;x=setTimeout(()=>{$(),b=setInterval($,6e4)},t)},V=()=>{x&&clearTimeout(x),x=null,b&&clearInterval(b),b=null},R=()=>{document.visibilityState==="hidden"?V():U()};return Z(()=>{W(),U(),document.addEventListener("visibilitychange",R)}),tt(()=>{V(),document.removeEventListener("visibilitychange",R)}),(t,e)=>(i(),s("div",ct,[a("div",{class:C(["absolute inset-0 transition-colors duration-1000 ease-in-out",G.value])},[h.value==="sunny"?(i(),s("div",ut,[...e[6]||(e[6]=[a("svg",{viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[a("circle",{cx:"50",cy:"50",r:"20",fill:"yellow"}),a("path",{d:"M50 10V20 M50 80V90 M10 50H20 M80 50H90 M22 22L29 29 M71 71L78 78 M22 78L29 71 M71 29L78 22",stroke:"yellow","stroke-width":"4","stroke-linecap":"round"})],-1)])])):n("",!0),h.value==="clear-night"?(i(),s("div",ht,[...e[7]||(e[7]=[P('<div class="absolute top-10 right-10 w-16 h-16 text-yellow-100 opacity-80 animate-pulse" data-v-f32a02c1><svg viewBox="0 0 24 24" fill="currentColor" data-v-f32a02c1><path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z" data-v-f32a02c1></path></svg></div><div class="star absolute top-1/4 left-1/4 w-1 h-1 bg-white rounded-full animate-twinkle" data-v-f32a02c1></div><div class="star absolute top-3/4 right-1/3 w-1 h-1 bg-white rounded-full animate-twinkle delay-75" data-v-f32a02c1></div><div class="star absolute bottom-1/4 left-1/3 w-1 h-1 bg-white rounded-full animate-twinkle delay-150" data-v-f32a02c1></div>',4)])])):n("",!0),h.value==="cloudy"?(i(),s("div",vt,[...e[8]||(e[8]=[P('<div class="absolute top-4 right-[-20%] w-32 h-20 opacity-40 animate-float-slow" data-v-f32a02c1><svg viewBox="0 0 24 24" fill="currentColor" class="text-white" data-v-f32a02c1><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z" data-v-f32a02c1></path></svg></div><div class="absolute bottom-8 left-[-10%] w-24 h-16 opacity-30 animate-float-slower" data-v-f32a02c1><svg viewBox="0 0 24 24" fill="currentColor" class="text-white" data-v-f32a02c1><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z" data-v-f32a02c1></path></svg></div>',2)])])):n("",!0),h.value==="rain"?(i(),s("div",pt,[(i(!0),s(M,null,S(J.value,o=>(i(),s("div",{key:o.id,class:"w-0.5 h-16 bg-gradient-to-b from-transparent to-white animate-rain",style:A({animationDelay:o.animationDelay,opacity:o.opacity})},null,4))),128))])):n("",!0),h.value==="snow"?(i(),s("div",wt,[(i(!0),s(M,null,S(H.value,o=>(i(),s("div",{key:o.id,class:"absolute w-1.5 h-1.5 bg-white rounded-full animate-snow opacity-80",style:A({left:o.left,top:o.top,animationDelay:o.animationDelay,animationDuration:o.animationDuration})},null,4))),128))])):n("",!0),h.value==="fog"?(i(),s("div",ft,[...e[9]||(e[9]=[a("div",{class:"absolute bottom-0 left-[-50%] w-[200%] h-[60%] bg-white/20 blur-[40px] animate-fog-flow"},null,-1),a("div",{class:"absolute bottom-[-20%] left-[-20%] w-[150%] h-[50%] bg-white/10 blur-[30px] animate-fog-flow-reverse"},null,-1)])])):n("",!0)],2),a("div",{class:C(["absolute inset-0 backdrop-blur-[0px] group-hover:backdrop-blur-[2px] transition-all duration-500",B.value?"bg-black/30":"bg-black/5"])},null,2),c.widget&&et(r).isLogged?(i(),s("div",mt,[a("button",{onClick:e[0]||(e[0]=O(o=>g.value=!0,["stop"])),class:"p-1.5 bg-black/10 text-white/70 hover:text-white rounded-full hover:bg-black/30 backdrop-blur-md transition-colors",title:"ËÆæÁΩÆÂüéÂ∏Ç"},[...e[10]||(e[10]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})],-1)])])])):n("",!0),a("div",gt,[a("div",yt,[a("span",bt,d(T.value),1),a("div",xt,[a("div",{onClick:e[1]||(e[1]=o=>{g.value=!0,y.value=l.value.city}),class:"flex items-center gap-1 opacity-90 cursor-pointer hover:opacity-100 transition-opacity"},[e[11]||(e[11]=a("svg",{class:"w-3 h-3 opacity-80",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),a("span",_t,d(l.value.city),1)]),(i(),at(lt,{to:"body"},[g.value?(i(),s("div",{key:0,class:"fixed inset-0 bg-black/60 backdrop-blur-md z-[9999] flex flex-col items-center justify-center p-4",onClick:e[5]||(e[5]=O(()=>{},["stop"]))},[a("div",kt,[e[12]||(e[12]=a("div",{class:"text-lg font-medium mb-4 text-white"},"ËÆæÁΩÆÂüéÂ∏Ç",-1)),ot(a("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>y.value=o),onKeyup:st(j,["enter"]),placeholder:"ËæìÂÖ•ÂüéÂ∏Ç (‰∏∫Á©∫Ëá™Âä®)",class:"w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/40 text-left outline-none focus:bg-white/20 focus:border-white/40 mb-4 transition-all",autofocus:""},null,544),[[it,y.value]]),a("div",Ct,[a("div",It,[a("button",{onClick:e[3]||(e[3]=o=>u.value=""),class:C(["text-white/50 hover:text-white transition-colors",{"font-bold text-white":!u.value}])}," ÁúÅ‰ªΩ/Âú∞Âå∫ ",2),u.value?(i(),s("span",Dt,"/")):n("",!0),u.value?(i(),s("span",Mt,d(u.value),1)):n("",!0)]),u.value?w.value&&w.value[u.value]?(i(),s("div",$t,[(i(!0),s(M,null,S(w.value[u.value],o=>(i(),s("button",{key:o,onClick:I=>{y.value=o,j()},class:"px-1 py-1.5 bg-white/5 hover:bg-white/20 text-white/70 hover:text-white rounded text-xs transition-colors truncate border border-white/5 hover:border-white/20"},d(o),9,zt))),128))])):(i(),s("div",Lt," Âä†ËΩΩ‰∏≠... ")):(i(),s("div",St,[(i(!0),s(M,null,S(w.value?Object.keys(w.value):[],o=>(i(),s("button",{key:o,onClick:I=>u.value=o,class:C(["px-2 py-1.5 text-xs rounded transition-colors text-center truncate border",u.value===o?"bg-blue-500 border-blue-500 text-white shadow-md":"bg-white/5 border-white/10 text-white/70 hover:bg-white/10 hover:border-white/20"])},d(o),11,jt))),128))]))]),a("div",Tt,[a("button",{onClick:e[4]||(e[4]=o=>g.value=!1),class:"px-4 py-2 bg-white/5 hover:bg-white/10 text-white/80 rounded-lg text-sm transition-colors"}," ÂèñÊ∂à "),a("button",{onClick:j,class:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-sm transition-colors font-medium shadow-lg shadow-blue-900/20"}," Á°ÆÂÆö ")])])])):n("",!0)]))])]),a("div",Nt,[a("div",{class:C(["text-3xl sm:text-4xl font-bold tracking-tighter font-mono leading-none bg-gradient-to-b from-white to-white/80 bg-clip-text text-transparent",B.value?"drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]":"drop-shadow-lg"])},d(L.value),3),a("div",Bt,[a("span",Et,d(l.value.text),1),h.value==="sunny"||h.value==="clear-night"?(i(),s("div",Wt)):n("",!0)])]),a("div",Ut,[a("div",Vt,[a("div",Rt,[nt(d(l.value.temp),1),e[13]||(e[13]=a("span",{class:"text-base align-top"},"¬∞",-1))])]),l.value.today&&l.value.today.min?(i(),s("div",Kt,[a("span",null,"üå°Ô∏è "+d(l.value.today.min)+"¬∞/"+d(l.value.today.max)+"¬∞",1),l.value.humidity?(i(),s("span",Pt,"üíß "+d(l.value.humidity)+"%",1)):n("",!0)])):n("",!0)])])]))}}),Ft=dt(At,[["__scopeId","data-v-f32a02c1"]]);export{Ft as default};
