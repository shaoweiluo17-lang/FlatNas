import{d as F,u as j,r as h,c as B,w as H,y as L,a as o,e as l,g as n,b as k,F as S,h as D,p as W,t as f,f as $,j as z,q as A,_ as E}from"./index-CEb9R0bB.js";const I={key:0,class:"w-full py-2.5 text-xs text-white/60 text-center"},N=["onClick"],V={key:0,class:"absolute bottom-0 left-0 right-0 h-0.5 bg-white/60"},Y={class:"flex-1 overflow-hidden relative"},q={key:0,class:"h-full flex flex-col items-center justify-center text-white/60 p-4 text-center"},P={key:1,class:"p-8 text-center text-white/60 text-xs animate-pulse"},G={key:2,class:"p-8 text-center text-white/70 text-xs"},J={key:3,class:"flex flex-col py-1"},K=["href"],O={class:"text-sm text-white/80 group-hover/item:text-white transition-colors font-medium line-clamp-2 mb-1"},Q={class:"flex justify-between items-center"},U={key:0,class:"text-[10px] text-white/50 line-clamp-1 flex-1 mr-2"},X={key:1,class:"text-[10px] text-white/40 whitespace-nowrap"},Z=300*1e3,tt=F({__name:"RssWidget",props:{widget:{}},setup(C){const u=j(),y=h({}),r=h(""),i=h([]),p=h(!1),x=h(""),d=B(()=>u.rssFeeds.filter(t=>t.enable));H(d,t=>{if(t.length>0){if(!t.find(s=>s.id===r.value)){const s=t[0];s&&(r.value=s.id,b(s))}}else r.value="",i.value=[]},{deep:!0});const b=async(t,s=!1)=>{if(!t)return;r.value=t.id,x.value="";const e=Date.now(),a=y.value[t.url];if(!s&&a&&e-a.ts<Z){i.value=a.data;return}p.value=!0,i.value=[],u.socket.emit("rss:fetch",{url:t.url});const w=c=>{if(c.url===t.url){const T=c.data.items||[];i.value=T.map(g=>({title:g.title,link:g.link,pubDate:g.pubDate,contentSnippet:g.contentSnippet})),y.value[t.url]={data:i.value,ts:Date.now()},p.value=!1,_()}},v=c=>{c.url===t.url&&(console.error(`Failed to load RSS: ${t.title}`,c.error),x.value="åŠ è½½å¤±è´¥",i.value=[],p.value=!1,_())},_=()=>{u.socket.off("rss:data",w),u.socket.off("rss:error",v)};u.socket.on("rss:data",w),u.socket.on("rss:error",v)};L(()=>{const t=d.value[0];t&&(r.value=t.id,b(t))});const M=t=>{const s=t.currentTarget,{scrollTop:e,scrollHeight:a,clientHeight:w}=s,v=t.deltaY,_=e<=0,c=e+w>=a-1;(_&&v<0||c&&v>0)&&(t.preventDefault(),t.stopPropagation())},m=h(null),R=t=>{m.value&&t.deltaY!==0&&(m.value.scrollLeft+=t.deltaY)};return(t,s)=>(l(),o("div",{class:"w-full h-full rounded-2xl backdrop-blur border border-white/10 overflow-hidden flex flex-col text-white relative transition-shadow",style:A({backgroundColor:`rgba(0,0,0,${Math.min(.85,Math.max(.15,C.widget?.opacity??.35))})`,color:"#fff"})},[n("div",{ref_key:"tabsRef",ref:m,onWheel:$(R,["prevent"]),class:"flex border-b border-white/10 bg-white/10 select-none overflow-x-auto custom-scrollbar"},[d.value.length===0?(l(),o("div",I," æš‚æ— è®¢é˜…æº ")):k("",!0),(l(!0),o(S,null,D(d.value,e=>(l(),o("button",{key:e.id,onClick:a=>b(e),class:W(["flex-shrink-0 px-4 py-2.5 text-xs font-bold transition-all flex items-center justify-center gap-1.5 relative whitespace-nowrap",r.value===e.id?"text-white bg-white/15":"text-white/60 hover:bg-white/10 hover:text-white"])},[n("span",null,f(e.title),1),r.value===e.id?(l(),o("div",V)):k("",!0)],10,N))),128))],544),n("div",Y,[n("div",{class:"h-full overflow-y-auto custom-scrollbar p-0",onWheel:M},[d.value.length===0?(l(),o("div",q,[...s[1]||(s[1]=[n("span",{class:"text-2xl mb-2"},"ðŸ“¡",-1),n("span",{class:"text-xs"},"è¯·åœ¨è®¾ç½®ä¸­æ·»åŠ å¹¶å¯ç”¨ RSS è®¢é˜…æº",-1)])])):p.value&&i.value.length===0?(l(),o("div",P," åŠ è½½ä¸­... ")):x.value?(l(),o("div",G,[z(f(x.value)+" ",1),n("button",{onClick:s[0]||(s[0]=e=>b(d.value.find(a=>a.id===r.value),!0)),class:"block mx-auto mt-2 text-white/80 hover:text-white hover:underline"}," é‡è¯• ")])):(l(),o("div",J,[(l(!0),o(S,null,D(i.value,(e,a)=>(l(),o("a",{key:a,href:e.link,target:"_blank",class:"block px-3 py-2 hover:bg-white/10 transition-colors group/item border-b border-white/10 last:border-0"},[n("div",O,f(e.title),1),n("div",Q,[e.contentSnippet?(l(),o("div",U,f(e.contentSnippet),1)):k("",!0),e.pubDate?(l(),o("div",X,f(new Date(e.pubDate).toLocaleDateString()),1)):k("",!0)])],8,K))),128))]))],32)])],4))}}),st=E(tt,[["__scopeId","data-v-0ead2acb"]]);export{st as default};
