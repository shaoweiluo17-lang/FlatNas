import{d as N,u as B,r as b,C as D,w as U,y as V,a as r,e as c,g as a,b as m,t as w,F as W,h as F,l as y,v as L,q as k,p as $,m as z,n as A,J as _,_ as H}from"./index-B3Or9p3Y.js";const K={class:"font-bold text-white text-xs mb-2 flex justify-between items-center"},j={class:"flex items-center gap-2"},q={key:0,class:"text-[10px] font-normal text-white/60 transition-opacity"},E={class:"text-[10px] text-white/60"},J=["onUpdate:modelValue"],P=["onClick"],Y={key:0,class:"text-xs text-white/50 text-center py-2"},G={class:"mt-2 pt-2 border-t border-white/10 flex gap-2"},O=N({__name:"TodoWidget",props:{widget:{}},setup(n){const o=n,i=B(),l=b(""),d=b("saved"),f=_(()=>{i.isLogged&&i.socket.emit("todo:update",{token:i.token||localStorage.getItem("flat-nas-token"),widgetId:o.widget.id,content:o.widget.data})},100),C=_(async()=>{i.isLogged&&(d.value="saving",await i.saveWidget(),setTimeout(()=>{d.value="saved"},500))},500),h=D(`flatnas-todo-backup-${o.widget.id}`,[]);U(()=>o.widget.data,t=>{t&&(h.value=t)},{deep:!0}),V(()=>{(!o.widget.data||o.widget.data.length===0)&&h.value.length>0&&(o.widget.data=h.value)});const g=()=>{d.value="unsaved",C()},x=()=>{l.value&&(o.widget.data||(o.widget.data=[]),o.widget.data.push({id:Date.now().toString(),text:l.value,done:!1}),l.value="",f(),g())},S=t=>{const s=typeof t=="string"?Number(t):t;Number.isNaN(s)||(o.widget.data.splice(s,1),f(),g())},T=t=>{const s=t.currentTarget,{scrollTop:e,scrollHeight:p,clientHeight:u}=s,v=t.deltaY,I=e<=0,M=e+u>=p-1;(I&&v<0||M&&v>0)&&(t.preventDefault(),t.stopPropagation())};return(t,s)=>(c(),r("div",{class:"w-full h-full rounded-2xl backdrop-blur border border-white/10 overflow-hidden flex flex-col text-white p-3",style:k({backgroundColor:`rgba(0,0,0,${Math.min(.85,Math.max(.15,n.widget.opacity??.35))})`,color:"#fff"})},[a("div",K,[a("div",j,[s[1]||(s[1]=a("span",null,"✅ 待办",-1)),d.value!=="saved"?(c(),r("span",q,w(d.value==="saving"?"...":"•"),1)):m("",!0)]),a("span",E,w(n.widget.data?.filter(e=>!e.done).length||0)+" 待完成",1)]),a("div",{class:"flex-1 overflow-y-auto space-y-1 scrollbar-hide",onWheel:T},[(c(!0),r(W,null,F(n.widget.data,(e,p)=>(c(),r("div",{key:e.id,class:"flex items-start gap-2 group"},[y(a("input",{type:"checkbox","onUpdate:modelValue":u=>e.done=u,onChange:g,class:"rounded text-white focus:ring-0 cursor-pointer mt-0.5"},null,40,J),[[L,e.done]]),a("span",{class:$(["text-xs flex-1 break-all whitespace-normal leading-tight",e.done?"line-through":""]),style:k({color:e.done?"#9ca3af":"#ffffff"})},w(e.text),7),a("button",{onClick:u=>S(p),class:"text-xs text-white/50 hover:text-white/80 border border-white/10 rounded px-2 py-0.5 hover:bg-white/10 transition-colors whitespace-nowrap shrink-0"}," 删除 ",8,P)]))),128)),n.widget.data?.length?m("",!0):(c(),r("div",Y," 无待办事项 "))],32),a("div",G,[y(a("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>l.value=e),onKeyup:A(x,["enter"]),placeholder:"添加待办...",class:"flex-1 text-xs bg-white/10 border border-white/20 rounded px-2 py-1 outline-none focus:bg-white/10 focus:border-white/40 transition-colors text-white placeholder-white/50"},null,544),[[z,l.value]]),a("button",{onClick:x,class:"bg-white/10 text-white text-xs px-3 py-1 rounded hover:bg-white/20 transition-colors whitespace-nowrap"}," 回车 ")])],4))}}),R=H(O,[["__scopeId","data-v-015954a7"]]);export{R as default};
