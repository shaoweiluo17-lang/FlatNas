import{d as I,u as M,r as p,c as T,w as E,y as j,o as B,a as l,e as a,g as i,b as g,F as y,h as S,p as H,t as x,f as L,j as N,q as V,_ as W}from"./index-CVQJtkH-.js";const $={key:0,class:"w-full py-2.5 text-xs text-white/60 text-center"},z=["onClick"],A={key:0,class:"absolute bottom-0 left-0 right-0 h-0.5 bg-white/60"},Y={class:"flex-1 overflow-hidden relative"},q={key:0,class:"h-full flex flex-col items-center justify-center text-white/60 p-4 text-center"},P={key:1,class:"p-8 text-center text-white/60 text-xs animate-pulse"},U={key:2,class:"p-8 text-center text-white/70 text-xs"},G={key:3,class:"flex flex-col py-1"},J=["href"],K={class:"text-sm text-white/80 group-hover/item:text-white transition-colors font-medium line-clamp-2 mb-1"},O={class:"flex justify-between items-center"},Q={key:0,class:"text-[10px] text-white/50 line-clamp-1 flex-1 mr-2"},X={key:1,class:"text-[10px] text-white/40 whitespace-nowrap"},Z=900*1e3,ee=I({__name:"RssWidget",props:{widget:{}},setup(D){const d=M(),n=p(""),v=p([]),b=p(!1),w=p("");let o,c;const h=T(()=>d.rssFeeds.filter(e=>e.enable));E(h,e=>{if(e.length>0){if(!e.find(s=>s.id===n.value)){const s=e[0];s&&(n.value=s.id,_(s))}}else n.value="",v.value=[]},{deep:!0});const _=async e=>{if(!e)return;o&&(o(),o=void 0),c&&(clearInterval(c),c=void 0),n.value=e.id,w.value="",b.value=!0,v.value=[];const s=u=>{if(u.url===e.url){const m=u.data.items||[];v.value=m.map(f=>({title:f.title,link:f.link,pubDate:f.pubDate,contentSnippet:f.contentSnippet})),b.value=!1,o&&(o(),o=void 0)}},t=u=>{u.url===e.url&&(console.error(`Failed to load RSS: ${e.title}`,u.error),w.value="åŠ è½½å¤±è´¥",v.value=[],b.value=!1,o&&(o(),o=void 0))};o=()=>{d.socket.off("rss:data",s),d.socket.off("rss:error",t)},d.socket.on("rss:data",s),d.socket.on("rss:error",t);const r=()=>{d.socket.emit("rss:fetch",{url:e.url})};r(),c=setInterval(r,Z)};j(()=>{const e=h.value[0];e&&(n.value=e.id,_(e))}),B(()=>{o&&(o(),o=void 0),c&&(clearInterval(c),c=void 0)});const R=e=>{const s=e.currentTarget,{scrollTop:t,scrollHeight:r,clientHeight:u}=s,m=e.deltaY,f=t<=0,F=t+u>=r-1;(f&&m<0||F&&m>0)&&(e.preventDefault(),e.stopPropagation())},k=p(null),C=e=>{k.value&&e.deltaY!==0&&(k.value.scrollLeft+=e.deltaY)};return(e,s)=>(a(),l("div",{class:"w-full h-full rounded-2xl backdrop-blur border border-white/10 overflow-hidden flex flex-col text-white relative transition-shadow",style:V({backgroundColor:`rgba(0,0,0,${Math.min(.85,Math.max(.15,D.widget?.opacity??.35))})`,color:"#fff"})},[i("div",{ref_key:"tabsRef",ref:k,onWheel:L(C,["prevent"]),class:"flex border-b border-white/10 bg-white/10 select-none overflow-x-auto custom-scrollbar"},[h.value.length===0?(a(),l("div",$," æš‚æ— è®¢é˜…æº ")):g("",!0),(a(!0),l(y,null,S(h.value,t=>(a(),l("button",{key:t.id,onClick:r=>_(t),class:H(["flex-shrink-0 px-4 py-2.5 text-xs font-bold transition-all flex items-center justify-center gap-1.5 relative whitespace-nowrap",n.value===t.id?"text-white bg-white/15":"text-white/60 hover:bg-white/10 hover:text-white"])},[i("span",null,x(t.title),1),n.value===t.id?(a(),l("div",A)):g("",!0)],10,z))),128))],544),i("div",Y,[i("div",{class:"h-full overflow-y-auto custom-scrollbar p-0",onWheel:R},[h.value.length===0?(a(),l("div",q,[...s[1]||(s[1]=[i("span",{class:"text-2xl mb-2"},"ðŸ“¡",-1),i("span",{class:"text-xs"},"è¯·åœ¨è®¾ç½®ä¸­æ·»åŠ å¹¶å¯ç”¨ RSS è®¢é˜…æº",-1)])])):b.value&&v.value.length===0?(a(),l("div",P," åŠ è½½ä¸­... ")):w.value?(a(),l("div",U,[N(x(w.value)+" ",1),i("button",{onClick:s[0]||(s[0]=t=>_(h.value.find(r=>r.id===n.value))),class:"block mx-auto mt-2 text-white/80 hover:text-white hover:underline"}," é‡è¯• ")])):(a(),l("div",G,[(a(!0),l(y,null,S(v.value,(t,r)=>(a(),l("a",{key:r,href:t.link,target:"_blank",class:"block px-3 py-2 hover:bg-white/10 transition-colors group/item border-b border-white/10 last:border-0"},[i("div",K,x(t.title),1),i("div",O,[t.contentSnippet?(a(),l("div",Q,x(t.contentSnippet),1)):g("",!0),t.pubDate?(a(),l("div",X,x(new Date(t.pubDate).toLocaleDateString()),1)):g("",!0)])],8,J))),128))]))],32)])],4))}}),se=W(ee,[["__scopeId","data-v-71ce6256"]]);export{se as default};
