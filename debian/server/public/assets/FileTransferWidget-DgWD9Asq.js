import{d as gt,u as bt,r as h,N as mt,O as yt,c as H,C as kt,w as Ke,x as be,y as _t,P as Ct,Q as Tt,a as l,e as n,b as d,E as Ge,g as i,p as k,i as _,t as p,F as S,h as Y,q as me,j as St,f as D,T as Je,l as Pt,m as Lt,n as Mt,_ as $t}from"./index-DetE_Czq.js";const It={key:0,class:"absolute inset-0 z-20 pointer-events-none flex items-center justify-center"},jt={key:1,class:"border-b border-white/10 px-3 py-2"},Dt={class:"mt-2 flex items-center justify-between gap-2 flex-wrap"},Et={class:"flex items-center gap-1 bg-white/10 rounded-xl p-1 border border-white/10"},Ot={class:"flex items-center gap-2"},zt=["disabled"],Rt={key:2,class:"px-3 py-2 border-b border-white/10 space-y-2"},Ut={class:"flex-1 min-w-0"},Nt={class:"flex items-center justify-between gap-2"},Bt={class:"text-xs font-semibold text-white truncate"},At={class:"text-[11px] text-white/60 shrink-0"},Ft={class:"mt-1 h-1.5 bg-white/10 rounded-full overflow-hidden"},Ht={class:"mt-1 flex items-center justify-between"},Yt={class:"text-[11px] text-white/60"},Wt={key:0,class:"text-red-200 ml-2"},Xt={class:"flex items-center gap-1"},Kt=["onClick"],Gt=["onClick"],Jt=["onClick"],Vt=["disabled"],Qt=["disabled"],Zt=["disabled"],qt={key:1,class:"h-px bg-white/10"},eo={class:"flex-1 min-h-0 overflow-hidden"},to={key:0,class:"h-full flex items-center justify-center text-white/70"},oo={key:1,class:"h-full flex flex-col"},so={key:0,class:"px-3 py-2 text-xs text-red-100 bg-red-500/20 border-b border-red-500/20"},no={key:1,class:"px-3 py-2 text-xs text-white/60"},io={key:0,class:"text-center text-white/70 text-sm py-10"},lo={key:1,class:"space-y-2"},ro={class:"flex justify-center"},ao={class:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10 text-[10px] text-white/60"},co=["data-transfer-id","onClick","onContextmenu","onPointerdown","onTouchstart"],uo={class:"whitespace-pre-wrap break-words"},fo=["href"],ho={key:1},po=["data-transfer-id","onClick","onContextmenu","onPointerdown","onTouchstart"],vo={class:"flex items-center gap-3"},xo={class:"w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center border border-white/10 overflow-hidden"},wo=["src"],go={key:1},bo={class:"min-w-0"},mo={class:"text-[11px] text-white/60"},yo={key:0,class:"text-center text-white/70 text-sm py-10"},ko={key:1,class:"space-y-2"},_o=["checked","onChange"],Co={class:"w-9 h-9 rounded-xl bg-white/10 border border-white/10 flex items-center justify-center shrink-0 overflow-hidden"},To=["src"],So={key:1},Po={key:2},Lo={class:"flex-1 min-w-0"},Mo={class:"text-sm font-bold text-white truncate"},$o={class:"text-[11px] text-white/60"},Io={class:"flex items-center gap-1"},jo=["onClick"],Do=["onClick"],Eo=["onClick"],Oo={key:0,class:"text-center text-white/70 text-sm py-10"},zo={key:1,class:"grid grid-cols-2 md:grid-cols-3 gap-2"},Ro=["onClick"],Uo=["src","alt"],No={key:1,class:"text-white/60 text-sm"},Bo=["placeholder"],Ao={class:"px-4 py-3 border-b border-white/10 flex items-center justify-between"},Fo={class:"min-w-0"},Ho={class:"text-sm font-bold text-white truncate"},Yo={key:0,class:"text-[11px] text-white/60"},Wo={class:"flex items-center gap-2"},Xo={class:"p-4"},Ko={key:0},Go=["src","alt"],Jo={key:1,class:"rounded-xl bg-white/5 border border-white/10 p-4 text-sm text-white/80"},Vo=2,Qo=50*1024*1024,Zo=1800*1e3,qo=gt({__name:"FileTransferWidget",props:{widget:{}},setup(ye){const re=ye,c=bt(),W=h(null),{isMobile:Ve}=mt(yt(c.appConfig,"deviceMode")),P=H(()=>re.widget.w===1&&re.widget.h===2),b=kt(`flatnas-transfer-tab-${re.widget.id}`,"chat"),ae=h(!1),I=h(null),u=h([]),q=h(null),Qe=async()=>{await be(),q.value&&(q.value.scrollTop=q.value.scrollHeight)},X=h(""),ke=h(null),_e=h(null),R=h(!1),K=h(0),G=h(!1),U=h(!1),Ce=h(0),Te=h(0),v=h(null),L=h([]),ee=h(0),de=h(!1),x=h(null),g=h({}),Ze=H(()=>[...u.value].sort((e,t)=>(e.timestamp||0)-(t.timestamp||0))),Se=H(()=>{const e=Ze.value,t=[];let o=-1;for(const s of e){const r=Number(s.timestamp)||0,a=t[t.length-1];!a||o>=0&&r-o>Zo?t.push({key:s.id,timestamp:r,items:[s]}):a.items.push(s),o=r}return t}),w=h({}),E=H(()=>Object.values(w.value).filter(Boolean).length),qe=(e,t)=>{const o={...w.value};t?o[e]=!0:delete o[e],w.value=o},Pe=e=>qe(e,!w.value[e]),J=()=>{const e=c.token||localStorage.getItem("flat-nas-token"),t={};return e&&(t.Authorization=`Bearer ${e}`),t},V=e=>{const t=Number(e)||0;if(t<1024)return`${t} B`;const o=t/1024;if(o<1024)return`${o.toFixed(1)} KB`;const s=o/1024;return s<1024?`${s.toFixed(1)} MB`:`${(s/1024).toFixed(2)} GB`},et=e=>{try{return new Date(e).toLocaleString()}catch{return""}},tt=e=>{try{const t=new Date(e),o=new Date;return t.getFullYear()===o.getFullYear()&&t.getMonth()===o.getMonth()&&t.getDate()===o.getDate()?t.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}):t.toLocaleString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}},ot=e=>{const t=String(e??"");if(!t)return[{kind:"text",text:""}];const o=/https?:\/\/[^\s<>"'`]+/g,s=[];let r=0;for(const a of t.matchAll(o)){const m=a[0]||"",y=a.index??-1;if(!m||y<0)continue;y>r&&s.push({kind:"text",text:t.slice(r,y)});let f=m,$="";for(;f&&/[)\]}\.,!?;:]+$/.test(f);)$=f.slice(-1)+$,f=f.slice(0,-1);f&&f!=="http://"&&f!=="https://"?s.push({kind:"link",text:f,href:f}):s.push({kind:"text",text:m}),$&&s.push({kind:"text",text:$}),r=y+m.length}return r<t.length&&s.push({kind:"text",text:t.slice(r)}),s.length?s:[{kind:"text",text:t}]},st=e=>`${e.name}|${e.size}|${e.lastModified}`,nt=e=>{const t=e.currentTarget,{scrollTop:o,scrollHeight:s,clientHeight:r}=t,a=e.deltaY,m=o<=0,y=o+r>=s-1;(m&&a<0||y&&a>0)&&(e.preventDefault(),e.stopPropagation())},Le=e=>{if(e.type==="add"&&e.item)u.value.some(t=>t.id===e.item.id)||(u.value=[e.item,...u.value].slice(0,1e3));else if(e.type==="delete"&&e.id){if(u.value=u.value.filter(t=>t.id!==e.id),w.value[e.id]){const t={...w.value};delete t[e.id],w.value=t}x.value?.id===e.id&&ie()}},Me=async()=>{if(c.isLogged){ae.value=!0,I.value=null;try{const e=b.value==="photos"?"photo":b.value==="files"?"file":"all",t=J(),o=await fetch(`/api/transfer/items?type=${encodeURIComponent(e)}&limit=1000`,{headers:t}),s=await o.json().catch(()=>({}));if(!o.ok||!s.success)throw new Error(s.error||`HTTP ${o.status}`);u.value=Array.isArray(s.items)?s.items:[]}catch(e){const t=e instanceof Error?e.message:String(e);I.value=t||"åŠ è½½å¤±è´¥"}finally{ae.value=!1}}},$e=()=>_e.value?.click(),ce=e=>{if(!c.isLogged)return;const t=e.filter(o=>o&&o.size>0);if(t.length){for(const o of t)L.value.push({id:`q-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,file:o,status:"queued",progress:0});ue()}},it=e=>{const t=e.target,o=t.files?Array.from(t.files):[];ce(o),t&&(t.value="")},lt=e=>{e.preventDefault(),e.stopPropagation(),R.value=!1,K.value=0;const t=e.dataTransfer?.files?Array.from(e.dataTransfer.files):[];ce(t)},Ie=e=>Array.from(e.dataTransfer?.types||[]).includes("Files"),rt=e=>{Ie(e)&&(K.value+=1,R.value=!0)},at=e=>{Ie(e)&&(e.preventDefault(),R.value=!0)},dt=()=>{K.value=Math.max(0,K.value-1),K.value===0&&(R.value=!1)},N=e=>u.value.find(t=>t.id===e)||null,C=()=>{U.value=!1,v.value=null},Q=(e,t,o)=>{Ce.value=Math.max(8,Math.min(e,window.innerWidth-196-8)),Te.value=Math.max(8,Math.min(t,window.innerHeight-220-8)),v.value=o,U.value=!0},ct=e=>{if(!c.isLogged)return;e.preventDefault();const o=e.target?.closest?.("[data-transfer-id]");Q(e.clientX,e.clientY,o?.dataset.transferId||null)},je=e=>{if(te===e.id){te=null;return}if(G.value){Pe(e.id);return}e.type==="file"&&ne(e)},ut=H(()=>{if(typeof navigator>"u")return!1;const e=navigator;return Math.max(0,e.maxTouchPoints||0,e.msMaxTouchPoints||0)>0?!0:typeof window<"u"&&"ontouchstart"in window}),De=H(()=>ut.value);let O=null,B=0,A=0,M=null,te=null,F=null;const j=()=>{O&&window.clearTimeout(O),O=null,M=null,F=null},Ee=(e,t)=>{if(!c.isLogged||!De.value||U.value||F==="pointer")return;const o=e.touches&&e.touches[0];o&&(j(),F="touch",B=o.clientX,A=o.clientY,M=t,O=window.setTimeout(()=>{M&&(te=M,Q(B,A,M),j())},520))},Oe=e=>{if(!O||F!=="touch")return;const t=e.touches&&e.touches[0];if(!t)return;const o=t.clientX-B,s=t.clientY-A;o*o+s*s>256&&j()},oe=()=>{j()},ze=(e,t)=>{c.isLogged&&De.value&&(U.value||e.pointerType==="touch"&&(j(),F="pointer",B=e.clientX,A=e.clientY,M=t,O=window.setTimeout(()=>{M&&(te=M,Q(B,A,M),j())},520)))},Re=e=>{if(!O||F!=="pointer"||e.pointerType!=="touch")return;const t=e.clientX-B,o=e.clientY-A;t*t+o*o>256&&j()},se=()=>{j()},Ue=()=>{w.value={}},ft=()=>{G.value=!G.value,G.value||Ue()},ht=async e=>{try{await navigator.clipboard.writeText(e)}catch(t){console.error("Copy failed",t)}},Ne=e=>{e.key==="Escape"&&C()},Be=e=>{!U.value||e.button!==0||e.target?.closest?.("[data-transfer-context-menu]")||C()},Ae=e=>{const t=e.clipboardData;if(!t)return;const o=[];for(const s of Array.from(t.items||[]))if(s.kind==="file"){const r=s.getAsFile();r&&o.push(r)}o.length&&(ce(o),e.preventDefault())},ue=()=>{if(c.isLogged)for(;ee.value<Vo;){const e=L.value.find(t=>t.status==="queued");if(!e)break;xt(e)}},fe=e=>{e.abort&&e.abort.abort(),e.abort=void 0,e.status==="uploading"&&(e.status="paused")},pt=e=>{e.status!=="paused"&&e.status!=="failed"||(e.status="queued",e.error=void 0,ue())},vt=e=>{fe(e),L.value=L.value.filter(t=>t.id!==e.id)},xt=async e=>{ee.value+=1,e.status="uploading",e.progress=Math.max(0,Math.min(1,e.progress||0)),e.error=void 0;const t=new AbortController;e.abort=t;try{const s=await fetch("/api/transfer/upload/init",{method:"POST",headers:c.getHeaders(),body:JSON.stringify({fileName:e.file.name,size:e.file.size,mime:e.file.type||"",fileKey:st(e.file),chunkSize:5242880}),signal:t.signal}),r=await s.json().catch(()=>({}));if(!s.ok||!r.success)throw new Error(r.error||`HTTP ${s.status}`);const a=String(r.uploadId||""),m=Number(r.chunkSize||5242880),y=Number(r.totalChunks||0),f=new Set(Array.isArray(r.uploaded)?r.uploaded.map(T=>Number(T)):[]);if(!a||!Number.isFinite(y)||y<=0)throw new Error("ä¸Šä¼ åˆå§‹åŒ–å¤±è´¥");let $=0;f.size&&($=Math.min(e.file.size,f.size*m),e.progress=$/e.file.size);for(let T=0;T<y;T++){if(f.has(T))continue;const Ye=T*m,wt=Math.min(e.file.size,Ye+m),We=e.file.slice(Ye,wt);let ge=0;for(;;){ge+=1;try{const z=new FormData;z.append("uploadId",a),z.append("index",String(T)),z.append("chunk",We,`${e.file.name}.part`);const Z=await fetch("/api/transfer/upload/chunk",{method:"POST",headers:J(),body:z,signal:t.signal}),Xe=await Z.json().catch(()=>({}));if(!Z.ok||!Xe.success)throw new Error(Xe.error||`HTTP ${Z.status}`);$+=We.size,e.progress=Math.max(0,Math.min(1,$/e.file.size));break}catch(z){if(t.signal.aborted||ge>=3)throw z;await new Promise(Z=>setTimeout(Z,300*ge))}}}const ve=await fetch("/api/transfer/upload/complete",{method:"POST",headers:c.getHeaders(),body:JSON.stringify({uploadId:a}),signal:t.signal}),xe=await ve.json().catch(()=>({}));if(!ve.ok||!xe.success)throw new Error(xe.error||`HTTP ${ve.status}`);e.status="completed",e.progress=1;const we=xe.item;we?u.value.some(T=>T.id===we.id)||(u.value=[we,...u.value].slice(0,200)):await Me(),L.value=L.value.filter(T=>T.id!==e.id)}catch(o){if(t.signal.aborted)e.status==="uploading"&&(e.status="paused");else{const s=o instanceof Error?o.message:String(o);e.status="failed",e.error=s||"ä¸Šä¼ å¤±è´¥"}}finally{e.abort===t&&(e.abort=void 0),ee.value=Math.max(0,ee.value-1),ue()}},he=async()=>{if(!c.isLogged)return;const e=X.value.trim();if(e){X.value="",await be();try{const t=await fetch("/api/transfer/text",{method:"POST",headers:c.getHeaders(),body:JSON.stringify({text:e})}),o=await t.json().catch(()=>({}));if(!t.ok||!o.success)throw new Error(o.error||`HTTP ${t.status}`);const s=o.item;s&&!u.value.some(r=>r.id===s.id)&&(u.value=[s,...u.value].slice(0,200))}catch(t){const o=t instanceof Error?t.message:String(t);I.value=o||"å‘é€å¤±è´¥"}finally{ke.value?.focus()}}},ne=async e=>{x.value=e,de.value=!0,e.type==="file"&&await Fe(e.id,e.file.url)},ie=()=>{de.value=!1,x.value=null},Fe=async(e,t)=>{if(g.value[e])return g.value[e];const o=J(),s=await fetch(t,{headers:o});if(!s.ok)throw new Error(`HTTP ${s.status}`);const r=await s.blob(),a=URL.createObjectURL(r);return g.value={...g.value,[e]:a},a},pe=async e=>{if(!e||e.type!=="file"||Ve.value&&e.file.size>=Qo&&!confirm(`æ£€æµ‹åˆ°æ–‡ä»¶è¾ƒå¤§ï¼ˆ${V(e.file.size)}ï¼‰ï¼Œå¯èƒ½è€—æ—¶ä¸”å ç”¨è¾ƒå¤šæµé‡/å†…å­˜ï¼Œæ˜¯å¦ç»§ç»­ä¸‹è½½ï¼Ÿ`))return;try{const m=await fetch("/api/transfer/download-token",{method:"POST",headers:c.getHeaders(),body:JSON.stringify({url:e.file.url})}),y=await m.json().catch(()=>({}));if(m.ok&&y.success&&typeof y.token=="string"){const f=document.createElement("a");f.href=`${e.file.url}?download=1&token=${encodeURIComponent(y.token)}`,f.download=e.file.name||"download",f.target="_blank",f.rel="noopener noreferrer",document.body.appendChild(f),f.click(),f.remove();return}}catch{}const t=J(),o=await fetch(`${e.file.url}?download=1`,{headers:t});if(!o.ok)throw new Error(`HTTP ${o.status}`);const s=await o.blob(),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=e.file.name||"download",document.body.appendChild(a),a.click(),a.remove(),setTimeout(()=>URL.revokeObjectURL(r),1e3)},le=async e=>{if(c.isLogged)try{const t=J(),o=await fetch(`/api/transfer/items/${encodeURIComponent(e)}`,{method:"DELETE",headers:t}),s=await o.json().catch(()=>({}));if(!o.ok||!s.success)throw new Error(s.error||`HTTP ${o.status}`);u.value=u.value.filter(a=>a.id!==e),w.value=Object.fromEntries(Object.entries(w.value).filter(([a])=>a!==e));const r=g.value[e];if(r){URL.revokeObjectURL(r);const a={...g.value};delete a[e],g.value=a}x.value?.id===e&&ie()}catch(t){const o=t instanceof Error?t.message:String(t);I.value=o||"åˆ é™¤å¤±è´¥"}},He=async()=>{const e=Object.entries(w.value).filter(([,t])=>t).map(([t])=>t);for(const t of e)await le(t)};return Ke(()=>[c.isLogged,b.value],async()=>{w.value={},c.isLogged&&(await Me(),b.value==="chat"&&Qe())},{immediate:!0}),Ke(()=>[b.value,u.value],async([e])=>{if(!c.isLogged||e!=="photos"&&e!=="chat"&&e!=="files")return;await be();const t=u.value.filter(o=>o.type==="file"&&String(o.file.type||"").startsWith("image/"));for(const o of t)try{await Fe(o.id,o.file.url)}catch{}}),_t(()=>{document.addEventListener("paste",Ae),document.addEventListener("keydown",Ne),document.addEventListener("pointerdown",Be,!0),W.value=Ct(),W.value.on("transfer:update",Le)}),Tt(()=>{document.removeEventListener("paste",Ae),document.removeEventListener("keydown",Ne),document.removeEventListener("pointerdown",Be,!0),W.value&&(W.value.off("transfer:update",Le),W.value.close()),L.value.forEach(e=>fe(e));for(const e of Object.values(g.value))URL.revokeObjectURL(e)}),(e,t)=>(n(),l("div",{class:k(["w-full h-full rounded-2xl backdrop-blur border border-white/10 overflow-hidden flex flex-col text-white relative transition-shadow",R.value?"shadow-[0_0_0_2px_rgba(96,165,250,0.55)]":""]),style:me({backgroundColor:`rgba(0,0,0,${Math.min(.85,Math.max(.15,ye.widget.opacity??.35))})`,color:"#fff"}),onDrop:lt,onDragenter:rt,onDragover:at,onDragleave:dt},[R.value?(n(),l("div",It,[...t[20]||(t[20]=[i("div",{class:"w-[92%] h-[92%] rounded-2xl border-2 border-dashed border-blue-300/70 bg-blue-500/10 backdrop-blur-sm flex items-center justify-center"},[i("div",{class:"text-sm font-bold text-white/90"},"æ¾å¼€é¼ æ ‡å³å¯ä¸Šä¼ ")],-1)])])):d("",!0),P.value?d("",!0):(n(),l("div",jt,[t[21]||(t[21]=i("div",{class:"flex flex-wrap items-baseline gap-x-2 gap-y-0.5 leading-tight"},[i("div",{class:"text-sm font-bold text-white"},"æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹"),i("div",{class:"text-[11px] text-white/70"},"æ”¯æŒæ‹–æ‹½ã€å¤šé€‰ã€æ–­ç‚¹ç»­ä¼ ")],-1)),i("div",Dt,[i("div",Et,[i("button",{onClick:t[0]||(t[0]=o=>b.value="chat"),class:k(["px-2.5 py-1 text-xs rounded-lg font-medium",_(b)==="chat"?"bg-white/20 text-white shadow-sm":"text-white/70"])}," èŠå¤© ",2),i("button",{onClick:t[1]||(t[1]=o=>b.value="files"),class:k(["px-2.5 py-1 text-xs rounded-lg font-medium",_(b)==="files"?"bg-white/20 text-white shadow-sm":"text-white/70"])}," æ–‡ä»¶ ",2),i("button",{onClick:t[2]||(t[2]=o=>b.value="photos"),class:k(["px-2.5 py-1 text-xs rounded-lg font-medium",_(b)==="photos"?"bg-white/20 text-white shadow-sm":"text-white/70"])}," å›¾ç‰‡ ",2)]),i("div",Ot,[i("input",{ref_key:"fileInputRef",ref:_e,type:"file",multiple:"",class:"hidden",onChange:it},null,544),i("button",{class:k(["px-3 py-1.5 text-xs font-bold rounded-lg transition-colors",_(c).isLogged?"bg-blue-500 text-white hover:bg-blue-600":"bg-white/10 text-white/40 cursor-not-allowed"]),disabled:!_(c).isLogged,onClick:$e}," æ·»åŠ æ–‡ä»¶ ",10,zt),_(b)==="files"&&E.value>0?(n(),l("button",{key:0,class:"px-3 py-1.5 text-xs font-bold rounded-lg bg-red-500/20 text-red-100 hover:bg-red-500/30",onClick:He}," åˆ é™¤é€‰ä¸­ ("+p(E.value)+") ",1)):d("",!0)])])])),L.value.length?(n(),l("div",Rt,[(n(!0),l(S,null,Y(L.value,o=>(n(),l("div",{key:o.id,class:"rounded-xl border border-white/10 bg-white/5 px-3 py-2 flex items-center gap-3"},[i("div",Ut,[i("div",Nt,[i("div",Bt,p(o.file.name),1),i("div",At,p(V(o.file.size)),1)]),i("div",Ft,[i("div",{class:"h-full bg-blue-500 rounded-full transition-[width]",style:me({width:`${Math.round((o.progress||0)*100)}%`})},null,4)]),i("div",Ht,[i("div",Yt,[St(p(o.status==="uploading"?"ä¸Šä¼ ä¸­":o.status==="paused"?"å·²æš‚åœ":o.status==="failed"?"å¤±è´¥":o.status==="completed"?"å®Œæˆ":"ç­‰å¾…ä¸­")+" ",1),o.error?(n(),l("span",Wt,p(o.error),1)):d("",!0)]),i("div",Xt,[o.status==="uploading"?(n(),l("button",{key:0,class:"px-2 py-1 text-[11px] rounded-lg bg-white/10 text-white hover:bg-white/15",onClick:s=>fe(o)}," æš‚åœ ",8,Kt)):d("",!0),o.status==="paused"||o.status==="failed"?(n(),l("button",{key:1,class:"px-2 py-1 text-[11px] rounded-lg bg-blue-500/20 text-blue-100 hover:bg-blue-500/30",onClick:s=>pt(o)}," ç»§ç»­ ",8,Gt)):d("",!0),i("button",{class:"px-2 py-1 text-[11px] rounded-lg bg-red-500/20 text-red-100 hover:bg-red-500/30",onClick:s=>vt(o)}," ç§»é™¤ ",8,Jt)])])])]))),128))])):d("",!0),(n(),Ge(Je,{to:"body"},[U.value?(n(),l("div",{key:0,"data-transfer-context-menu":"",class:"fixed z-[10001] w-48 rounded-xl border border-white/10 bg-black/70 backdrop-blur shadow-xl overflow-hidden",style:me({left:`${Ce.value}px`,top:`${Te.value}px`}),onClick:t[12]||(t[12]=D(()=>{},["stop"])),onContextmenu:t[13]||(t[13]=D(()=>{},["prevent"]))},[v.value&&N(v.value)?.type==="text"?(n(),l("button",{key:0,class:"w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors text-white",onClick:t[3]||(t[3]=async()=>{const o=v.value,s=o?N(o):null;C(),s&&s.type==="text"&&await ht(s.content)})}," å¤åˆ¶ ")):d("",!0),i("button",{class:k(["w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors",_(c).isLogged?"text-white":"text-white/40 cursor-not-allowed"]),disabled:!_(c).isLogged,onClick:t[4]||(t[4]=()=>{C(),$e()})}," æ·»åŠ æ–‡ä»¶ ",10,Vt),i("button",{class:"w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors text-white",onClick:t[5]||(t[5]=()=>{C(),ft()})},p(G.value?"é€€å‡ºå¤šé€‰":"å¤šé€‰"),1),i("button",{class:k(["w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors",E.value>0?"text-white":"text-white/40 cursor-not-allowed"]),disabled:E.value===0,onClick:t[6]||(t[6]=async()=>{C(),await He()})}," åˆ é™¤é€‰ä¸­ ("+p(E.value)+") ",11,Qt),i("button",{class:k(["w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors",E.value>0?"text-white":"text-white/40 cursor-not-allowed"]),disabled:E.value===0,onClick:t[7]||(t[7]=()=>{C(),Ue()})}," æ¸…ç©ºé€‰æ‹© ",10,Zt),v.value?(n(),l("div",qt)):d("",!0),v.value?(n(),l("button",{key:2,class:"w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors text-white",onClick:t[8]||(t[8]=()=>{const o=v.value;C(),o&&Pe(o)})},p(v.value&&w.value[v.value]?"å–æ¶ˆé€‰æ‹©":"é€‰æ‹©"),1)):d("",!0),v.value?(n(),l("button",{key:3,class:"w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors text-white",onClick:t[9]||(t[9]=async()=>{const o=v.value;C(),o&&await le(o)})}," åˆ é™¤æ­¤æ¡ ")):d("",!0),v.value&&N(v.value)?.type==="file"?(n(),l("button",{key:4,class:"w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors text-white",onClick:t[10]||(t[10]=async()=>{const o=v.value,s=o?N(o):null;C(),s&&s.type==="file"&&ne(s)})}," é¢„è§ˆ ")):d("",!0),v.value&&N(v.value)?.type==="file"?(n(),l("button",{key:5,class:"w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors text-white",onClick:t[11]||(t[11]=async()=>{const o=v.value,s=o?N(o):null;C(),s&&s.type==="file"&&await pe(s)})}," ä¸‹è½½ ")):d("",!0)],36)):d("",!0)])),i("div",eo,[_(c).isLogged?(n(),l("div",oo,[I.value?(n(),l("div",so,p(I.value),1)):d("",!0),ae.value?(n(),l("div",no,"åŠ è½½ä¸­...")):(n(),l("div",{key:2,ref_key:"scrollContainerRef",ref:q,class:"flex-1 min-h-0 overflow-y-auto px-3 py-3 space-y-3 scrollbar-glass",onWheel:nt,onContextmenu:D(ct,["prevent","stop"])},[_(b)==="chat"?(n(),l(S,{key:0},[Se.value.length?(n(),l("div",lo,[(n(!0),l(S,null,Y(Se.value,o=>(n(),l("div",{key:o.key,class:"space-y-1.5"},[i("div",ro,[i("div",ao,p(tt(o.timestamp)),1)]),(n(!0),l(S,null,Y(o.items,s=>(n(),l("div",{key:s.id,class:"flex"},[s.type==="text"?(n(),l("div",{key:0,class:k(["max-w-[90%] rounded-xl bg-white/10 text-white border border-white/10 transition-shadow select-text",[w.value[s.id]?"shadow-[0_0_0_2px_rgba(96,165,250,0.55)]":"",P.value?"px-2 py-1.5 text-xs":"px-3 py-2 text-sm"]]),"data-transfer-id":s.id,onClick:r=>je(s),onContextmenu:D(r=>Q(r.clientX,r.clientY,s.id),["prevent","stop"]),onPointerdown:r=>ze(r,s.id),onPointermove:Re,onPointerup:se,onPointercancel:se,onTouchstart:r=>Ee(r,s.id),onTouchmove:Oe,onTouchend:oe,onTouchcancel:oe},[i("div",uo,[(n(!0),l(S,null,Y(ot(s.content),(r,a)=>(n(),l(S,{key:a},[r.kind==="link"?(n(),l("a",{key:0,href:r.href,target:"_blank",rel:"noopener noreferrer",class:"text-blue-200 underline underline-offset-2 hover:text-blue-100",onClick:t[14]||(t[14]=D(()=>{},["stop"]))},p(r.text),9,fo)):(n(),l("span",ho,p(r.text),1))],64))),128))])],42,co)):(n(),l("button",{key:1,class:k(["max-w-[90%] text-left rounded-xl bg-white/10 hover:bg-white/15 transition-colors border border-white/10 transition-shadow select-none",[w.value[s.id]?"shadow-[0_0_0_2px_rgba(96,165,250,0.55)]":"",P.value?"px-2 py-1.5":"px-3 py-2"]]),"data-transfer-id":s.id,style:{"-webkit-touch-callout":"none"},onClick:r=>je(s),onContextmenu:D(r=>Q(r.clientX,r.clientY,s.id),["prevent","stop"]),onPointerdown:r=>ze(r,s.id),onPointermove:Re,onPointerup:se,onPointercancel:se,onTouchstart:r=>Ee(r,s.id),onTouchmove:Oe,onTouchend:oe,onTouchcancel:oe},[i("div",vo,[i("div",xo,[String(s.file.type||"").startsWith("image/")&&g.value[s.id]?(n(),l("img",{key:0,src:g.value[s.id],class:"w-full h-full object-cover"},null,8,wo)):(n(),l("span",go,p(String(s.file.type||"").startsWith("image/")?"ğŸ–¼ï¸":"ğŸ“„"),1))]),i("div",bo,[i("div",{class:k(["font-bold text-white truncate",P.value?"text-xs":"text-sm"])},p(s.file.name),3),i("div",mo,p(V(s.file.size)),1)])])],42,po))]))),128))]))),128))])):(n(),l("div",io,[...t[23]||(t[23]=[i("div",{class:"text-3xl mb-2"},"ğŸ’¬",-1),i("div",{class:"font-bold text-white"},"æŠŠæ–‡ä»¶å’Œæ–‡å­—å‘åˆ°è¿™é‡Œ",-1),i("div",{class:"text-xs text-white/60 mt-1"},"æ”¯æŒæ‹–æ‹½ä¸Šä¼ ï¼›æ”¯æŒå¤åˆ¶ç²˜è´´å›¾ç‰‡/æ–‡ä»¶",-1)])]))],64)):_(b)==="files"?(n(),l(S,{key:1},[u.value.length?(n(),l("div",ko,[(n(!0),l(S,null,Y(u.value,o=>(n(),l("div",{key:o.id,class:"rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 transition-colors px-3 py-2 flex items-center gap-3"},[o.type==="file"?(n(),l("input",{key:0,type:"checkbox",class:"accent-blue-600",checked:!!w.value[o.id],onChange:s=>{w.value[o.id]=s.target.checked}},null,40,_o)):d("",!0),i("div",Co,[o.type==="file"&&String(o.file.type||"").startsWith("image/")&&g.value[o.id]?(n(),l("img",{key:0,src:g.value[o.id],class:"w-full h-full object-cover"},null,8,To)):o.type==="file"&&String(o.file.type||"").startsWith("image/")?(n(),l("span",So,"ğŸ–¼ï¸")):(n(),l("span",Po,"ğŸ“„"))]),i("div",Lo,[i("div",Mo,p(o.type==="file"?o.file.name:""),1),i("div",$o,p(o.type==="file"?V(o.file.size):"")+" Â· "+p(et(o.timestamp)),1)]),i("div",Io,[o.type==="file"?(n(),l("button",{key:0,class:"px-2 py-1 text-[11px] rounded-lg bg-white/10 text-white hover:bg-white/15",onClick:s=>ne(o)}," é¢„è§ˆ ",8,jo)):d("",!0),o.type==="file"?(n(),l("button",{key:1,class:"px-2 py-1 text-[11px] rounded-lg bg-white/10 text-white hover:bg-white/15",onClick:async()=>{try{await pe(o)}catch(s){I.value=s.message||"ä¸‹è½½å¤±è´¥"}}}," ä¸‹è½½ ",8,Do)):d("",!0),i("button",{class:"px-2 py-1 text-[11px] rounded-lg bg-red-500/20 text-red-100 hover:bg-red-500/30",onClick:s=>le(o.id)}," åˆ é™¤ ",8,Eo)])]))),128))])):(n(),l("div",yo,[...t[24]||(t[24]=[i("div",{class:"text-3xl mb-2"},"ğŸ“",-1),i("div",{class:"font-bold text-white"},"æš‚æ— æ–‡ä»¶",-1)])]))],64)):(n(),l(S,{key:2},[u.value.length?(n(),l("div",zo,[(n(!0),l(S,null,Y(u.value,o=>(n(),l("button",{key:o.id,class:"rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 overflow-hidden aspect-square flex items-center justify-center",onClick:s=>ne(o)},[o.type==="file"&&g.value[o.id]?(n(),l("img",{key:0,src:g.value[o.id],class:"w-full h-full object-cover",alt:o.file.name},null,8,Uo)):(n(),l("div",No,"åŠ è½½ä¸­..."))],8,Ro))),128))])):(n(),l("div",Oo,[...t[25]||(t[25]=[i("div",{class:"text-3xl mb-2"},"ğŸ–¼ï¸",-1),i("div",{class:"font-bold text-white"},"æš‚æ— å›¾ç‰‡",-1)])]))],64))],544)),_(b)==="chat"?(n(),l("div",{key:3,class:k(["border-t border-white/10",P.value?"p-1":"p-3"])},[i("div",{class:k(P.value?"relative block":"flex items-end gap-2")},[Pt(i("textarea",{ref_key:"composerRef",ref:ke,"onUpdate:modelValue":t[15]||(t[15]=o=>X.value=o),rows:"1",placeholder:P.value?"ç²˜è´´/æ‹–å…¥ (Shift+Enter)":"Shift+Enter æ¢è¡Œ",class:k(["resize-none rounded-xl border border-white/20 bg-white/10 outline-none text-white placeholder-white/50 focus:border-blue-400",P.value?"w-full pr-8 pl-2 py-1 text-xs scrollbar-hide":"flex-1 px-3 py-2 text-sm"]),onKeydown:t[16]||(t[16]=Mt(D(o=>{if(o.shiftKey){X.value+=`
`;return}he()},["prevent"]),["enter"]))},null,42,Bo),[[Lt,X.value]]),P.value?(n(),l("button",{key:0,class:"absolute right-1 bottom-1 p-1 text-blue-400 hover:text-blue-300 transition-colors",onClick:he},[...t[26]||(t[26]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[i("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),i("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})],-1)])])):(n(),l("button",{key:1,class:"px-3 py-2 text-xs font-bold rounded-xl bg-blue-500 text-white hover:bg-blue-600",onClick:he}," å‘é€ "))],2)],2)):d("",!0)])):(n(),l("div",to,[...t[22]||(t[22]=[i("div",{class:"text-center px-6"},[i("div",{class:"text-3xl mb-2"},"ğŸ”’"),i("div",{class:"text-sm font-bold text-white"},"ç™»å½•åä½¿ç”¨æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹"),i("div",{class:"text-xs text-white/60 mt-1"}," æ•°æ®å°†æŒä¹…åŒ–å­˜å‚¨åœ¨æœåŠ¡ç«¯ `server/doc/transfer/` ")],-1)])]))]),(n(),Ge(Je,{to:"body"},[de.value&&x.value?(n(),l("div",{key:0,class:"fixed inset-0 z-[9999] bg-black/40 backdrop-blur-sm flex items-center justify-center p-4",onClick:ie},[i("div",{class:"w-full max-w-3xl rounded-2xl bg-black/50 backdrop-blur border border-white/10 shadow-xl overflow-hidden text-white",onClick:t[19]||(t[19]=D(()=>{},["stop"]))},[i("div",Ao,[i("div",Fo,[i("div",Ho,p(x.value.type==="file"?x.value.file.name:"é¢„è§ˆ"),1),x.value.type==="file"?(n(),l("div",Yo,p(V(x.value.file.size))+" Â· "+p(x.value.file.type||"unknown"),1)):d("",!0)]),i("div",Wo,[x.value.type==="file"?(n(),l("button",{key:0,class:"px-3 py-1.5 text-xs font-bold rounded-lg bg-white/10 text-white hover:bg-white/15",onClick:t[17]||(t[17]=async()=>{try{await pe(x.value)}catch(o){I.value=o.message||"ä¸‹è½½å¤±è´¥"}})}," ä¸‹è½½ ")):d("",!0),i("button",{class:"px-3 py-1.5 text-xs font-bold rounded-lg bg-red-500/20 text-red-100 hover:bg-red-500/30",onClick:t[18]||(t[18]=async()=>{await le(x.value.id)})}," åˆ é™¤ "),i("button",{class:"px-3 py-1.5 text-xs font-bold rounded-lg bg-blue-500 text-white hover:bg-blue-600",onClick:ie}," å…³é—­ ")])]),i("div",Xo,[x.value.type==="file"?(n(),l("div",Ko,[String(x.value.file.type||"").startsWith("image/")&&g.value[x.value.id]?(n(),l("img",{key:0,src:g.value[x.value.id],class:"max-h-[70vh] w-full object-contain rounded-xl bg-white/5 border border-white/10",alt:x.value.file.name},null,8,Go)):(n(),l("div",Jo," è¯¥æ–‡ä»¶ç±»å‹æš‚ä¸æ”¯æŒç›´æ¥é¢„è§ˆï¼Œè¯·ä½¿ç”¨â€œä¸‹è½½â€ã€‚ "))])):d("",!0)])])])):d("",!0)]))],38))}}),ts=$t(qo,[["__scopeId","data-v-d8ea53fa"]]);export{ts as default};
