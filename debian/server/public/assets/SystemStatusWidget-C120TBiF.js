import{d as U,u as B,r as h,c as g,y as K,o as V,a as o,e as i,g as e,b as v,p as c,j as S,t as s,q as m,F as j,h as L,_ as z}from"./index-DetE_Czq.js";const E={class:"flex items-center justify-between w-full"},N={class:"flex flex-col"},P={key:0},W={class:"opacity-75 text-xs"},D={key:1},T={class:"opacity-75 text-sm"},q={key:2,class:"opacity-80 origin-left"},A=["title"],G={class:"flex flex-col gap-0.5"},H={class:"flex justify-between text-xs text-gray-500"},O={class:"flex flex-col"},R={class:"flex gap-2"},J={key:0,class:"text-[10px] text-gray-400"},Q=["title"],X={class:"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden flex"},Y={class:"flex flex-col gap-0.5"},Z={class:"flex justify-between text-xs text-gray-500"},$={class:"scale-90 origin-right"},ee={class:"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"},te={class:"flex justify-between text-xs text-gray-500"},se=["title"],le={class:"text-[10px]"},ae={class:"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"},oe=["title"],ie={class:"flex gap-1 scale-90 origin-right"},ne={key:1,class:"flex-1 flex items-center justify-center text-xs text-gray-400"},re=U({__name:"SystemStatusWidget",props:{widget:{}},setup(F){const I=B(),d=F,t=h(null),C=g(()=>!!d.widget?.data?.useMock),y=g(()=>(d.widget?.w||1)>=2&&(d.widget?.w||1)<4&&(d.widget?.h||1)<=1),x=g(()=>(d.widget?.w||1)>=4&&(d.widget?.h||1)<=1),n=g(()=>y.value||x.value);let a=null;const u=h(0),M=h(1e4),_=()=>{a&&clearInterval(a),a=setInterval(()=>{document.visibilityState!=="hidden"&&k()},M.value)},w=()=>{a&&clearInterval(a),a=null},b=()=>{document.visibilityState==="hidden"?w():_()},k=async()=>{if(C.value){t.value={cpu:{currentLoad:15,currentLoadUser:10,currentLoadSystem:5,manufacturer:"Intel",brand:"Core i9-9900K",speed:3.6,cores:8},mem:{total:16*1024*1024*1024,used:8*1024*1024*1024,active:8*1024*1024*1024,available:8*1024*1024*1024},disk:[{fs:"/dev/sda1",type:"ext4",size:500*1024*1024*1024,used:200*1024*1024*1024,use:40,mount:"/"}],network:[{iface:"eth0",rx_sec:1024*1024,tx_sec:512*1024}],temp:{main:45,cores:[],max:45},uptime:3600*24*2,os:{distro:"Mock OS",release:"1.0",codename:"Mocky",kernel:"5.15.0",arch:"x64",hostname:"mock-server"}};return}try{const p=I.getHeaders(),r=await fetch("/api/system/stats",{headers:p});if(!r.ok){u.value++,u.value>=3&&(a&&clearInterval(a),a=null,console.warn("System stats polling stopped due to repeated errors."));return}const l=await r.json();l.success?(t.value=l.data,u.value=0):(u.value++,u.value>=3&&(a&&clearInterval(a),a=null))}catch(p){console.error(p),u.value++,u.value>=3&&(a&&clearInterval(a),a=null)}};return K(()=>{k(),_(),document.addEventListener("visibilitychange",b)}),V(()=>{w(),document.removeEventListener("visibilitychange",b)}),(p,r)=>(i(),o("div",{class:c(["w-full h-full flex overflow-hidden bg-white/80 dark:bg-gray-800/80 backdrop-blur-md rounded-2xl p-3 relative transition-all",[n.value?"flex-row items-center gap-3":"flex-col"]])},[e("div",{class:c(["flex shrink-0 transition-all rounded-xl",[n.value?"flex-col justify-between text-left bg-gray-50/50 dark:bg-gray-700/30 px-3 py-2 h-full":"flex-row items-center justify-between mb-3",y.value?"w-[220px]":"",x.value?"w-[240px]":""]])},[e("div",E,[e("div",N,[r[0]||(r[0]=e("span",{class:"font-bold text-gray-700 dark:text-gray-200 leading-none"},"系统状态",-1)),t.value?.os?(i(),o("div",{key:0,class:c(["mt-1 font-mono leading-tight text-gray-500 dark:text-gray-400",n.value?"text-base flex flex-col items-start":"text-sm"])},[n.value?(i(),o("div",D,[S(s(t.value.os.distro)+" "+s(t.value.os.release)+" ",1),e("span",T,"("+s(t.value.os.arch)+")",1)])):(i(),o("div",P,[S(s(t.value.os.distro)+" "+s(t.value.os.release)+" ",1),e("span",W,"("+s(t.value.os.arch)+")",1)])),t.value.os.kernel?(i(),o("div",q," Kernel: "+s(t.value.os.kernel),1)):v("",!0)],2)):v("",!0)])]),t.value?(i(),o("div",{key:0,class:c(["text-sm text-gray-400",[n.value?"mt-1 text-left":"text-left"]])},[e("div",null,"运行: "+s((t.value.uptime/86400).toFixed(1))+" 天",1),t.value.os?(i(),o("div",{key:0,class:c(["truncate",[n.value?"max-w-[120px]":"scale-90 origin-left max-w-[80px]"]]),title:t.value.os.hostname},s(t.value.os.hostname),11,A)):v("",!0)],2)):v("",!0)],2),t.value?(i(),o("div",{key:0,class:c(["flex-1 overflow-y-auto custom-scrollbar",[y.value?"grid grid-cols-1 gap-y-2 content-center h-full pr-1":"",x.value?"grid grid-cols-3 gap-x-4 gap-y-2 content-center h-full pr-1":"",n.value?"":"flex flex-col gap-3 pr-1"]])},[e("div",G,[e("div",H,[e("div",O,[e("div",R,[r[1]||(r[1]=e("span",null,"CPU",-1)),t.value.temp?.main?(i(),o("span",J,s(t.value.temp.main)+"°C",1)):v("",!0)]),t.value.cpu.brand&&!n.value?(i(),o("div",{key:0,class:"text-[9px] text-gray-400 truncate max-w-[120px]",title:t.value.cpu.manufacturer+" "+t.value.cpu.brand},s(t.value.cpu.brand),9,Q)):v("",!0)]),e("span",null,s(t.value.cpu.currentLoad.toFixed(1))+"%",1)]),e("div",X,[e("div",{class:"h-full bg-blue-500",style:m({width:t.value.cpu.currentLoadUser+"%"}),title:"User"},null,4),e("div",{class:"h-full bg-red-400",style:m({width:t.value.cpu.currentLoadSystem+"%"}),title:"System"},null,4)])]),e("div",Y,[e("div",Z,[r[2]||(r[2]=e("span",null,"RAM",-1)),e("span",$,s((t.value.mem.active/1024/1024/1024).toFixed(1))+"/"+s((t.value.mem.total/1024/1024/1024).toFixed(1))+"G",1)]),e("div",ee,[e("div",{class:"h-full bg-purple-500 transition-all duration-500",style:m({width:t.value.mem.active/t.value.mem.total*100+"%"})},null,4)])]),e("div",{class:c(["flex flex-col gap-1",{"row-span-2":x.value}])},[(i(!0),o(j,null,L(t.value.disk.slice(0,n.value?1:void 0),(l,f)=>(i(),o("div",{key:f,class:"flex flex-col gap-0.5"},[e("div",te,[e("span",{class:"truncate max-w-[60%] text-[10px]",title:l.mount},"Disk ("+s(l.mount)+")",9,se),e("span",le,s(l.use.toFixed(0))+"%",1)]),e("div",ae,[e("div",{class:"h-full bg-green-500 transition-all duration-500",style:m({width:l.use+"%"})},null,4)])]))),128))],2),e("div",{class:c(["flex flex-col gap-1",[n.value?"":"pt-2 border-t border-gray-100 dark:border-gray-700 mt-1",x.value?"col-span-2":""]])},[(i(!0),o(j,null,L(t.value.network.filter((l,f)=>l.rx_sec>0||l.tx_sec>0||l.iface==="eth0"||f===0).slice(0,n.value?1:3),(l,f)=>(i(),o("div",{key:f,class:"flex items-center justify-between text-[10px] text-gray-500 font-mono"},[e("span",{class:"text-gray-400 truncate max-w-[40px]",title:l.iface},s(l.iface),9,oe),e("div",ie,[e("span",null,"↓"+s((l.rx_sec/1024).toFixed(0))+"K",1),e("span",null,"↑"+s((l.tx_sec/1024).toFixed(0))+"K",1)])]))),128))],2)],2)):(i(),o("div",ne," 加载中... "))],2))}}),ue=z(re,[["__scopeId","data-v-faedeb98"]]);export{ue as default};
