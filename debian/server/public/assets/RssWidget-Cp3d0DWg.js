import{d as j,u as M,r as x,c as T,w as S,y as N,o as z,a,e as n,k as A,g as c,A as B,b as k,F as D,h as F,p as H,t as b,f as L,i as W,z as $,j as Y,q as U,_ as q}from"./index--aZVXybM.js";const P={key:0,class:"w-full py-2.5 text-xs text-white/60 text-center"},G=["onClick"],J={key:0,class:"absolute bottom-0 left-0 right-0 h-0.5 bg-white/60"},K={class:"flex-1 overflow-hidden relative"},O={key:0,class:"h-full flex flex-col items-center justify-center text-white/60 p-4 text-center"},Q={key:1,class:"p-8 text-center text-white/60 text-xs animate-pulse"},X={key:2,class:"p-8 text-center text-white/70 text-xs"},Z={key:3,class:"flex flex-col py-1"},ee=["href"],te={class:"text-sm text-white/80 group-hover/item:text-white transition-colors font-medium line-clamp-2 mb-1"},se={class:"flex justify-between items-center"},oe={key:0,class:"text-[10px] text-white/50 line-clamp-1 flex-1 mr-2"},le={key:1,class:"text-[10px] text-white/40 whitespace-nowrap"},ae=900*1e3,ne=j({__name:"RssWidget",props:{widget:{}},setup(C){const r=M(),i=x(""),v=x([]),m=x(!1),w=x("");let o,u;const f=T(()=>r.rssFeeds.filter(e=>e.enable)),h=x([]);S(f,e=>{const s=h.value.map(l=>l.id).join(","),t=e.map(l=>l.id).join(",");s!==t&&(h.value=[...e])},{immediate:!0,deep:!0});const I=()=>{const e=r.rssFeeds.filter(s=>!s.enable);r.rssFeeds=[...h.value,...e],r.saveData()};S(f,e=>{if(e.length>0){if(!e.find(s=>s.id===i.value)){const s=e[0];s&&(i.value=s.id,_(s))}}else i.value="",v.value=[]},{deep:!0});const _=async e=>{if(!e)return;o&&(o(),o=void 0),u&&(clearInterval(u),u=void 0),i.value=e.id,w.value="",m.value=!0,v.value=[];const s=d=>{if(d.url===e.url){const g=d.data.items||[];v.value=g.map(p=>({title:p.title,link:p.link,pubDate:p.pubDate,contentSnippet:p.contentSnippet})),m.value=!1,o&&(o(),o=void 0)}},t=d=>{d.url===e.url&&(console.error(`Failed to load RSS: ${e.title}`,d.error),w.value="åŠ è½½å¤±è´¥",v.value=[],m.value=!1,o&&(o(),o=void 0))};o=()=>{r.socket.off("rss:data",s),r.socket.off("rss:error",t)},r.socket.on("rss:data",s),r.socket.on("rss:error",t);const l=()=>{r.socket.emit("rss:fetch",{url:e.url})};l(),u=setInterval(l,ae)};N(()=>{const e=f.value[0];e&&(i.value=e.id,_(e))}),z(()=>{o&&(o(),o=void 0),u&&(clearInterval(u),u=void 0)});const R=e=>{const s=e.currentTarget,{scrollTop:t,scrollHeight:l,clientHeight:d}=s,g=e.deltaY,p=t<=0,V=t+d>=l-1;(p&&g<0||V&&g>0)&&(e.preventDefault(),e.stopPropagation())},y=x(null),E=e=>{y.value&&e.deltaY!==0&&(y.value.scrollLeft+=e.deltaY)};return(e,s)=>(n(),a("div",{class:"w-full h-full rounded-2xl backdrop-blur border border-white/10 overflow-hidden flex flex-col text-white relative transition-shadow",style:U({backgroundColor:`rgba(0,0,0,${Math.min(.85,Math.max(.15,C.widget?.opacity??.35))})`,color:"#fff"})},[A(W($),{ref_key:"tabsRef",ref:y,modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=t=>h.value=t),onWheel:L(E,["prevent"]),animation:150,onEnd:I,class:"flex border-b border-white/10 bg-white/10 select-none overflow-x-auto custom-scrollbar"},{default:B(()=>[f.value.length===0?(n(),a("div",P," æš‚æ— è®¢é˜…æº ")):k("",!0),(n(!0),a(D,null,F(h.value,t=>(n(),a("button",{key:t.id,onClick:l=>_(t),class:H(["flex-shrink-0 px-4 py-2.5 text-xs font-bold transition-all flex items-center justify-center gap-1.5 relative whitespace-nowrap cursor-move",i.value===t.id?"text-white bg-white/15":"text-white/60 hover:bg-white/10 hover:text-white"])},[c("span",null,b(t.title),1),i.value===t.id?(n(),a("div",J)):k("",!0)],10,G))),128))]),_:1},8,["modelValue"]),c("div",K,[c("div",{class:"h-full overflow-y-auto custom-scrollbar p-0",onWheel:R},[f.value.length===0?(n(),a("div",O,[...s[2]||(s[2]=[c("span",{class:"text-2xl mb-2"},"ðŸ“¡",-1),c("span",{class:"text-xs"},"è¯·åœ¨è®¾ç½®ä¸­æ·»åŠ å¹¶å¯ç”¨ RSS è®¢é˜…æº",-1)])])):m.value&&v.value.length===0?(n(),a("div",Q," åŠ è½½ä¸­... ")):w.value?(n(),a("div",X,[Y(b(w.value)+" ",1),c("button",{onClick:s[1]||(s[1]=t=>_(f.value.find(l=>l.id===i.value))),class:"block mx-auto mt-2 text-white/80 hover:text-white hover:underline"}," é‡è¯• ")])):(n(),a("div",Z,[(n(!0),a(D,null,F(v.value,(t,l)=>(n(),a("a",{key:l,href:t.link,target:"_blank",class:"block px-3 py-2 hover:bg-white/10 transition-colors group/item border-b border-white/10 last:border-0"},[c("div",te,b(t.title),1),c("div",se,[t.contentSnippet?(n(),a("div",oe,b(t.contentSnippet),1)):k("",!0),t.pubDate?(n(),a("div",le,b(new Date(t.pubDate).toLocaleDateString()),1)):k("",!0)])],8,ee))),128))]))],32)])],4))}}),ie=q(ne,[["__scopeId","data-v-11b23abf"]]);export{ie as default};
