import{d as kt,u as _t,r as h,N as Ct,O as Tt,c as Y,C as St,w as Ge,y as Lt,P as Pt,Q as Mt,a as l,e as n,b as c,g as i,E as Je,p as k,i as _,t as v,F as S,h as W,q as ye,j as It,f as E,T as Ve,l as $t,m as jt,n as Et,x as Qe,_ as Dt}from"./index-BKCwBmTe.js";const Ot={key:0,class:"absolute inset-0 z-20 pointer-events-none flex items-center justify-center"},Rt={key:1,class:"border-b border-white/10 px-3 py-2"},Ut={class:"mt-2 flex items-center justify-between gap-2 flex-wrap"},zt={class:"flex items-center gap-1 bg-white/10 rounded-xl p-1 border border-white/10"},Bt={class:"flex items-center gap-2"},Nt=["disabled"],At={key:2,class:"px-3 py-2 border-b border-white/10 space-y-2"},Ft={class:"flex-1 min-w-0"},Ht={class:"flex items-center justify-between gap-2"},Yt={class:"text-xs font-semibold text-white truncate"},Wt={class:"text-[11px] text-white/60 shrink-0"},Xt={class:"mt-1 h-1.5 bg-white/10 rounded-full overflow-hidden"},Kt={class:"mt-1 flex items-center justify-between"},Gt={class:"text-[11px] text-white/60"},Jt={key:0,class:"text-red-200 ml-2"},Vt={class:"flex items-center gap-1"},Qt=["onClick"],Zt=["onClick"],qt=["onClick"],eo=["disabled"],to=["disabled"],oo=["disabled"],so={key:1,class:"h-px bg-white/10"},no={class:"flex-1 min-h-0 overflow-hidden"},io={key:0,class:"h-full flex items-center justify-center text-white/70"},lo={key:1,class:"h-full flex flex-col"},ro={key:0,class:"px-3 py-2 text-xs text-red-100 bg-red-500/20 border-b border-red-500/20"},ao={key:1,class:"px-3 py-2 text-xs text-white/60"},co={key:0,class:"text-center text-white/70 text-sm py-10"},uo={key:1,class:"space-y-2"},fo={class:"flex justify-center"},ho={class:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10 text-[10px] text-white/60"},vo=["data-transfer-id","onClick","onContextmenu","onPointerdown","onTouchstart"],po={class:"whitespace-pre-wrap break-words"},xo=["href"],wo={key:1},bo=["data-transfer-id","onClick","onContextmenu","onPointerdown","onTouchstart"],go={class:"flex items-center gap-3"},mo={class:"w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center border border-white/10 overflow-hidden"},yo=["src"],ko={key:1},_o={class:"min-w-0"},Co={class:"text-[11px] text-white/60"},To={key:0,class:"text-center text-white/70 text-sm py-10"},So={key:1,class:"space-y-2"},Lo=["checked","onChange"],Po={class:"w-9 h-9 rounded-xl bg-white/10 border border-white/10 flex items-center justify-center shrink-0 overflow-hidden"},Mo=["src"],Io={key:1},$o={key:2},jo={class:"flex-1 min-w-0"},Eo={class:"text-sm font-bold text-white truncate"},Do={class:"text-[11px] text-white/60"},Oo={class:"flex items-center gap-1"},Ro=["onClick"],Uo=["onClick"],zo=["onClick"],Bo={key:0,class:"text-center text-white/70 text-sm py-10"},No={key:1,class:"grid grid-cols-2 md:grid-cols-3 gap-2"},Ao=["onClick"],Fo=["src","alt"],Ho={key:1,class:"text-white/60 text-sm"},Yo=["placeholder"],Wo={class:"px-4 py-3 border-b border-white/10 flex items-center justify-between"},Xo={class:"min-w-0"},Ko={class:"text-sm font-bold text-white truncate"},Go={key:0,class:"text-[11px] text-white/60"},Jo={class:"flex items-center gap-2"},Vo={class:"p-4"},Qo={key:0},Zo=["src","alt"],qo={key:1,class:"rounded-xl bg-white/5 border border-white/10 p-4 text-sm text-white/80"},es=2,ts=50*1024*1024,os=1800*1e3,ss=kt({__name:"FileTransferWidget",props:{widget:{}},setup(ke){const ae=ke,u=_t(),X=h(null),{isMobile:Ze}=Ct(Tt(u.appConfig,"deviceMode")),L=Y(()=>ae.widget.w===1&&ae.widget.h===2),g=St(`flatnas-transfer-tab-${ae.widget.id}`,"chat"),ce=h(!1),$=h(null),p=h([]),K=h(null),qe=async()=>{await Qe(),K.value&&(K.value.scrollTop=K.value.scrollHeight)},G=h(""),_e=h(null),Ce=h(null),B=h(!1),J=h(0),V=h(!1),N=h(!1),Te=h(0),Se=h(0),w=h(null),P=h([]),te=h(0),de=h(!1),x=h(null),f=h({});let D=null;const et=Y(()=>[...p.value].sort((e,t)=>(e.timestamp||0)-(t.timestamp||0))),Le=Y(()=>{const e=et.value,t=[];let o=-1;for(const s of e){const r=Number(s.timestamp)||0,a=t[t.length-1];!a||o>=0&&r-o>os?t.push({key:s.id,timestamp:r,items:[s]}):a.items.push(s),o=r}return t}),b=h({}),O=Y(()=>Object.values(b.value).filter(Boolean).length),tt=(e,t)=>{const o={...b.value};t?o[e]=!0:delete o[e],b.value=o},Pe=e=>tt(e,!b.value[e]),Q=()=>{const e=u.token||localStorage.getItem("flat-nas-token"),t={};return e&&(t.Authorization=`Bearer ${e}`),t},Z=e=>{const t=Number(e)||0;if(t<1024)return`${t} B`;const o=t/1024;if(o<1024)return`${o.toFixed(1)} KB`;const s=o/1024;return s<1024?`${s.toFixed(1)} MB`:`${(s/1024).toFixed(2)} GB`},ot=e=>{try{return new Date(e).toLocaleString()}catch{return""}},st=e=>{try{const t=new Date(e),o=new Date;return t.getFullYear()===o.getFullYear()&&t.getMonth()===o.getMonth()&&t.getDate()===o.getDate()?t.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}):t.toLocaleString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}},nt=e=>{const t=String(e??"");if(!t)return[{kind:"text",text:""}];const o=/https?:\/\/[^\s<>"'`]+/g,s=[];let r=0;for(const a of t.matchAll(o)){const m=a[0]||"",y=a.index??-1;if(!m||y<0)continue;y>r&&s.push({kind:"text",text:t.slice(r,y)});let d=m,I="";for(;d&&/[)\]}\.,!?;:]+$/.test(d);)I=d.slice(-1)+I,d=d.slice(0,-1);d&&d!=="http://"&&d!=="https://"?s.push({kind:"link",text:d,href:d}):s.push({kind:"text",text:m}),I&&s.push({kind:"text",text:I}),r=y+m.length}return r<t.length&&s.push({kind:"text",text:t.slice(r)}),s.length?s:[{kind:"text",text:t}]},it=e=>`${e.name}|${e.size}|${e.lastModified}`,lt=e=>{const t=e.currentTarget,{scrollTop:o,scrollHeight:s,clientHeight:r}=t,a=e.deltaY,m=o<=0,y=o+r>=s-1;(m&&a<0||y&&a>0)&&(e.preventDefault(),e.stopPropagation())},Me=e=>{if(e.type==="add"&&e.item)p.value.some(t=>t.id===e.item.id)||(p.value=[e.item,...p.value].slice(0,1e3));else if(e.type==="delete"&&e.id){if(p.value=p.value.filter(t=>t.id!==e.id),b.value[e.id]){const t={...b.value};delete t[e.id],b.value=t}x.value?.id===e.id&&le()}},Ie=async()=>{if(u.isLogged){ce.value=!0,$.value=null;try{const e=g.value==="photos"?"photo":g.value==="files"?"file":"all",t=Q(),o=await fetch(`/api/transfer/items?type=${encodeURIComponent(e)}&limit=1000`,{headers:t}),s=await o.json().catch(()=>({}));if(!o.ok||!s.success)throw new Error(s.error||`HTTP ${o.status}`);p.value=Array.isArray(s.items)?s.items:[]}catch(e){const t=e instanceof Error?e.message:String(e);$.value=t||"åŠ è½½å¤±è´¥"}finally{ce.value=!1}}},$e=()=>Ce.value?.click(),ue=e=>{if(!u.isLogged)return;const t=e.filter(o=>o&&o.size>0);if(t.length){for(const o of t)P.value.push({id:`q-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,file:o,status:"queued",progress:0});fe()}},rt=e=>{const t=e.target,o=t.files?Array.from(t.files):[];ue(o),t&&(t.value="")},at=e=>{e.preventDefault(),e.stopPropagation(),B.value=!1,J.value=0;const t=e.dataTransfer?.files?Array.from(e.dataTransfer.files):[];ue(t)},je=e=>Array.from(e.dataTransfer?.types||[]).includes("Files"),ct=e=>{je(e)&&(J.value+=1,B.value=!0)},dt=e=>{je(e)&&(e.preventDefault(),B.value=!0)},ut=()=>{J.value=Math.max(0,J.value-1),J.value===0&&(B.value=!1)},R=e=>p.value.find(t=>t.id===e)||null,C=()=>{N.value=!1,w.value=null},q=(e,t,o)=>{Te.value=Math.max(8,Math.min(e,window.innerWidth-196-8)),Se.value=Math.max(8,Math.min(t,window.innerHeight-220-8)),w.value=o,N.value=!0},ft=e=>{if(!u.isLogged)return;e.preventDefault();const o=e.target?.closest?.("[data-transfer-id]");q(e.clientX,e.clientY,o?.dataset.transferId||null)},Ee=e=>{if(oe===e.id){oe=null;return}if(V.value){Pe(e.id);return}e.type==="file"&&ie(e)},ht=Y(()=>{if(typeof navigator>"u")return!1;const e=navigator;return Math.max(0,e.maxTouchPoints||0,e.msMaxTouchPoints||0)>0?!0:typeof window<"u"&&"ontouchstart"in window}),De=Y(()=>ht.value);let U=null,A=0,F=0,M=null,oe=null,H=null;const j=()=>{U&&window.clearTimeout(U),U=null,M=null,H=null},Oe=(e,t)=>{if(!u.isLogged||!De.value||N.value||H==="pointer")return;const o=e.touches&&e.touches[0];o&&(j(),H="touch",A=o.clientX,F=o.clientY,M=t,U=window.setTimeout(()=>{M&&(oe=M,q(A,F,M),j())},520))},Re=e=>{if(!U||H!=="touch")return;const t=e.touches&&e.touches[0];if(!t)return;const o=t.clientX-A,s=t.clientY-F;o*o+s*s>256&&j()},se=()=>{j()},Ue=(e,t)=>{u.isLogged&&De.value&&(N.value||e.pointerType==="touch"&&(j(),H="pointer",A=e.clientX,F=e.clientY,M=t,U=window.setTimeout(()=>{M&&(oe=M,q(A,F,M),j())},520)))},ze=e=>{if(!U||H!=="pointer"||e.pointerType!=="touch")return;const t=e.clientX-A,o=e.clientY-F;t*t+o*o>256&&j()},ne=()=>{j()},Be=()=>{b.value={}},vt=()=>{V.value=!V.value,V.value||Be()},pt=async e=>{try{await navigator.clipboard.writeText(e)}catch(t){console.error("Copy failed",t)}},Ne=e=>{e.key==="Escape"&&C()},Ae=e=>{!N.value||e.button!==0||e.target?.closest?.("[data-transfer-context-menu]")||C()},Fe=e=>{const t=e.clipboardData;if(!t)return;const o=[];for(const s of Array.from(t.items||[]))if(s.kind==="file"){const r=s.getAsFile();r&&o.push(r)}o.length&&(ue(o),e.preventDefault())},fe=()=>{if(u.isLogged)for(;te.value<es;){const e=P.value.find(t=>t.status==="queued");if(!e)break;bt(e)}},he=e=>{e.abort&&e.abort.abort(),e.abort=void 0,e.status==="uploading"&&(e.status="paused")},xt=e=>{e.status!=="paused"&&e.status!=="failed"||(e.status="queued",e.error=void 0,fe())},wt=e=>{he(e),P.value=P.value.filter(t=>t.id!==e.id)},bt=async e=>{te.value+=1,e.status="uploading",e.progress=Math.max(0,Math.min(1,e.progress||0)),e.error=void 0;const t=new AbortController;e.abort=t;try{const s=await fetch("/api/transfer/upload/init",{method:"POST",headers:u.getHeaders(),body:JSON.stringify({fileName:e.file.name,size:e.file.size,mime:e.file.type||"",fileKey:it(e.file),chunkSize:5242880}),signal:t.signal}),r=await s.json().catch(()=>({}));if(!s.ok||!r.success)throw new Error(r.error||`HTTP ${s.status}`);const a=String(r.uploadId||""),m=Number(r.chunkSize||5242880),y=Number(r.totalChunks||0),d=new Set(Array.isArray(r.uploaded)?r.uploaded.map(T=>Number(T)):[]);if(!a||!Number.isFinite(y)||y<=0)throw new Error("ä¸Šä¼ åˆå§‹åŒ–å¤±è´¥");let I=0;d.size&&(I=Math.min(e.file.size,d.size*m),e.progress=I/e.file.size);for(let T=0;T<y;T++){if(d.has(T))continue;const We=T*m,yt=Math.min(e.file.size,We+m),Xe=e.file.slice(We,yt);let me=0;for(;;){me+=1;try{const z=new FormData;z.append("uploadId",a),z.append("index",String(T)),z.append("chunk",Xe,`${e.file.name}.part`);const ee=await fetch("/api/transfer/upload/chunk",{method:"POST",headers:Q(),body:z,signal:t.signal}),Ke=await ee.json().catch(()=>({}));if(!ee.ok||!Ke.success)throw new Error(Ke.error||`HTTP ${ee.status}`);I+=Xe.size,e.progress=Math.max(0,Math.min(1,I/e.file.size));break}catch(z){if(t.signal.aborted||me>=3)throw z;await new Promise(ee=>setTimeout(ee,300*me))}}}const we=await fetch("/api/transfer/upload/complete",{method:"POST",headers:u.getHeaders(),body:JSON.stringify({uploadId:a}),signal:t.signal}),be=await we.json().catch(()=>({}));if(!we.ok||!be.success)throw new Error(be.error||`HTTP ${we.status}`);e.status="completed",e.progress=1;const ge=be.item;ge?p.value.some(T=>T.id===ge.id)||(p.value=[ge,...p.value].slice(0,200)):await Ie(),P.value=P.value.filter(T=>T.id!==e.id)}catch(o){if(t.signal.aborted)e.status==="uploading"&&(e.status="paused");else{const s=o instanceof Error?o.message:String(o);e.status="failed",e.error=s||"ä¸Šä¼ å¤±è´¥"}}finally{e.abort===t&&(e.abort=void 0),te.value=Math.max(0,te.value-1),fe()}},ve=async()=>{if(!u.isLogged)return;const e=G.value.trim();if(e){G.value="",await Qe();try{const t=await fetch("/api/transfer/text",{method:"POST",headers:u.getHeaders(),body:JSON.stringify({text:e})}),o=await t.json().catch(()=>({}));if(!t.ok||!o.success)throw new Error(o.error||`HTTP ${t.status}`);const s=o.item;s&&!p.value.some(r=>r.id===s.id)&&(p.value=[s,...p.value].slice(0,200))}catch(t){const o=t instanceof Error?t.message:String(t);$.value=o||"å‘é€å¤±è´¥"}finally{_e.value?.focus()}}},ie=async e=>{x.value=e,de.value=!0,e.type==="file"&&await He(e.id,e.file.url)},le=()=>{de.value=!1,x.value=null},He=async(e,t)=>{if(f.value[e])return f.value[e];const o=Q(),s=await fetch(t,{headers:o});if(!s.ok)throw new Error(`HTTP ${s.status}`);const r=await s.blob(),a=URL.createObjectURL(r);return f.value={...f.value,[e]:a},a},pe=async e=>{if(!e||e.type!=="file"||Ze.value&&e.file.size>=ts&&!confirm(`æ£€æµ‹åˆ°æ–‡ä»¶è¾ƒå¤§ï¼ˆ${Z(e.file.size)}ï¼‰ï¼Œå¯èƒ½è€—æ—¶ä¸”å ç”¨è¾ƒå¤šæµé‡/å†…å­˜ï¼Œæ˜¯å¦ç»§ç»­ä¸‹è½½ï¼Ÿ`))return;try{const m=await fetch("/api/transfer/download-token",{method:"POST",headers:u.getHeaders(),body:JSON.stringify({url:e.file.url})}),y=await m.json().catch(()=>({}));if(m.ok&&y.success&&typeof y.token=="string"){const d=document.createElement("a");d.href=`${e.file.url}?download=1&token=${encodeURIComponent(y.token)}`,d.download=e.file.name||"download",d.target="_blank",d.rel="noopener noreferrer",document.body.appendChild(d),d.click(),d.remove();return}}catch{}const t=Q(),o=await fetch(`${e.file.url}?download=1`,{headers:t});if(!o.ok)throw new Error(`HTTP ${o.status}`);const s=await o.blob(),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=e.file.name||"download",document.body.appendChild(a),a.click(),a.remove(),setTimeout(()=>URL.revokeObjectURL(r),1e3)},re=async e=>{if(u.isLogged)try{const t=Q(),o=await fetch(`/api/transfer/items/${encodeURIComponent(e)}`,{method:"DELETE",headers:t}),s=await o.json().catch(()=>({}));if(!o.ok||!s.success)throw new Error(s.error||`HTTP ${o.status}`);p.value=p.value.filter(a=>a.id!==e),b.value=Object.fromEntries(Object.entries(b.value).filter(([a])=>a!==e));const r=f.value[e];if(r){URL.revokeObjectURL(r);const a={...f.value};delete a[e],f.value=a}x.value?.id===e&&le()}catch(t){const o=t instanceof Error?t.message:String(t);$.value=o||"åˆ é™¤å¤±è´¥"}},Ye=async()=>{const e=Object.entries(b.value).filter(([,t])=>t).map(([t])=>t);for(const t of e)await re(t)};Ge(()=>[u.isLogged,g.value],async()=>{b.value={},u.isLogged&&(await Ie(),g.value==="chat"&&qe())},{immediate:!0});const gt=e=>{if(x.value?.id===e)return;const t=f.value[e];if(t){URL.revokeObjectURL(t);const o={...f.value};delete o[e],f.value=o}},mt=()=>{D||(D=new IntersectionObserver(e=>{for(const t of e){const s=t.target.dataset.observeId;if(s)if(t.isIntersecting){const r=R(s);r&&r.type==="file"&&String(r.file.type||"").startsWith("image/")&&He(r.id,r.file.url).catch(()=>{})}else gt(s)}},{root:K.value,rootMargin:"500px 0px 500px 0px"}))},xe=(e,t)=>{if(!e||!D)return;const o=e instanceof Element?e:e.$el;o&&o instanceof HTMLElement&&(o.dataset.observeId=t,D.observe(o))};return Lt(()=>{document.addEventListener("paste",Fe),document.addEventListener("keydown",Ne),document.addEventListener("pointerdown",Ae,!0),X.value=Pt(),X.value.on("transfer:update",Me),mt()}),Ge(g,()=>{for(const e of Object.values(f.value))URL.revokeObjectURL(e);f.value={}}),Mt(()=>{document.removeEventListener("paste",Fe),document.removeEventListener("keydown",Ne),document.removeEventListener("pointerdown",Ae,!0),X.value&&(X.value.off("transfer:update",Me),X.value.close()),D&&(D.disconnect(),D=null),P.value.forEach(e=>he(e));for(const e of Object.values(f.value))URL.revokeObjectURL(e)}),(e,t)=>(n(),l("div",{class:k(["w-full h-full rounded-2xl backdrop-blur border border-white/10 overflow-hidden flex flex-col text-white relative transition-shadow",B.value?"shadow-[0_0_0_2px_rgba(96,165,250,0.55)]":""]),style:ye({backgroundColor:`rgba(0,0,0,${Math.min(.85,Math.max(.15,ke.widget.opacity??.35))})`,color:"#fff"}),onDrop:at,onDragenter:ct,onDragover:dt,onDragleave:ut},[B.value?(n(),l("div",Ot,[...t[20]||(t[20]=[i("div",{class:"w-[92%] h-[92%] rounded-2xl border-2 border-dashed border-blue-300/70 bg-blue-500/10 backdrop-blur-sm flex items-center justify-center"},[i("div",{class:"text-sm font-bold text-white/90"},"æ¾å¼€é¼ æ ‡å³å¯ä¸Šä¼ ")],-1)])])):c("",!0),i("input",{ref_key:"fileInputRef",ref:Ce,type:"file",multiple:"",class:"hidden",onChange:rt},null,544),L.value?c("",!0):(n(),l("div",Rt,[t[21]||(t[21]=i("div",{class:"flex flex-wrap items-baseline gap-x-2 gap-y-0.5 leading-tight"},[i("div",{class:"text-sm font-bold text-white"},"æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹"),i("div",{class:"text-[11px] text-white/70"},"æ”¯æŒæ‹–æ‹½ã€å¤šé€‰ã€æ–­ç‚¹ç»­ä¼ ")],-1)),i("div",Ut,[i("div",zt,[i("button",{onClick:t[0]||(t[0]=o=>g.value="chat"),class:k(["px-2.5 py-1 text-xs rounded-lg font-medium",_(g)==="chat"?"bg-white/20 text-white shadow-sm":"text-white/70"])}," èŠå¤© ",2),i("button",{onClick:t[1]||(t[1]=o=>g.value="files"),class:k(["px-2.5 py-1 text-xs rounded-lg font-medium",_(g)==="files"?"bg-white/20 text-white shadow-sm":"text-white/70"])}," æ–‡ä»¶ ",2),i("button",{onClick:t[2]||(t[2]=o=>g.value="photos"),class:k(["px-2.5 py-1 text-xs rounded-lg font-medium",_(g)==="photos"?"bg-white/20 text-white shadow-sm":"text-white/70"])}," å›¾ç‰‡ ",2)]),i("div",Bt,[i("button",{class:k(["px-3 py-1.5 text-xs font-bold rounded-lg transition-colors",_(u).isLogged?"bg-blue-500 text-white hover:bg-blue-600":"bg-white/10 text-white/40 cursor-not-allowed"]),disabled:!_(u).isLogged,onClick:$e}," æ·»åŠ æ–‡ä»¶ ",10,Nt),_(g)==="files"&&O.value>0?(n(),l("button",{key:0,class:"px-3 py-1.5 text-xs font-bold rounded-lg bg-red-500/20 text-red-100 hover:bg-red-500/30",onClick:Ye}," åˆ é™¤é€‰ä¸­ ("+v(O.value)+") ",1)):c("",!0)])])])),P.value.length?(n(),l("div",At,[(n(!0),l(S,null,W(P.value,o=>(n(),l("div",{key:o.id,class:"rounded-xl border border-white/10 bg-white/5 px-3 py-2 flex items-center gap-3"},[i("div",Ft,[i("div",Ht,[i("div",Yt,v(o.file.name),1),i("div",Wt,v(Z(o.file.size)),1)]),i("div",Xt,[i("div",{class:"h-full bg-blue-500 rounded-full transition-[width]",style:ye({width:`${Math.round((o.progress||0)*100)}%`})},null,4)]),i("div",Kt,[i("div",Gt,[It(v(o.status==="uploading"?"ä¸Šä¼ ä¸­":o.status==="paused"?"å·²æš‚åœ":o.status==="failed"?"å¤±è´¥":o.status==="completed"?"å®Œæˆ":"ç­‰å¾…ä¸­")+" ",1),o.error?(n(),l("span",Jt,v(o.error),1)):c("",!0)]),i("div",Vt,[o.status==="uploading"?(n(),l("button",{key:0,class:"px-2 py-1 text-[11px] rounded-lg bg-white/10 text-white hover:bg-white/15",onClick:s=>he(o)}," æš‚åœ ",8,Qt)):c("",!0),o.status==="paused"||o.status==="failed"?(n(),l("button",{key:1,class:"px-2 py-1 text-[11px] rounded-lg bg-blue-500/20 text-blue-100 hover:bg-blue-500/30",onClick:s=>xt(o)}," ç»§ç»­ ",8,Zt)):c("",!0),i("button",{class:"px-2 py-1 text-[11px] rounded-lg bg-red-500/20 text-red-100 hover:bg-red-500/30",onClick:s=>wt(o)}," ç§»é™¤ ",8,qt)])])])]))),128))])):c("",!0),(n(),Je(Ve,{to:"body"},[N.value?(n(),l("div",{key:0,"data-transfer-context-menu":"",class:"fixed z-[10001] w-48 rounded-xl border border-white/10 bg-black/70 backdrop-blur shadow-xl overflow-hidden",style:ye({left:`${Te.value}px`,top:`${Se.value}px`}),onClick:t[12]||(t[12]=E(()=>{},["stop"])),onContextmenu:t[13]||(t[13]=E(()=>{},["prevent"]))},[w.value&&R(w.value)?.type==="text"?(n(),l("button",{key:0,class:"w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors text-white",onClick:t[3]||(t[3]=async()=>{const o=w.value,s=o?R(o):null;C(),s&&s.type==="text"&&await pt(s.content)})}," å¤åˆ¶ ")):c("",!0),i("button",{class:k(["w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors",_(u).isLogged?"text-white":"text-white/40 cursor-not-allowed"]),disabled:!_(u).isLogged,onClick:t[4]||(t[4]=()=>{C(),$e()})}," æ·»åŠ æ–‡ä»¶ ",10,eo),i("button",{class:"w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors text-white",onClick:t[5]||(t[5]=()=>{C(),vt()})},v(V.value?"é€€å‡ºå¤šé€‰":"å¤šé€‰"),1),i("button",{class:k(["w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors",O.value>0?"text-white":"text-white/40 cursor-not-allowed"]),disabled:O.value===0,onClick:t[6]||(t[6]=async()=>{C(),await Ye()})}," åˆ é™¤é€‰ä¸­ ("+v(O.value)+") ",11,to),i("button",{class:k(["w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors",O.value>0?"text-white":"text-white/40 cursor-not-allowed"]),disabled:O.value===0,onClick:t[7]||(t[7]=()=>{C(),Be()})}," æ¸…ç©ºé€‰æ‹© ",10,oo),w.value?(n(),l("div",so)):c("",!0),w.value?(n(),l("button",{key:2,class:"w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors text-white",onClick:t[8]||(t[8]=()=>{const o=w.value;C(),o&&Pe(o)})},v(w.value&&b.value[w.value]?"å–æ¶ˆé€‰æ‹©":"é€‰æ‹©"),1)):c("",!0),w.value?(n(),l("button",{key:3,class:"w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors text-white",onClick:t[9]||(t[9]=async()=>{const o=w.value;C(),o&&await re(o)})}," åˆ é™¤æ­¤æ¡ ")):c("",!0),w.value&&R(w.value)?.type==="file"?(n(),l("button",{key:4,class:"w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors text-white",onClick:t[10]||(t[10]=async()=>{const o=w.value,s=o?R(o):null;C(),s&&s.type==="file"&&ie(s)})}," é¢„è§ˆ ")):c("",!0),w.value&&R(w.value)?.type==="file"?(n(),l("button",{key:5,class:"w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors text-white",onClick:t[11]||(t[11]=async()=>{const o=w.value,s=o?R(o):null;C(),s&&s.type==="file"&&await pe(s)})}," ä¸‹è½½ ")):c("",!0)],36)):c("",!0)])),i("div",no,[_(u).isLogged?(n(),l("div",lo,[$.value?(n(),l("div",ro,v($.value),1)):c("",!0),ce.value?(n(),l("div",ao,"åŠ è½½ä¸­...")):(n(),l("div",{key:2,ref_key:"scrollContainerRef",ref:K,class:"flex-1 min-h-0 overflow-y-auto px-3 py-3 space-y-3 scrollbar-glass",onWheel:lt,onContextmenu:E(ft,["prevent","stop"])},[_(g)==="chat"?(n(),l(S,{key:0},[Le.value.length?(n(),l("div",uo,[(n(!0),l(S,null,W(Le.value,o=>(n(),l("div",{key:o.key,class:"space-y-1.5"},[i("div",fo,[i("div",ho,v(st(o.timestamp)),1)]),(n(!0),l(S,null,W(o.items,s=>(n(),l("div",{key:s.id,class:"flex"},[s.type==="text"?(n(),l("div",{key:0,class:k(["max-w-[90%] rounded-xl bg-white/10 text-white border border-white/10 transition-shadow select-text",[b.value[s.id]?"shadow-[0_0_0_2px_rgba(96,165,250,0.55)]":"",L.value?"px-2 py-1.5 text-xs":"px-3 py-2 text-sm"]]),"data-transfer-id":s.id,onClick:r=>Ee(s),onContextmenu:E(r=>q(r.clientX,r.clientY,s.id),["prevent","stop"]),onPointerdown:r=>Ue(r,s.id),onPointermove:ze,onPointerup:ne,onPointercancel:ne,onTouchstart:r=>Oe(r,s.id),onTouchmove:Re,onTouchend:se,onTouchcancel:se},[i("div",po,[(n(!0),l(S,null,W(nt(s.content),(r,a)=>(n(),l(S,{key:a},[r.kind==="link"?(n(),l("a",{key:0,href:r.href,target:"_blank",rel:"noopener noreferrer",class:"text-blue-200 underline underline-offset-2 hover:text-blue-100",onClick:t[14]||(t[14]=E(()=>{},["stop"]))},v(r.text),9,xo)):(n(),l("span",wo,v(r.text),1))],64))),128))])],42,vo)):(n(),l("button",{key:1,class:k(["max-w-[90%] text-left rounded-xl bg-white/10 hover:bg-white/15 transition-colors border border-white/10 transition-shadow select-none",[b.value[s.id]?"shadow-[0_0_0_2px_rgba(96,165,250,0.55)]":"",L.value?"px-2 py-1.5":"px-3 py-2"]]),"data-transfer-id":s.id,ref_for:!0,ref:r=>xe(r,s.id),style:{"-webkit-touch-callout":"none"},onClick:r=>Ee(s),onContextmenu:E(r=>q(r.clientX,r.clientY,s.id),["prevent","stop"]),onPointerdown:r=>Ue(r,s.id),onPointermove:ze,onPointerup:ne,onPointercancel:ne,onTouchstart:r=>Oe(r,s.id),onTouchmove:Re,onTouchend:se,onTouchcancel:se},[i("div",go,[i("div",mo,[String(s.file.type||"").startsWith("image/")&&f.value[s.id]?(n(),l("img",{key:0,src:f.value[s.id],class:"w-full h-full object-cover"},null,8,yo)):(n(),l("span",ko,v(String(s.file.type||"").startsWith("image/")?"ğŸ–¼ï¸":"ğŸ“„"),1))]),i("div",_o,[i("div",{class:k(["font-bold text-white truncate",L.value?"text-xs":"text-sm"])},v(s.file.name),3),i("div",Co,v(Z(s.file.size)),1)])])],42,bo))]))),128))]))),128))])):(n(),l("div",co,[...t[23]||(t[23]=[i("div",{class:"text-3xl mb-2"},"ğŸ’¬",-1),i("div",{class:"font-bold text-white"},"æŠŠæ–‡ä»¶å’Œæ–‡å­—å‘åˆ°è¿™é‡Œ",-1),i("div",{class:"text-xs text-white/60 mt-1"},"æ”¯æŒæ‹–æ‹½ä¸Šä¼ ï¼›æ”¯æŒå¤åˆ¶ç²˜è´´å›¾ç‰‡/æ–‡ä»¶",-1)])]))],64)):_(g)==="files"?(n(),l(S,{key:1},[p.value.length?(n(),l("div",So,[(n(!0),l(S,null,W(p.value,o=>(n(),l("div",{key:o.id,class:"rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 transition-colors px-3 py-2 flex items-center gap-3",ref_for:!0,ref:s=>xe(s,o.id)},[o.type==="file"?(n(),l("input",{key:0,type:"checkbox",class:"accent-blue-600",checked:!!b.value[o.id],onChange:s=>{b.value[o.id]=s.target.checked}},null,40,Lo)):c("",!0),i("div",Po,[o.type==="file"&&String(o.file.type||"").startsWith("image/")&&f.value[o.id]?(n(),l("img",{key:0,src:f.value[o.id],class:"w-full h-full object-cover"},null,8,Mo)):o.type==="file"&&String(o.file.type||"").startsWith("image/")?(n(),l("span",Io,"ğŸ–¼ï¸")):(n(),l("span",$o,"ğŸ“„"))]),i("div",jo,[i("div",Eo,v(o.type==="file"?o.file.name:""),1),i("div",Do,v(o.type==="file"?Z(o.file.size):"")+" Â· "+v(ot(o.timestamp)),1)]),i("div",Oo,[o.type==="file"?(n(),l("button",{key:0,class:"px-2 py-1 text-[11px] rounded-lg bg-white/10 text-white hover:bg-white/15",onClick:s=>ie(o)}," é¢„è§ˆ ",8,Ro)):c("",!0),o.type==="file"?(n(),l("button",{key:1,class:"px-2 py-1 text-[11px] rounded-lg bg-white/10 text-white hover:bg-white/15",onClick:async()=>{try{await pe(o)}catch(s){$.value=s.message||"ä¸‹è½½å¤±è´¥"}}}," ä¸‹è½½ ",8,Uo)):c("",!0),i("button",{class:"px-2 py-1 text-[11px] rounded-lg bg-red-500/20 text-red-100 hover:bg-red-500/30",onClick:s=>re(o.id)}," åˆ é™¤ ",8,zo)])]))),128))])):(n(),l("div",To,[...t[24]||(t[24]=[i("div",{class:"text-3xl mb-2"},"ğŸ“",-1),i("div",{class:"font-bold text-white"},"æš‚æ— æ–‡ä»¶",-1)])]))],64)):(n(),l(S,{key:2},[p.value.length?(n(),l("div",No,[(n(!0),l(S,null,W(p.value,o=>(n(),l("button",{key:o.id,class:"rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 overflow-hidden aspect-square flex items-center justify-center",onClick:s=>ie(o),ref_for:!0,ref:s=>xe(s,o.id)},[o.type==="file"&&f.value[o.id]?(n(),l("img",{key:0,src:f.value[o.id],class:"w-full h-full object-cover",alt:o.file.name},null,8,Fo)):(n(),l("div",Ho,"åŠ è½½ä¸­..."))],8,Ao))),128))])):(n(),l("div",Bo,[...t[25]||(t[25]=[i("div",{class:"text-3xl mb-2"},"ğŸ–¼ï¸",-1),i("div",{class:"font-bold text-white"},"æš‚æ— å›¾ç‰‡",-1)])]))],64))],544)),_(g)==="chat"?(n(),l("div",{key:3,class:k(["border-t border-white/10",L.value?"p-1":"p-3"])},[i("div",{class:k(L.value?"relative block":"flex items-end gap-2")},[$t(i("textarea",{ref_key:"composerRef",ref:_e,"onUpdate:modelValue":t[15]||(t[15]=o=>G.value=o),rows:"1",placeholder:L.value?"ç²˜è´´/æ‹–å…¥ (Shift+Enter)":"Shift+Enter æ¢è¡Œ",class:k(["resize-none rounded-xl border border-white/20 bg-white/10 outline-none text-white placeholder-white/50 focus:border-blue-400",L.value?"w-full pr-8 pl-2 py-1 text-xs scrollbar-hide":"flex-1 px-3 py-2 text-sm"]),onKeydown:t[16]||(t[16]=Et(E(o=>{if(o.shiftKey){G.value+=`
`;return}ve()},["prevent"]),["enter"]))},null,42,Yo),[[jt,G.value]]),L.value?(n(),l("button",{key:0,class:"absolute right-1 bottom-1 p-1 text-blue-400 hover:text-blue-300 transition-colors",onClick:ve},[...t[26]||(t[26]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[i("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),i("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})],-1)])])):(n(),l("button",{key:1,class:"px-3 py-2 text-xs font-bold rounded-xl bg-blue-500 text-white hover:bg-blue-600",onClick:ve}," å‘é€ "))],2)],2)):c("",!0)])):(n(),l("div",io,[...t[22]||(t[22]=[i("div",{class:"text-center px-6"},[i("div",{class:"text-3xl mb-2"},"ğŸ”’"),i("div",{class:"text-sm font-bold text-white"},"ç™»å½•åä½¿ç”¨æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹"),i("div",{class:"text-xs text-white/60 mt-1"}," æ•°æ®å°†æŒä¹…åŒ–å­˜å‚¨åœ¨æœåŠ¡ç«¯ `server/doc/transfer/` ")],-1)])]))]),(n(),Je(Ve,{to:"body"},[de.value&&x.value?(n(),l("div",{key:0,class:"fixed inset-0 z-[9999] bg-black/40 backdrop-blur-sm flex items-center justify-center p-4",onClick:le},[i("div",{class:"w-full max-w-3xl rounded-2xl bg-black/50 backdrop-blur border border-white/10 shadow-xl overflow-hidden text-white",onClick:t[19]||(t[19]=E(()=>{},["stop"]))},[i("div",Wo,[i("div",Xo,[i("div",Ko,v(x.value.type==="file"?x.value.file.name:"é¢„è§ˆ"),1),x.value.type==="file"?(n(),l("div",Go,v(Z(x.value.file.size))+" Â· "+v(x.value.file.type||"unknown"),1)):c("",!0)]),i("div",Jo,[x.value.type==="file"?(n(),l("button",{key:0,class:"px-3 py-1.5 text-xs font-bold rounded-lg bg-white/10 text-white hover:bg-white/15",onClick:t[17]||(t[17]=async()=>{try{await pe(x.value)}catch(o){$.value=o.message||"ä¸‹è½½å¤±è´¥"}})}," ä¸‹è½½ ")):c("",!0),i("button",{class:"px-3 py-1.5 text-xs font-bold rounded-lg bg-red-500/20 text-red-100 hover:bg-red-500/30",onClick:t[18]||(t[18]=async()=>{await re(x.value.id)})}," åˆ é™¤ "),i("button",{class:"px-3 py-1.5 text-xs font-bold rounded-lg bg-blue-500 text-white hover:bg-blue-600",onClick:le}," å…³é—­ ")])]),i("div",Vo,[x.value.type==="file"?(n(),l("div",Qo,[String(x.value.file.type||"").startsWith("image/")&&f.value[x.value.id]?(n(),l("img",{key:0,src:f.value[x.value.id],class:"max-h-[70vh] w-full object-contain rounded-xl bg-white/5 border border-white/10",alt:x.value.file.name},null,8,Zo)):(n(),l("div",qo," è¯¥æ–‡ä»¶ç±»å‹æš‚ä¸æ”¯æŒç›´æ¥é¢„è§ˆï¼Œè¯·ä½¿ç”¨â€œä¸‹è½½â€ã€‚ "))])):c("",!0)])])])):c("",!0)]))],38))}}),is=Dt(ss,[["__scopeId","data-v-192d0611"]]);export{is as default};
