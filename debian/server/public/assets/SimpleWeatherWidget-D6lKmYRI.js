import{d as X,r as w,w as Y,u as Z,c as _,y as tt,o as et,a as s,e as i,g as o,b as d,E as at,G as ot,F as m,h as x,q as C,p as f,t as c,i as it,f as q,l as st,m as lt,n as nt,T as rt,L as dt,_ as ct}from"./index-CEb9R0bB.js";const ut={class:"h-full w-full relative overflow-hidden text-white group select-none transition-all duration-500 rounded-2xl"},ht={key:0,class:"absolute -top-10 -right-10 w-48 h-48 opacity-30 animate-spin-slow"},vt={key:1,class:"absolute inset-0"},wt={key:2,class:"absolute inset-0 overflow-hidden"},ft={key:3,class:"absolute inset-0 flex justify-around items-start overflow-hidden opacity-50"},pt={key:4,class:"absolute inset-0 overflow-hidden"},yt={key:5,class:"absolute inset-0 overflow-hidden"},gt={class:"text-sm sm:text-base font-medium opacity-90 flex items-center gap-2"},bt={key:0,class:"mt-2 text-xs opacity-75 flex items-center gap-2"},mt={key:0,class:"w-full mt-2 pt-2 border-t border-white/10 space-y-2"},xt={class:"opacity-90"},kt={class:"flex items-center gap-2 opacity-80"},_t={key:0,class:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity z-20"},Ct={class:"bg-gray-900/90 p-6 rounded-2xl border border-white/10 shadow-2xl max-w-sm w-full backdrop-blur-xl"},Dt={class:"mb-6 w-full"},It={class:"flex items-center gap-2 mb-2 text-sm"},Mt={key:0,class:"text-white/30"},jt={key:1,class:"text-white font-bold"},$t={key:0,class:"grid grid-cols-4 gap-2 mb-4"},St=["onClick"],Kt={key:1,class:"grid grid-cols-4 gap-2 max-h-[200px] overflow-y-auto pr-1 custom-scrollbar"},Lt=["onClick"],zt={key:2,class:"h-[200px] flex items-center justify-center text-white/40 text-xs"},Bt={class:"flex gap-3 justify-end"},Et=X({__name:"SimpleWeatherWidget",props:{widget:{}},setup(D){const p=w(null),R=async()=>{if(!p.value)try{const e=await dt(()=>import("./cityData-DPPCip0y.js"),[]);p.value=e.cityData}catch(e){console.error("Failed to load city data",e)}},g=w(!1),y=w(""),u=w("");Y(g,e=>{e&&R()});const n=D,l=Z(),r=w({temp:"--",city:(()=>{if(n.widget?.data?.city)return n.widget.data.city;try{const e=localStorage.getItem("flatnas_auto_city");if(e)return JSON.parse(e).city}catch{}return"定位中..."})(),text:"...",humidity:"",today:{min:"",max:""},forecast:[]}),$=w(!1);let I=null;const T=w(Array.from({length:6},(e,t)=>({id:t+1,animationDelay:`${Math.random()}s`,opacity:Math.random()}))),P=w(Array.from({length:12},(e,t)=>({id:t+1,left:`${Math.random()*100}%`,top:"-10px",animationDelay:`${Math.random()*5}s`,animationDuration:`${3+Math.random()*4}s`})));n.widget?.data?.city&&(y.value=n.widget.data.city);const M=()=>{try{if(n.widget){n.widget.data||(n.widget.data={});const e=y.value.trim();n.widget.data.city=e,L()}}catch(e){console.error("Failed to save city",e)}finally{g.value=!1}},v=_(()=>{const e=r.value.text;return e.includes("雨")?"rain":e.includes("雪")?"snow":e.includes("雾")||e.includes("霾")?"fog":e.includes("云")||e.includes("阴")?"cloudy":e.includes("晴")?$.value?"clear-night":"sunny":"default"}),S=_(()=>["snow","cloudy","fog"].includes(v.value)),U=_(()=>{switch(v.value){case"sunny":return"bg-gradient-to-br from-blue-400 via-blue-300 to-orange-200";case"clear-night":return"bg-gradient-to-br from-indigo-900 via-purple-900 to-slate-900";case"cloudy":return"bg-gradient-to-br from-slate-400 via-slate-300 to-gray-200";case"rain":return"bg-gradient-to-br from-slate-700 via-blue-900 to-slate-800";case"snow":return"bg-gradient-to-br from-blue-100 via-white to-blue-50";case"fog":return"bg-gradient-to-br from-gray-500 via-slate-400 to-zinc-400";default:return"bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-500"}}),K=()=>{const e=new Date().getHours();$.value=e<6||e>=18},k=_(()=>n.widget&&n.widget.h&&n.widget.h>1&&r.value.forecast&&r.value.forecast.length>0),V=e=>{try{const t=new Date(e),a=["周日","周一","周二","周三","周四","周五","周六"],h=new Date;return t.getDate()===h.getDate()&&t.getMonth()===h.getMonth()?"今天":a[t.getDay()]}catch{return e}},L=async()=>{const e=n.widget?.data?.city||y.value||"Shanghai",t=b=>{(b.city===e||b.city==="Shanghai"&&!n.widget?.data?.city)&&(r.value=b.data,h())},a=async b=>{if(b.city===e){const z=l.appConfig.weatherSource||"wttr",O=l.appConfig.amapKey||"",G=l.appConfig.qweatherProjectId||"",J=l.appConfig.qweatherKeyId||"",Q=l.appConfig.qweatherPrivateKey||"";let B=`/api/weather?city=${encodeURIComponent(e)}&source=${z}&key=${encodeURIComponent(O)}`;z==="qweather"&&(B+=`&projectId=${encodeURIComponent(G)}&keyId=${encodeURIComponent(J)}&privateKey=${encodeURIComponent(Q)}`);try{const E=await fetch(B);if(!E.ok)throw new Error("REST weather failed");const j=await E.json();if(!j.success||!j.data)throw new Error("REST payload invalid");r.value=j.data}catch{r.value={temp:"22",city:n.widget?.data?.city||"本地",text:"舒适",humidity:"50%",today:{min:"18",max:"25"},forecast:[]}}finally{h()}}},h=()=>{l.socket.off("weather:data",t),l.socket.off("weather:error",a)};l.socket.on("weather:data",t),l.socket.on("weather:error",a);const F=l.appConfig.weatherSource||"wttr",W=l.appConfig.amapKey||"",N=l.appConfig.qweatherProjectId||"",H=l.appConfig.qweatherKeyId||"",A=l.appConfig.qweatherPrivateKey||"";l.socket.emit("weather:fetch",{city:e,source:F,key:W,projectId:N,keyId:H,privateKey:A})};return tt(()=>{K(),L(),I=setInterval(K,6e4)}),et(()=>{I&&clearInterval(I)}),(e,t)=>(i(),s("div",ut,[o("div",{class:f(["absolute inset-0 transition-colors duration-1000 ease-in-out",U.value]),style:C({opacity:D.widget?.opacity??1})},[v.value==="sunny"?(i(),s("div",ht,[...t[5]||(t[5]=[o("svg",{viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[o("circle",{cx:"50",cy:"50",r:"20",fill:"yellow"}),o("path",{d:"M50 10V20 M50 80V90 M10 50H20 M80 50H90 M22 22L29 29 M71 71L78 78 M22 78L29 71 M71 29L78 22",stroke:"yellow","stroke-width":"4","stroke-linecap":"round"})],-1)])])):d("",!0),v.value==="clear-night"?(i(),s("div",vt,[...t[6]||(t[6]=[ot('<div class="absolute top-10 right-10 w-16 h-16 text-yellow-100 opacity-80 animate-pulse" data-v-3ecf8f1a><svg viewBox="0 0 24 24" fill="currentColor" data-v-3ecf8f1a><path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z" data-v-3ecf8f1a></path></svg></div><div class="star absolute top-1/4 left-1/4 w-1 h-1 bg-white rounded-full animate-twinkle" data-v-3ecf8f1a></div><div class="star absolute top-3/4 right-1/3 w-1 h-1 bg-white rounded-full animate-twinkle delay-75" data-v-3ecf8f1a></div><div class="star absolute bottom-1/4 left-1/3 w-1 h-1 bg-white rounded-full animate-twinkle delay-150" data-v-3ecf8f1a></div>',4)])])):d("",!0),v.value==="cloudy"?(i(),s("div",wt,[...t[7]||(t[7]=[o("div",{class:"absolute top-4 right-[-20%] w-32 h-20 opacity-40 animate-float-slow"},[o("svg",{viewBox:"0 0 24 24",fill:"currentColor",class:"text-white"},[o("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"})])],-1)])])):d("",!0),v.value==="rain"?(i(),s("div",ft,[(i(!0),s(m,null,x(T.value,a=>(i(),s("div",{key:a.id,class:"w-0.5 h-16 bg-gradient-to-b from-transparent to-white animate-rain",style:C({animationDelay:a.animationDelay,opacity:a.opacity})},null,4))),128))])):d("",!0),v.value==="snow"?(i(),s("div",pt,[(i(!0),s(m,null,x(P.value,a=>(i(),s("div",{key:a.id,class:"absolute w-1.5 h-1.5 bg-white rounded-full animate-snow opacity-80",style:C({left:a.left,top:a.top,animationDelay:a.animationDelay,animationDuration:a.animationDuration})},null,4))),128))])):d("",!0),v.value==="fog"?(i(),s("div",yt,[...t[8]||(t[8]=[o("div",{class:"absolute bottom-0 left-[-50%] w-[200%] h-[60%] bg-white/20 blur-[40px] animate-fog-flow"},null,-1),o("div",{class:"absolute bottom-[-20%] left-[-20%] w-[150%] h-[50%] bg-white/10 blur-[30px] animate-fog-flow-reverse"},null,-1)])])):d("",!0)],6),o("div",{class:f(["absolute inset-0 backdrop-blur-[0px] group-hover:backdrop-blur-[2px] transition-all duration-500",S.value?"bg-black/30":"bg-black/5"]),style:C({opacity:D.widget?.opacity??1})},null,6),o("div",{class:f(["relative z-10 h-full flex flex-col items-center p-4 transition-all",k.value?"justify-between":"justify-center"])},[o("div",{class:f(["flex flex-col items-center justify-center",{"flex-1":k.value}])},[o("div",{class:f(["text-4xl sm:text-5xl font-bold tracking-tighter mb-2",S.value?"drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]":"drop-shadow-lg"])},c(r.value.temp)+"° ",3),o("div",gt,[o("span",null,c(r.value.text),1),t[9]||(t[9]=o("span",{class:"w-1 h-1 rounded-full bg-white/50"},null,-1)),o("span",null,c(r.value.city),1)]),r.value.today&&r.value.today.min&&!k.value?(i(),s("div",bt,[o("span",null,c(r.value.today.min)+"° / "+c(r.value.today.max)+"°",1)])):d("",!0)],2),k.value?(i(),s("div",mt,[(i(!0),s(m,null,x(r.value.forecast.slice(0,3),(a,h)=>(i(),s("div",{key:h,class:"flex items-center justify-between text-xs font-medium"},[o("span",xt,c(V(a.date)),1),o("div",kt,[o("span",null,c(a.mintempC)+"° / "+c(a.maxtempC)+"°",1)])]))),128))])):d("",!0)],2),n.widget&&it(l).isLogged?(i(),s("div",_t,[o("button",{onClick:t[0]||(t[0]=q(a=>g.value=!0,["stop"])),class:"p-1.5 bg-black/10 text-white/70 hover:text-white rounded-full hover:bg-black/30 backdrop-blur-md transition-colors",title:"设置城市"},[...t[10]||(t[10]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})],-1)])])])):d("",!0),(i(),at(rt,{to:"body"},[g.value?(i(),s("div",{key:0,class:"fixed inset-0 bg-black/60 backdrop-blur-md z-[9999] flex flex-col items-center justify-center p-4",onClick:t[4]||(t[4]=q(()=>{},["stop"]))},[o("div",Ct,[t[11]||(t[11]=o("div",{class:"text-lg font-medium mb-4 text-white"},"设置城市",-1)),st(o("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>y.value=a),onKeyup:nt(M,["enter"]),placeholder:"输入城市 (为空自动)",class:"w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/40 text-left outline-none focus:bg-white/20 focus:border-white/40 mb-4 transition-all",autofocus:""},null,544),[[lt,y.value]]),o("div",Dt,[o("div",It,[o("button",{onClick:t[2]||(t[2]=a=>u.value=""),class:f(["text-white/50 hover:text-white transition-colors",{"font-bold text-white":!u.value}])}," 省份/地区 ",2),u.value?(i(),s("span",Mt,"/")):d("",!0),u.value?(i(),s("span",jt,c(u.value),1)):d("",!0)]),u.value?p.value&&p.value[u.value]?(i(),s("div",Kt,[(i(!0),s(m,null,x(p.value[u.value],a=>(i(),s("button",{key:a,onClick:h=>{y.value=a,M()},class:f(["px-2 py-1.5 bg-white/5 hover:bg-white/20 text-white/70 hover:text-white rounded text-xs transition-colors truncate border border-white/5 hover:border-white/20",{"bg-blue-500 text-white":y.value===a}])},c(a),11,Lt))),128))])):(i(),s("div",zt," 加载中... ")):(i(),s("div",$t,[(i(!0),s(m,null,x(p.value?Object.keys(p.value):[],a=>(i(),s("button",{key:a,onClick:h=>u.value=a,class:f(["px-2 py-1.5 text-xs rounded transition-colors text-center truncate border",u.value===a?"bg-blue-500 border-blue-500 text-white shadow-md":"bg-white/5 border-white/10 text-white/70 hover:bg-white/10 hover:border-white/20"])},c(a),11,St))),128))]))]),o("div",Bt,[o("button",{onClick:t[3]||(t[3]=a=>g.value=!1),class:"px-4 py-2 bg-white/5 hover:bg-white/10 text-white/80 rounded-lg text-sm transition-colors"}," 取消 "),o("button",{onClick:M,class:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-sm transition-colors font-medium shadow-lg shadow-blue-900/20"}," 确定 ")])])])):d("",!0)]))]))}}),Tt=ct(Et,[["__scopeId","data-v-3ecf8f1a"]]);export{Tt as default};
